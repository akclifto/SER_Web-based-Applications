(function(){var v,st;try{(function(){var n={L_Directions_Arrive_By:"Arrive by",L_Directions_Arrive_Time:"Arrive by {0}",L_Directions_Last_Train:"Last train",L_Directions_Depart_At:"Leave at",L_Directions_Depart_Time:"Leave at {0}",L_Directions_Highways:"Avoid highways",L_Directions_Save_History:"Save destination history",L_Directions_Delete_History:"delete destination history",L_Directions_History_Deleted:"Previous history deleted.",L_Directions_Options:"Options",L_Directions_Option_Miles:"Miles",L_Directions_Option_Km:"Kilometers",L_Option_Sort_By:"Sort by:",L_Option_Sort_By_Time:"Time",L_Option_Sort_By_Cost:"Price",L_Option_Sort_By_Transfers:"Number of transfers",L_Option_Transit_Mode:"Transit Mode:",L_Option_Avoid_Flights:"Avoid flights",L_Option_Avoid_Express_Trains:"Avoid express trains",L_Option_Use_Bullet_Trains:"Use bullet trains",L_Option_Avoid_Bullet_Trains:"Avoid bullet trains",L_Transit_Mode_Bus:"Bus",L_Transit_Mode_Subway:"Subway",L_Transit_Mode_Train:"Train",L_Transit_Mode_CityRail:"Tram/Light rail",L_Transit_Mode_Ferry:"Ferry",L_Directions_Round_Trip:"Roundtrip",L_Directions_Title_Drive:"Driving",L_Directions_Title_Transit:"Transit",L_Directions_Title_Walk:"Walking",L_Directions_Title_MultiMode:"Recommended",L_Directions_Tolls:"Avoid tolls",L_Directions_AvoidFerry:"Avoid ferries",L_DirectionsTaskTitle_Text:"Directions",L_Directions_Today:"Today",L_Directions_MyLocation:"My location",L_Directions_Home:"Home",L_Directions_Work:"Work",L_Directions_Error_Waypoints:"To find a route, please tell us where you're starting from and where you're going.",L_Directions_Error_No_Results:"We can't find directions between one or more waypoints. Check your waypoints and route options and try again.",DirectionsServerError:"We are having trouble providing directions for this journey.  Please check your waypoints and route options or try again later",L_Directions_Error_Equal_Waypoints:"Your starting and ending locations are the same.",DirectionsErrorCannotFindRoad:"We can't find directions for this journey because one or more waypoints are too far from any known roads. Please check your waypoints and route options or try again later.",DirectionsErrorSourceNotFound:"We can't find directions for this journey because one or more waypoints are in a region of the world where we do not have routing data.",DirectionsErrorNoTransitTrip:"We can't find transit directions for the specified date or times.",DirectionsErrorNoNearbyStops:"There are no stops near one or more of your waypoints.",DirectionsErrorNoSolution:"We can't find directions for this journey. Check your waypoints and route options and try again.",DirectionsErrorOutOfBoundsForTransit:"We can't find transit directions for this journey because one or more waypoints is in a region of the world where we do not offer transit routing.",DirectionsErrorTimeout:"This routing request is taking too long",DirectionsErrorTooFar:"The distance between one or more waypoints is too long to calculate directions. Try getting directions for shorter distances.",DirectionsErrorStopsTooClose:"The transit stops you've chosen are too close together. Try different stops, or consider walking directions.",DirectionsErrorWalkBestAlternative:"Walking directions may be a better option for this route.",L_Directions_Error_User_Location_Not_Found:"Your location is not available. This may occur if your browser or computer settings prevent websites or applications from using your location. You can still get directions by proving a start and end location.",L_Directions_Time_Control_Tip:"Select when to leave or arrive.",L_Directions_Leave_Now:"Leave now",L_Directions_Title_Add:"Add destination",L_Directions_Title_Delete:"Remove",L_Directions_Duration:"{0} hr {1} min",L_Directions_Results_Title:"Via {0}",L_Directions_Results_Description_Time:"{0} without traffic",L_Directions_Results_Delay_Time:"{0} delay",L_Directions_Results_Title_Time_With_Traffic:"{0} with traffic",L_Directions_Title_Reverse:"Reverse",L_Directions_Title_Start:"From",L_Directions_Title_Destination:"To",L_Directions_Leg_To:"to ",L_Directions_Loading:"Directions loading... ",L_Data_Special_Attribution:"Buy Tickets From:",L_Data_Attribution:"Data From:",L_Report_Problem_Link:"Report a problem",L_TransitDisclaimer_Text:"These directions are subject to the Microsoft® Service Agreement and are for informational purposes only. No guarantee is made regarding their completeness or accuracy. Contains public sector information licensed under the Open Government License v.1.0.",L_DirectionsDisclaimer_TomTom_Text:"These directions are subject to the {0} and are for informational purposes only. No guarantee is made regarding their completeness or accuracy. Construction projects, traffic, or other events may cause actual conditions to differ from these results. Map and traffic data © {year} TomTom.",L_TransitDisclaimer_Text_Japan:"免責事項: Bing では、各パートナーより情報の提供を受けてサービスを提供しています。Bing 及び各パートナーは正確な情報の提供に努めていますが、本情報を利用してご利用者に生じた問題や損害に関しては責任を負いかねます。(ご注意) JR 線の時刻は Bing が自らの責任により加工していますが、変更となる場合があります。各路線の最新情報に関しては、ご利用者ご自身で再確認いただくことをおすすめします。弘承 平成２５年１２４号 JR データの内容は、株式会社交通新聞社発行の「ＪＲ時刻表」に基づいています。この時刻データを無断転載・複写や電磁媒体等に加工することを禁じます。路線検索 © 株式会社ヴァル研究所",L_DirectionsDisclaimer_Text_Japan:"提示される経路は Microsoft® サービス規約 に準拠しており、情報提供のみを目的としています。経路の完全性または正確性は一切保証されていません。工事、交通状況、その他の要因により、実際の状況は検索結果と異なる場合があります。地図データ © 2015 ZENRIN™。",L_TermsOfUse_Text:"Microsoft® Service Agreement",L_Directions_Duration_Min:"{0} min",L_Directions_Duration_Less_One_Min:"1 min",L_Directions_Go:"Go",L_Directions_Cost:"¥{0}‎",L_Directions_NoTolls:"Your route will avoid tolls.",L_Directions_NoFerry:"Your route will avoid ferries.",L_Directions_NoHighways:"Your route will avoid highways.",L_Directions_NoTollsOrHighways:"Your route will avoid tolls and highways.",L_Directions_NoTollsOrFerry:"Your route will avoid tolls and ferries.",L_Directions_NoHighwaysOrFerry:"Your route will avoid highways and ferries.",L_Directions_NoTollsHighwaysOrFerry:"Your route will avoid tolls, highways and ferries.",L_Directions_Process_Title_Text_Line:"{0} to {1}",L_Directions_Title_Reorder:"Drag to reorder",L_Directions_Waypoint_Text_From_Name_Address:"{0}, {1}",L_Directions_WalkDistance:"{0}, about {1}",L_Directions_Print:"Print",L_Directions_PrintSelected:"Print selected route",L_Directions_PrintNotesWatermark:"Type your route notes here",L_Directions_Error_Search_Fail:"We can't find directions for this journey because one or more waypoints were not found. Please check your waypoints and route options or try again later.",L_Directions_Via_Text:"via {0}",L_Directions_Via_Remove_Link:"Remove",L_Directions_Drag_Pin_Tip:"Drag to modify your route",L_Directions_Turn_Preview_Tip:"Click to preview your turn",L_Directions_Airline:"Airline",L_Directions_Bus:"Bus",L_Directions_Ferry:"Ferry",L_Directions_Train:"Train",L_Directions_Transit_Via1:"Via {0}: {1}",L_Directions_Transit_Via2:", {0}: {1}",L_Directions_Tube:"Tube",L_Directions_Categories_Bar_Entity_Coffee:"Coffee",L_Directions_Categories_Bar_Entity_GasStations:"Gas stations",L_Directions_Categories_Bar_Entity_GroceryStores:"Grocery stores",L_Directions_Categories_Bar_Entity_Hotels:"Hotels",L_Directions_Categories_Bar_Entity_Restaurants:"Restaurants",L_Directions_Categories_Bar_Entity_FastFood:"Fast food",L_Directions_Categories_Bar_Entity_Attractions:"Attractions",L_Directions_Categories_Bar_Entity_Custom:"More ...",L_Directions_Categories_Bar_Entity_More:"More",L_Directions_Hour_Min_Separator:":",L_Directions_Hour:"hr",L_Directions_Minute:"min",L_Directions_Light_Traffic:"Light traffic",L_Directions_Moderate_Traffic:"Moderate traffic",L_Directions_Heavy_Traffic:"Heavy traffic",L_Directions_Leg_Title:"from {from} to {to}",L_Directions_Leg_Title_To:"{from} to {to}",L_Directions_Leg_TimeDist_Text:"{time} ({distance})",L_Directions_Leg_TimeOnly_Text:"{time}",L_Nearby_Parking:"See nearby parking",L_Print_InstructionIndexSeparator:".",L_Directions_See_All_Routes:"see all routes",L_Directions_Back_Button:"return to route",L_Directions_Edit_Directions:"edit directions",L_Directions_See_All_Routes_Comment:"Choose the route you would like to reach your destination.",L_Directions_See_All_Routes_Title:"Routes - ",L_Menu_ReportProblem_Link_Text:"Report a Problem",L_Directions_TimeDistance_Separator:", ",L_Directions_Add_From:"From {0}",L_Directions_Add_To:"To {0}",L_InexactMatch:"An exact match was not found. Use {0} or change the search term.",L_Close:"Close",L_DirectionsTaskDistanceTitle_Text:"Distance",L_Directions_Interpunct:"·",L_Directions_RouteInfo_Ferry:"Takes ferry",L_Directions_RouteInfo_TollRoad:"Toll on route",L_Directions_RouteInfo_LocalRoads:"Local roads",L_Directions_RouteInfo_CrossBorder:"Crosses border",L_Directions_RouteInfo_Unpaved:"Unpaved roads",DirectionRouteSummaryAriaLabelDrive:"{mode} route is {distance} {via}, it will take {duration}. {traffic}. {embellishment}",DirectionRouteSummaryAriaLabelTransit:"Transit route at {routeTimes}, {via} will take {duration}. {embellishment}. {frequency}",DirectionSpecialAttributionAriaLabel:"Agency Attribution Link",L_Transit_Frequency_Text:"Every {0} min",L_Transit_Late:"{0} min late",L_Transit_Early:"{0} min early",Directions_Camera_Tip:"View camera at:",L_Directions_InstructionDetailsLess:"Less Details",L_Directions_InstructionDetailsMore:"More Details",L_Transit_MoreTransit:" +{0} more ",L_Transit_RunningOnTime:"Running on time",L_Directions_CrossBorder:"Avoid crossing country border",CategoriesBar_Food:"Food",L_DistanceUnitKm_Text:"km",L_DistanceUnitMeters_Text:"m",L_DistanceUnitFeetShort_Text:"ft",L_DistanceUnitMilesShortText_Text:"mi",L_DistanceUnitMilesLongText_Text:"miles",L_Distance_Format:"{0} {1}",L_LatLon_Format:"{0}, {1}",L_Directions_TransitImpactedDueToCOVID19:"Public transit services may be impacted by COVID-19. Officials recommend limiting public transit use.",L_Directions_COVID19:"COVID-19",L_Get_Return_Directions:"Get return directions"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("DirectionsTask",n):window.$MicrosoftMaps8.ResourcesObject=n})();var r=window.$MicrosoftMaps8,e=r.Internal,ru=r.Calendar=r.Calendar||{},te=r.Tasks=r.Tasks||{},b=r.Directions=r.Directions||{},ht=e.TaskData=e.TaskData||{},uu=r.Transit=r.Transit||{},bt=r.Traffic=r.Traffic||{},ie=e.AdsScenario,kt=r.Anchor,rr=e.BaseTask,dt=e._BaseMapTemplateSelector,ft=e.BaseTaskViewModel,re=r.BasicTemplate,fu=r.BitmapImageTemplate,ci=r.VectorImageTemplate,ue=e._BoundsAccumulator,eu=e._CanvasLabelRenderer,ou=r.CategoriesBar,g=r.CategoriesBarItemData,su=r.ChildVectorImageTemplate,fe=ht.CollectionActions,li=e.ControlTemplate,l=r.DataHandlerKeys,hu=e._Debug,ee=e.DefaultPrimitiveCriteria,t=r.GlobalConfig.features.directions,ii=e._EntryPoints,oe=r.GlobalConfig.features.feedback,o=e._Gimme,se=e.GeolocationProvider,nt=r.GlobalConfig,a=r.GlobalDataEventHandler,he=r.ImageFromCssHelper,u=e._Helper,s=e._JSEvent,ce=e._LatLonCrs,ur=r.LocationRect,cu=e._LruCache,k=r.Location,le=r.MapLayer,ai=e.MapInteractionBehavior,it=e.MapHelper,ae=r.MapView,fr=r.MapMath,lu=r.MapTypeId,er=e._Network,or=e._ObservableObject,vi=e._ObservableCollection,ve=e._ObservableObjectChangedArgs,sr=e._Overlay,ye=e._OverlayEntity,pe=nt.features.parking,p=r.Point,et=r.GlobalConfig.features.print,au=e.PrintContent,hr=e.PrintManager,h=e.PushpinIconType,vu=e._PerfV2Logger,we=e.ReverseGeocoder,i=r.ResourceManager.DirectionsTask,cr=e.RoutePolyline,ri=e.RoutePushpin,be=e.SpatialMath,ke=e.StaticPromise,yu=e._StreetsidePerfConstants,de=ru.SingleCalendar,pu=r.SimplePointPrimitive,wu=r.Size,ge=r.CommonControls.SyndicatedAds,y=r.TaskTypes,no=e.Template,lr=r.VectorMapLayer,tt=ht.Waypoint,ct=ht.DistanceUnit,rt=ht.Optimize,d=ht.TimeTypes,n=ht.DirectionsMode,ar=r.ZoomLevel,to=e.TipComponents,bu=r.CommonControls.AutosuggestV2,ku=r.CommonControls.MobileAutosuggestV2,ot=r.CommonControls.DirectionsAutosuggestDataModel,du=r.CommonControls.AutosuggestViewModel,ui=r.CommonControls.SearchHistoryLocalStorageHelper,vr=r.GlobalConfig.features.autosuggest,fi=nt.features.streetside,gu=r.TaskPrimitivesZOrderManager,nf=uu.TransitRequester,ei=r.PrimitiveOverlayHelper,tf=e._MapAuthentication,lt=e._VectorMath,gt=bt.TrafficPinV2,io=bt.CameraOverlayEntity,rf=r.BucketPrimitiveTemplateSelector,uf=bt.IncidentViewModel,yi=bt.TrafficIncidentPopup,yr=bt.TrafficLocalStorageHelper,ro=nt.features.traffic,ff='<div class="infoboxOverlay trafficMiniInfobox">    <p>        <TextBlock Text="{Binding primitive.resources.L_Traffic_Camera_Tip}" />    <\/p>    <p>        <TextBlock Text="{Binding primitive.entity.trafficDescription}" />    <\/p><\/div>',ef='<div class="{Binding panelClass}" data-tag="directionsPanel">    <div class="longDistancePanel" style:display="{Binding longDistanceText Converter=nullToDisplayNone}">        <h4>            <a href="#" data-process="{Binding taskOptionFrom}"><TextBlock Text="{Binding longDistanceFrom}" /><\/a>            <TextBlock Text="{Binding longDistanceSeparator}" />            <a href="#" data-process="{Binding taskOptionTo}"><TextBlock Text="{Binding longDistanceTo}" /><\/a>        <\/h4>        <p>            <TextBlock Text="{Binding longDistanceText}" />        <\/p>    <\/div>    <div class="directionsInput" data-tag="directionsInput" style:display="{Binding showWaypoints Converter=boolToDisplay}">\t\t<div class="{Binding optionsClass}">\t\t\t<div class="dirTopRow">\t\t\t\t<div>\t\t\t\t\t<div class="dirModes" data-tag="dirModes">\t\t\t\t\t\t<ItemsControl ItemsSource="{Binding modes}">\t\t\t\t\t\t\t<ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t<DataTemplate>\t\t\t\t\t\t\t\t\t<a title="{Binding tooltip}" role="button" class="{Binding btnClass}" event:click="onModeClick" href="#" mode="{Binding mode}" aria-pressed="{Binding ariaPressed}" aria-selected="{Binding ariaSelected}" aria-disabled="{Binding ariaDisabled}"><\/a>\t\t\t\t\t\t\t\t<\/DataTemplate>\t\t\t\t\t\t\t<\/ItemsControl.ItemTemplate>\t\t\t\t\t\t<\/ItemsControl>\t\t\t\t\t<\/div>\t\t\t\t\t<div>\t\t\t\t\t\t<a class="dirBtnOptions dropdownBtn" id="dirBtnOptions" href="#" event:click="onOptionsClick" data-tag="dirBtnOptions" role="button" aria-expanded="false" aria-controls="dirOptsPopup">\t\t\t\t\t\t\t<TextBlock Text="{Binding resources.L_Directions_Options}" />\t\t\t\t\t\t<\/a>\t\t\t\t\t\t<div class="dirOptsSummary" data-tag="dirOptsSummary" style:display="{Binding optionsText Converter=nullToDisplayNone}">\t\t\t\t\t\t\t<a event:click="onOptionsClick" id="dirOptsSummaryBtn" role="button" aria-expanded="false" aria-controls="dirOptsPopup"><TextBlock Text="{Binding optionsText}"/><\/a>\t\t\t\t\t\t<\/div>\t\t\t\t\t<\/div>\t\t\t\t<\/div>\t\t\t<\/div>\t\t\t<div class="dirOptsPopup dropdownPopup" id="dirOptsPopup" data-tag="dirOptsPopup">\t\t\t\t<div class="dirOptsUnits" data-tag="dirOptsUnits" role="radiogroup">                    <p>                        <input type="radio" class="radio" name="distanceUnits" checked="{Binding unitsMiles Mode=TwoWay}" data-tag="dirOptsUnitsMiles" role="radio" aria-checked="{Binding unitsMiles}" aria-labelledby="{Binding milesUniqueId}" />                        <label id="{Binding milesUniqueId}">                            <TextBlock Text="{Binding resources.L_Directions_Option_Miles}" />                        <\/label>                        <input type="radio" class="radio" name="distanceUnits" checked="{Binding unitsKm Mode=TwoWay}" data-tag="dirOptsUnitsKm" role="radio" aria-checked="{Binding unitsKm}" aria-labelledby="{Binding kmsUniqueId}"/>                        <label id="{Binding kmsUniqueId}">                            <TextBlock Text="{Binding resources.L_Directions_Option_Km}" />                        <\/label>                    <\/p>\t\t\t\t<\/div>                <div class="dirOptsSortBy" style:display="{Binding mode Converter=displaySortByOptions}" data-tag="dirOptsSortBy" role="radiogroup" aria-labelledby="dirSortById">                    <p id="dirSortById">                        <TextBlock Text="{Binding resources.L_Option_Sort_By}" />                    <\/p>                    <p>                        <label style:display="{Binding showOptimizeTime Converter=boolToDisplay}">                            <input type="radio" class="radio" checked="{Binding optimizeTime Mode=TwoWay}" name="dirOptsSortBy" data-tag="dirOptsSortByTime" role="radio" aria-checked="{Binding optimizeTime}" />                            <TextBlock Text="{Binding resources.L_Option_Sort_By_Time}" />                        <\/label>                        <label style:display="{Binding showOptimizeCost Converter=boolToDisplay}">                            <input type="radio" class="radio" checked="{Binding optimizeCost Mode=TwoWay}" name="dirOptsSortBy" data-tag="dirOptsSortByCost" role="radio" aria-checked="{Binding optimizeCost}" />                            <TextBlock Text="{Binding resources.L_Option_Sort_By_Cost}" />                        <\/label>                        <label style:display="{Binding showOptimizeTransfers Converter=boolToDisplay}">                            <input type="radio" class="radio" checked="{Binding optimizeTransfers Mode=TwoWay}" name="dirOptsSortBy" data-tag="dirOptsSortByTransfers" role="radio" aria-checked="{Binding optimizeTransfers}" />                            <TextBlock Text="{Binding resources.L_Option_Sort_By_Transfers}" />                        <\/label>                    <\/p>                <\/div>                <div class="dirOptsDriving" style:display="{Binding mode Converter=displayIfDriving}" data-tag="dirOptsDriving">                    <table role="presentation">                        <tbody>                            <tr class="panelRowSpace">                                <td>                                    <CheckBox Content="{Binding resources.L_Directions_Highways}" Checked="{Binding avoidHighways Mode=TwoWay}" Value="" data-tag="dirOptsDrivingHighways" role="checkbox" aria-checked="{Binding avoidHighways}" />                                                                    <\/td>                                <td>                                    <CheckBox Content="{Binding resources.L_Directions_AvoidFerry}" Checked="{Binding avoidFerry Mode=TwoWay}" Value="" data-tag="dirOptsDrivingFerry" role="checkbox" aria-checked="{Binding avoidFerry}" />                                <\/td>                            <\/tr>                            <tr>                                <td>                                    <CheckBox Content="{Binding resources.L_Directions_Tolls}" Checked="{Binding avoidTolls Mode=TwoWay}" Value="" data-tag="dirOptsDrivingTolls" role="checkbox" aria-checked="{Binding avoidTolls}" />                                <\/td>                                <td style:display="{Binding showAvoidBorders Converter=boolToDisplay}">                                    <CheckBox Content="{Binding resources.L_Directions_CrossBorder}"  Checked="{Binding avoidBorder Mode=TwoWay}" Value="" data-tag="dirOptsDrivingBorder" role="checkbox" aria-checked="{Binding avoidBorder}" />                                <\/td>                            <\/tr>                        <\/tbody>                    <\/table>                <\/div>                <div class="dirOptsTransit" style:display="{Binding mode Converter=displaySpecialTransitModeFilter}" data-tag="dirOptsTransit">                    <p style:display="{Binding mode Converter=boolToDisplay}">                        <TextBlock Text="{Binding resources.L_Option_Transit_Mode}" />                    <\/p>                    <p>                        <CheckBox Content="{Binding resources.L_Option_Avoid_Flights}" Checked="{Binding avoidFlights Mode=TwoWay}" Value="" data-tag="dirOptsAvoidFlights" role="checkbox" aria-checked="{Binding avoidFlights}" />                    <\/p>                    <p>                        <CheckBox Content="{Binding resources.L_Option_Avoid_Express_Trains}" Checked="{Binding avoidExpressTrains Mode=TwoWay}" Value="" data-tag="dirOptsAvoidExpressTrains" role="checkbox" aria-checked="{Binding avoidExpressTrains}" />                    <\/p>                    <p class="dirOptsBulletTrains">                        <label>                            <input type="radio" class="radio" checked="{Binding useBulletTrains Mode=TwoWay}" name="dirOptsBulletTrains" data-tag="dirOptsUseBulletTrains" role="checkbox" aria-checked="{Binding useBulletTrains}" />                            <TextBlock Text="{Binding resources.L_Option_Use_Bullet_Trains}" />                        <\/label>                    <\/p>                    <p class="dirOptsBulletTrains">                        <label>                            <input type="radio" class="radio" checked="{Binding avoidBulletTrains Mode=TwoWay}" name="dirOptsBulletTrains" data-tag="dirOptsAvoidBulletTrains" role="checkbox" aria-checked="{Binding avoidBulletTrains}"/>                            <TextBlock Text="{Binding resources.L_Option_Avoid_Bullet_Trains}" />                        <\/label>                    <\/p>                <\/div>                <div class="dirOptsTransit" style:display="{Binding mode Converter=displayTransitModeFilterROW}" data-tag="dirOptsTransit">                    <p style:display="{Binding mode Converter=boolToDisplay}">                        <TextBlock Text="{Binding resources.L_Option_Transit_Mode}" />                    <\/p>                    <table role="presentation">                        <tbody>                            <tr>                                <td>                                    <CheckBox Content="{Binding resources.L_Transit_Mode_Bus}" Checked="{Binding allowBuses Mode=TwoWay}" Value="" data-tag="dirOptsAllowBuses" role="checkbox" aria-checked="{Binding allowsBuses}" />                                <\/td>                                <td>                                    <CheckBox Content="{Binding resources.L_Transit_Mode_CityRail}" Checked="{Binding allowCityRails Mode=TwoWay}" Value="" data-tag="dirOptsAllowCityRails" role="checkbox" aria-checked="{Binding allowsCityRails}" />                                <\/td>                            <\/tr>                            <tr>                                <td>                                    <CheckBox Content="{Binding resources.L_Transit_Mode_Subway}" Checked="{Binding allowSubways Mode=TwoWay}" Value="" data-tag="dirOptsAllowSubways" role="checkbox" aria-checked="{Binding allowsSubways}" />                                <\/td>                                <td>                                    <CheckBox Content="{Binding resources.L_Transit_Mode_Ferry}" Checked="{Binding allowFerries Mode=TwoWay}" Value="" data-tag="dirOptsAllowFerries" role="checkbox" aria-checked="{Binding allowsFerries}" />                                <\/td>                            <\/tr>                            <tr>                                <td>                                    <CheckBox Content="{Binding resources.L_Transit_Mode_Train}" Checked="{Binding allowTrains Mode=TwoWay}" Value="" data-tag="dirOptsAllowTrains" role="checkbox" aria-checked="{Binding allowsTrains}" />                                <\/td>                            <\/tr>                        <\/tbody>                    <\/table>                <\/div>                <div class="dirOptsSaveHistory" style:display="{Binding enableHistory Converter=boolToDisplay}" data-tag="dirOptsSaveHistory">                    <p>                        <CheckBox Content="{Binding resources.L_Directions_Save_History}" Checked="{Binding saveHistory Mode=TwoWay}" Value="" data-tag="dirOptsSaveHistory" />                    <\/p>                    <p class="dirHistory">                        <a href="#" event:click="onDeleteHistory" class="dirDeleteHistory" style:display="{Binding historyDeleted Converter=boolToNotDisplay}" role="button">                            <TextBlock Text="{Binding resources.L_Directions_Delete_History}" />                        <\/a>                    <\/p>                    <p class="dirHistory dirHistoryDeleted" style:display="{Binding historyDeleted Converter=boolToDisplay}">                        <TextBlock Text="{Binding resources.L_Directions_History_Deleted}" />                    <\/p>                <\/div>\t\t\t<\/div>\t\t<\/div>\t\t<div class="dirWaypoints">            <a href="#" class="backArrowButton" data-tag="dirReturnBtn" role="button"/>\t\t\t<DraggableList ItemsSource="{Binding waypoints}" gripClass="defaultGrip dirWpGrip" tooltip="{Binding resources.L_Directions_Title_Reorder}" role="button" aria-label="{Binding resources.L_Directions_Title_Drag_Reorder_Enter}" scrollContainer="{Binding scrollContainer}" event:onDragComplete="onDragComplete" event:onDragBegin="onDragBegin">\t\t\t\t<DraggableList.ItemTemplate>\t\t\t\t\t<DataTemplate>\t\t\t\t\t\t<div>\t\t\t\t\t\t\t<div class="dirWp" data-tag="dirWp">\t\t\t\t\t\t\t\t<div class="{Binding index Converter=indexToIconClass}" aria-label="{Binding index Converter=indexToWaypointTitle}"><TextBlock Text="{Binding index Converter=indexToIconText}" /><\/div>\t\t\t\t\t\t\t\t<WatermarkedTextInput Watermark="{Binding index Converter=indexToWaypointTitle}" Value="{Binding inputText Mode=TwoWay}" MaxLength="1000" data-tag="input" />\t\t\t\t\t\t\t\t<a href="#" style:display="{Binding showDelete Converter=boolToDisplay}" role="button" event:click="onDelete" class="dirBtnDelete commonButton deleteButton" title="{Binding resources.L_Directions_Title_Delete}" data-tag="dirBtnDelete"><\/a>\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t\t<div class="dirResolve" style:display="{Binding upHierarchy Converter=nullToDisplayNone}">\t\t\t\t\t\t\t\t<a href="#" event:click="onCloseResolve" class="commonButton deleteButton" title="{Binding resources.L_Close}" data-tag="dirCloseResolve" role="button"><\/a>\t\t\t\t\t\t\t\t<TextBlock Text="{Binding resolveText1}" /><a href="#" event:click="onResolve" role="button"><TextBlock Text="{Binding upHierarchy}" /><\/a><TextBlock Text="{Binding resolveText2}" />\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t<\/div>\t\t\t\t\t<\/DataTemplate>\t\t\t\t<\/DraggableList.ItemTemplate>\t\t\t<\/DraggableList>\t\t<\/div>                 <a class="dirBtnRev" href="#" style:display="{Binding showReverse Converter=boolToDisplay}" event:click="onReverseClick" title="{Binding resources.L_Directions_Title_Reverse}" data-tag="dirBtnRev" role="button"><\/a>        <div class="dirAddBtn" style:display="{Binding allowAddWp Converter=boolToDisplay}">            <a aria-label="{Binding resources.L_Directions_Title_Add}" class="commonButton dirBtnAdd" href="#" event:click="onAddClick" data-tag="dirBtnAdd" role="button">                                           <TextBlock Text="{Binding resources.L_Directions_Title_Add}" />                           <\/a>        <\/div>\t\t<div class="{Binding showTimeControls Converter=showTimeControlsToClass}">\t\t\t<div class="drTimeGo">\t\t\t\t<div>\t\t\t\t\t<div class="dirBtnTime" style:display="{Binding mode Converter=displayTimeControls}">\t\t\t\t\t\t<a href="#" event:click="onTimeClick" data-tag="dirBtnTime" role="button" aria-expanded="false" title="{Binding resources.L_Directions_Time_Control_Tip}">\t\t\t\t\t\t\t<div data-tag="dateTimeSummary1"><TextBlock Text="{Binding dateTimeSummary1}"/><\/div>                            <div class="dropdownIcon" data-tag="dateTimeSummary2"><TextBlock Text="{Binding dateTimeSummary2}" /><\/div>\t\t\t\t\t\t<\/a>\t\t\t\t\t<\/div>\t\t\t\t\t<div>\t\t\t\t\t\t<a class="dirBtnGo commonButton" href="#" event:click="onGetDirectionsClick" role="button" data-tag="dirBtnGo">                            <TextBlock Text="{Binding resources.L_Directions_Go}" />                        <\/a>\t\t\t\t\t<\/div>\t\t\t\t<\/div>\t\t\t<\/div>\t\t\t<div class="dirProgress MicrosoftMap_progress" style:visibility="{Binding showProgress Converter=boolToVisibility}" aria-label="{Binding resources.L_Directions_Loading}" data-tag="dirProgress"><\/div>            <div class="dirTimePopup dropdownPopup" data-tag="dirTimePopup">                <RadioGroup ItemsSource="{Binding timeTypes}" SelectedItem="{Binding transitTimeType Mode=TwoWay}" />                <!--show TimeControlTemplate and calendar on Desktop-->                <TimeControl Time="{Binding time Mode=TwoWay}" Editing="{Binding EditingTime Mode=TwoWay}" Disabled="{Binding timeCtrlDisabled}" TaskId="{Binding taskId}"/>                <div class="calContainer" data-tag="datePicker"><\/div>                <!--show MobileTimeControlTemplate on Mobile-->                <div class="mobileTimeContainer" style:display="{Binding showMobileTimeControl Converter=boolToDisplay}">                    <MobileTimeControl Time="{Binding time Mode=TwoWay}" Date="{Binding Date Mode=TwoWay}" />                <\/div>            <\/div>        <\/div>\t<\/div>    <div class="editDirectionsButton backEdit separator" style:display="{Binding showEditDirections Converter=boolToDisplay}" event:click="onEditDirectionsClick">        <div class="editDir"><TextBlock Text="{Binding resources.L_Directions_Edit_Directions}" /><\/div>    <\/div>    <div class="seeAllRoutesButton backEdit" style:display="{Binding showEditDirections Converter=boolToDisplay}" event:click="onSeeAllRoutesClick">        <div class="editDir"><TextBlock Text="{Binding resources.L_Directions_See_All_Routes}" /><\/div>    <\/div>\t<div class="dirMessage" style:display="{Binding messageText Converter=nullToDisplayNone}" data-tag="dirMessage" tabindex="0">\t\t<TextBlock Text="{Binding messageText}" />\t<\/div>    <div class="searchboxWithAS" style:display="{Binding showSuggestionsPanel Converter=boolToDisplay}">    <\/div>    <div class="routecategoriesbar" style:display="{Binding showRouteCategoriesPanel Converter=boolToDisplay}"><\/div><\/div>',pr='<div class="directionsPanel" data-tag="directionsPanel" class="{Binding showSeeAllRoutes Converter=boolToSeeAllRoutesClassName}">    <div class="seeAllRoutesPanel" data-tag="seeAllRoutesPanel" style:display="{Binding showSeeAllRoutes Converter=boolToDisplay}">        <div class="backArrowDiv directionsBack">            <a class="commonButton backArrowButton directionsBackButton" event:click="onSeeAllRoutesReturnClick" href="#" role="button" data-tag="backToDirectionsCardButton">                <div class="directionsBackButtonText">                    <TextBlock text="{Binding resources.L_Directions_Back_Button}" />                <\/div>            <\/a>        <\/div>        <div class="editDir dirSeeAllComment"><TextBlock text="{Binding resources.L_Directions_See_All_Routes_Comment}" /><\/div>    <\/div>    <div class="multimode">        <div class="dirPrintSelect" data-tag="dirPrintText" style:display="{Binding isSDK Converter=boolToNotDisplay}">            <a href="#" role="button" event:click="onPrintDirectionsClick" aria-label="{Binding resources.L_Directions_Print}">                <div class="printSelected"><TextBlock Text="{Binding resources.L_Directions_PrintSelected}" /><\/div>            <\/a>        <\/div>        <div class="dr_specialAnnouncement" style:display="{Binding showTransitSpecialMessage Converter=boolToDisplay}">            <div style:display="{Binding enableNewDiretionsAnswerAlert Converter=boolToDisplay}">                <span class="dr_alert_pill">                    <i class="dr_alert_icon"><\/i>                    <span>                        <TextBlock text="{Binding resources.L_Directions_COVID19}" />                    <\/span>                <\/span>                <span class="dr_alert_text">                    <TextBlock text="{Binding resources.L_Directions_TransitImpactedDueToCOVID19}" />                <\/span>                            <\/div>            <div style:display="{Binding enableNewDiretionsAnswerAlert Converter=boolToNotDisplay}">                <TextBlock text="{Binding resources.L_Directions_TransitImpactedDueToCOVID19}" />            <\/div>        <\/div>        <ItemsControl ItemsSource="{Binding directionsResultsTitleSet}" panelTagName="ul">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <li class="{Binding isSelected Converter=boolToSelectedTitleClassName}" data-tag="{Binding isSelected Converter=boolToSelectedTitleClassName}">                        <div class="directionsRouteLink">                            <a class="directionsRouteSummaryLink" href="#" event:click="onResultsTitleClick" data-tag="directionsRouteLink" role="button" aria-selected="{Binding isSelected}" aria-label="{Binding ariaSummary}">                                <table>                                    <tr class="drTitleRow">                                        <td class="drRouteMode" data-tag="drRouteMode">                                            <div class="{Binding routeMode Converter=routeModeToClassName}" data-tag="{Binding routeMode Converter=routeModeToClassName}"><\/div>                                        <\/td>                                        <td>                                            <div class="drTitleRoot">                                                <table class="drTitleTable" role="presentation">                                                    <tr>                                                        <td>                                                            <div class="{Binding routeMode Converter=routeModeToClassName}" style:display="{Binding routeMode Converter=routeModeToDrivingDisplay}">                                                                <div class="distanceLine" data-tag="descriptionDistance">                                                                    <TextBlock Text="{Binding subtitle}" />                                                                <\/div>                                                            <\/div>                                                            <div class="lineOne">                                                                <div class="{Binding trafficConditionClassName}" style:display="{Binding trafficCondition Converter=nullToDisplayNone}" data-tag="descriptionTrafficCondition">                                                                    <TextBlock Text="{Binding trafficCondition}" />                                                                <\/div>                                                                <div class="drTitleDelay" style:display="{Binding descriptionTimeNoTraffic Converter=nullToDisplayNone}" data-tag="descriptionTimeNoTraffic">                                                                    <span class="interpunct">                                                                        <TextBlock Text="{Binding resources.L_Directions_Interpunct}" />                                                                    <\/span>                                                                    <TextBlock Text="{Binding descriptionTimeNoTraffic}" />                                                                <\/div>                                                                <div class="drTitleLeft titleFont" style:display="{Binding mainTitle Converter=nullToDisplayNone}">                                                                    <i class="{Binding warningSeverityIconClassName}" style:display="{Binding hasWarning Converter=boolToDisplay}"><\/i>                                                                    <span>                                                                        <TextBlock Text="{Binding mainTitle}" />                                                                    <\/span>                                                                <\/div>                                                            <\/div>                                                            <div class="lineTwo" style:display="{Binding routeMode Converter=routeModeToDisplay}">                                                                <div class="drTitleText" style:display="{Binding descriptionVia Converter=nullToDisplayNone}">                                                                    <span data-tag="descriptionVia">                                                                        <TextBlock Text="{Binding descriptionVia}" />                                                                    <\/span>                                                                    <span class="drCost" style:display="{Binding cost Converter=nullToDisplayNone}" data-tag="descriptionCost">                                                                        <TextBlock Text="{Binding cost}" />                                                                    <\/span>                                                                <\/div>                                                                <div class="drTitleText">                                                                    <div class="embellishBlock" style:display="{Binding embellishment Converter=nullToDisplayNone}" data-tag="descriptionEmbellishment">                                                                        <span class="interpunct" style:display="{Binding descriptionVia Converter=nullToDisplayNone}">                                                                            <TextBlock Text="{Binding resources.L_Directions_Interpunct}" />                                                                        <\/span>                                                                        <div class="{Binding embellishment Converter=stringToEmbellishmentClassName}">                                                                            <span class="{Binding isLate Converter=boolToEmbellishmentClassName}">                                                                                <span class="{Binding isTransitEmbellishment Converter=boolToTransitEmbellishmentClassName}">                                                                                    <TextBlock Text="{Binding embellishment}" />                                                                                <\/span>                                                                            <\/span>                                                                        <\/div>                                                                    <\/div>                                                                    <span class="drFreqency" style:display="{Binding frequency Converter=nullToDisplayNone}" data-tag="descriptionFreq">                                                                        <span class="interpunct">                                                                            <TextBlock Text="{Binding resources.L_Directions_Interpunct}" />                                                                        <\/span>                                                                        <TextBlock Text="{Binding frequency}" />                                                                    <\/span>                                                                <\/div>                                                            <\/div>                                                        <\/td>                                                    <\/tr>                                                <\/table>                                                <table class="drTimeline" style:display="{Binding transitSummary Converter=nullToDisplayNone}" data-tag="drTimeline">                                                    <ItemsControl ItemsSource="{Binding transitSummary}" panelTagName="div">                                                        <ItemsControl.ItemTemplate>                                                            <DataTemplate>                                                                <span class="{Binding icon Converter=iconToClassName}" data-tag="drTimelineCell">                                                                    <span class="dirSvg svg"><\/span>                                                                    <span class="{Binding lineColor Converter=lineNameToClassName}" style:background-color="{Binding lineColor}" data-tag="bm_lineName">                                                                        <TextBlock Text="{Binding text}" />                                                                    <\/span>                                                                <\/span>                                                            <\/DataTemplate>                                                        <\/ItemsControl.ItemTemplate>                                                    <\/ItemsControl>                                                <\/table>                                                <div class="lineTwoTransit" style:display="{Binding routeMode Converter=routeModeToNotDisplay}">                                                    <div class="drTitleText" style:display="{Binding descriptionVia Converter=nullToDisplayNone}">                                                        <span data-tag="descriptionVia" style:display="{Binding routeMode Converter=multiModeToDisplay}">                                                            <TextBlock Text="{Binding descriptionVia}" />                                                        <\/span>                                                        <span class="drCost" style:display="{Binding cost Converter=nullToDisplayNone}" data-tag="descriptionCost">                                                            <TextBlock Text="{Binding cost}" />                                                        <\/span>                                                    <\/div>                                                    <div class="drTitleText">                                                        <span class="drFreqency" style:display="{Binding frequency Converter=nullToDisplayNone}" data-tag="descriptionFreq">                                                            <TextBlock Text="{Binding frequency}" />                                                        <\/span>                                                        <span style:display="{Binding embellishment Converter=nullToDisplayNone}" data-tag="descriptionEmbellishment">                                                            <span class="interpunct" style:display="{Binding frequency Converter=nullToDisplayNone}">                                                                <TextBlock Text="{Binding resources.L_Directions_Interpunct}" />                                                            <\/span>                                                            <span class="{Binding embellishment Converter=stringToEmbellishmentClassName}">                                                                <span class="{Binding isLate Converter=boolToEmbellishmentClassName}">                                                                    <span class="{Binding isTransitEmbellishment Converter=boolToTransitEmbellishmentClassName}">                                                                        <TextBlock Text="{Binding embellishment}" />                                                                    <\/span>                                                                <\/span>                                                            <\/span>                                                        <\/span>                                                    <\/div>                                                <\/div>                                            <\/div>                                        <\/td>                                        <td class="{Binding isSelected Converter=boolToMultimodeSelectedDurationClassName}">                                            <div class="drDurationRoot">                                                <table class="{Binding trafficConditionTimeClassName}" role="presentation">                                                    <tr>                                                        <td style:display="{Binding hours Converter=nullToDisplayNone}">                                                            <div class="drHours" data-tag="drHours">                                                                <TextBlock Text="{Binding hours}" />                                                            <\/div>                                                            <div class="drHoursLabel" data-tag="drHoursLabel">                                                                <TextBlock Text="{Binding resources.L_Directions_Hour}" />                                                            <\/div>                                                        <\/td>                                                        <td class="hoursMinsSeparator" style:display="{Binding hours Converter=nullToDisplayNone}">                                                            <TextBlock Text="{Binding resources.L_Directions_Hour_Min_Separator}" />                                                        <\/td>                                                        <td>                                                            <div class="drMins" data-tag="drMins" style:text-align="{Binding hours Converter=timeDurationToTextAlignment}">                                                                <TextBlock Text="{Binding minutes}" />                                                            <\/div>                                                            <div class="drMinsLabel" data-tag="drMinsLabel" style:text-align="{Binding hours Converter=timeDurationToTextAlignment}">                                                                <TextBlock Text="{Binding resources.L_Directions_Minute}" />                                                            <\/div>                                                        <\/td>                                                    <\/tr>                                                <\/table>                                            <\/div>                                        <\/td>                                    <\/tr>                                <\/table>                            <\/a>                            <div class="multimodeInstructions">                                <a class="instructionDetails" event:click="onShowInstructionClick" href="#" role="button">                                    <div class="{Binding detailsArrow Converter=arrowBoolToClass}">                                        <TextBlock class="instructionDetailsHeaderText" Text="{Binding detailsHint Mode=TwoWay}" />                                    <\/div>                                <\/a>                                <div class="dirInstructionBlock" style:display="{Binding result.showResults Converter=boolToDisplay}">                                    <div class="instructionsListSection" style:display="{Binding showInstructions Converter=boolToDisplay}">                                        <div class="dirPrintText" data-tag="dirPrintText" style:display="{Binding isSDK Converter=boolToNotDisplay}">                                            <a style:display="{Binding showPrint Converter=boolToDisplay}" href="#" role="button" event:click="onPrintDirectionsClick" aria-label="{Binding resources.L_Directions_Print}">                                                <TextBlock Text="{Binding resources.L_Directions_Print}" />                                            <\/a>                                        <\/div>                                        <div style:display="{Binding result.showResults Converter=boolToDisplay}" data-tag="dirInstructionsList" event:mouseleave="onInstructionsMouseLeave" event:blur="onInstructionsMouseLeave">                                            <ItemsControl ItemsSource="{Binding result.routeLegs}" panelTagName="div">                                                <ItemsControl.ItemTemplate>                                                    <DataTemplate>                                                        <div class="{Binding legClassName}" data-tag="dirLegContainer">                                                            <div class="legSeparators"><\/div>                                                            <a data-index="{Binding index}" class="dirRouteLegTable" event:click="onLegTitleClick" style:display="{Binding showLegTitle Converter=boolToDisplay}" href="#" data-tag="routeLegTable">                                                                <div style:display="table-row">                                                                    <div class="legSpace" style:display="table-cell"><\/div>                                                                    <div style:display="table-cell">                                                                        <div data-tag="dirLegRouteInfoContainer">                                                                            <span class="dirLegTimeDistText" data-tag="dirLegTimeDistText">                                                                                <TextBlock Text="{Binding timeDistanceText}" />                                                                            <\/span>                                                                            <span data-tag="arrow" class="{Binding showInstructions Converter=showGroupToClass}"><\/span>                                                                            <div class="dirLegTitle" data-tag="dirLegTitle">                                                                                <TextBlock text="{Binding legTitle}" />                                                                            <\/div>                                                                        <\/div>                                                                    <\/div>                                                                <\/div>                                                            <\/a>                                                            <div class="dirLegIcons" style:display="{Binding showInstructions Converter=boolToNotDisplay}" data-tag="dirLegIconContainer">                                                                <div>                                                                    <span class="{Binding index Converter=indexToStartClass}" data-tag="dirLegIcon">                                                                        <TextBlock Text="{Binding index Converter=indexToIconTextStart}" />                                                                    <\/span>                                                                    <span class="legWaypointAddress">                                                                        <TextBlock Text="{Binding startWaypointAddress}" />                                                                    <\/span>                                                                    <div class="dirLegIconsGap" data-tag="dirLegIconsGap"><\/div>                                                                    <span class="{Binding index Converter=indexToEndClass}" data-tag="dirLegIcon">                                                                        <TextBlock Text="{Binding index Converter=indexToIconTextEnd}" />                                                                    <\/span>                                                                    <span class="legWaypointAddress">                                                                        <TextBlock Text="{Binding endWaypointAddress}" />                                                                    <\/span>                                                                <\/div>                                                            <\/div>                                                            <div class="{Binding legInstructionsClassName}" style:display="{Binding showInstructions Converter=boolToDisplay}" data-tag="dirInstructionContainer">                                                                <ItemsControl ItemsSource="{Binding instructionSteps}" panelTagName="div">                                                                    <ItemsControl.ItemTemplate>                                                                        <DataTemplate>                                                                            <div style:display="{Binding show Converter=boolToDisplay}" class="{Binding cssClass}" role="{Binding role}" tabindex="0" event:click="onInstructionClick" event:mouseenter="onMouseEnter" event:keydown="onInstructionKeyDown" event:focus="onMouseEnter" data-tag="dirInstruction">                                                                                <div class="bm_dirInstructionRow">                                                                                    <div style:display="table-cell"><\/div>                                                                                    <div style:display="table-cell"><\/div>                                                                                    <div style:display="table-cell"><\/div>                                                                                    <div style:display="table-cell"><\/div>                                                                                <\/div>                                                                                <div class="bm_dirInstructionRow">                                                                                    <div style:border-color="{Binding transitLineColor}" class="bm_dirLeftSpace">                                                                                        <TextBlock Text="{Binding timeText}" />                                                                                    <\/div>                                                                                    <div style:display="table-cell" aria-hidden="true" style:visibility="{Binding showIcon Converter=boolToVisibility}">                                                                                        <div class="{Binding transitLineColor Converter=lineColorToIconClass}" style:background-color="{Binding transitLineColor}">                                                                                            <TextBlock Text="{Binding iconText}" />                                                                                            <div class="dirSvg svg"><\/div>                                                                                            <img src="{Binding roadShieldUrl}" style:display="{Binding roadShieldUrl Converter=nullToDisplayNone}" />                                                                                        <\/div>                                                                                    <\/div>                                                                                    <div class="dirInstruction">                                                                                        <p style:display="{Binding isClickable Converter=boolToNotDisplay}">                                                                                            <TextBlock Text="{Binding stepText}" />                                                                                        <\/p>                                                                                        <a data-q="{Binding stepText}" data-eid="{Binding entityId}" data-sf="{Binding searchFilter}" style:display="{Binding isClickable Converter=boolToDisplay}" href="#" event:click="onStepTextClick" aria-label="{Binding waypointTitle}" role="button">                                                                                            <TextBlock Text="{Binding stepText}" />                                                                                        <\/a>                                                                                        <p style:display="{Binding startTimeHint Converter=nullToDisplayNone}">                                                                                            <TextBlock Text="{Binding startTimeHint}" />                                                                                        <\/p>                                                                                        <p style:display="{Binding endTimeHint Converter=nullToDisplayNone}">                                                                                            <TextBlock Text="{Binding endTimeHint}" />                                                                                        <\/p>                                                                                        <p style:display="{Binding stepAddress Converter=nullToDisplayNone}">                                                                                            <TextBlock Text="{Binding stepAddress}" />                                                                                        <\/p>                                                                                        <ItemsControl ItemsSource="{Binding viaPoints}">                                                                                            <ItemsControl.ItemTemplate>                                                                                                <DataTemplate>                                                                                                    <p class="dirVia">                                                                                                        <span>                                                                                                            <TextBlock Text="{Binding text}" />                                                                                                        <\/span>                                                                                                        <a href="#" event:click="onRemoveViaClick" role="button" data-wpi="{Binding waypointIndex}" data-vwpi="{Binding viaPointIndex}" aria-label="{Binding removeLinkText}">                                                                                                            <TextBlock Text="{Binding removeLinkText}" />                                                                                                        <\/a>                                                                                                    <\/p>                                                                                                <\/DataTemplate>                                                                                            <\/ItemsControl.ItemTemplate>                                                                                        <\/ItemsControl>                                                                                        <ItemsControl ItemsSource="{Binding childSteps}">                                                                                            <ItemsControl.ItemTemplate>                                                                                                <DataTemplate>                                                                                                    <p>                                                                                                        <TextBlock Text="{Binding stepText}" />                                                                                                    <\/p>                                                                                                <\/DataTemplate>                                                                                            <\/ItemsControl.ItemTemplate>                                                                                        <\/ItemsControl>                                                                                        <div style:display="{Binding showHints Converter=boolToDisplay}">                                                                                            <ItemsControl ItemsSource="{Binding hints}">                                                                                                <ItemsControl.ItemTemplate>                                                                                                    <DataTemplate>                                                                                                        <p class="dirHint" data-tag="dirHint">                                                                                                            <TextBlock Text="{Binding text}" />                                                                                                        <\/p>                                                                                                    <\/DataTemplate>                                                                                                <\/ItemsControl.ItemTemplate>                                                                                            <\/ItemsControl>                                                                                        <\/div>                                                                                        <div style:display="{Binding showWarnings Converter=boolToDisplay}">                                                                                            <ItemsControl ItemsSource="{Binding warnings}">                                                                                                <ItemsControl.ItemTemplate>                                                                                                    <DataTemplate>                                                                                                        <p class="{Binding severity Converter=getWarningIconClass}" data-tag="{Binding severity Converter=getWarningIconClass}">                                                                                                            <TextBlock Text="{Binding text}" />                                                                                                        <\/p>                                                                                                    <\/DataTemplate>                                                                                                <\/ItemsControl.ItemTemplate>                                                                                            <\/ItemsControl>                                                                                        <\/div>                                                                                        <p class="dirSpecialAttribution" data-tag="dirSpecialAttribution" style:display="{Binding specialAttributionUri Converter=nullToDisplayNone}">                                                                                            <TextBlock Text="{Binding resources.L_Data_Special_Attribution}" />                                                                                            <a href="{Binding specialAttributionUri}" target="_blank" role="button" aria-label="{Binding resources.DirectionSpecialAttributionAriaLabel}">                                                                                                <TextBlock Text="{Binding specialAttributionLink}" />                                                                                            <\/a>                                                                                        <\/p>                                                                                        <a href="#" role="button" style:display="{Binding showNearbyParking Converter=boolToDisplay}" event:click="onNearbyParkingClick">                                                                                            <TextBlock Text="{Binding resources.L_Nearby_Parking}" />                                                                                        <\/a>                                                                                    <\/div>                                                                                    <div class="bm_dirInstructionArrow">                                                                                        <div data-tag="arrow" class="{Binding showGroup Converter=showGroupToClass}" style:display="{Binding groupItems Converter=arrayToDisplay}">                                                                                        <\/div>                                                                                    <\/div>                                                                                <\/div>                                                                                <div class="bm_dirInstructionRow">                                                                                    <div class="bm_dirLeftSpace" style:display="{Binding travelDistanceText Converter=nullToDisplayNone}" data-tag="dirInstructionTravelDistance">                                                                                        <div class="dirInstructionTravelDistance">                                                                                            <TextBlock Text="{Binding travelDistanceText}" />                                                                                        <\/div>                                                                                    <\/div>                                                                                    <div style:display="table-cell"><\/div>                                                                                    <div style:display="table-cell"><\/div>                                                                                    <div style:display="table-cell"><\/div>                                                                                <\/div>                                                                                <div class="bm_dirInstructionRow">                                                                                    <div style:display="table-cell"><\/div>                                                                                    <div style:display="table-cell"><\/div>                                                                                    <div style:display="table-cell"><\/div>                                                                                    <div style:display="table-cell"><\/div>                                                                                <\/div>                                                                            <\/div>                                                                        <\/DataTemplate>                                                                    <\/ItemsControl.ItemTemplate>                                                                <\/ItemsControl>                                                            <\/div>                                                        <\/div>                                                    <\/DataTemplate>                                                <\/ItemsControl.ItemTemplate>                                            <\/ItemsControl>                                        <\/div>                                        <div class="getReturnDirectionsLink" data-tag="getReturnDirectionsLink" style:display="{Binding showGetReturnDirectionsLink Converter=boolToDisplay}">                                            <a event:click="onGetReturnDirectionsClick" href="#" role="button">                                                <TextBlock Text="{Binding resources.L_Get_Return_Directions}" />                                            <\/a>                                        <\/div>                                        <div class="reportProblemLink" data-tag="reportProblemLink" style:display="{Binding isSDK Converter=boolToNotDisplay}">                                            <a href="#" event:click="reportProblem" role="button" aria-label="{Binding resources.L_Report_Problem_Link}">                                                <TextBlock Text="{Binding resources.L_Report_Problem_Link}" />                                            <\/a>                                        <\/div>                                        <div class="dirAttribution" data-tag="dirAttribution" style:display="{Binding showAttribution Converter=boolToDisplay}">                                            <TextBlock Text="{Binding resources.L_Data_Attribution}" />                                            <ItemsControl ItemsSource="{Binding transitAttributions}">                                                <ItemsControl.ItemTemplate>                                                    <DataTemplate>                                                        <p>                                                            <a href="{Binding uri}" event:click="attributionClick" target="_blank" class="{Binding uri Converter=emptyUriToClass}" data-tag="dirTransitAttribution">                                                                <TextBlock Text="{Binding agencyName}" />                                                            <\/a>                                                        <\/p>                                                    <\/DataTemplate>                                                <\/ItemsControl.ItemTemplate>                                            <\/ItemsControl>                                        <\/div>                                        <div class="dirDisclaimer" data-tag="dirDisclaimer" style:display="{Binding showDisclaimer Converter=boolToDisplay}">                                            <TextBlock Text="{Binding disclaimerText}" />                                        <\/div>                                        <div class="dirTransitLogo" data-tag="dirTransitLogo" style:display="{Binding showTransitLogo Converter=boolToDisplay}">                                        <\/div>                                    <\/div>                                <\/div>                            <\/div>                        <\/div>                    <\/li>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>    <\/div>        <\/div>',of='<div class="{Binding printMode}" data-tag="directionsPanel">  <table>      <tr>          <td class="waypointSummary" data-tag="waypointSummary">              <ItemsControl ItemsSource="{Binding waypoints}" panelTagName="ul">                <ItemsControl.ItemTemplate>                  <DataTemplate>                      <div>                          <table>                              <tr>                                  <td class="waypointTypeLabel">                                      <span class="dirWaypointIcon" data-tag="dirWaypointIcon">                                              <span class="{Binding waypointType Converter=waypointTypeToClass}">                                                  <TextBlock Text="{Binding index Converter=indexToWaypointTypeLabel}" />                                              <\/span>                                      <\/span>                                                                        <\/td>                                  <td class="waypointAddress">                                      <TextBlock Text="{Binding inputText}" />                                  <\/td>                              <\/tr>                          <\/table>                      <\/div>                  <\/DataTemplate>                <\/ItemsControl.ItemTemplate>              <\/ItemsControl>          <\/td>          <td class="routeDetails">              <Tab TabContent="{Binding printTitleViewModel}" TabTemplate="{Binding titlePrintTemplate}" IsDisplayed="true">  <\/Tab>          <\/td>      <\/tr>  <\/table>    <div class="printNotes">        <table>            <tbody>                <tr>                    <td class="waypointAddress">                        <div class="screenNotes">                            <textarea class="waypointNotes" placeholder="{Binding resources.L_Directions_PrintNotesWatermark}" data-tag="printNotes" maxlength="{Binding notesMaxCharSize}"><\/textarea>                        <\/div>                        <div class="printedNotes">                        <\/div>                    <\/td>                <\/tr>            <\/tbody>        <\/table>    <\/div>      <div class="dirInstructions" data-tag="dirInstructions">        <div class="isText showText" data-tag="dirPrintInstructionText">            <Tab TabContent="{Binding printInstructionsViewModel}" TabTemplate="{Binding instructionsPrintTemplate}" IsDisplayed="true">  <\/Tab>        <\/div>        <div class="taskMapPrint isMap showMap directionsMapPrintPageBreak taskMapPrintPageBreak" data-tag="directionsMapPrint">            <div class="printArea" data-tag="printArea">                <div class="printMap" data-tag="printMap">                <\/div>            <\/div>        <\/div>        <div class="dirSourceDestMiniMaps isMap showMap" data-tag="dirSourceDestMiniMaps">            <ItemsControl ItemsSource="{Binding waypoints}">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <div class="{Binding index Converter=indexToOddEvenClass}" data-tag="waypointPrintMaps">                            <p class="waypointHeading" data-tag="waypointHeading">                                <span class="miniMapIndexLetter">                                    <span class="dirWaypointIcon" data-tag="dirWaypointIcon">                                        <span>                                                                                        <span class="{Binding waypointType Converter=waypointTypeToClass}">                                                <TextBlock Text="{Binding index Converter=indexToIconTextStart}" />                                            <\/span>                                        <\/span>                                    <\/span>                                <\/span>                                <span class="miniMapText">                                    <TextBlock Text="{Binding inputText}" />                                <\/span>                            <\/p>                            <img src="{Binding printImagePath}" />                        <\/div>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>  <\/div>  <div class="dirAttribution" data-tag="dirAttribution" style:display="{Binding showAttribution Converter=boolToDisplay}">    <span class="dirDataFrom">      <TextBlock Text="{Binding resources.L_Data_Attribution}" />    <\/span>    <span class="dirTransitAttribution" data-tag="dirTransitAttribution">      <TextBlock Text="{Binding attributionText}" />    <\/span>  <\/div>  <div class="dirDisclaimer" data-tag="dirDisclaimer">    <TextBlock Text="{Binding disclaimerText}" />  <\/div><\/div>',wr='<div class="directionsPanel" data-tag="directionsPanel" class="{Binding showSeeAllRoutes Converter=boolToSeeAllRoutesClassName}">    <div class="seeAllRoutesPanel" data-tag="seeAllRoutesPanel" style:display="{Binding showSeeAllRoutes Converter=boolToDisplay}">        <div class="backArrorowDiv directionsBack">            <a class="commonButton backArrowButton directionsBackButton" event:click="onSeeAllRoutesReturnClick" href="#" role="button" data-tag="backToDirectionsCardButton">                <div class="directionsBackButtonText">                    <TextBlock text="{Binding resources.L_Directions_Back_Button}" />                <\/div>            <\/a>        <\/div>        <div class="editDir dirSeeAllComment"><TextBlock text="{Binding resources.L_Directions_See_All_Routes_Comment}" /><\/div>    <\/div>    <div>        <ItemsControl ItemsSource="{Binding directionsResultsTitleSet}" panelTagName="ul">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <li class="{Binding isSelected Converter=boolToSelectedTitleClassName}" data-tag="{Binding isSelected Converter=boolToSelectedTitleClassName}">                        <a href="#" event:click="onResultsTitleClick" data-tag="directionsRouteLink" role="button" aria-selected="{Binding isSelected}" aria-label="{Binding ariaSummary}">                            <table>                                <tr class="drTitleRow">                                    <td class="{Binding isSelected Converter=boolToSelectedDurationClassName}">                                        <div class="drDurationRoot">                                            <table class="{Binding trafficConditionTimeClassName}">                                                <tr>                                                    <td style:display="{Binding hours Converter=nullToDisplayNone}">                                                        <div class="drHours" data-tag="drHours">                                                            <TextBlock Text="{Binding hours}" />                                                        <\/div>                                                        <div class="drHoursLabel" data-tag="drHoursLabel">                                                            <TextBlock Text="{Binding resources.L_Directions_Hour}" />                                                        <\/div>                                                    <\/td>                                                    <td class="hoursMinsSeparator" style:display="{Binding hours Converter=nullToDisplayNone}">                                                        <TextBlock Text="{Binding resources.L_Directions_Hour_Min_Separator}" />                                                    <\/td>                                                    <td>                                                        <div class="drMins" data-tag="drMins">                                                            <TextBlock Text="{Binding minutes}" />                                                        <\/div>                                                        <div class="drMinsLabel" data-tag="drMinsLabel">                                                            <TextBlock Text="{Binding resources.L_Directions_Minute}" />                                                        <\/div>                                                    <\/td>                                                <\/tr>                                            <\/table>                                        <\/div>                                    <\/td>                                    <td>                                        <div class="drTitleRoot">                                            <table class="drTitleTable">                                                <tr>                                                    <td>                                                        <div class="lineOne">                                                            <div class="{Binding trafficConditionClassName}" style:display="{Binding trafficCondition Converter=nullToDisplayNone}" data-tag="descriptionTrafficCondition">                                                                <TextBlock Text="{Binding trafficCondition}" />                                                            <\/div>                                                            <div class="drTitleDelay" style:display="{Binding descriptionTimeNoTraffic Converter=nullToDisplayNone}" data-tag="descriptionTimeNoTraffic">                                                                <span class="interpunct">                                                                    <TextBlock Text="{Binding resources.L_Directions_Interpunct}" />                                                                <\/span>                                                                <TextBlock Text="{Binding descriptionTimeNoTraffic}" />                                                            <\/div>                                                            <div class="drTitleLeft titleFont" style:display="{Binding mainTitle Converter=nullToDisplayNone}">                                                                <TextBlock Text="{Binding mainTitle}" />                                                            <\/div>                                                        <\/div>                                                        <div class="lineTwo">                                                            <div class="drTitleText" style:display="{Binding descriptionVia Converter=nullToDisplayNone}">                                                                <span data-tag="descriptionVia">                                                                    <TextBlock Text="{Binding descriptionVia}" />                                                                <\/span>                                                                <span class="drCost" style:display="{Binding cost Converter=nullToDisplayNone}" data-tag="descriptionCost">                                                                    <TextBlock Text="{Binding cost}" />                                                                <\/span>                                                            <\/div>                                                            <div class="drTitleText">                                                                <span style:display="{Binding embellishment Converter=nullToDisplayNone}" data-tag="descriptionEmbellishment">                                                                    <span class="interpunct" style:display="{Binding descriptionVia Converter=nullToDisplayNone}">                                                                        <TextBlock Text="{Binding resources.L_Directions_Interpunct}" />                                                                    <\/span>                                                                    <span class="{Binding embellishment Converter=stringToEmbellishmentClassName}">                                                                        <span class="{Binding isLate Converter=boolToEmbellishmentClassName}">                                                                            <span class="{Binding isTransitEmbellishment Converter=boolToTransitEmbellishmentClassName}">                                                                                <TextBlock Text="{Binding embellishment}" />                                                                            <\/span>                                                                        <\/span>                                                                    <\/span>                                                                <\/span>                                                                <span class="drFreqency" style:display="{Binding frequency Converter=nullToDisplayNone}" data-tag="descriptionFreq">                                                                    <span class="interpunct">                                                                        <TextBlock Text="{Binding resources.L_Directions_Interpunct}" />                                                                    <\/span>                                                                    <TextBlock Text="{Binding frequency}" />                                                                <\/span>                                                            <\/div>                                                        <\/div>                                                    <\/td>                                                    <td class="drTitleRight" data-tag="descriptionDistance">                                                        <TextBlock Text="{Binding subtitle}" />                                                    <\/td>                                                <\/tr>                                            <\/table>                                            <table class="drTimeline" style:display="{Binding timelineSegments Converter=nullToDisplayNone}" style:width="{Binding timelineWidth Converter=fractionToPercent}" data-tag="drTimeline">                                                <ItemsControl ItemsSource="{Binding timelineSegments}" panelTagName="tr">                                                    <ItemsControl.ItemTemplate>                                                        <DataTemplate>                                                            <td style:width="{Binding width Converter=fractionToPercent}" class="{Binding className}" data-tag="drTimelineCell">                                                                <div style:background-color="{Binding lineColor}"><\/div>                                                                <span class="dirSvg svg"><\/span>                                                            <\/td>                                                        <\/DataTemplate>                                                    <\/ItemsControl.ItemTemplate>                                                <\/ItemsControl>                                            <\/table>                                        <\/div>                                    <\/td>                                <\/tr>                            <\/table>                        <\/a>                    <\/li>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>    <\/div>       <div data-tag="dirInstructions" style:display="{Binding showSeeAllRoutes Converter=boolToNotDisplay}">        <div>            <div class="dirPrintText" data-tag="dirPrintText" style:display="{Binding isSDK Converter=boolToNotDisplay}">                <a style:display="{Binding showPrint Converter=boolToDisplay}" href="#" role="button" event:click="onPrintDirectionsClick" aria-label="{Binding resources.L_Directions_Print}">                    <TextBlock Text="{Binding resources.L_Directions_Print}" />                <\/a>            <\/div>            <ItemsControl ItemsSource="{Binding directionsResultsListSet}">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <div style:display="{Binding showResults Converter=boolToDisplay}" data-tag="dirInstructionsList" event:mouseleave="onInstructionsMouseLeave" event:blur="onInstructionsMouseLeave">                            <ItemsControl ItemsSource="{Binding routeLegs}" panelTagName="div">                                <ItemsControl.ItemTemplate>                                    <DataTemplate>                                        <div class="{Binding legClassName}" data-tag="dirLegContainer">                                            <div data-index="{Binding index}" class="dirRouteLegTable" event:click="onLegTitleClick" style:display="{Binding showLegTitle Converter=boolToDisplay}" data-tag="routeLegTable">                                                <div style:display="table-row">                                                    <div class="legSpace" style:display="table-cell"><\/div>                                                    <div class="dirLegIcons" style:display="{Binding showInstructions Converter=boolToNotDisplay}" data-tag="dirLegIconContainer">                                                        <div>                                                            <div class="{Binding index Converter=indexToStartClass}" data-tag="dirLegIcon">                                                                <TextBlock Text="{Binding index Converter=indexToIconTextStart}" />                                                            <\/div>                                                            <div class="dirLegIconsGap" data-tag="dirLegIconsGap"><\/div>                                                            <div class="{Binding index Converter=indexToEndClass}" data-tag="dirLegIcon">                                                                <TextBlock Text="{Binding index Converter=indexToIconTextEnd}" />                                                            <\/div>                                                        <\/div>                                                    <\/div>                                                    <div style:display="table-cell">                                                        <div data-tag="dirLegRouteInfoContainer">                                                            <div class="dirLegTimeDistText" data-tag="dirLegTimeDistText">                                                                <TextBlock Text="{Binding timeDistanceText}" />                                                            <\/div>                                                            <div class="dirLegTitle" data-tag="dirLegTitle">                                                                <TextBlock text="{Binding legTitle}" />                                                            <\/div>                                                        <\/div>                                                    <\/div>                                                    <div style:display="table-cell">                                                        <div data-tag="arrow" class="{Binding showInstructions Converter=showGroupToClass}"><\/div>                                                    <\/div>                                                <\/div>                                            <\/div>                                            <div class="{Binding legInstructionsClassName}" style:display="{Binding showInstructions Converter=boolToDisplay}" data-tag="dirInstructionContainer">                                                <ItemsControl ItemsSource="{Binding instructionSteps}" panelTagName="div">                                                    <ItemsControl.ItemTemplate>                                                        <DataTemplate>                                                            <div style:display="{Binding show Converter=boolToDisplay}" class="{Binding cssClass}" role="{Binding role}" tabindex="0" event:click="onInstructionClick" event:mouseenter="onMouseEnter" event:keydown="onInstructionKeyDown" event:focus="onMouseEnter" data-tag="dirInstruction">                                                                <div class="bm_dirInstructionRow">                                                                    <div style:display="table-cell"><\/div>                                                                    <div style:display="table-cell"><\/div>                                                                    <div style:display="table-cell"><\/div>                                                                    <div style:display="table-cell"><\/div>                                                                <\/div>                                                                <div class="bm_dirInstructionRow">                                                                    <div style:border-color="{Binding transitLineColor}" class="bm_dirLeftSpace">                                                                        <TextBlock Text="{Binding timeText}" />                                                                    <\/div>                                                                    <div style:display="table-cell" aria-hidden="true" style:visibility="{Binding showIcon Converter=boolToVisibility}">                                                                        <div class="{Binding transitLineColor Converter=lineColorToIconClass}" style:background-color="{Binding transitLineColor}">                                                                            <TextBlock Text="{Binding iconText}" />                                                                            <div class="dirSvg svg"><\/div>                                                                            <img src="{Binding roadShieldUrl}" style:display="{Binding roadShieldUrl Converter=nullToDisplayNone}" />                                                                        <\/div>                                                                    <\/div>                                                                    <div class="dirInstruction">                                                                        <p style:display="{Binding isClickable Converter=boolToNotDisplay}">                                                                            <TextBlock Text="{Binding stepText}" />                                                                        <\/p>                                                                        <a data-q="{Binding stepText}" data-eid="{Binding entityId}" data-sf="{Binding searchFilter}" style:display="{Binding isClickable Converter=boolToDisplay}" href="#" event:click="onStepTextClick" aria-label="{Binding waypointTitle}" role="button">                                                                            <TextBlock Text="{Binding stepText}" />                                                                        <\/a>                                                                        <p style:display="{Binding startTimeHint Converter=nullToDisplayNone}">                                                                            <TextBlock Text="{Binding startTimeHint}" />                                                                        <\/p>                                                                        <p style:display="{Binding endTimeHint Converter=nullToDisplayNone}">                                                                            <TextBlock Text="{Binding endTimeHint}" />                                                                        <\/p>                                                                        <p style:display="{Binding stepAddress Converter=nullToDisplayNone}">                                                                            <TextBlock Text="{Binding stepAddress}" />                                                                        <\/p>                                                                        <ItemsControl ItemsSource="{Binding viaPoints}">                                                                            <ItemsControl.ItemTemplate>                                                                                <DataTemplate>                                                                                    <p class="dirVia">                                                                                        <span>                                                                                            <TextBlock Text="{Binding text}" />                                                                                        <\/span>                                                                                        <a href="#" event:click="onRemoveViaClick" role="button" data-wpi="{Binding waypointIndex}" data-vwpi="{Binding viaPointIndex}" aria-label="{Binding removeLinkText}" role="button">                                                                                            <TextBlock Text="{Binding removeLinkText}" />                                                                                        <\/a>                                                                                    <\/p>                                                                                <\/DataTemplate>                                                                            <\/ItemsControl.ItemTemplate>                                                                        <\/ItemsControl>                                                                        <ItemsControl ItemsSource="{Binding childSteps}">                                                                            <ItemsControl.ItemTemplate>                                                                                <DataTemplate>                                                                                    <p>                                                                                        <TextBlock Text="{Binding stepText}" />                                                                                    <\/p>                                                                                <\/DataTemplate>                                                                            <\/ItemsControl.ItemTemplate>                                                                        <\/ItemsControl>                                                                        <div style:display="{Binding showHints Converter=boolToDisplay}">                                                                            <ItemsControl ItemsSource="{Binding hints}">                                                                                <ItemsControl.ItemTemplate>                                                                                    <DataTemplate>                                                                                        <p class="dirHint" data-tag="dirHint">                                                                                            <TextBlock Text="{Binding text}" />                                                                                        <\/p>                                                                                    <\/DataTemplate>                                                                                <\/ItemsControl.ItemTemplate>                                                                            <\/ItemsControl>                                                                        <\/div>                                                                        <div style:display="{Binding showWarnings Converter=boolToDisplay}">                                                                            <ItemsControl ItemsSource="{Binding warnings}">                                                                                <ItemsControl.ItemTemplate>                                                                                    <DataTemplate>                                                                                        <p class="{Binding severity Converter=getWarningIconClass}" data-tag="{Binding severity Converter=getWarningIconClass}">                                                                                            <TextBlock Text="{Binding text}" />                                                                                        <\/p>                                                                                    <\/DataTemplate>                                                                                <\/ItemsControl.ItemTemplate>                                                                            <\/ItemsControl>                                                                        <\/div>                                                                        <p class="dirSpecialAttribution" data-tag="dirSpecialAttribution" style:display="{Binding specialAttributionUri Converter=nullToDisplayNone}">                                                                            <TextBlock Text="{Binding resources.L_Data_Special_Attribution}" />                                                                            <a href="{Binding specialAttributionUri}" target="_blank" role="button" aria-level="{Binding resources.DirectionSpecialAttributionAriaLabel}">                                                                                <TextBlock Text="{Binding specialAttributionLink}" />                                                                            <\/a>                                                                        <\/p>                                                                        <a href="#" role="button" style:display="{Binding showNearbyParking Converter=boolToDisplay}" event:click="onNearbyParkingClick">                                                                            <TextBlock Text="{Binding resources.L_Nearby_Parking}" />                                                                        <\/a>                                                                    <\/div>                                                                    <div class="bm_dirInstructionArrow">                                                                        <div data-tag="arrow" class="{Binding showGroup Converter=showGroupToClass}" style:display="{Binding groupItems Converter=arrayToDisplay}">                                                                        <\/div>                                                                    <\/div>                                                                <\/div>                                                                <div class="bm_dirInstructionRow">                                                                    <div class="bm_dirLeftSpace" style:display="{Binding travelDistanceText Converter=nullToDisplayNone}" data-tag="dirInstructionTravelDistance">                                                                        <div class="dirInstructionTravelDistance">                                                                            <TextBlock Text="{Binding travelDistanceText}" />                                                                        <\/div>                                                                    <\/div>                                                                    <div style:display="table-cell"><\/div>                                                                    <div style:display="table-cell"><\/div>                                                                    <div style:display="table-cell"><\/div>                                                                <\/div>                                                                <div class="bm_dirInstructionRow">                                                                    <div style:display="table-cell"><\/div>                                                                    <div style:display="table-cell"><\/div>                                                                    <div style:display="table-cell"><\/div>                                                                    <div style:display="table-cell"><\/div>                                                                <\/div>                                                            <\/div>                                                        <\/DataTemplate>                                                    <\/ItemsControl.ItemTemplate>                                                <\/ItemsControl>                                            <\/div>                                        <\/div>                                    <\/DataTemplate>                                <\/ItemsControl.ItemTemplate>                            <\/ItemsControl>                        <\/div>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>    <\/div>    <div class="reportProblemLink" data-tag="reportProblemLink" style:display="{Binding isSDK Converter=boolToNotDisplay}">        <a href="#" event:click="reportProblem" role="button" aria-label="{Binding resources.L_Report_Problem_Link}">            <TextBlock Text="{Binding resources.L_Report_Problem_Link}" />        <\/a>    <\/div>    <div class="dirAttribution" data-tag="dirAttribution" style:display="{Binding showAttribution Converter=boolToDisplay}">        <TextBlock Text="{Binding resources.L_Data_Attribution}" />        <ItemsControl ItemsSource="{Binding transitAttributions}">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <p>                        <a href="{Binding uri}" target="_blank" class="{Binding uri Converter=emptyUriToClass}" data-tag="dirTransitAttribution">                            <TextBlock Text="{Binding agencyName}" />                        <\/a>                    <\/p>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>    <\/div>    <div class="dirDisclaimer" data-tag="dirDisclaimer" style:display="{Binding showDisclaimer Converter=boolToDisplay}">        <TextBlock Text="{Binding disclaimerText}" />    <\/div>    <div class="dirTransitLogo" data-tag="dirTransitLogo" style:display="{Binding showTransitLogo Converter=boolToDisplay}">    <\/div><\/div>',sf='<div class="dragOverlay" data-events-for="ms-composite">    <div class="dragPin" style:visibility="{Binding ShowPin Converter=boolToVisibility}"><\/div>    <div class="clear"><\/div>    <div class="dragPinMessage" style:visibility="{Binding ShowTip Converter=boolToVisibility}">        <p style:display="{Binding ShowDragTip Converter=boolToDisplay}">            <TextBlock Text="{Binding resources.L_Directions_Drag_Pin_Tip}"/>        <\/p>        <p style:display="{Binding ShowPreviewTip Converter=boolToDisplay}">            <TextBlock Text="{Binding resources.L_Directions_Turn_Preview_Tip}"/>        <\/p>    <\/div><\/div>',hf='<div>  <div style:display="{Binding showResults Converter=boolToDisplay}" data-tag="dirInstructionsList" event:mouseleave="onInstructionsMouseLeave">    <ItemsControl ItemsSource="{Binding routeLegs}" panelTagName="div">      <ItemsControl.ItemTemplate>        <DataTemplate>          <div class="{Binding legClassName}" data-tag="dirLegContainer">            <div data-index="{Binding index}" style:display="{Binding showLegTitle Converter=boolToDisplay}" data-tag="routeLegTable">                <div class="dirLegIcons" data-tag="dirLegIconContainer">                    <div>                        <span class="dirStartLegIcon" data-tag="dirStartLegIcon">                            <span>                                                                <span class="{Binding startIconType Converter=waypointTypeToClass}">                                    <TextBlock  Text="{Binding index Converter=indexToIconTextStart}" />                                <\/span>                            <\/span>                        <\/span>                        <span class="legFromTo">                            <TextBlock Text="{Binding resources.L_Directions_Leg_To}" />                        <\/span>                        <span class="dirEndLegIcon" data-tag="dirEndLegIcon">                            <span>                                <span class="{Binding endIconType Converter=waypointTypeToClass}">                                    <TextBlock  Text="{Binding index Converter=indexToIconTextEnd}" />                                <\/span>                            <\/span>                        <\/span>                                                    <\/div>                <\/div>                <div>                    <div class="dirLegRouteInfoContainer" data-tag="dirLegRouteInfoContainer">                        <p class="dirLegTimeDistText" data-tag="dirLegTimeDistText">                            <TextBlock Text="{Binding timeDistanceText}" />                        <\/p>                    <\/div>                <\/div>            <\/div>            <div class="startWaypointTitle" data-tag="startWaypointTitle" >                <span class="dirStartLegIcon" data-tag="dirStartLegIcon">                    <span>                                                <span class="{Binding startIconType Converter=waypointTypeToClass}">                            <TextBlock Text="{Binding index Converter=indexToIconTextStart}" />                        <\/span>                    <\/span>                <\/span>                <span class="waypointAddressTitle">                    <TextBlock Text="{Binding startWaypointAddress}" />                <\/span>            <\/div>              <div class="dirInstructionContainer">                  <div class="{Binding legInstructionsClassName}" style:display="{Binding showInstructions Converter=boolToDisplay}" data-tag="dirInstructionContainer">                      <ItemsControl ItemsSource="{Binding instructionSteps}" panelTagName="ul">                          <ItemsControl.ItemTemplate>                              <DataTemplate>                                  <li class="instructionContainer" style:display="{Binding show Converter=boolToDisplay}">                                      <div class="directionsStepOuterBox">                                          <div class="wrapper">                                              <div class="{Binding parentStepIndex Converter=indexToOddEvenBackgroundClass}">                                              <\/div>                                          <\/div>                                          <div class="instructionStep">                                              <table>                                                  <tbody style:display="{Binding show Converter=boolToDisplay}" class="{Binding cssClass}" event:click="onInstructionClick" event:mouseenter="onMouseEnter" data-tag="dirInstruction">                                                      <tr><th colspan="5"><\/th><\/tr>                                                      <tr>                                                          <td class="printDirIcon">                                                              <table>                                                                  <tr>                                                                      <td class="transitTimeText">                                                                          <div>                                                                              <TextBlock Text="{Binding timeText}" />                                                                          <\/div>                                                                      <\/td>                                                                      <td>                                                                          <div class="dirIcon">                                                                              <div class="dirSvg svg"><\/div>                                                                              <img src="{Binding roadShieldUrl}" style:display="{Binding roadShieldUrl Converter=nullToDisplayNone}" />                                                                          <\/div>                                                                      <\/td>                                                                  <\/tr>                                                              <\/table>                                                          <\/td>                                                          <td class="instructionStepIndex">                                                              <div style:display="{Binding stepIndex Converter=nullToDisplayNone}">                                                                  <TextBlock Text="{Binding stepIndex}" />                                                                  <TextBlock Text="{Binding resources.L_Print_InstructionIndexSeparator}" />                                                              <\/div>                                                          <\/td>                                                          <td class="dirInstruction">                                                              <p>                                                                  <FormattedTextBlock Formattedtext="{Binding formattedText}" />                                                              <\/p>                                                              <p style:display="{Binding stepAddress Converter=nullToDisplayNone}">                                                                  <TextBlock Text="{Binding stepAddress}" />                                                              <\/p>                                                              <ItemsControl ItemsSource="{Binding viaPoints}">                                                                  <ItemsControl.ItemTemplate>                                                                      <DataTemplate>                                                                          <p class="dirVia">                                                                              <span>                                                                                  <TextBlock Text="{Binding text}" />                                                                              <\/span>                                                                              <a href="#" event:click="onRemoveViaClick" data-wpi="{Binding waypointIndex}" data-vwpi="{Binding viaPointIndex}">                                                                                  <TextBlock Text="{Binding removeLinkText}" />                                                                              <\/a>                                                                          <\/p>                                                                      <\/DataTemplate>                                                                  <\/ItemsControl.ItemTemplate>                                                              <\/ItemsControl>                                                              <ItemsControl ItemsSource="{Binding childSteps}">                                                                  <ItemsControl.ItemTemplate>                                                                      <DataTemplate>                                                                          <p>                                                                              <FormattedTextBlock Formattedtext="{Binding formattedText}" />                                                                          <\/p>                                                                      <\/DataTemplate>                                                                  <\/ItemsControl.ItemTemplate>                                                              <\/ItemsControl>                                                              <ItemsControl ItemsSource="{Binding hints}">                                                                  <ItemsControl.ItemTemplate>                                                                      <DataTemplate>                                                                          <p class="dirHint" data-tag="dirHint">                                                                              <TextBlock Text="{Binding text}" />                                                                          <\/p>                                                                      <\/DataTemplate>                                                                  <\/ItemsControl.ItemTemplate>                                                              <\/ItemsControl>                                                              <ItemsControl ItemsSource="{Binding warnings}">                                                                  <ItemsControl.ItemTemplate>                                                                      <DataTemplate>                                                                          <p class="{Binding severity Converter=getWarningIconClass}" data-tag="{Binding severity Converter=getWarningIconClass}">                                                                              <TextBlock Text="{Binding text}" />                                                                          <\/p>                                                                      <\/DataTemplate>                                                                  <\/ItemsControl.ItemTemplate>                                                              <\/ItemsControl>                                                              <p class="dirSpecialAttribution" data-tag="dirSpecialAttribution" style:display="{Binding specialAttributionUri Converter=nullToDisplayNone}">                                                                  <TextBlock Text="{Binding resources.L_Data_Special_Attribution}" />                                                                  <a href="{Binding specialAttributionUri}" target="_blank">                                                                      <TextBlock Text="{Binding specialAttributionLink}" />                                                                  <\/a>                                                              <\/p>                                                              <a href="#" style:display="{Binding showNearbyParking Converter=boolToDisplay}" event:click="onNearbyParkingClick">                                                                  <TextBlock Text="{Binding resources.L_Nearby_Parking}" />                                                              <\/a>                                                          <\/td>                                                          <td class="dirTravelDistance" style:display="{Binding travelDistanceText Converter=nullToDisplayNone}" data-tag="dirInstructionTravelDistance">                                                              <span>                                                                  <TextBlock Text="{Binding travelDistanceText}" />                                                              <\/span>                                                              <span class="dirTravelTime" style:display="{Binding travelDurationText Converter=nullToDisplayNone}" data-tag="dirInstructionTravelTime">                                                                  <span>                                                                      <TextBlock Text="{Binding resources.L_Directions_TimeDistance_Separator}" />                                                                      <TextBlock Text="{Binding travelDurationText}" />                                                                  <\/span>                                                              <\/span>                                                          <\/td>                                                      <\/tr>                                                      <tr><th colspan="5"><\/th><\/tr>                                                  <\/tbody>                                              <\/table>                                          <\/div>                                      <\/div>                                  <\/li>                              <\/DataTemplate>                          <\/ItemsControl.ItemTemplate>                      <\/ItemsControl>                  <\/div>              <\/div>            <div class="endWaypointTitle" data-tag="endWaypointTitle">                <span class="dirEndLegIcon" data-tag="dirEndLegIcon">                    <span>                                                <span class="{Binding endIconType Converter=waypointTypeToClass}">                            <TextBlock Text="{Binding index Converter=indexToIconTextEnd}" />                        <\/span>                    <\/span>                <\/span>                <span class="waypointAddressTitle">                    <TextBlock Text="{Binding endWaypointAddress}" />                <\/span>            <\/div>          <\/div>        <\/DataTemplate>      <\/ItemsControl.ItemTemplate>    <\/ItemsControl>  <\/div><\/div>',cf='<div class="{Binding LabelRootClass}"  style:z-index="{Binding ZIndex}" data-tag="{Binding LabelRootClass}">    <p data-tag="routeLabelTime">            <TextBlock Text="{Binding TimeText}"/>    <\/p>    <p data-tag="routeLabelDistance">            <TextBlock Text="{Binding DistanceText}"/>    <\/p><\/div>',lf='<div>    <li style:display="{Binding isSelected Converter=boolToDisplay}" data-tag="{Binding isSelected Converter=boolToSelectedTitleClassName}">        <a href="#" data-tag="directionsRouteLink">            <table class="routeSummary">                <tr>                    <td class="routeSummaryTitle">                        <div class="{Binding isSelected Converter=boolToSelectedDurationClassName}">                            <div class="drDurationRoot">                                <div class="drDurationTable">                                    <div class="drHrDisplay" style:display="{Binding hours Converter=nullToDisplayNone}">                                        <span class="drHours" data-tag="drHours">                                            <TextBlock Text="{Binding hours}" />                                        <\/span>                                        <span class="drHoursLabel" data-tag="drHoursLabel">                                            <TextBlock Text="{Binding resources.L_Directions_Hour}" />                                        <\/span>                                    <\/div>                                    <div class="hoursMinsSeparator" style:display="{Binding hours Converter=nullToDisplayNone}">                                        <TextBlock Text="{Binding resources.L_Directions_Hour_Min_Separator}" />                                    <\/div>                                    <div class="drMinDisplay">                                        <span class="drMins" data-tag="drMins">                                            <TextBlock Text="{Binding minutes}" />                                        <\/span>                                        <span class="drMinsLabel" data-tag="drMinsLabel">                                            <TextBlock Text="{Binding resources.L_Directions_Minute}" />                                        <\/span>                                    <\/div>                                <\/div>                            <\/div>                        <\/div>                        <div class="drTitleRight" data-tag="descriptionDistance">                            <div class="timeDistanceSeparator" style:display="{Binding routeMode Converter=modeToDisplay}">                                <TextBlock Text="{Binding resources.L_Directions_TimeDistance_Separator}" />                            <\/div>                            <TextBlock Text="{Binding subtitle}" />                        <\/div>                    <\/td>                <\/tr>                <tr>                    <td class="routeDetails">                        <div class="drTitleRoot">                            <table class="drTitleTable">                                <tr>                                <td>                                    <span class="{Binding trafficConditionClassName}" style:display="{Binding trafficCondition Converter=nullToDisplayNone}" data-tag="descriptionTrafficCondition">                                        <TextBlock Text="{Binding trafficCondition}" />                                    <\/span>                                    <span class="drTitleLeft titleFont" style:display="{Binding mainTitle Converter=nullToDisplayNone}">                                        <TextBlock Text="{Binding mainTitle}" />                                    <\/span>                                              <span class="drTitleText" style:display="{Binding descriptionTimeNoTraffic Converter=nullToDisplayNone}" data-tag="descriptionTimeNoTraffic">                                        <TextBlock Text=" (" />                                        <TextBlock Text="{Binding descriptionTimeNoTraffic}" />                                        <TextBlock Text=")" />                                    <\/span>                                            <div class="drTitleText" style:display="{Binding descriptionVia Converter=nullToDisplayNone}" data-tag="descriptionVia">                                        <span>                                            <TextBlock Text="{Binding descriptionVia}" />                                        <\/span>                                        <span class="drFreqency" style:display="{Binding frequency Converter=nullToDisplayNone}" data-tag="descriptionFreq">                                            <span class="interpunct">                                                <TextBlock Text="{Binding resources.L_Directions_Interpunct}" />                                            <\/span>                                            <TextBlock Text="{Binding frequency}" />                                        <\/span>                                    <\/div>                                    <span style:display="{Binding embellishment Converter=nullToDisplayNone}" data-tag="descriptionEmbellishment">                                        <span class="interpunct">                                            <TextBlock Text="{Binding resources.L_Directions_Interpunct}" />                                        <\/span>                                        <span class="{Binding embellishment Converter=stringToEmbellishmentClassName}">                                            <span class="{Binding isLate Converter=boolToEmbellishmentClassName}">                                                <TextBlock Text="{Binding embellishment}" />                                            <\/span>                                        <\/span>                                                                        <\/span>                                <\/td>                                <\/tr>                            <\/table>                            <table class="drTimeline" style:display="{Binding timelineSegments Converter=nullToDisplayNone}" style:width="{Binding timelineWidth Converter=fractionToPercent}" data-tag="drTimeline">                                <ItemsControl ItemsSource="{Binding timelineSegments}" panelTagName="tr">                                <ItemsControl.ItemTemplate>                                    <DataTemplate>                                    <td style:width="{Binding width Converter=fractionToPercent}" class="{Binding className}" data-tag="drTimelineCell">                                        <div><\/div>                                        <span class="svg"><\/span>                                    <\/td>                                    <\/DataTemplate>                                <\/ItemsControl.ItemTemplate>                                <\/ItemsControl>                            <\/table>                        <\/div>                    <\/td>                <\/tr>            <\/table>        <\/a>    <\/li><\/div>',w=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),pi=[new g("attractionsIcon",i.L_Directions_Categories_Bar_Entity_Attractions,0,"Attractions","90012"),new g("hotelsIcon",i.L_Directions_Categories_Bar_Entity_Hotels,1,"TravelAccomodations","91572"),new g("restaurantsIcon",i.L_Directions_Categories_Bar_Entity_Restaurants,2,"Restaurants","90287"),new g("coffeeIcon",i.L_Directions_Categories_Bar_Entity_Coffee,3,"Coffee","91649"),new g("gasStationsIcon",i.L_Directions_Categories_Bar_Entity_GasStations,4,"GasStations","90089"),new g("groceryStoresIcon",i.L_Directions_Categories_Bar_Entity_GroceryStores,5,"Supermarkets","91493")],af=[new g("restaurantsIcon",i.CategoriesBar_Food,2,"Restaurants","90287",i.L_Directions_Categories_Bar_Entity_Restaurants),new g("coffeeIcon",i.L_Directions_Categories_Bar_Entity_Coffee,3,"Coffee","91649"),new g("hotelsIcon",i.L_Directions_Categories_Bar_Entity_Hotels,1,"TravelAccomodations","91572"),new g("attractionsIcon",i.L_Directions_Categories_Bar_Entity_Attractions,0,"Attractions","90012"),],uo=[new g("attractionsIcon",i.L_Directions_Categories_Bar_Entity_Attractions,0,"Attractions","90012"),new g("hotelsIcon",i.L_Directions_Categories_Bar_Entity_Hotels,1,"TravelAccomodations","91572"),new g("restaurantsIcon",i.L_Directions_Categories_Bar_Entity_Restaurants,2,"Restaurants","90287"),new g("fastFoodIcon",i.L_Directions_Categories_Bar_Entity_FastFood,6,"FastFood","90287"),new g("gasStationsIcon",i.L_Directions_Categories_Bar_Entity_GasStations,4,"GasStations","90089"),new g("groceryStoresIcon",i.L_Directions_Categories_Bar_Entity_GroceryStores,5,"Supermarkets","91493")],vf=function(n){function t(t){var i=n.call(this)||this;return i.type=y.directionsFlipTask,i._controlTemplateFactory=t,i.displayState={colorIndex:0,groupName:"Directions"},i}return w(t,n),t.prototype.activate=function(t,i){n.prototype.activate.call(this,t,i);i&&i.incident&&(this._taskState=i,this.setIncident(i.incident));this.parentTaskId=i&&i.parentId},t.prototype.getIconColorAndClassName=function(n){n("#227AB0","directionsFlipTask")},t.prototype.deactivate=function(){var t={requestorType:"DirectionsFlipTask",requestorId:this.id,type:y.directionsTask,requestState:{action:6},taskId:this.parentTaskId};a.invokeHandler(l.taskProcessDataHandlerKey,t);n.prototype.deactivate.call(this)},t.prototype.processCallback=function(){},t.prototype.process=function(n){var t=n.requestState,i;t.incident&&(this._taskState=t,this.setIncident(t.incident),i={activationState:1,prominence:1},this.setDisplayState(i))},t.prototype.setIncident=function(){this.setTitle(this._taskState.incident.description);this._viewModel&&this._viewModel.dispose();var n=this._viewModel=new gf(this._controlTemplateFactory,this._taskState.incident,this.map,this.id);this.addControl(n.getControl());yr&&yr.saveIncident(this._taskState.incident)},t.prototype.serialize=function(){return this._taskState},t.prototype.setDisplayState=function(t){if(n.prototype.setDisplayState.call(this,t),this.displayState.activationState===1&&this.displayState.prominence===1){var i={requestorType:"DirectionsFlipTask",requestorId:this.id,type:y.directionsTask,requestState:{action:5},taskId:this.parentTaskId};a.invokeHandler(l.taskProcessDataHandlerKey,i)}},t.prototype.getCardIconInfo=function(){return{iconClass:"trfkTsk"}},t.prototype.isSharable=function(){return!1},t.prototype.hasDefaultFocusElement=function(){return!0},t}(rr),f;(function(n){n[n.Success=0]="Success";n[n.UnknownError=1]="UnknownError";n[n.CantFindNearbyRoad=2]="CantFindNearbyRoad";n[n.TooFar=3]="TooFar";n[n.NoSolution=4]="NoSolution";n[n.DataSourceNotFound=5]="DataSourceNotFound";n[n.CacheMiss=6]="CacheMiss";n[n.NoAvailableTransitTrip=7]="NoAvailableTransitTrip";n[n.TransitStopsTooClose=8]="TransitStopsTooClose";n[n.WalkingBestAlternative=9]="WalkingBestAlternative";n[n.OutOfTransitBounds=10]="OutOfTransitBounds";n[n.TimeoutOccurred=11]="TimeoutOccurred";n[n.SkpError=12]="SkpError";n[n.NoNearbyStops=13]="NoNearbyStops";n[n.RateLimiterRejected=14]="RateLimiterRejected";n[n.ParameterValidationError=15]="ParameterValidationError";n[n.atleastTwoWaypointRequired=16]="atleastTwoWaypointRequired";n[n.generalError=17]="generalError";n[n.noResults=18]="noResults";n[n.searchServiceFailed=19]="searchServiceFailed";n[n.otherError=20]="otherError"})(f||(f={}));var yf=function(n){function t(t){var u=this,r={};return u=n.call(this,r,t,sf)||this,r.defineProperty("showTip",null,null,{defaultValue:!1}),r.defineProperty("showPin",null,null,{defaultValue:!1}),r.defineProperty("showDragTip",null,null,{defaultValue:!1}),r.defineProperty("showPreviewTip",null,null,{defaultValue:!1}),u.resources=i,u}return w(t,n),t}(ft),pf=function(n){function t(t){var i=this,r=new k(0,0),u=new p(0,0);return i=n.call(this,null,r,u)||this,i._overlayViewModel=new yf(t),i.setOverlayElement(i._overlayViewModel.getControl()),i}return w(t,n),t.prototype.setShowTip=function(n,t){var i=n||t;i&&(this._overlayViewModel.setShowDragTip(n),this._overlayViewModel.setShowPreviewTip(t));this._overlayViewModel.setShowTip(i)},t.prototype.setShowPin=function(n){this._overlayViewModel.setShowPin(n)},t}(sr),oi=function(){function i(n,t,i){this._map=t;this._controlTemplateFactory=i;this._routePins=[];this.routeLinePoints=[];this._primitivesPins=[];this._index=n;this._polylines=[];this._trafficPins=[];this._taskState=1}return i.prototype.select=function(){var n,t,i;if(this._isCurrentlySelected=!0,this._updatePrimitives(),this._labelOverlay&&this._labelOverlay.setIsSelected(!0),this._trafficPins&&this._trafficPins.length){for(n=0,t=0;t<this._trafficPins.length;t++)this._trafficPins[t].incident&&this._trafficPins[t].incident.type===12&&n++;i=this._trafficPins.length-n;n&&v.logInstrumentationEvent(c.CAM,{CTC:n});i&&v.logInstrumentationEvent(c.WARN,{CTC:i})}},i.prototype.unSelect=function(){this._isCurrentlySelected=!1;this._updatePrimitives();this._labelOverlay&&this._labelOverlay.setIsSelected(!1)},i.prototype.show=function(){this._updatePrimitives()},i.prototype.setTaskPrimitiveState=function(n){this._taskState=n;this._taskState===1?this.showLabel():this.hideLabel();this._updatePrimitives()},i.prototype.createIncidentPins=function(n){var r,t,u;if(n)for(r=0;r<n.length;r++)if(t=n[r],t&&t.origin&&(u=k.parseLatLong(t.origin),u)){var f={type:"Point",coordinates:[u.latitude,u.longitude]},e={point:f,description:t.text,type:i.parseIncidentType(t.warningType),severity:i.parseIncidentSeverity(t.severity)},o=new gt(e,null,!0);this._trafficPins.push(o)}},i.prototype.createCameraPins=function(n){for(var i=0;i<n.length;i++){var t=n[i],r={type:"Point",coordinates:t.location.coordinates},u={imageUrl:t.url},f={point:r,copyright:t.copyrightNotice,description:t.name,incidentId:t.id,type:12,images:[u]},e=new gt(f,null,!0);this._trafficPins.push(e)}},i.prototype.createPolyLineAndStopPins=function(n,i,r,u,f,e,o,s,c){var nt,tt=n.routePath.line.coordinates,y=[],it=!0,d,rt,p,w,l,a,g;if(!this.routeLinePoints.length){for(l=0;l<tt.length;l++)d=tt[l],rt=new k(d[0],d[1]),this.routeLinePoints.push(rt);it=!1}if(u){for(p=[],w=0,l=1;l<u.length;l++)u[l].routeLegStopPoint.isVia?w++:(p.push(w),w=0);var v=0,b=0,ut=[],ft=[],et={annotationIndex:0,lastEnd:0};for(l=0;l<u.length;l++){if(a=u[l],l!==0&&(a.routeLegStopPoint.isVia?b++:(v++,b=0)),e){if(l!==0){var ot=u[l-1].routeLegStopPoint.routePathIndex,st=a.routeLegStopPoint.routePathIndex,ht=this.routeLinePoints.slice(ot,st+1);y.push(this._convertPointsToPolyline(ht,o,null,i,v,b,r,p[v],c))}}else a.itineraryItems&&a.itineraryItems.length>0&&this.createOptimizedPolylineCollection(n.routeLegs[v],a,et,i,r,v,p,y,o,s,c);it||(l===0||t.enableMultiMode&&a.categoryName?(g=h.start,l!==0&&a.categoryName==="parkandrides"&&(g=h.parkAndRide),this.addStopPointPin(a.routeLegStopPoint,g,f[l],r,o,l,-1)):this.addViaOrStopPoint(r,a.routeLegStopPoint,f,v,b,l===u.length-1,ut,ft,o))}this._commitStopPointPin(ft);this._commitStopPointPin(ut)}y&&y.length&&(nt=this._polylines).push.apply(nt,y)},i.prototype.dispose=function(){u._disposeEvents(this);this._map=null;this._controlTemplateFactory=null;u._clearDisposables([this._primitivesPins,this._labelOverlay,this._routePins,this._trafficPins]);for(var n=0;n<this._polylines.length;n++)u._clearDisposables(this._polylines[n]);this._polylines=[]},i._constructWaypointQueueItem=function(n,t,i,r,u,f,e){return{stopPoint:n,pushpinType:t,instructionViewModel:i,routeMode:r,renderOptions:u,stopPointIndex:f,viaPointIndex:e}},i._isManeuverEqual=function(n,t){return n.mode===t.mode&&n.isFerry===t.isFerry},i.getViaIndexes=function(n){var u=[],r=n.routeSubLegs,t,i;if(r.length>1)for(t=0;t<r.length;t++)i=r[t],i.endWaypoint&&i.endWaypoint.isVia&&u.push(i.endWaypoint.routePathIndex);return u},i.getViasInSegment=function(n,t,i){for(var u=[],r=0;r<n.length;r++)n[r]>=t&&n[r]<i&&u.push(n[r]);return u},i.getAnnotationState=function(n,t,r,u){for(var o,s,h,f={endIndex:t,manuever:u},e=0;e<r.length;e++)if(e+1<r.length){if(o=r[e],s=r[e+1],o.index<=n&&n<s.index)return i.setTrafficTypeFromAnnotaions(o,f),f.endIndex=s.index,f}else return h=r[r.length-1],i.setTrafficTypeFromAnnotaions(h,f),f;return f},i.setTrafficTypeFromAnnotaions=function(n,t){if(n&&n.traffic){var i=n.traffic;(i==="Moderate"||i==="Heavy"||i==="High")&&(t.manuever.mode=i)}},i.parseIncidentSeverity=function(n){var t=1;if(n)switch(n.toLowerCase()){case"minor":t=2;break;case"moderate":t=3;break;case"serious":t=4}return t},i.parseIncidentType=function(n){switch(n.toLowerCase()){case"scheduledconstruction":return 9;case"accident":return 1;case"trafficflow":return 2;case"disabledvehicle":return 3;case"masstransit":return 4;case"miscellaneous":return 5;case"othernews":case"other":return 6;case"plannedevent":return 7;case"alert":return 10;case"roadhazard":return 8;case"weather":return 11}return null},i.prototype._convertPointsToPolyline=function(i,r,u,f,e,o,s,h){var c;if(t.isSDK&&r)switch(s){case n.transit:c=u&&u.mode==="Walk"?r.walkingPolylineOptions:r.transitPolylineOptions;break;case n.walking:c=r.walkingPolylineOptions;break;default:c=r.drivingPolylineOptions}return new ni(i,this._index,f,e,o,s,h,u,c)},i.prototype.createOptimizedPolylineCollection=function(t,r,u,f,e,o,s,h,c,l,a){for(var y,it,rt,ft,g,w,et,v=[],ot=r.routeLegStopPoint.routePathIndex,ht=i.getViaIndexes(t),k=0,b={mode:r.itineraryItems[0].iconType,isFerry:r.itineraryItems.length>0&&r.itineraryItems[0].details&&r.itineraryItems[0].details.length>0&&r.itineraryItems[0].details[0].roadType==="Ferry"},ut=0;ut<r.itineraryItems.length;ut++)if(r.itineraryItems[0].details&&r.itineraryItems[0].details.length>0&&r.itineraryItems[0].details[0].startPathIndices&&r.itineraryItems[0].details[0].startPathIndices.length>0&&r.itineraryItems[0].details[0].startPathIndices[0]!==0&&(ot=0),y=r.itineraryItems[ut],y&&y.details)for(it=!1;!it;){var nt=u.lastEnd,tt,p=null,ct=y.details&&y.details.length>0&&y.details[0].roadType==="Ferry",st={mode:y.iconType,isFerry:ct},d=0;if(y.details&&y.details.length>0&&y.details[y.details.length-1].endPathIndices&&y.details[y.details.length-1].endPathIndices.length>0&&(d=ot+y.details[y.details.length-1].endPathIndices[0]),e===n.driving&&l?(rt=i.getAnnotationState(nt,d,l,st),u.lastEnd=d<rt.endIndex?d:rt.endIndex,tt=rt.manuever,it=u.lastEnd===d):(u.lastEnd=d,tt=st,it=!0),ft=i._isManeuverEqual(tt,b),g=i.getViasInSegment(ht,nt,u.lastEnd),p=this.routeLinePoints.slice(nt,u.lastEnd+1),g.length===0)v.length&&!ft?(h.push(this._convertPointsToPolyline(v,c,b,f,o,k,e,s[o],a)),v=p):v=v.concat(p);else for(w=0;w<=g.length;){if(et=w<g.length?g[w]:u.lastEnd,p=this.routeLinePoints.slice(nt,et+1),nt=et,p.length===0){v=v.concat(p);k++;w++;continue}w===0&&ft?v=v.concat(p):v.length&&w>0?(h.push(this._convertPointsToPolyline(v,c,b,f,o,k-1,e,s[o],a)),v=p):v.length&&tt!==b?(h.push(this._convertPointsToPolyline(v,c,b,f,o,k,e,s[o],a)),v=p):v=v.concat(p);w<g.length&&k++;w++}b=tt}v.length&&h.push(this._convertPointsToPolyline(v,c,b,f,o,k,e,s[o],a))},i.prototype.addViaOrStopPoint=function(n,t,r,u,f,e,o,s,c){var a=h.middle,l;t.isVia?(l=i._constructWaypointQueueItem(t,h.via,null,n,c,u,f-1),o.push(l)):e?(a=h.end,this.addStopPointPin(t,a,r[r.length-1],n,c,u,f)):(l=i._constructWaypointQueueItem(t,a,r[u],n,c,u,f),s.push(l))},i.prototype._commitStopPointPin=function(n){for(var t,i=0;i<n.length;i++)t=n[i],this.addStopPointPin(t.stopPoint,t.pushpinType,t.instructionViewModel,t.routeMode,t.renderOptions,t.stopPointIndex,t.viaPointIndex)},i.prototype.addStopPointPin=function(n,t,i,r,u,f,e){var s,o;i?s=i.stepText:n&&(s=n.description);o=yt.createStopPointPin(new k(n.coordinates[0],n.coordinates[1]),t,r,!0,i,f,e,this,s,u);o&&this._primitivesPins.push(o);o&&i&&(i.pushpin=o)},i.prototype.addItineraryPin=function(t,i,r,u,f,e){if(f!==n.walking){var s=h[t.toLowerCase()],o=new wt(i.location,s,i,f,!0,this,i.stepIconClass,r,u,null,null,e,!0);this._primitivesPins.push(o);i.pushpin=o}},i.prototype.getPrimitives=function(n){var i,e=this._polylines.length,u,t,r,f;if(n&&e>1)if(this._taskState===3)i=[];else if(this._combinedPolyline)i=[this._combinedPolyline];else{for(t=void 0,r=0;r<e;r++)t=this._polylines[r],r===0?u=t.getLocations().slice():u.push.apply(u,t.getLocations());f=new ni(u,t.getIndex(),t.getMapType(),t.legIndex,t.subLegIndex,t.getRouteMode(),t.getNumberOfViaPoints());f.id=t.id+"_c";i=[f];this._combinedPolyline=f}else i=this._polylines.slice();return i.push.apply(i,this._primitivesPins),i.push.apply(i,this._trafficPins),i},i.prototype.getRoutepointNeighbors=function(n){var i;if(!this.routeLinePoints)return null;var e=n.latitude.toFixed(3),o=n.longitude.toFixed(3),r=[],u=null,f=null,t=-1;for(i=0;i<this.routeLinePoints.length;i++)if(this.routeLinePoints[i].latitude.toFixed(3)===e&&this.routeLinePoints[i].longitude.toFixed(3)===o){t=i;break}return t!==-1&&(t<this.routeLinePoints.length-1&&(f=this.routeLinePoints[t+1]),t>0&&(u=this.routeLinePoints[t-1])),r.push(u),r.push(f),r},i.prototype._updatePrimitives=function(){var n,i=this._polylines.slice(),t,r;for(this._combinedPolyline&&i.push(this._combinedPolyline),n=0;n<i.length;n++)t=i[n],t.changeCardTaskState(this._taskState),t.changeRouteSelectionState(this._isCurrentlySelected),t.update();for(n=0;n<this._primitivesPins.length;n++)this._primitivesPins[n].changeCardTaskState(this._taskState),this._primitivesPins[n].changeRouteSelectionState(this._isCurrentlySelected),this._primitivesPins[n].update();for(n=0;n<this._trafficPins.length;n++)this._isCurrentlySelected&&this._taskState===1?(r=this._trafficPins[n].viewState===2,this._trafficPins[n].viewState=r?2:0):this._trafficPins[n].viewState=3},i.prototype.setLabel=function(n,t){this._labelOverlay||(this._labelOverlay=new df(this._controlTemplateFactory));this._labelOverlay.setMessage(n,t)},i.prototype.setLabelLocation=function(n,t){this.labelLocation=n;this._isLabelLocationMiddle=t},i.prototype.showLabel=function(){this.labelLocation&&this._labelOverlay&&(this._taskState===1&&!this._labelOverlayShowing&&(!this._isLabelLocationMiddle||this._isLabelLocationMiddle&&this._isCurrentlySelected)&&(this._map.getOverlays().insert(this._labelOverlay),this._labelOverlayShowing=!0),this._labelOverlay.setAlignment(this.labelLocation))},i.prototype.hideLabel=function(){this._labelOverlay&&this._map.getOverlays().remove(this._labelOverlay);this._labelOverlayShowing=!1},i}(),c;(function(n){n[n.A=1]="A";n[n.GD=2]="GD";n[n.ARC=3]="ARC";n[n.SE=4]="SE";n[n.AC=5]="AC";n[n.RWTLC=6]="RWTLC";n[n.RPPC=7]="RPPC";n[n.WR=8]="WR";n[n.DR=9]="DR";n[n.PD=10]="PD";n[n.EXP=11]="EXP";n[n.COL=12]="COL";n[n.ARCM=13]="ARCM";n[n.CAM=14]="CAM";n[n.CAMCLK=15]="CAMCLK";n[n.ARCB=16]="ARCB";n[n.DBG=17]="DBG";n[n.SI=18]="SI";n[n.DMC=19]="DMC";n[n.CAMHVR=20]="CAMHVR";n[n.CAMPRLD=21]="CAMPRLD";n[n.INCCLK=22]="INCCLK";n[n.INCHVR=23]="INCHVR";n[n.WARN=24]="WARN"})(c||(c={}));v=function(){function n(){}return n.logInstrumentationEvent=function(i,r){if(!t.isSDK){var u={logData:{feature:n.featureName,action:c[i],data:r},impressionGuid:nt.dynamicProperties.mapsIG};a.invokeHandler(l.instrumentationDataHandlerKey,u)}},n.callMapSnRInstrumentation=function(n){if(!t.isSDK){var i={logData:{feature:"d",data:n}};a.invokeHandler(l.callServerInstrumentationDataHandlerKey,i)}},n.featureName="DD",n}(),function(n){n[n.RW=1]="RW";n[n.RR=2]="RR";n[n.PD=3]="PD";n[n.MR=4]="MR";n[n.PL=5]="PL";n[n.TD=6]="TD"}(st||(st={}));var at=function(){function t(){}return t.setClientPerf=function(n){t.perfLog=n},t.logPerfEvent=function(i,r){if(!t.perfLog)return null;var u=t.featureName;if(u+="_",r)switch(r){case n.driving:u+="D_";break;case n.transit:u+="T_";break;case n.walking:u+="W_";break;case n.multimode:u+="M_"}return u+=st[i],t.perfLog.start(u)},t.featureName="DD",t.keyForDragRequest="DR",t}(),wi=function(n){function r(t,r){var u=this,f={},e;return u=n.call(this,f)||this,u.resources=i,u.isBeingResolved=!1,u._waypointModel=t,u._panelViewModel=r,u.waypointDeleteEvent=new s,u._suggestionItemSelected=new s,u._suggestionItemSelected.add(function(n){u._onSuggestionItemSelected(n)}),u._suggestionItemClicked=new s,u._suggestionItemClicked.add(function(n){u._onSuggestionItemClicked(n)}),u._onFocus=new s,u._onFocus.add(function(n){u.onFocus(n)}),u._onAutosuggest=new s,u._onAutosuggest.add(function(n){r.onDropdown(n)}),u._onAutosuggestKeydown=new s,u._onAutosuggestKeydown.add(function(n){u.onAutosuggestKeydownFunction(n)}),f.defineProperty("index"),u.setIndex(-1),f.defineProperty("showDelete"),f.defineProperty("upHierarchy"),f.defineProperty("inputText",u._onInputTextChanged),f.defineProperty("printImagePath"),u.setPrintImagePath(""),u._updateInputText(),u.waypointType=1,e=i.L_InexactMatch.split("{0}"),u.resolveText1=e[0],u.resolveText2=e[1],u}return w(r,n),r.prototype.onDelete=function(n){if(n.preventDefault(),this._panelViewModel&&this.getIndex()===this._panelViewModel.waypoints.length-1){var t=this._panelViewModel.getControl().select(".dirWp")[this.getIndex()-1];o(t).select(".icon").swap_class("middle","end")}this.waypointDeleteEvent.invoke(this.getIndex())},r.prototype.setUpHierarchyResult=function(n){this._savedEntity=n;this.setUpHierarchy(n.getDescription())},r.prototype.onResolve=function(n){n.preventDefault();var t=this._savedEntity,i=t.getRoutableLocation();this.update(t.getDescription(),i?i:t.getLocation(),t.getTitle(),t);this._panelViewModel.addToHistory(t);this._clearSavedEntity()},r.prototype.onCloseResolve=function(n){n.preventDefault();this._clearSavedEntity()},r.prototype.getWayPointModel=function(){return this._waypointModel},r.prototype.update=function(n,t,r,u,f){var o,e,s,h;if(this.isBeingResolved=!1,this._waypointModel.address=n,this._waypointModel.point=t,this._waypointModel.name=r,this._waypointModel.isApproximate=!n,u&&!this._waypointModel.eid&&(this._waypointModel.eid=u.id),this._entity=u,this._updateInputText(),o=this.getIndex(),f&&(this._waypointModel.filterUrlParam=f.entityId,this._waypointModel.asName=f.formatedLine1,this._waypointModel.asFormattedAddress=f.formatedLine2,f.type!=="Favorite"&&f.type!=="Default"||t||(t=f.location,this._waypointModel.point=t),this._waypointModel.asType=1,f.type==="Favorite"?(this._waypointModel.asType=6,f.subType==="Home"&&(this._waypointModel.asType=4),f.subType==="Work"&&(this._waypointModel.asType=5)):f.type==="History"&&(this._waypointModel.asType=7)),r===i.L_Directions_MyLocation&&(this._waypointModel.asType=2),t){if(o<this._panelViewModel.waypoints.length-1)for(e=o+1;e<this._panelViewModel.waypoints.length;e++)if(s=this._panelViewModel.waypoints[e],h=s.getWayPointModel(),h.point)break;else s._autoSuggestModel.update(this._waypointModel,this._panelViewModel.getMode(),this._panelViewModel.getWaypointDataModels(),this._panelViewModel.contextId);this._panelViewModel.waypointResolvedEvent&&this._panelViewModel.waypointResolvedEvent.invoke(this)}},r.prototype.trim=function(){this._setInputTextFromCode(this.getInputText().trim())},r.prototype.isEmpty=function(){return!this.getInputText()},r.prototype.cancelAutosuggest=function(){this._autosuggest&&this._autosuggest.stopAutosuggest(!1)},r.prototype.initAutosuggest=function(n,t,i,r){var u=o(".dirWaypoints",n[0]),f=o("input",u[0]),l=o("a.backArrowButton",u[0]),e=o(".searchboxWithAS",n[0]),s,h,c;e&&f&&t&&(s=o(f[this.getIndex()]),h=o(e[0]),this._autoSuggestModel=new ot,this._autosuggest&&this._autosuggest.removeEventHandlers(),this._autosuggestViewModel=new du(this._autoSuggestModel,i),c="as_container_directions",this._autosuggest=this._createAutoSuggest(h,s,c,this._autosuggestViewModel,t,l),this._autosuggest.setItemSelectionEventHandler(this._suggestionItemSelected),this._autosuggest.setItemClickEventHandler(this._suggestionItemClicked),this._autosuggest.setFocusEventHandler(this._onFocus),this._autosuggest.setAutosuggestKeydownHandler(this._onAutosuggestKeydown),this._autosuggest.setOnAutosuggestHandler(this._onAutosuggest),this._autosuggest.setAutosuggestBlurHandler(this._onAutosuggestBlur),this._autosuggest.setSuggestionRequestHandler(r))},r.prototype.onFocus=function(n){var u,i,t,r;if(n){if(i=this.getIndex(),i>0)for(t=i-1;t>=0;t--)if(r=this._panelViewModel.waypoints[t].getWayPointModel(),r.point){u=r;break}this._autoSuggestModel.update(u,this._panelViewModel.getMode(),this._panelViewModel.getWaypointDataModels(),this._panelViewModel.contextId);this._panelViewModel.getMessageText()===null&&this._panelViewModel.isResultsPanelShowing||(this._panelViewModel.showAutosuggestPanel(),this._autosuggest.refreshAutosuggest());this._panelViewModel.onWaypointFocusChanged(this)}else this._panelViewModel.setShowSuggestionsPanel(!1)},r.prototype.refreshAutosuggest=function(){this._autosuggest&&this._autosuggest.refreshAutosuggest()},r.prototype.onAutosuggestKeydownFunction=function(n){var r=n,u=r.keyCode||r.which,f,t;this._panelViewModel.hideMessage();u==13?(f=this._autosuggestViewModel.getSelectedSuggestion(),this._suggestionSelected(f)):u==8&&this.getInputText()===i.L_Directions_MyLocation&&(t=n.currentTarget,t&&(t.selectionStart=t.selectionEnd=0),this.update("",null))},r.prototype.getEntity=function(){return this._entity},r.prototype.setWaypointSuggestionRequestedHandler=function(n){this._autosuggest&&this._autosuggest.setSuggestionRequestHandler(n)},r.prototype.getWaypointTitle=function(){if(this._waypointModel.name)return this._waypointModel.name;if(this._waypointModel.address)return this._waypointModel.address;var n=this._waypointModel.point;return n?si.formatLatLonString(n.latitude,n.longitude):""},r.prototype.dispose=function(){this._autosuggestViewModel.dispose();this._autosuggest&&this._autosuggest.removeEventHandlers();n.prototype.dispose.call(this);u._disposeEvents(this);u._nullifyClass(this)},r.prototype._suggestionSelected=function(n){var t=1,r;n&&n.searchText===i.L_Directions_MyLocation?(this._getCurrentPosition(),t=2):(n&&(n.type==="Favorite"?(t=6,n.subType==="Home"&&(t=4),n.subType==="Work"&&(t=5)):n.type==="History"?t=7:n.defaultSuggestion&&(t=3),this.update(n.formatedAddress,null,n.title,null,n),this._waypointModel.isApproximate=n.type==="Place"&&n.subType==="PopulatedPlace"),this._updateDirectionsOnSelection());n&&(r={},r.AST=t,v.logInstrumentationEvent(c.AC,r))},r.prototype._updateDirectionsOnSelection=function(){var n,i;if(t.enableUpdateDirectionsOnSelection){for(n=this.getIndex(),i=this._panelViewModel.waypoints.length;n<i;n++)if(this._panelViewModel.waypoints[n].getInputText().trim()===""){this._panelViewModel.setFocusToWaypoint(n);return}for(n=0,i=this.getIndex();n<i;n++)if(this._panelViewModel.waypoints[n].getInputText().trim()===""){this._panelViewModel.setFocusToWaypoint(n);return}this._panelViewModel.getDirections()}},r.prototype._onSuggestionItemSelected=function(n){this._waypointModel.eid=n.entityId;n.title!==i.L_Directions_MyLocation&&this.update(n.formatedAddress,null,n.title,null,n)},r.prototype.onGeolocationCallback=function(n){n.error?this._panelViewModel.clearResultsAndShowMessage({errorDetails:[i.L_Directions_Error_User_Location_Not_Found],errorCode:f.searchServiceFailed,searchType:2}):(this.update(i.L_Directions_MyLocation,n.location,i.L_Directions_MyLocation),this._updateDirectionsOnSelection())},r.prototype._onSuggestionItemClicked=function(n){this._waypointModel.eid=n.entityId;this._suggestionSelected(n)},r.prototype._getCurrentPosition=function(){var n=this,t={callback:function(t){return n.onGeolocationCallback(t)},performReverseGeocoding:!1};this._panelViewModel.geolocationProvider.GetCurrentPosition(t)},r.prototype._updateInputText=function(){var n="";n=this._waypointModel.name&&this._waypointModel.address?this._waypointModel.name!==this._waypointModel.address?i.L_Directions_Waypoint_Text_From_Name_Address.replace("{0}",this._waypointModel.name).replace("{1}",this._waypointModel.address):this._waypointModel.name:this.getWaypointTitle();this._setInputTextFromCode(n)},r.prototype._setInputTextFromCode=function(n){this._textModifiedFromCode=!0;this.setInputText(n);this._textModifiedFromCode=!1},r.prototype._onInputTextChanged=function(n,t){this._textModifiedFromCode||(this._panelViewModel&&this._panelViewModel.showAutosuggestPanel(),this._savedEntity&&this._clearSavedEntity(),this._waypointModel.clear(),this.isBeingResolved=!1,t===""&&this._panelViewModel.waypointResolvedEvent.invoke(this),this._panelViewModel&&this._panelViewModel.clearDirectionsResults.invoke())},r.prototype._clearSavedEntity=function(){this.setUpHierarchy(null);this._savedEntity=null},r.prototype._createAutoSuggest=function(n,t,i,r,u,f){return nt.isMobile?new ku(n,t,i,r,u,f):new bu(n,t,i,r,u)},r}(or),vt=function(){function i(){this.setToInitialState()}return i.prototype.setToInitialState=function(){var r,i;for(this.waypoints=[],i=0;i<2;i++)this.waypoints.push(new tt);for(this.mode=n[n[t.defaultMode]],t.bestModeEnabled&&this.mode==n.multimode&&(this.mode=t.defaultMode),r=[],i=0;i<=8;i++)r.push(!0);this.options={unit:t.unit,avoidMotorWays:!1,avoidTollRoads:!1,roundTrip:!1,saveHistory:!0,timeType:d.firstAvailable,transitTypes:r}},i.prototype.tryAddWaypoint=function(n,t){var r=this.waypoints.length,i;if(t<0||t>r)return!1;for(i=r;i>t;i--)this.waypoints[i]=this.waypoints[i-1];return this.waypoints[i]=n,!0},i.prototype.tryRemoveWaypoint=function(n){var t=this.waypoints.length;return n<0||n>=t?!1:(this.waypoints.splice(n,1),!0)},i.prototype.tryUpdateWaypoint=function(n,t){var i=this.waypoints.length;return t<0||t>=i?!1:(this.waypoints[t]=n.getWayPointModel(),!0)},i.prototype.reorderWaypoint=function(n,t){var i=this.waypoints[n];this.tryRemoveWaypoint(n);this.tryAddWaypoint(i,t)},i.inputDataFromDirectionState=function(r,u,f,e){var l,o,s,c;if(f===void 0&&(f=!0),e===void 0&&(e=!1),u=u||new i,r&&r.waypoints||e){if(l=r.waypoints.length,l!==1||e){for(u.waypoints=[],o=0;o<l;o++)u.waypoints.push(tt.createObjectFrom(r.waypoints[o]));for(;o<2;o++)u.waypoints.push(new tt)}else{var v=r.waypoints[0],a=v.waypointType,h=tt.createObjectFrom(v);if(a===1)u.waypoints[0]=h;else if(a===2)u.waypoints[u.waypoints.length-1]=h;else if(a===4){for(o=0;o<u.waypoints.length&&u.waypoints[o].name;)o++;o!==u.waypoints.length&&(u.waypoints[o]=h)}else f&&(u.waypoints[u.waypoints.length-1]=h)}if(s=r.options,s)for(c in s)s[c]&&(u.options[c]=s[c]);r.mode&&(u.mode=r.mode===n.driving||t.enableTransitMode&&r.mode===n.transit||r.mode===n.walking||t.bestModeEnabled&&r.mode===n.multimode||t.isSDK&&r.mode===n.truck?r.mode:t.defaultMode,t.bestModeEnabled&&u.mode===n.multimode&&(u.mode=t.defaultMode))}return u},i.inputDataToDirectionsState=function(n,t){var r,i;if(t===void 0&&(t=!0),t&&n.waypoints)for(r=0;r<n.waypoints.length;r++)i=n.waypoints[r],i.point&&(i.point.latitude=Math.round(i.point.latitude*1e6)/1e6,i.point.longitude=Math.round(i.point.longitude*1e6)/1e6);return{waypoints:n.waypoints,mode:n.mode,options:n.options}},i}(),br=function(){function i(){}return i.downloadRoutes=function(r,u){var f=r.requestOptions;if(!f)throw new Error("options parameter must be defined!");if(!f.waypoints||f.waypoints.length===0)throw new Error("options parameter is missing required properties!");f.mode===n.truck?i._downloadRoutesViaPost(r.mapCredentials,t.calculateTruckRouteServiceUrl,r,u):tf.instance.authenticateClientAndRetrieveSessionId(function(n){var f=t.applicationKey||n;i._downloadRoutesViaGet(f,t.calculateRouteServiceUrl,r,u)})},i._downloadRoutesViaGet=function(n,r,u,e){var o={},y=u.requestOptions,p=u.isDragRequest,b=u.viaPoint,k=u.viaPointRemoved,d=i._createOptionsQueryParam(y,y.mode,o,p),s=i.buildRequest(n,r,u,o,!0),h,a,l,w;if(s.url.length>i.MaxRequestUrlLength&&(s=i.buildRequest(n,r,u,o,!1)),er.downloadJsonp(s.url,"routes",function(n,t){var u=t.requestOptions,i,r;n&&(i={errorCode:f.Success},n.statusCode!==200&&n.errors&&n.errors.length>0?i=n.errors[0]:n.resourceSets&&n.resourceSets.length||(i.errorCode=f.noResults),e&&e(t,n,i),i.errorCode!==f.Success||t.isDragRequest||(r={},r.NR=n.resourceSets[0].resources.length,v.logInstrumentationEvent(c.DR,r)))},function(n){e&&e(n,null,{errorCode:f.generalError})},null,!1,u,0,p?"Maps_rted":"Maps_rte"),o.M=y.mode,o.NM=y.waypoints.length,o.O=d,p)o.D=b?2:k?3:1;else{for(h="",a=0;a<s.waypoints.length;a++)l=s.waypoints[a],l.name?h+=l.name:l.address?h+=l.address:l.point&&(w=l.point,h=h+w.latitude+","+w.longitude,t.enableApproximateLocation&&l.isApproximate&&(h+="a")),a!==s.waypoints.length-1&&(h+="|");o.WS=s.waypointsSources;s.satrWaypointExists&&(o.WC=s.waypointsCoordinates);v.callMapSnRInstrumentation(h)}v.logInstrumentationEvent(c.GD,o)},i.buildRequest=function(r,u,f,e,o){var s=f.requestOptions,d=f.isDragRequest,st=f.viaPoint,ht=f.subLegIndex,pt=f.legIndex,g=t.bestModeEnabled&&s.mode===n.multimode?"alternate":n[s.mode],v,y,p,a,w,b,k,ft,et,ot,yt;t.bestModeEnabled&&d&&s.mode===n.multimode?g=n[n.driving]:s.mode===n.transit&&t.enableMultiMode&&(g="multimodal");var l=u.replace("{app_key}",r).replace("{culture}",i._getUrlCultureParam()).replace("{travelMode}",g),c=[],ct="",tt="",it=!1;for(a=0;a<s.waypoints.length;a++)if(v=s.waypoints[a],c.push(v),ct+=v.waypointSource.toString(),v.point&&(tt+=v.point.latitude+","+v.point.longitude),tt+=a===s.waypoints.length-1?"":";",it=it||v.waypointSource===4||v.waypointSource===2,y=v.viaWaypoints,a===pt)if(ht>=y.length)c=c.concat(y),c.push(st);else for(p=0;p<y.length;p++)p===ht&&c.push(st),c.push(y[p]);else y&&(c=c.concat(y));for(a=0;a<c.length;a++)l+=i._createWaypointQueryParam(c[a],a,o),a!==c.length-1&&(l+="&");var lt=c[0],at=c[c.length-1],h={};if(d){if(h.ra=["routepath"],s.mode!==n.transit&&h.ra.push("excludeitinerary"),lt.point&&at.point){var wt=ur.fromLocations(lt.point,at.point),bt=wt.center,kt=ar.toScale(bt,ut.currentZoomLevel,!1);h.res=[kt.toString()]}}else if(f&&f.isSummaryOnly?h.ra=["routeSummariesOnly"]:s.mode===n.transit?(h.ig=["true"],h.ra=["routepath,transitStops"]):s.mode===n.driving||s.mode===n.multimode?(s.mode===n.multimode&&t.enableBestModeItineraryGroups&&(h.ig=["true"]),h.ra=["routepath,routepathannotations,routeproperties"],s.mode===n.multimode&&h.ra.push("transitStops"),t.isSDK||h.ra.push("includeCameras")):h.ra=["routeproperties,routepath"],f&&!f.isSummaryOnly&&h.ra.push("routeInfoCard,TransitFrequency"),!t.isSDK){if(w=[],t.timeConstraintEnabled&&w.push("timeconstroute"),t.learnedHeuristicEnabled&&w.push("learnedheuristic"),w.length>0){l=l.replace("{cmnPltParam}",nt.platformCommonParam);var rt="&setfeatures=",vt=rt+w.join(","),dt=l.indexOf(rt);dt===-1?l+=vt:l=l.replace(rt,vt+",")}b=[];s.mode===n.transit&&t.transitOBDLEnabled&&b.push("transitodbl");b.length>0&&(l+="&setflight="+b.join(","))}for(t.enableMultiMode&&(s.isReturnDirection?c.length===3&&(h.lm=["transit,driving"]):(h.lm=["driving,transit"],h.cn=["parkandrides"])),k=0,ft=Object.keys(h);k<ft.length;k++)et=ft[k],ot=h[et].join(","),ot.length>0&&(l+="&"+et+"="+ot);return yt=i._createOptionsQueryParam(s,s.mode,e,d),l+=yt,{url:l,waypoints:c,waypointsSources:ct,waypointsCoordinates:tt,satrWaypointExists:it}},i._downloadRoutesViaPost=function(n,t,r,u){var e=t.replace("{app_key}",n),o=i._constructPostBody(r),s=function(n){var t,i;if(u){t=null;try{t=JSON.parse(n)}catch(e){u(r,null,{errorCode:f.UnknownError})}t===null?u(r,null,{errorCode:f.noResults}):(t.errors&&t.errors.length>0?(i=t.errors[0],i.errorCode===""&&(i.errorCode=f.NoSolution)):i=t.resourceSets&&t.resourceSets.length?{errorCode:f.Success}:{errorCode:f.noResults},u(r,t,i))}},h=function(){u&&u(r,null,{errorCode:f.generalError})};er.doPost(e,o,{onSuccess:s,onError:h})},i._constructPostBody=function(n){var r={waypoints:[],routeAttributes:"routePath"},o=n.requestOptions,u,c,s,h,f,e;for(o.options&&(u=o.options,r.distanceBeforeFirstTurn=u.distanceBeforeFirstTurn,r.heading=u.heading,r.vehicleSpec=u.vehicleSpec,r.borderRestriction=u.borderRestriction,c=i._createAvoidList(u),c.length>0&&(r.avoid=c),s=u.optimize||t.optimize,s&&(r.optimize=rt[s],s===rt.timeWithTraffic&&u.dateTime&&(r.dateTime=i._createDateTimeString(new Date(u.dateTime)))),r.distanceUnit=i._createDistanceUnit(u)),h=0;h<o.waypoints.length;h++)f=o.waypoints[h],e={},e.address=f.address,e.isViaPoint=f.isViaWaypoint,f.point&&(e.latitude=f.point.latitude,e.longitude=f.point.longitude),r.waypoints.push(e);return JSON.stringify(r)},i._getUrlCultureParam=function(){if(!i._urlCultureParam){var n=nt.dynamicProperties.uiLanguage;n.toLowerCase()==="yy-zz"&&(n="ja-ploc-jp");i._urlCultureParam=n}return i._urlCultureParam},i._createWaypointQueryParam=function(n,i,r){var u="",e,f,s,o,h;return n.isViaWaypoint&&(u+="v"),u+="wp.",u+=i,u+="=",n.locationIdentifier?u+=n.locationIdentifier:n.point?(e=n.point,u+=e.latitude,u+=",",u+=e.longitude,t.enableApproximateLocation&&n.isApproximate&&(u+="a"),r&&(t.enableMultiMode&&n.categoryName&&n.eid?(f=n.eid.split(":"),s=f.length===2&&f[0]==="ypid"?f[1]:"",u+='[cat="'+n.categoryName+'" ypid="'+s+'"]'):(o=n.rawAddress||n.address,o&&(u+="["+encodeURIComponent(o)+"]")))):n.address&&(h=n.address,u+=h),u},i._createAvoidList=function(n){var t=[],i="";return n&&(n.avoidHighways&&t.push("highways"),n.avoidTollRoads&&t.push("tolls"),n.avoidFerry&&t.push("ferry"),n.avoidBorder&&t.push("borderCrossing"),n.minimizeHighways&&t.push("minimizeHighways"),n.minimizeTolls&&t.push("minimizeTolls"),n.avoidExpressTrains&&t.push("expresstrain"),n.avoidAirlines&&t.push("airline"),n.avoidBulletTrains&&t.push("bullettrain"),t.length>0&&(i=t.join())),i},i._createDistanceUnit=function(n){var i=t.unit;return n.unit&&(i=n.unit),i===ct.miles?"mi":"km"},i._createDateTimeString=function(n){var t=n.getUTCMinutes();return t<10&&(t="0"+t),n.getUTCMonth()+1+"/"+n.getUTCDate()+"/"+n.getUTCFullYear()+" "+n.getUTCHours()+":"+t+":00"},i._createOptionsQueryParam=function(r,u,f,e){var s="",o=r.options,y,p,c,v,a,l,h,w,b;if(o){if(y=i._createAvoidList(o),y.length>0&&(s+="&avoid="+y),(u===n.driving||u===n.multimode||u===n.transit&&(t.enableOptimizeCost||t.enableOptimizeTime||t.enableOptimizeTransfers))&&(p=o.optimize||(u===n.driving||u===n.multimode)&&t.optimize,p&&(s+="&optmz="+rt[p])),(u===n.transit||u===n.multimode)&&o.transitTypes){for(c="&trt=",v=!0,a=1;a<o.transitTypes.length;a++)o.transitTypes[a]?c+=a+",":v&&(v=!1);v||(c=c.substring(0,c.length-1),s+=c)}s+="&du="+i._createDistanceUnit(o);(u===n.transit||u===n.multimode||u===n.driving&&t.enablePredictiveRouting)&&(l=o.timeType,w=!1,f&&(f.TT=l),l===d.firstAvailable?(l=d.departure,h=new Date,h=new Date(h.getTime()-h.getTimezoneOffset()*6e4),w=!0):o.dateTime&&(h=new Date(o.dateTime)),l&&h&&(w||(s+="&dt="+i._createDateTimeString(h)),s+="&tt="+d[l]));b=e?1:o.maxRoutes?o.maxRoutes:u===n.multimode||r.isReturnDirection?i.MaxMultimodeRoutes:t.maxRoutes;s+="&maxSolns=";s+=b}return s+"&rpo=Points"},i.MaxMultimodeRoutes=4,i.MaxRequestUrlLength=2e3,i}(),bi=function(e){function h(n,u,f,o,h,c,l,a,v,y){var p=this,w={};return p=e.call(this,w,u,ef)||this,p._perfLog=l,p.resources=i,p._map=c,p.geolocationProvider=o,p._featureName=t.featureType,p.enableHistory=!t.isSDK&&!(vr&&vr.autosuggestHistory),p.directionsManagerCallback=a,p.resolveWaypointsInRoutingService=y,p._setEnabledOptions(),p.isLongDistanceIntent=!1,p._spatialMath=r.SpatialMath,p._taskId=h,p._inputData=n,p.showAvoidBorders=!t.isSDK,p.disposables.push(p.getDirectionsRequested=new s,p.directionsResultsRequested=new s,p.directionsModeChanged=new s,p.clearDirectionsResults=new s,p.waypointResolvedEvent=new s,p.taskTitleRequestedEvent=new s,p.seeAllRoutesClick=new s,p.resolveWaypointSDKEvent=new s),p._populateModes(v),p.disposables.push(p.waypoints=new vi),p.disposables.push(p.waypoints.changed.add(function(n){p._onWaypointsChanged(n)})),w.defineProperty("optionsClass",null,null,{defaultValue:""}),w.defineProperty("showTimeControls",p._onShowTimeControlsChanged,null,{defaultValue:!1}),w.defineProperty("scrollContainer",null,null,{defaultValue:null}),w.defineProperty("panelClass",null,null,{defaultValue:"directionsPanel"}),p._panelDim=0,w.defineProperty("showReverse"),w.defineProperty("showWaypoints",null,null,{defaultValue:!0}),w.defineProperty("showEditDirections",null,null,{defaultValue:!1}),w.defineProperty("messageText"),w.defineProperty("showProgress"),w.defineProperty("showMobileTimeControl"),w.defineProperty("milesUniqueId"),w.defineProperty("kmsUniqueId"),w.defineProperty("avoidHighways",p._onAvoidHighwaysChanged),w.defineProperty("avoidTolls",p._onAvoidTollsChanged),w.defineProperty("avoidFerry",p._onAvoidFerryChanged),w.defineProperty("avoidBorder",p._onAvoidBorderChanged),w.defineProperty("roundTrip",p._onRoundTripChanged),w.defineProperty("unitsKm",p._onUnitsKmChanged),w.defineProperty("unitsMiles",p._onUnitsMilesChanged),w.defineProperty("optimizeTime",p._onOptimizeTimeChanged,null,{defaultValue:!0}),w.defineProperty("optimizeCost",p._onOptimizeCostChanged),w.defineProperty("optimizeTransfers",p._onOptimizeTransfersChanged),p._setTransitModeOptions(w),w.defineProperty("saveHistory",function(n,t){ui.resetIsHistoryEnabled(t)},null,{defaultValue:ui.isHistoryEnabled()}),w.defineProperty("showSuggestionsPanel",null,null,{defaultValue:!0}),w.defineProperty("historyDeleted",null,null,{defaultValue:!1}),w.defineProperty("showRouteCategoriesPanel",null,null,{defaultValue:!1}),w.defineProperty("optionsText"),w.defineProperty("dateTimeSummary1"),w.defineProperty("dateTimeSummary2"),w.defineProperty("allowAddWp"),w.defineProperty("resultsExpanded"),w.defineProperty("mode",p._onModeChanged),w.defineProperty("longDistanceSeparator"),w.defineProperty("longDistanceFrom"),w.defineProperty("longDistanceTo"),w.defineProperty("taskOptionFrom"),w.defineProperty("taskOptionTo"),w.defineProperty("longDistanceText"),p.disposables.push(p.timeTypes=new vi),p.timeTypes.insert({text:i.L_Directions_Leave_Now,value:d.firstAvailable}),p.timeTypes.insert({text:i.L_Directions_Depart_At,value:d.departure}),p.timeTypes.insert({text:i.L_Directions_Arrive_By,value:d.arrival}),w.defineProperty("transitTimeType",p._onTimeTypeChanged),w.defineProperty("date",p._onDateTimeChanged,null,{defaultValue:Date.now()}),w.defineProperty("time",p._onDateTimeChanged),w.defineProperty("editingTime"),w.defineProperty("timeCtrlDisabled"),w.defineProperty("taskId",null,null,{defaultValue:h}),p}return w(h,e),h.prototype.initializeControls=function(n){this.setShowProgress(!1);this.updateInputControlsFromModel();this._updateDateTimeSummary(!1);this.setShowMobileTimeControl(r.GlobalConfig.isMobile);this.initializeCalendar(n)},h.prototype.initializeCalendar=function(n){var t=this,i=o(".calContainer",this.getControl()[0]);i&&n&&n.instanceAsync("SingleCalendar",function(n){n.init(i,t.getDate());n.onDateChangeEvent.add(function(n){n.setHours(0,0,0,0);t.setDate(n.getTime());var i=o(".dirBtnGo",t.getControl()[0])[0];i.focus()});t._calendar=n})},h.prototype.onTaskStateChanged=function(n){var t,u,i,r,f;if(n.animationState===1){for(t=document.activeElement,u=this.getControl()[0];t&&t!==u;)t=t.parentNode;if(!t){for(i=0,r=-1;i<this.waypoints.length;i++)if(this.waypoints[i].isEmpty()){r=i;this.setFocusToWaypoint(r);break}r<0&&(f=o(".dirBtnGo",u)[0],f.focus())}}n.activationState===2&&(this.hideMessage(),this.setOptionsClass(""),this.setShowTimeControls(!1))},h.prototype.setResultsShowingFlag=function(n){this.isResultsPanelShowing=n},h.prototype.serializeTaskOptions=function(n){return o.Internals.stringify(n)},h.prototype.getAndResetPanelFocusFlag=function(){var n=this._isCurrentDirectionsUpdate;return this._isCurrentDirectionsUpdate=!1,n},h.prototype.onGetDirectionsClick=function(n){n&&n.preventDefault();this.setEditingTime(!1);this.setShowTimeControls(!1);this._isCurrentDirectionsUpdate=!1;this.getDirections()},h.prototype.onDropdown=function(n){t.enableDimPanelOnDropdown&&(n?++this._panelDim:this._panelDim>0&&--this._panelDim,this.setPanelClass("directionsPanel"+(this._panelDim?" drPanelDimmed":"")))},h.prototype.initAutosuggest=function(){this.showAutosuggestPanel();this.contextId=u._generateRandomKey();for(var n=0;n<this.waypoints.length;n++)this.waypoints[n].initAutosuggest(this.getControl(),this._map,this.controlTemplateFactory,this._suggestionRequestedHandler)},h.prototype.setWaypointSuggestionRequestedHandler=function(n){this._suggestionRequestedHandler=n;for(var t=0;t<this.waypoints.length;t++)this.waypoints[t].setWaypointSuggestionRequestedHandler(this._suggestionRequestedHandler)},h.prototype.showAutosuggestPanel=function(){this.setShowSuggestionsPanel(!0);this.hideMessage();this.setShowTimeControls(!1)},h.prototype._updateWaypointsFromData=function(){if(this._inputData.waypoints&&this._inputData.waypoints.length){this.waypoints.clear();for(var n=0;n<this._inputData.waypoints.length;n++)this._addWaypointViewModel(this._inputData.waypoints[n]);this._updateArriveByTimeTypes()}},h.prototype.getRouteTitle=function(){var r=this.waypoints.length,n,t;return r>=2&&(n=this.waypoints[0].getWaypointTitle(),t=this.waypoints[r-1].getWaypointTitle(),n&&t)?i.L_Directions_Process_Title_Text_Line.replace("{0}",n).replace("{1}",t):null},h.prototype._filterAutosuggestDetailCards=function(n){var t,i;if(this._currentFocusedWaypoint&&this._inputData&&this._inputData.waypoints&&this._inputData.waypoints.length&&n){var r=this._currentFocusedWaypoint.getIndex(),u=this._inputData.waypoints[r-1],f=this._inputData.waypoints[r+1],e=[];for(t=0;t<n.length;t++)(i=n[t],u&&k.areEqual(u.point,i.getLocation())||f&&k.areEqual(f.point,i.getLocation()))||e.push(i);return e}return n},h.prototype.updateCurrentLocalDetailCards=function(n){h._localDetailCards=h._localDetailCards.concat(n);ot.appendLocalDetailCards(n);this._currentFocusedWaypoint&&this._currentFocusedWaypoint.refreshAutosuggest()},h.prototype.resetLocalDetailsCards=function(){h._localDetailCards=[];ot.resetCurrentLocalDetailsCards()},h.prototype.updateCurrentTransitStopCards=function(n){h._transitStopCards=n;ot.updateCurrentTransitStopCards(n);this._currentFocusedWaypoint&&this._currentFocusedWaypoint.refreshAutosuggest()},h.prototype.onWaypointFocusChanged=function(n){!this._currentFocusedWaypoint||this._currentFocusedWaypoint===n||this._currentFocusedWaypoint.getWayPointModel().point||this._currentFocusedWaypoint.isBeingResolved||(this._currentFocusedWaypoint.isBeingResolved=!0,this._resolveWayPoint(this._currentFocusedWaypoint.getIndex(),!0));this._currentFocusedWaypoint=n;ot.updateCurrentLocalDetailCards(this._filterAutosuggestDetailCards(h._localDetailCards));ot.updateCurrentTransitStopCards(this._filterAutosuggestDetailCards(h._transitStopCards))},h.prototype.waypointResolved=function(n){var s,u,l,r;n.inData.requestorState.perfState&&(s=n.inData.requestorState.perfState,s.end());t.enableMultiMode&&(this._inputData.isReturnDirection=!1);var o=n.inData,a=o.requestState,h=o.requestorState.isBeingPrefetched,c=o.requestorState.waypointIndex,e=this.waypoints[c];e.isBeingResolved=!1;n.outData&&n.outData.length===1&&n.outData[0].data&&(t.isSDK?(u=n.outData[0].data,e.update(o.requestState.query,u)):n.outData[0].data.entities&&n.outData[0].data.entities.length>0&&(l=n.outData[0].data.entities,r=l[0],r.isUpHierarchy?e.setUpHierarchyResult(r):(u=r.getRoutableLocation()||r.getLocation(),e.update(r.getDescription(),u,r.getTitle(),r),this.addToHistory(r))));u&&!h&&this._invokeResolveWaypoint(c);u||h||this.clearResultsAndShowMessage({errorDetails:[i.L_Directions_Error_Search_Fail],errorCode:f.searchServiceFailed,searchType:e.getWayPointModel().asType})},h.prototype.addToHistory=function(n){this.getSaveHistory()&&(ui.saveWaypoint(n),this.setHistoryDeleted(!1))},h.prototype.getDirections=function(n,r,e){var s,o,h,c;for(this.contextId=u._generateRandomKey(),this.getDirectionsRequested.invoke(),this._dismissAllAutosuggests(),s=0,o=this.waypoints.length-1,h=0;o>=0;o--)c=this.waypoints[o],c.trim(),c.isEmpty()?this.waypoints.length>2&&this._deleteWaypoint(o):(h++,s=o);h<2?(n||this.clearResultsAndShowMessage({errorDetails:[i.L_Directions_Error_Waypoints],errorCode:f.atleastTwoWaypointRequired}),h!==1||this._inputData.waypoints[s].point||this._resolveWayPoint(s,!0)):(this.setShowProgress(!0),t.enableMultiMode&&this._inputData.isReturnDirection&&this._returnDirectionsInputData?this.directionsResultsRequested.invoke({DirectionsInputData:this._returnDirectionsInputData}):this._invokeResolveWaypoint(0,r,e))},h.prototype.onGeolocationCallback=function(n){n.error?n.error&&this.clearResultsAndShowMessage({errorDetails:[i.L_Directions_Error_User_Location_Not_Found],errorCode:f.searchServiceFailed,searchType:2}):(this.waypoints[0].update(i.L_Directions_MyLocation,n.location,i.L_Directions_MyLocation),this.getDirections())},h.prototype.onReverseClick=function(n){n.preventDefault();t.enableMultiMode&&(this._inputData.isReturnDirection=!1);this._reorderWaypoint(0,1);this._updateExistingDirections()},h.prototype.processReturnDirectionsRequest=function(n){var i,r,t,f,e;for(this._reorderWaypoint(0,1),this.setShowProgress(!0),this._inputData.isReturnDirection=!0,i=u._copyObject(this._inputData),i.waypoints=[],r=n.length-1;r>=0;r--)if(t=n[r],t.coordinate&&t.coordinate.coordinates&&t.coordinate.coordinates.length===2)f=new tt(t.address,new k(t.coordinate.coordinates[0],t.coordinate.coordinates[1]),t.entityName,!1,null,t.entityId,null,null,null,null,null,null,null,t.categoryName),i.waypoints.push(f),this._returnDirectionsInputData=i;else throw new Error("Waypoint is invalid.");e={DirectionsInputData:i};this.directionsResultsRequested.invoke(e)},h.prototype.onEditDirectionsClick=function(){},h.prototype.onOptionsClick=function(n){var t,i;n.preventDefault();t=this.getOptionsClass()==="";this.setOptionsClass(t?"dropdownOpen":"");i=n.currentTarget;i.setAttribute("aria-expanded",t?"true":"false")},h.prototype.onTimeClick=function(n){var t,i;n.preventDefault();t=!this.getShowTimeControls();this.setShowTimeControls(t);i=n.currentTarget;i.setAttribute("aria-expanded",t?"true":"false")},h.prototype.forceDrivingMode=function(){var i=this.getMode(),r=this.getForceDirectionsState(i),t;i===n.multimode&&r&&(t=this._getModeData(i),t.enabled=!1,t.setAriaSelected(this.getMode()===t.mode),t.setAriaDisabled(this.getMode()!==t.mode&&!t.enabled),t.setBtnClass("dirBtn"+t.modeName+" dirBtn"+(this.getMode()===t.mode?"Selected":t.enabled?"Normal":"Disabled")),this.directionsModeChanged.invoke(n.driving),this.updateModeBtnState())},h.prototype.onAddClick=function(n){this._invalidateResults();n.preventDefault();var i=o(".icon.end",this.getControl()[0]);i.swap_class("end","middle");this.addWaypoint(new tt);this.hideMessage();t.enableFocusToWaypointOnAddClick&&this.setFocusToWaypoint(this.waypoints.length-1);t.bestModeEnabled&&this.forceDrivingMode()},h.prototype.showEditAndCollapseCard=function(){},h.prototype.setFocusToWaypoint=function(n){var i=o(".dirWaypoints",this.getControl()[0])[0],t,r;i&&(t=o("input",i),r=t.length,n>=0&&n<r&&Microsoft.Maps.setTimeout(function(){t[n].focus()},500))},h.prototype.addWaypoint=function(n){this.getAllowAddWp()&&this._inputData.tryAddWaypoint(n,this._inputData.waypoints.length)&&this._addWaypointViewModel(n);this._updateArriveByTimeTypes()},h.prototype.setWaypoint=function(n,t){t>=0&&t<this.waypoints.length&&(this._inputData.waypoints[t]=n)},h.prototype.removeViaPoint=function(n,t){if(n>=0&&n<this.waypoints.length){var i=this.waypoints[n].getWayPointModel().viaWaypoints;t>=0&&t<i.length&&(i.splice(t,1),this.directionsResultsRequested.invoke({DirectionsInputData:this._inputData,viaPointRemoved:!0}))}},h.prototype.onModeClick=function(n){var i,t,r;n.preventDefault();i=n.target;t=this._getModeData(Number(i.getAttribute("mode")));t&&t.enabled&&(this.getMode()===t.mode?this._onModeChanged(this.getMode(),t.mode):this.setMode(t.mode));r={M:t.mode};v.logInstrumentationEvent(c.DMC,r)},h.prototype.isSelectedMode=function(n){return Boolean(n===this.getMode()).toString()},h.prototype.selectedModeToDisplay=function(n){return this.boolToDisplay(n===this.getMode())},h.prototype.displayIfDriving=function(i){return this.boolToDisplay(i===n.driving||t.bestModeEnabled&&i===n.multimode)},h.prototype.displaySortByOptions=function(i){return this.boolToDisplay(i===n.transit&&(t.enableOptimizeCost||t.enableOptimizeTime||t.enableOptimizeTransfers))},h.prototype.displaySpecialTransitModeFilter=function(i){return this.boolToDisplay(i===n.transit&&t.specialTransitModeFilter)},h.prototype.displayTransitModeFilterROW=function(i){return this.boolToDisplay(i===n.transit&&!t.specialTransitModeFilter&&t.transitModeFilter)},h.prototype.displayIfTransit=function(t){return this.boolToDisplay(t===n.transit)},h.prototype.displayIfNotTransit=function(t){return this.boolToDisplay(t===n.driving||t===n.walking)},h.prototype.displayTimeControls=function(i){return this.boolToDisplay(i===n.transit||i===n.driving&&t.enablePredictiveRouting||i===n.multimode&&t.bestModeEnabled&&t.enablePredictiveRouting)},h.prototype.showTimeControlsToClass=function(n){return n?"dropdownOpen":""},h.prototype.indexToWaypointTitle=function(n){return n?i.L_Directions_Title_Destination:i.L_Directions_Title_Start},h.prototype.indexToIconText=function(n){return String.fromCharCode(n+65)},h.prototype.indexToIconClass=function(n){var t="icon ";switch(n){case 0:t+="start";break;case this._inputData.waypoints.length-1:t+="end";break;default:t+="middle"}return t},h.prototype.clearResultsAndShowMessage=function(n,t){this.setShowProgress(!1);this.clearDirectionsResults.invoke();this.showMessage(n,t);this.taskTitleRequestedEvent.invoke(this.isLongDistanceIntent?i.L_DirectionsTaskDistanceTitle_Text:i.L_DirectionsTaskTitle_Text);this.directionsManagerCallback&&this.directionsManagerCallback.invoke(n)},h.prototype.showMessage=function(n,t){var e,r,u,i;this.isLongDistanceIntent||(n.errorCode===undefined&&(n.errorCode=f.otherError),e=n.errorDetails&&n.errorDetails.length>0&&n.errorDetails[0]?n.errorDetails[0]:"",r=this._getErrorText(n.errorCode,e),this.setMessageText(r),u=o(".dirMessage",this.getControl()[0]),u[0]&&u[0].focus(),n.errorCode!==f.Success&&(i={},i.ET=n.errorCode,i.TI=t,i.ED=r,n.errorCode===f.searchServiceFailed&&(i.AST=n.searchType||8),v.logInstrumentationEvent(c.SE,i)));this.setShowSuggestionsPanel(!1)},h.prototype.hideMessage=function(){this.setMessageText(null)},h.prototype.getWaypointDataModels=function(){return this._inputData.waypoints},h.prototype.onDragComplete=function(n){var t,i;if(n){for(t=0;t<this.waypoints.length;t++)this._inputData.tryUpdateWaypoint(this.waypoints[t],t);this._updateExistingDirections();i={};i.RT=2;v.logInstrumentationEvent(c.WR,i);n.initAutosuggest(this.getControl(),this._map,this.controlTemplateFactory,this._suggestionRequestedHandler)}},h.prototype.updateInputControlsFromModel=function(){this._isUpdating=!0;this.setMode(this._inputData.mode);var n=this._inputData.options;this.setAvoidHighways(!!n.avoidHighways);this.setAvoidTolls(!!n.avoidTollRoads);this.setAvoidFerry(!!n.avoidFerry);this.setAvoidBorder(!!n.avoidBorder);this.setRoundTrip(!!n.roundTrip);this.setUnitsKm(n.unit===ct.km);this.setUnitsMiles(n.unit===ct.miles);this.setOptimizeTime(n.optimize===rt.time);this.setOptimizeCost(n.optimize===rt.money);this.setOptimizeTransfers(n.optimize===rt.transfers);this.setAvoidBulletTrains(!!n.avoidBulletTrains);this.setAvoidExpressTrains(!!n.avoidExpressTrains);this.setAvoidFlights(!!n.avoidAirlines);this._updateTransitModeOptionsFromData();this._updateWaypointsFromData();this.setMilesUniqueId("miles"+this._taskId);this.setKmsUniqueId("kms"+this._taskId);this._initializeTimeAndDateControls();this._isUpdating=!1},h.prototype.updateInputControlsFromState=function(n){this._inputData=vt.inputDataFromDirectionState(n,this._inputData,!0,!0);this.updateInputControlsFromModel()},h.prototype.updateModeBtnState=function(i){for(var r,c,s,v,u,p,h,o,f,y,l,e,w=this.getForceDirectionsState(i),a=0;a<this.modes.length;a++){if(r=this.modes[a],r.enabled=this.waypoints.length<=r.maxWaypoints,r.enabled&&!r.supportViaPoint)for(c=0;c<this.waypoints.length;c++)if(this.waypoints[c].getWayPointModel().viaWaypoints.length>0){r.enabled=!1;break}if(r.enabled&&r.mode===n.walking&&(s=this._spatialMath,s&&(v=s.DistanceUnits,u=0,this.waypoints&&this.waypoints.length>1&&(p=this.waypoints[0].getWayPointModel().point,p))))for(h=this.waypoints[0].getWayPointModel().point,o=1;o<this.waypoints.length;o++){if(this.waypoints[o-1].getWayPointModel().viaWaypoints)for(y=this.waypoints[o-1].getWayPointModel().viaWaypoints,l=0;l<y.length;l++){if(f=y[l].point,u+=s.getDistanceTo(h,f,v.Miles),u&&u>t.maxWalkingDistance){r.enabled=!1;break}h=f}if(u<=t.maxWalkingDistance&&(f=this.waypoints[o].getWayPointModel().point,f)){if(u+=s.getDistanceTo(h,f,v.Miles),u&&u>t.maxWalkingDistance){r.enabled=!1;break}h=f}}e=this.getMode()===r.mode?"Selected":r.enabled?"Normal":"Disabled";t.bestModeEnabled&&(w?(r.mode===n.multimode&&(r.enabled=!1,e="Disabled"),r.mode===n.driving&&(e="Selected")):i&&i===n.driving&&(r.mode===n.multimode?e="Normal":r.mode===n.driving&&(e="Selected")));r.setBtnClass("dirBtn"+r.modeName+" dirBtn"+e);r.setAriaPressed(this.getMode()===r.mode);r.setAriaSelected(e==="Selected");r.setAriaDisabled(!r.enabled)}},h.prototype.onDeleteHistory=function(n){n.preventDefault();ui.removeAll();this.setHistoryDeleted(!0);var t=o(".dirBtnOptions.dropdownBtn",this.getControl()[0])[0];t.focus()},h.prototype.dispose=function(){this._calendar&&(this._calendar.dispose(),this._calendar=null);e.prototype.dispose.call(this)},h.prototype._initializeTimeAndDateControls=function(){var t=this.timeTypes[0],u=this._inputData.options.timeType,n,r,i;if(u)for(n=0;n<this.timeTypes.length;n++)if(u===this.timeTypes[n].value){t=this.timeTypes[n];break}this.setTransitTimeType(t);r=new Date;(t.value===d.departure||t.value===d.arrival)&&(i=this._inputData.options.dateTime,i&&(r=new Date(i+new Date(i).getTimezoneOffset()*6e4)));this._setDateAndTime(r.getTime())},h.prototype._getWaypointCount=function(){for(var t=0,n=0;n<this.waypoints.length;n++)this.waypoints[n].getWayPointModel().isViaWaypoint||t++;return t},h.prototype.hasViaPoints=function(){for(var n=0;n<this.waypoints.length;n++)if(this.waypoints[n].getWayPointModel().viaWaypoints.length>0)return!0;return!1},h.prototype.getForceDirectionsState=function(t){return(!t||t&&t!==n.walking)&&(this._getWaypointCount()>2||this.hasViaPoints())},h.prototype._populateModes=function(){this.modes=[];t.bestModeEnabled&&this.modes.push(new ti(n.multimode,"Multi"));this.modes.push(new ti(n.driving,"Drive"));t.enableTransitMode&&this.modes.push(new ti(n.transit,"Transit"));this.modes.push(new ti(n.walking,"Walk"));t.isSDK&&this.modes.push(new ti(n.truck,"Truck"))},h.prototype._updateExistingDirections=function(){if(!this._isUpdating){for(var n=0,t=this._inputData.waypoints.length;n<t;n++)if(!this._inputData.waypoints[n].point){this._invalidateResults();return}this._isCurrentDirectionsUpdate=!0;this.getDirections()}},h.prototype._onWaypointsChanged=function(n){var i,u,f,r,t,e;for(this._isUpdating||(n.added?(i=n.added[0],u=n.addedIndex,u>0&&(this.waypoints[u-1].getWayPointModel().viaWaypoints=[])):n.removed&&(i=n.removed[0],f=n.removedIndex,f>0&&(this.waypoints[f-1].getWayPointModel().viaWaypoints=[]))),i&&(i.getWayPointModel().viaWaypoints=[]),r=this.waypoints.length-1,t=0;t<=r;t++)e=this.waypoints[t],e.setIndex(t),e.setShowDelete(r>1);this.setShowReverse(r<=1);this._updateAllowAddWp();this.updateModeBtnState();this.waypointResolvedEvent.invoke(null)},h.prototype._addWaypointViewModel=function(n){var i=this,t;n.isViaWaypoint||(t=new wi(n,this),t.waypointDeleteEvent.add(function(n){i._deleteWaypoint(n);i._updateExistingDirections()}),t.changed.add(function(n){n.name==="inputText"&&i.hideMessage()}),this.waypoints.insert(t),t.initAutosuggest(this.getControl(),this._map,this.controlTemplateFactory,this._suggestionRequestedHandler),ot.updateCurrentLocalDetailCards(this._filterAutosuggestDetailCards(h._localDetailCards)),ot.updateCurrentTransitStopCards(this._filterAutosuggestDetailCards(h._transitStopCards)),this.showAutosuggestPanel(),this.waypointResolvedEvent&&this.waypointResolvedEvent.invoke(t))},h.prototype._deleteWaypoint=function(n){this._inputData.tryRemoveWaypoint(n)&&(this._currentFocusedWaypoint===this.waypoints[n]&&(this._currentFocusedWaypoint=null),this.waypoints.removeAt(n),this._updateArriveByTimeTypes())},h.prototype._updateArriveByTimeTypes=function(){var n=this._getArriveByIndex(),t;this.waypoints.length>2&&n!==-1?(t=this.getTransitTimeType(),this.timeTypes.removeAt(n,1),this.timeTypes.length>0&&t&&t.value===d.arrival&&this.setTransitTimeType(this.timeTypes[0])):this.waypoints.length===2&&n===-1&&this.timeTypes.insert({text:i.L_Directions_Arrive_By,value:d.arrival})},h.prototype._getArriveByIndex=function(){for(var t=-1,n=0;n<this.timeTypes.length;n++)if(this.timeTypes[n].value===d.arrival){t=n;break}return t},h.prototype._onAvoidHighwaysChanged=function(n,t){this._inputData.options.avoidHighways=t;this._updateOptionsAndExistingDirections()},h.prototype._onAvoidTollsChanged=function(n,t){this._inputData.options.avoidTollRoads=t;this._updateOptionsAndExistingDirections()},h.prototype._onAvoidFerryChanged=function(n,t){this._inputData.options.avoidFerry=t;this._updateOptionsAndExistingDirections()},h.prototype._onAvoidBorderChanged=function(n,t){this._inputData.options.avoidBorder=t;this._updateOptionsAndExistingDirections()},h.prototype._updateOptionsAndExistingDirections=function(){this._updateOptionsText();this._updateExistingDirections()},h.prototype._onRoundTripChanged=function(n,t){this._inputData.options.roundTrip=t;this._updateExistingDirections()},h.prototype._onUnitsKmChanged=function(n,t){this.setUnitsMiles(!t);t&&(this._inputData.options.unit=ct.km);t&&this._updateExistingDirections()},h.prototype._onUnitsMilesChanged=function(n,t){this.setUnitsKm(!t);t&&(this._inputData.options.unit=ct.miles);t&&this._updateExistingDirections()},h.prototype._onOptimizeTimeChanged=function(n,i){i&&t.enableOptimizeTime&&(this.setOptimizeCost(!1),this.setOptimizeTransfers(!1),this._inputData.options.optimize=rt.time,this._updateExistingDirections())},h.prototype._onOptimizeCostChanged=function(n,i){i&&t.enableOptimizeCost&&(this.setOptimizeTime(!1),this.setOptimizeTransfers(!1),this._inputData.options.optimize=rt.money,this._updateExistingDirections())},h.prototype._onOptimizeTransfersChanged=function(n,i){i&&t.enableOptimizeTransfers&&(this.setOptimizeCost(!1),this.setOptimizeTime(!1),this._inputData.options.optimize=rt.transfers,this._updateExistingDirections())},h.prototype._onAvoidFlightsChanged=function(n,t){this._inputData.options.avoidAirlines=t;this._updateExistingDirections()},h.prototype._onAvoidExpressTrainsChanged=function(n,t){this._inputData.options.avoidExpressTrains=t;var i=o("[name='dirOptsBulletTrains']",this.getControl()[0]);i.for_each(function(n){t?n.setAttribute("disabled","true"):n.removeAttribute("disabled")});this._updateExistingDirections()},h.prototype._onAvoidBulletTrainsChanged=function(n,t){this.getAvoidExpressTrains()||(this.setUseBulletTrains(!t),this._inputData.options.avoidBulletTrains=t,this._updateExistingDirections())},h.prototype._onUseBulletTrainsChanged=function(n,t){this.setAvoidBulletTrains(!t)},h.prototype._updateOptionsText=function(){var r="",o=this.getMode();if(o===n.driving||t.bestModeEnabled&&o===n.multimode){var u=this.getAvoidHighways(),f=this.getAvoidTolls(),e=this.getAvoidFerry();f&&u&&e?r=i.L_Directions_NoTollsHighwaysOrFerry:f&&e?r=i.L_Directions_NoTollsOrFerry:e&&u?r=i.L_Directions_NoHighwaysOrFerry:f&&u?r=i.L_Directions_NoTollsOrHighways:u?r=i.L_Directions_NoHighways:f?r=i.L_Directions_NoTolls:e&&(r=i.L_Directions_NoFerry)}this.setOptionsText(r)},h.prototype._onModeChanged=function(r,u){var e,f;if(this.updateModeBtnState(),this._updateAllowAddWp(),this._updateOptionsText(),this.hideMessage(),this._inputData.mode=u,t.enableMultiMode&&(this._inputData.isReturnDirection=!1),u!==n.walking&&(u!==n.driving||t.enablePredictiveRouting)||this.setShowTimeControls(!1),e=!0,u===n.transit&&t.enableOptimizeTime&&this.setOptimizeTime(!0),f=3,u===n.transit&&this.timeTypes.length===f)t.enableLastAvailableOption&&this.timeTypes.insert({text:i.L_Directions_Last_Train,value:d.lastAvailable});else if(u===n.driving&&this.timeTypes.length>f)for(this.timeTypes.indexOf(this.getTransitTimeType())>=f&&(this.setTransitTimeType(this.timeTypes[0]),e=!1);this.timeTypes.length>f;)this.timeTypes.removeAt(f);e&&this._updateExistingDirections();this.directionsModeChanged.invoke(u)},h.prototype._onTimeTypeChanged=function(n,t){if(!this._isUpdating){if(this._inputData.options.timeType=t.value,this.setTimeCtrlDisabled(t.value===d.lastAvailable),this._updateAllowAddWp(),t.value===d.firstAvailable||t.value===d.lastAvailable){this._isUpdating=!0;var i=new Date;this._setDateAndTime(i.getTime());this._calendar&&this._calendar.SetDate(this.getDate());this._writeDateTimeToModel();this._isUpdating=!1;this._updateExistingDirections()}else this._writeDateTimeToModel(),this._invalidateResults();this.getShowTimeControls()||this._updateDateTimeSummary(!1)}},h.prototype._setDateAndTime=function(n){var t=new Date(n);this.setTime((t.getHours()*60+t.getMinutes())*60);t.setHours(0,0,0,0);this.setDate(t.getTime())},h.prototype._onDateTimeChanged=function(){this._isUpdating||(this.getTransitTimeType().value===d.firstAvailable?this.setTransitTimeType(this.timeTypes[1]):(this._writeDateTimeToModel(),this._updateExistingDirections()),this.getShowTimeControls()||this._updateDateTimeSummary(!1))},h.prototype._writeDateTimeToModel=function(){this._inputData.options.dateTime=this.getDate()+this.getTime()*1e3-new Date(this.getDate()).getTimezoneOffset()*6e4},h.prototype._updateDateTimeSummary=function(n){var f="",r="",t;n||(t=this.getTransitTimeType().value,t===d.firstAvailable||t===d.lastAvailable?r=this.getTransitTimeType().text:(f=u._formatString(t===d.departure?i.L_Directions_Depart_Time:i.L_Directions_Arrive_Time,u._formatUTCTimeString(new Date(this.getTime()*1e3))),r=u._formatLongDateString(new Date(this.getDate()))));this.setDateTimeSummary1(f);this.setDateTimeSummary2(r)},h.prototype._onShowTimeControlsChanged=function(n,t){var r;if(this._updateDateTimeSummary(t),t){var u=o(".dirTimePopup",this.getControl()[0]),i=u.select("a:not([tabindex='-1']), [tabindex='0']"),f=i[0];f.focus();r=o(i[i.length-1]);r.add_event("keydown",this._onTimeControlKeyDown);this._timeControlLastElement=r}else this._timeControlLastElement&&this._timeControlLastElement.remove_event("keydown",this._onTimeControlKeyDown)},h.prototype._onTimeControlKeyDown=function(n){var u=n.keyCode,t,i,r;if(u===9&&!n.shiftKey){for(n.stopPropagation(),n.preventDefault(),t=n.currentTarget,i=t.getAttribute("class");!i||i.indexOf("dropdownOpen")<0;)t=t.parentElement,i=t.getAttribute("class");r=o(".dirBtnGo",t)[0];r.focus()}},h.prototype._getModeData=function(n){for(var i,t=0,r=this.modes.length;t<r;t++)if(i=this.modes[t],i.mode===n)return i;return null},h.prototype._dismissAllAutosuggests=function(){this.setShowSuggestionsPanel(!1);for(var n=0;n<this.waypoints.length;n++)this.waypoints[n].cancelAutosuggest()},h.prototype._updateAllowAddWp=function(){this.setAllowAddWp(this.waypoints.length<this._getModeData(this.getMode()).maxWaypoints&&this._inputData.options.timeType!==d.arrival)},h.prototype._reorderWaypoint=function(n,t){var r=this.waypoints[n],i;this.waypoints.removeAt(n);this.waypoints.insert(r,t);this._inputData.reorderWaypoint(n,t);r.initAutosuggest(this.getControl(),this._map,this.controlTemplateFactory,this._suggestionRequestedHandler);i={};i.RT=1;v.logInstrumentationEvent(c.WR,i)},h.prototype._resolveWayPoint=function(n,i){var r,u;if(!this.resolveWaypointsInRoutingService){r=null;u=this.waypoints[n];n>0&&(r=this._getMapBoundsForWaypoint(this.waypoints[n-1]));var f=u.getWayPointModel(),o={query:u.getInputText(),mapBounds:r,point:r?null:this._getValuesForPreviousLocation(n),disableTaskActivate:!0,noAds:!0,filterUrlParam:f.filterUrlParam,asName:f.asName,asFormattedAddress:f.asFormattedAddress,entryPoint:ii.DirectionsWaypointSearch},s=at.logPerfEvent(st.RW),e={requestorId:this._taskId,requestorState:{waypointIndex:n,callbackState:this._generateCallbackState(),perfState:s,isBeingPrefetched:i},type:y.localSearchTask,requestState:o};t.isSDK?this.resolveWaypointSDKEvent.invoke(e):a.invokeHandler(l.taskProcessDataHandlerKey,e)}},h.prototype._generateCallbackState=function(){for(var t="",n=0,i=this.waypoints.length;n<i;n++)t+=this.waypoints[n].getInputText();return t},h.prototype._invokeResolveWaypoint=function(n,t,r){for(var u,s,e,h,o;n<=this._inputData.waypoints.length-1&&this._inputData.waypoints[n].point;)n++;if(n<=this._inputData.waypoints.length-1&&!this.resolveWaypointsInRoutingService)this._resolveWayPoint(n);else{if(u=!0,s=this.waypoints[0].getWayPointModel().point,s){for(e=1;e<this.waypoints.length;e++)if(h=this.waypoints[e].getWayPointModel().point,!h||!k.areEqual(h,s)){u=!1;break}}else u=!1;u?this.clearResultsAndShowMessage({errorDetails:[i.L_Directions_Error_Equal_Waypoints],errorCode:f.atleastTwoWaypointRequired}):(o={DirectionsInputData:this._inputData},t&&(o.routeIndex=t),r&&(o.routeId=r),this.directionsResultsRequested.invoke(o))}},h.prototype._getMapBoundsForWaypoint=function(n){var r=n.getEntity(),i=r&&r.getBoundingBox(),t;return i&&i.length===2?(t=ur.fromLocations(i[0],i[1]),[t.getNorth(),t.getWest(),t.getSouth(),t.getEast()]):null},h.prototype._getValuesForPreviousLocation=function(n){if(n>0&&n<this.waypoints.length){var i=this.waypoints[n-1],t=i.getWayPointModel().point;if(t)return[t.latitude,t.longitude]}return null},h.prototype._invalidateResults=function(){this.clearDirectionsResults.invoke()},h.prototype.onSeeAllRoutesClick=function(){},h.prototype.seeAllRoutesReturnClick=function(){},h.prototype._setEnabledOptions=function(){this.showOptimizeTime=t.enableOptimizeTime;this.showOptimizeCost=t.enableOptimizeCost;this.showOptimizeTransfers=t.enableOptimizeTransfers},h.prototype._setTransitModeOptions=function(n){n.defineProperty("avoidFlights",this._onAvoidFlightsChanged);n.defineProperty("avoidExpressTrains",this._onAvoidExpressTrainsChanged);n.defineProperty("avoidBulletTrains",this._onAvoidBulletTrainsChanged);n.defineProperty("useBulletTrains",this._onUseBulletTrainsChanged);var t=this._inputData.options.transitTypes;n.defineProperty("allowBuses",this._updateTransitModeOptionsFromSelection,null,{defaultValue:t[1]});n.defineProperty("allowCityRails",this._updateTransitModeOptionsFromSelection,null,{defaultValue:t[2]});n.defineProperty("allowSubways",this._updateTransitModeOptionsFromSelection,null,{defaultValue:t[7]});n.defineProperty("allowFerries",this._updateTransitModeOptionsFromSelection,null,{defaultValue:t[5]});n.defineProperty("allowTrains",this._updateTransitModeOptionsFromSelection,null,{defaultValue:t[4]})},h.prototype._updateTransitModeOptionsFromData=function(){var n=this._inputData.options.transitTypes;this.setAllowBuses(n[1]);this.setAllowCityRails(n[2]);this.setAllowSubways(n[7]);this.setAllowFerries(n[5]);this.setAllowTrains(n[4])},h.prototype._updateTransitModeOptionsFromSelection=function(){var n=this._inputData.options.transitTypes;n[1]=this.getAllowBuses();n[2]=this.getAllowCityRails();n[7]=this.getAllowSubways();n[5]=this.getAllowFerries();n[4]=this.getAllowTrains();this._updateExistingDirections()},h.prototype._getErrorText=function(n,t){var r=n.valueOf();typeof r!="number"&&(r=f[r]);switch(r){case f.atleastTwoWaypointRequired:case f.searchServiceFailed:return t?t:i.L_Directions_Error_No_Results;case f.CantFindNearbyRoad:return i.DirectionsErrorCannotFindRoad;case f.DataSourceNotFound:return i.DirectionsErrorSourceNotFound;case f.NoAvailableTransitTrip:return i.DirectionsErrorNoTransitTrip;case f.NoNearbyStops:return i.DirectionsErrorNoNearbyStops;case f.NoSolution:return i.DirectionsErrorNoSolution;case f.OutOfTransitBounds:return i.DirectionsErrorOutOfBoundsForTransit;case f.TimeoutOccurred:return i.DirectionsErrorTimeout;case f.TooFar:return i.DirectionsErrorTooFar;case f.TransitStopsTooClose:return i.DirectionsErrorStopsTooClose;case f.WalkingBestAlternative:return i.DirectionsErrorWalkBestAlternative;case f.ParameterValidationError:case f.SkpError:case f.CacheMiss:case f.RateLimiterRejected:return i.DirectionsServerError;case f.generalError:case f.noResults:case f.otherError:case f.UnknownError:default:return i.L_Directions_Error_No_Results}},h}(ft),kr=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return w(t,n),t.prototype.initializeCalendar=function(){},t.prototype.setShowInputBoxes=function(n){this.setShowWaypoints(n);this.setShowEditDirections(!n)},t.prototype.onEditDirectionsClick=function(n){n.preventDefault();this.setShowInputBoxes(!0)},t.prototype.showEditAndCollapseCard=function(){this.setShowInputBoxes(!1);a.invokeHandler(l.layoutDataHandlerKey,{action:"updateLayout",state:{layoutType:"collapseCard"}})},t.prototype.onSeeAllRoutesClick=function(n){n.preventDefault();this.setShowEditDirections(!1);this.setShowRouteCategoriesPanel(!1);this.seeAllRoutesClick.invoke()},t.prototype.seeAllRoutesReturnClick=function(){this.setShowEditDirections(!0);this.setShowRouteCategoriesPanel(!0)},t}(bi),si=function(){function n(){}return n.prototype.getTitle=function(){return""},n.prototype.getSubtitle=function(){return""},n.prototype.getDescriptionTime=function(){return null},n.prototype.getDescriptionTimeNoTraffic=function(){return null},n.prototype.getRouteEmbellishments=function(){return null},n.prototype.getStartTime=function(){return null},n.prototype.getEndTime=function(){return null},n.prototype.getDescriptionVia=function(){return""},n.prototype.getHtmlFormattedInstruction=function(){return""},n.prototype.getInstruction=function(){return[]},n.prototype.getExtraTransitSegments=function(n){return i.L_Transit_MoreTransit.replace("{0}",n)},n.prototype.getStartInstruction=function(n,t,r,u,f,e){var s=this._createWaypointInstruction(n,u?"dirRouteStart":"dirRouteStop bm_dirRouteLegStart",r[0].routeLegStopPoint,f),c,o,h,l;for(s.viaPoints=[],c=n.getWayPointModel(),o=1;o<r.length;o++)h=r[o].routeLegStopPoint,h.isVia&&c.viaWaypoints.length>=o&&(l={text:i.L_Directions_Via_Text.replace("{0}",h.description),removeLinkText:i.L_Directions_Via_Remove_Link,waypointIndex:n.getIndex(),viaPointIndex:o-1},s.viaPoints.push(l),c.viaWaypoints[o-1].address=h.description);return u&&e&&(s.startTimeHint=this.getStartTime(e)),s},n.prototype.getEndInstruction=function(n,t,i,r,u,f){var e=this._createWaypointInstruction(n,u||u===undefined?"dirRouteEnd":"dirRouteStop bm_dirRouteLegEnd",i[i.length-1].routeLegStopPoint,r);return u&&f&&e&&(e.endTimeHint=this.getEndTime(f)),e},n.prototype.getFormattedDistanceText=function(t,i,r,u){var f=i.distanceUnit.toLowerCase()!=="mile";return t?n.formatDistanceString(t,f,r,u):""},n.prototype.getDurationString=function(n){var r=Math.round(n/60),t=r%60,f=Math.floor(r/60);return f==0?u._formatString(i.L_Directions_Duration_Min,t==0?1:t):u._formatString(i.L_Directions_Duration,f,t)},n.prototype.setMap=function(n){this._map=n},n.prototype.setRenderOptions=function(n){this.renderOptions=n},n.prototype.getCost=function(){return null},n.prototype._createWaypointInstruction=function(n,t,i,r){if(n)return new pt(r,i,null,t,n,this.renderOptions)},n.formatDistanceString=function(n,t,f,e){if(!i||!i.L_DistanceUnitMeters_Text)return u._formatDistanceString(n,t,f,e);var o,s=1,h=n>=50&&f;return n=n&&h?Math.round(n):n,t?n<.1?(n*=1e3,o=i.L_DistanceUnitMeters_Text,s=0):o=i.L_DistanceUnitKm_Text:n<.1?(n*=5280,o=i.L_DistanceUnitFeetShort_Text,s=0):o=r.GlobalConfig.features.directions.bestModeEnabled&&e?i.L_DistanceUnitMilesLongText_Text:i.L_DistanceUnitMilesShortText_Text,u._formatString(i.L_Distance_Format,u._toFixed(n,h?0:s),o)},n.formatLatLonString=function(n,t){return!i||!i.L_LatLon_Format?u._formatLatLonString(n,t):u._formatString(i.L_LatLon_Format,u._toFixed(n,6),u._toFixed(t,6))},n}(),hi=function(n){function r(){var t=n.call(this)||this;return t.roadShieldsReadyEvent=new s,t.unloadedRoadShields=0,t._isRtl=u._isRtl(),t}return w(r,n),r.prototype.getDescriptionVia=function(n){var t=n&&n.routeLegs&&n.routeLegs.length&&n.routeLegs[0].description;return t?u._formatString(i.L_Directions_Results_Title,t):null},r.prototype.getDescriptionTime=function(n){return n?this.getDurationString(n.travelDurationTraffic):null},r.prototype.getRouteEmbellishments=function(n){var t=[],r=null,e,s,o,u,f;if(n&&n.routeLegs){for(e=0;e<n.routeLegs.length;e++)for(s=n.routeLegs[e],o=0;o<s.routeSubLegs.length;o++)if(u=s.routeSubLegs[o],u.routeProperties&&u.routeProperties.length>0)for(f=0;f<u.routeProperties.length;f++)u.routeProperties[f]&&t.push(u.routeProperties[f]);t.length>0&&(t.indexOf("Toll")!=-1?r=i.L_Directions_RouteInfo_TollRoad:t.indexOf("Ferry")!=-1?r=i.L_Directions_RouteInfo_Ferry:t.indexOf("CrossBorder")!=-1?r=i.L_Directions_RouteInfo_CrossBorder:t.indexOf("NoHighway")!=-1?r=i.L_Directions_RouteInfo_LocalRoads:t.indexOf("Unpaved")!=-1&&(r=i.L_Directions_RouteInfo_Unpaved))}return r},r.prototype.getDescriptionTimeNoTraffic=function(n){var t=this.getStartTime(n),r;return t?t:n.travelDuration&&n.travelDurationTraffic&&(r=n.travelDurationTraffic-n.travelDuration,r>=180&&r/n.travelDurationTraffic>.05)?(t=this.getDurationString(r),t?u._formatString(i.L_Directions_Results_Delay_Time,t):null):null},r.prototype.getStartTime=function(n){var r,t;return n&&(t=n&&n.routeLegs&&n.routeLegs.length&&n.routeLegs[0],t&&t.startTime&&(r=u._getTimeString(t.startTime))),r?u._formatString(i.L_Directions_Depart_Time,r):null},r.prototype.getEndTime=function(n){var r,t;return n&&(t=n&&n.routeLegs&&n.routeLegs.length&&n.routeLegs[n.routeLegs.length-1],t&&t.endTime&&(r=u._getTimeString(t.endTime))),r?u._formatString(i.L_Directions_Arrive_Time,r):null},r.prototype.getTitle=function(){return null},r.prototype.getSubtitle=function(n){return n?this.getFormattedDistanceText(n.travelDistance,n,!0,!0):""},r.prototype.getInstruction=function(n,t,i){var e=[],u,f,o;if(n){if(u=new pt(i,n.maneuverPoint,n,null,null,this.renderOptions),u.travelDistanceText=this.getFormattedDistanceText(n.travelDistance,t),u.stepText=n.instruction.text,u.formattedText=this.getHtmlFormattedInstruction(n.instruction.formattedText),u.hints=n.hints,this._isRtl&&(u.stepText=this._modifyListForRtl(u.stepText),u.formattedText=this._modifyListForRtl(u.formattedText),f=u.hints&&u.hints.length,f))while(--f>=0)u.hints[f].text=this._modifyListForRtl(u.hints[f].text);u.warnings=this._sortWarnings(n.warnings);n.travelDistance>=r.TravelDistanceThreshhold&&(u.travelDurationText=this.getDurationString(n.travelDuration));o=n.instruction.maneuverType;this._constructRoadShieldUrl(u,n.details,o);e.push(u)}return e},r.prototype.getHtmlFormattedInstruction=function(n){return n&&(n=n.replace(new RegExp("(<\/ExitNumber>|<\/TurnDir>|<\/RoadName>|<\/Sign>|<\/WaypointName>|<\/CmpsDir>)","gi"),"<\/b>"),n=n.replace(new RegExp("(<ExitNumber>|<TurnDir>|<RoadName>|<Sign>|<WaypointName>|<CmpsDir>)","gi"),"<b>"),n=n.replace(new RegExp("<\/([^bs>]*)>","gi"),""),n=n.replace(new RegExp("<([^bs>]*)>","gi"),"")),n},r.prototype._constructRoadShieldUrl=function(n,i,u){var c=this,e,o,h,l,s,f,a,v;if(!i||!i.length){n.setStepIconClass(u);return}for(e=[],o=-1,h=0;h<i.length;h++)l=i[h],s=l.roadShieldRequestParameters,s&&(o===-1&&(o=s.bucket||r._defaultRoadShieldBucketId),s.shields&&Array.prototype.push.apply(e,s.shields));if(e.length)e.length>1&&e.sort(function(n,t){var i=n.roadShieldType,r=t.roadShieldType;return i!=r?i-r:t.labels[0].localeCompare(n.labels[0])});else{n.setStepIconClass(u);return}if(f=e[0],!this._shouldDisplayShield(o,f,u)){n.setStepIconClass(u);return}t.enableRoadShieldIconXsr?(this.unloadedRoadShields++,a=[f.roadShieldType-1],this._map&&this._map.getTemplateSelector().then(function(t){t.getShieldsAsync(r._roadShieldZoom,o,a,function(t){try{var i=c._getLabel(f.labels),r=t[0].renderIcon({id:null,name:i}),e=r[0].toDataURL();n.setRoadShieldUrl(e)}catch(o){n.setStepIconClass(u)}finally{--c.unloadedRoadShields==0&&c.roadShieldsReadyEvent.invoke()}})})):(v=t.roadShieldServiceUrlFormat.replace("{bucket}",o).replace("{shield}",f.roadShieldType).replace("{label}",f.labels&&f.labels.length?f.labels[0]:""),n.setRoadShieldUrl(v))},r.prototype._getLabel=function(n){if(!n||!n.length)return"";if(n[0].indexOf("UP:")===0)try{var t=JSON.parse(n[0].substring(3));return t.label}catch(i){return n[0]}return n[0]},r.prototype._shouldDisplayShield=function(n,t,i){if(n===50360||n===50395){if(t.roadShieldType===1||t.roadShieldType===2)return!0}else if(t.roadShieldType===1)return!0;return i==="TakeRampLeft"||i==="TakeRampRight"||i==="TakeRampStraight"||i==="Merge"||i==="RampThenHighwayLeft"||i==="RampThenHighwayRight"||i==="RampToHighwayStraight"||i==="BearThenMerge"||i==="TurnThenMerge"||i==="RoadNameChange"},r.prototype._sortWarnings=function(n){if(n)return n.sort(function(n,t){var i=["Serious","Moderate","Minor","LowImpact","None"];return i.indexOf(n.severity)-i.indexOf(t.severity)})},r.prototype._modifyListForRtl=function(n){return n&&n.replace(/\s\/\s/g," \\‏ ")},r.TravelDistanceThreshhold=10,r._roadShieldZoom=14,r._defaultRoadShieldBucketId=787073,r}(si),ki=function(n){function t(){return n.call(this)||this}return w(t,n),t.prototype.getDescriptionTimeNoTraffic=function(){return null},t}(hi),dr=function(n){function r(){return n.call(this)||this}return w(r,n),r.prototype.getDescriptionVia=function(n){var f=n&&n.routeLegs&&n.routeLegs.length&&n.routeLegs[0].itineraryItems,o="",e,s;if(t.enableMultiMode&&n.travelMode==="Multimodal"&&n.routeLegs[0].endLocation&&n.routeLegs[0].endLocation.name)o+=u._formatString(i.L_Directions_Results_Title,n.routeLegs[0].endLocation.name);else if(f&&f.length)for(e=0,s=0;e<f.length;e++)f[e].transitLine&&(o+=u._formatString(s++>0?i.L_Directions_Transit_Via2:i.L_Directions_Transit_Via1,r.typeNames[f[e].iconType],f[e].transitLine.abbreviatedName));return o?o:null},r.prototype.getTitle=function(n){var i="",t,f,e;return n&&(t=n&&n.routeLegs&&n.routeLegs.length&&n.routeLegs[0],t&&t.startTime&&t.endTime&&(f=u._getTimeString(t.startTime),e=u._getTimeString(n.routeLegs[n.routeLegs.length-1].endTime),i=u._formatString(r._transitTimeFormat,f,e))),i},r.prototype.getDescriptionTimeNoTraffic=function(){return null},r.prototype.getSubtitle=function(n){return n?this.getDurationString(n.travelDuration):""},r.prototype.getInstruction=function(n,r,f){var p=[],e,l,h,w,o,a,it,c,y,s,v,d,g,b,nt,tt;if(n){if(e=new pt(f,n.maneuverPoint,n,null,null,this.renderOptions),n.groupText?(l=n.childItineraryItems[0],e.setStepIconClass(l.iconType),e.stepText=n.groupText,e.formattedText=e.stepText,e.itineraryItem.maneuverPoint=l.maneuverPoint,e.location=new k(l.maneuverPoint.coordinates[0],l.maneuverPoint.coordinates[1]),e.itineraryItem.instruction=l.instruction,e.setShow(!0)):(e.setStepIconClass(n.iconType),e.stepText=n.instruction.text,e.formattedText=this.getHtmlFormattedInstruction(n.instruction.formattedText),e.timeText=n.time?u._getTimeString(n.time):""),e.hints=n.hints||[],e.warnings=n.warnings||[],n.transitLine&&(n.transitLine.uri&&n.transitLine.uri.indexOf(t.specialAttributionLink)>-1&&(e.specialAttributionUri=n.transitLine.uri,e.specialAttributionLink=t.specialAttributionLink),n.transitLine.lineColor&&(e.transitLineColor=u._formatHexColorString(n.transitLine.lineColor,""))),p.push(e),e.groupItems=[],e.groupItemsLocations=[],w=n.childItineraryItems,w&&w.length)for(e.childSteps=[],c=0;c<w.length;c++)o=w[c],n.groupText?(a=this.getInstruction(o,r,f)[0],it=o.instruction.maneuverType,a.setShow(!1),a.setStepIconClass(it),a.parentStepIndex=n.parentInstructionIndex,p.push(a),e.groupItems.push(a),v=o.maneuverPoint.coordinates,e.groupItemsLocations.push(new k(v[0],v[1]))):o.instruction.maneuverType==="TransitArrive"?(h=new pt(f,o.maneuverPoint,o,o.instruction.maneuverType,null,this.renderOptions),h.parentStepIndex=n.parentInstructionIndex,h.stepText=o.instruction.text,h.formattedText=this.getHtmlFormattedInstruction(o.instruction.formattedText),h.timeText=u._getTimeString(o.time),h.transitArriveTime=u._getTime(o.time),h.needPushpin=!1,h.transitLineColor=e.transitLineColor):o.instruction.maneuverType==="TransitDepart"&&(e.transitDepartTime=u._getTime(o.time),e.timeText=u._getTimeString(o.time),e.childSteps=[{stepText:o.instruction.text,formattedText:this.getHtmlFormattedInstruction(o.instruction.formattedText)}]);if(n.transitStops&&n.transitStops.length)for(c=0;c<n.transitStops.length;c++)y=n.transitStops[c],s=new pt(f,y.position,null,null,null,this.renderOptions),s.setShow(!1),s.setStepIconClass("TransitStop"),s.stepText=y.stopName,s.parentStepIndex=n.parentInstructionIndex,s.formattedText=s.stepText,s.needPushpin=!0,s.transitStopID=y.stopId,s.transitStopName=y.stopName,s.transitLineColor=e.transitLineColor,p.push(s),e.groupItems.push(s),v=y.position.coordinates,e.groupItemsLocations.push(new k(v[0],v[1]));if(h){if(h.transitDepartTime=e.transitDepartTime,e.hints){for(d=[],g=[],b=0;b<e.hints.length;b++)nt=e.hints[b],tt=nt.hintType,(tt==="PreviousTransitStop"||tt==="NextTransitStop"?d:g).push(nt);e.hints=g;h.hints=d}p.push(h)}n.iconType==="Walk"&&n.travelDistance&&(e.hints=e.hints||[],e.hints.unshift({text:u._formatString(i.L_Directions_WalkDistance,this.getFormattedDistanceText(n.travelDistance,r),this.getDurationString(n.travelDuration))}))}return p},r.prototype.getStartInstruction=function(i,r,f,e,o){var s=n.prototype.getStartInstruction.call(this,i,r,f,e,o);return s.timeText=r.startTime?u._getTimeString(r.startTime):"",s.timeText=t.enableMultiMode?r.startTime?u._getTimeString(r.startTime):"":u._getTimeString(r.startTime),s},r.prototype.getEndInstruction=function(t,i,r,f){var e=n.prototype.getEndInstruction.call(this,t,i,r,f);return e.timeText=u._getTimeString(i.endTime),e},r.prototype.getHtmlFormattedInstruction=function(n){return n&&(n=n.replace(new RegExp("(<\/TransportType>|<\/TransitLineName>|<\/TransitLineTerminus>|<\/TransitStop>|<\/StartLocation>|<\/EndLocation>|<\/ServiceProvider>|<\/Phone>|<\/Action>)","gi"),"<\/b>"),n=n.replace(new RegExp("(<TransportType>|<TransitLineName>|<TransitLineTerminus>|<TransitStop>|<StartLocation>|<EndLocation>|<ServiceProvider>|<Phone>|<Action>)","gi"),"<b>"),n=n.replace(new RegExp("<\/([^bs>]*)>","gi"),""),n=n.replace(new RegExp("<([^bs>]*)>","gi"),"")),n},r.prototype.getCost=function(n){var r=0,t,u;if(n&&n.routeLegs&&n.routeLegs.length)for(t=0,u=n.routeLegs.length;t<u;t++)r+=n.routeLegs[t].cost;return i.L_Directions_Cost.replace("{0}",r)},r._transitTimeFormat="{0} - {1}",r.typeNames={Bus:i.L_Directions_Bus,Ferry:i.L_Directions_Ferry,Train:i.L_Directions_Train,Tube:i.L_Directions_Tube,Airline:i.L_Directions_Airline},r}(si),di=function(r){function e(u,f,o,h,c,l,a,v,y,p){var w=this,b={};return w=r.call(this,b,f,t.bestModeEnabled?pr:wr)||this,b.defineProperty("disclaimerText"),b.defineProperty("showSeeAllRoutes",function(){y&&y.displayDisclaimer!==undefined||w.setShowDisclaimer(!w.getShowSeeAllRoutes())}),b.defineProperty("showDisclaimer"),b.defineProperty("showTransitLogo",null,null,{defaultValue:!0}),w._map=u,w._totalDirectionsRequestPerfState=a,w._controlTemplateFactory=f,w.directionsResultsTitleSet=[],w.directionsResultsListSet=[],w.routelines=[],w.stopPoints=[],w.allStopPoints=[],w.routeStopPointPathIndices=[],w._requestOptions=o,w._panelViewModel=h,w._taskId=v,w.disposables.push(w._routeMapEntitiesCollection=c),w.resultsOnlyDisplayed=new s,w._directionsFormattedTextProvider=e._directionsFormattedTextProviders[n[o.mode]](),w._directionsFormattedTextProvider.roadShieldsReadyEvent&&w.disposables.push(w._directionsFormattedTextProvider.roadShieldsReadyEvent.add(function(){w._onRoadShieldReadyEvent()})),w._directionsFormattedTextProvider.setRenderOptions(y),w._routeSelected=-1,w.reportProblemClicked=new s,w.resources=i,w.routeSelectedEvent=new s,w.showPrint=et.isEnabled,w.discarded=!1,w.seeAllRoutesReturnClick=new s,w.isSDK=t.isSDK,w.isBestMode=t.bestModeEnabled,w.setShowDisclaimer(!w.getShowSeeAllRoutes()),y&&w._setRenderOptions(y),w._routeDraggable=typeof p=="boolean"?p:!0,w._directionsFormattedTextProvider.setMap(w._map),w._startClass=" startWaypointLetter",w._stopClass=" stopWaypointLetter",w._endClass=" endWaypointLetter",w.enableNewDiretionsAnswerAlert=t.enableNewDiretionsAnswerAlert,w}return w(e,r),e.prototype.hideDirectionsResultsListSet=function(){for(var n=0;n<this.directionsResultsListSet.length;n++)this.directionsResultsListSet[n].setShowResults(!1),this.directionsResultsTitleSet[n].setIsSelected(!1)},e.prototype.boolToSelectedTitleClassName=function(n){return n?"drTitle selected":"drTitle"},e.prototype.stringToEmbellishmentClassName=function(n){return n===this.resources.L_Directions_RouteInfo_TollRoad?"drEmbellishRed":"drEmbellish"},e.prototype.boolToEmbellishmentClassName=function(n){return n?"drEmbellishLateRed":""},e.prototype.boolToTransitEmbellishmentClassName=function(n){return n?"drTransitEmbellish":""},e.prototype.iconToClassName=function(n){return"tt"+n},e.prototype.lineNameToClassName=function(n){var i="",t,r;return n&&(t=parseInt(n&&n.substr(1),16),t&&t<16777215&&(r=u._calcLuminance(t),i=r>.65?"darkText":"lightText")),"bm_lineName "+i},e.prototype.routeModeToDrivingDisplay=function(t){return t===n.driving||t===n.walking?"":"none"},e.prototype.multiModeToDisplay=function(i){return t.enableMultiMode&&i===n.multimode?"":"none"},e.prototype.routeModeToDisplay=function(i){return i===n.transit||t.enableMultiMode&&i===n.multimode?"none":""},e.prototype.routeModeToNotDisplay=function(i){return i===n.transit||t.enableMultiMode&&i===n.multimode?"":"none"},e.prototype.routeModeToClassName=function(t){var i="";if(t)switch(t){default:case n.driving:i="driving";break;case n.transit:i="transit";break;case n.walking:i="walking";break;case n.multimode:i="parkAndRide"}return i},e.prototype.boolToMultimodeSelectedDurationClassName=function(n){return n?"drDuration selected":"drDuration"},e.prototype.boolToSelectedDurationClassName=function(t){return this._requestOptions.mode===n.transit?"hide":t?"drDuration selected":"drDuration"},e.prototype.indexToOddEvenClass=function(n){return n===null||n===undefined||n===-1?"":"waypointPrintMaps "+(n%2==0?"even":"odd")},e.prototype.indexToOddEvenBackgroundClass=function(n){return n===null||n===undefined||n===-1?"":n%2==0?"bg":"noBg"},e.prototype.indexToWaypointTypeLabel=function(n){return n===null||n===undefined||n===-1?"":this.indexToIconTextStart(n)},e.prototype.getPanelRouteMode=function(){return this._requestOptions.mode},e.prototype.getRouteMode=function(n){var i=this._requestOptions.mode;return t.bestModeEnabled&&this._routeSets&&this._routeSets.length>0&&n<this._routeSets.length&&(i=this._getCurrentRouteMode(this._routeSets[n])),i},e.prototype.getDirections=function(n,t,i,r,u,f,e){var s=this,h=at.logPerfEvent(st.RR,this._requestOptions.mode),o=this._map&&this._map.getMapOptions(),c={requestOptions:this._requestOptions,needBestMapView:t,perfState:h,isDragRequest:i,viaPoint:r,legIndex:u,subLegIndex:f,viaPointRemoved:e,setResultPanelFocus:!this._panelViewModel.getAndResetPanelFocusFlag(),mapCredentials:o&&o.credentials};this._rawResponse=null;br.downloadRoutes(c,function(t,i,r){s._onDownloadRouteCallback(t,i,r,n)})},e.prototype.taskStateChanged=function(n){this._routeMapEntitiesCollection.setTaskPrimitiveState(n)},e.prototype.onInstructionsMouseLeave=function(){this._routeMapEntitiesCollection.highlightAndInvalidate(null)},e.prototype.onStepTextClick=function(n){var r,u,h;n&&n.stopImmediatePropagation();n&&n.preventDefault&&n.preventDefault();var f=n.currentTarget,o=f.getAttribute("data-eid"),s=f.getAttribute("data-sf"),c=f.getAttribute("data-q"),t={};s?t.filterUrlParam=s:o&&(t.id=o);for(var i=0,e=ut.localDetailCardsData.length,v=ut.polygonEntityDetailCardsData.length;i<e+v;i++)if(r=i<e?ut.localDetailCardsData[i]:ut.polygonEntityDetailCardsData[i-e],u=r.data,u&&u.length===1&&(h=u[0],r.processorId&&h.id===t.id)){a.invokeHandler(l.taskDataHandlerKey,{action:"focus",id:r.processorId});return}t.query=c;t.entryPoint=ii.DirectionsRouteList;a.invokeHandler(l.taskProcessDataHandlerKey,{requestState:t,type:y.localSearchTask})},e.prototype.onRemoveViaClick=function(n){n&&n.stopImmediatePropagation();n&&n.preventDefault&&n.preventDefault();var t=e.getAttributeFromHtmlElement(n.currentTarget,"data-wpi"),i=e.getAttributeFromHtmlElement(n.currentTarget,"data-vwpi");this._panelViewModel.removeViaPoint(t,i)},e.prototype.getRouteSelected=function(){return this._routeSelected},e.prototype.onPrintDirectionsClick=function(n){n&&n.preventDefault&&n.preventDefault();et.isEnabled&&(ut.printCardClick=!0,a.invokeHandler(l.printDataHandlerKey,{source:2,taskType:y.directionsTask,taskId:this._taskId,data:{RI:this.getRouteSelected(),LOC:"P"}}))},e.prototype.dispose=function(){this._map=null;u._clearDisposables(this.directionsResultsListSet);u._clearDisposables(this.directionsResultsTitleSet);u._clearDisposables(this.waypoints);this._routeMapEntitiesCollection.dispose();this.clearRoutes();r.prototype.dispose.call(this)},e.prototype._buildAttributionsForPrint=function(){var i="",t;if(this._requestOptions.mode==n.transit&&this.showAttribution)for(t=0;this.transitAttributions&&t<this.transitAttributions.length;t++)this.transitAttributions[t].agencyName&&(i=i?i+this.resources.L_Directions_TimeDistance_Separator+this.transitAttributions[t].agencyName:this.transitAttributions[t].agencyName);return i},e.prototype.getDirectionsHtmlContentForPrint=function(){var t=this,r=this.getRouteSelected(),u=this.getRouteMode(r),i,f,e;return this.printTitleViewModel=this.directionsResultsTitleSet[r],this.printInstructionsViewModel=this.prepareInstructionListViewModelForPrint(this.directionsResultsListSet[r]),this.printMode="directionsPanel "+(u===n.transit?"transit":u===n.walking?"walking":"driving"),this.printTitleViewModel.routeMode=u,this.attributionText=this._buildAttributionsForPrint(),this.notesMaxCharSize=et.notesMaxChars,i={boolToSelectedDurationClassName:function(n){return t.boolToSelectedDurationClassName(n)},boolToSelectedTitleClassName:function(n){return t.boolToSelectedTitleClassName(n)},boolToEmbellishmentClassName:function(n){return t.boolToEmbellishmentClassName(n)},boolToTransitEmbellishmentClassName:function(n){return t.boolToTransitEmbellishmentClassName(n)},routeModeToClassName:function(n){return t.routeModeToClassName(n)},stringToEmbellishmentClassName:function(n){return t.stringToEmbellishmentClassName(n)},boolToDisplay:function(n){return t.boolToDisplay(n)},nullToDisplayNone:function(n){return t.nullToDisplayNone(n)},fractionToPercent:function(n){return t.fractionToPercent(n)},iconToClassName:function(n){return t.iconToClassName(n)},boolToNotDisplay:function(n){return t.boolToNotDisplay(n)},indexToStartClass:function(n){return t.indexToStartClass(n)},indexToEndClass:function(n){return t.indexToEndClass(n)},showGroupToClass:function(n){return t.showGroupToClass(n)},getWarningIconClass:function(n){return t.getWarningIconClass(n)},arrayToDisplay:function(n){return t.arrayToDisplay(n)},lineColorToIconClass:function(n){return t.lineColorToIconClass(n)},onPrintDirectionsClick:function(n){return t.onPrintDirectionsClick(n)},indexToOddEvenClass:function(n){return t.indexToOddEvenClass(n)},indexToWaypointTypeLabel:function(n){return t.indexToWaypointTypeLabel(n)},indexToOddEvenBackgroundClass:function(n){return t.indexToOddEvenBackgroundClass(n)},modeToDisplay:function(t){return t===n.transit?"none":"inline"},indexToIconTextStart:function(n){return t.indexToIconTextStart(n)},indexToIconTextEnd:function(n){return t.indexToIconTextEnd(n)},emptyUriToClass:function(n){return t.emptyUriToClass(n)},waypointTypeToClass:function(n){return"dirLegIconText"+(n==1?t._startClass:n==2?t._endClass:t._stopClass)}},this.titlePrintTemplate=new li(lf,i),this.instructionsPrintTemplate=new li(hf,i),f=this._controlTemplateFactory({templateText:of,staticResources:i}),e=f.applyDataTemplate(this),e[0].outerHTML},e.prototype.getWarningIconClass=function(n){var t="dirWarning";return n?t+" warning"+n:t},e.prototype.emptyUriToClass=function(n){return n?t.bestModeEnabled?"clickAttribution":"":"noClickAttribution"},e.prototype.select=function(n,i,r,u){var h,f,e,s;if(n!==this._routeSelected&&n>=0&&n<this.directionsResultsTitleSet.length){for(h=t.bestModeEnabled&&this._panelViewModel.hasViaPoints(),f=0;f<this.directionsResultsTitleSet.length;f++)e=n===f,this.directionsResultsTitleSet[f].setIsSelected(e),h&&e&&this._panelViewModel.getResultsExpanded()&&(this.directionsResultsTitleSet[f].setShowInstructions(e),this.directionsResultsTitleSet[f].setDetailsArrow(!0)),this.directionsResultsListSet[f].setShowResults(e),t.bestModeEnabled&&!e&&this.directionsResultsTitleSet[f].showHideInstructions(this.getControl(),!1);this._routeSelected=n;this.routeSelectedEvent&&this.routeSelectedEvent.invoke();this._routeMapEntitiesCollection.select(n,i,r,this._requestOptions.mode);u&&(s=o(".drTitle.selected",this.getControl()[0]).select("a"),s[0]&&s[0].focus())}},e.prototype.getRoutesLength=function(){return this.directionsResultsTitleSet.length},e.prototype.clearRoutesLabels=function(){this._routeMapEntitiesCollection&&this._routeMapEntitiesCollection.clearRoutesLabels()},e.prototype.showRoutesLabels=function(){this._routeMapEntitiesCollection&&this._routeMapEntitiesCollection.showRouteLabels()},e.prototype.clearRoutes=function(){this.directionsResultsTitleSet=[];this.directionsResultsListSet=[];this._routeMapEntitiesCollection.clearRoutesLabels();this.routeStopPointPathIndices=[];this.routelines=[];this.stopPoints=[];this._rawResponse=null},e.prototype.instructionRowClass=function(n){var t=" circleIcon";switch(n){case"TurnLeft":case"TurnLeftThenBearLeft":case"TurnLeftThenBearRight":case"TurnLeftThenTurnLeft":case"TurnLeftThenTurnRight":return"turnLeft"+t;case"TurnRight":case"TurnRightThenBearLeft":case"TurnRightThenBearRight":case"TurnRightThenTurnLeft":case"TurnRightThenTurnRight":return"turnRight"+t;case"UTurn":case"TurnBack":return"uTurnLeft"+t;case"KeepStraight":case"Continue":case"KeepOnRampStraight":case"KeepToStayStraight":case"RoadNameChange":case"TakeRampStraight":case"Transfer":return"keepStraight"+t;case"BearLeft":case"BearLeftThenBearLeft":case"BearLeftThenBearRight":case"BearLeftThenTurnLeft":case"BearLeftThenTurnRight":case"KeepOnRampLeft":return"slightLeft"+t;case"BearRight":case"BearRightThenBearLeft":case"BearRightThenBearRight":case"BearRightThenTurnLeft":case"BearRightThenTurnRight":case"KeepOnRampRight":return"slightRight"+t;case"KeepLeft":case"KeepToStayLeft":return"keepLeft"+t;case"KeepRight":case"KeepToStayRight":return"keepRight"+t;case"EnterRoundabout":case"EnterThenExitRoundabout":return"enterRoundaboutRight"+t;case"TakeRampRight":case"TakeRampLeft":case"ExitRoundabout":case"EnterRoundaboutLeft":case"Merge":case"TurnToStayLeft":case"TurnToStayRight":case"UTurnRight":case"RampThenHighwayRight":case"RampThenHighwayLeft":case"DepartStart":return n+t;case"Bus":case"Walk":case"Ferry":case"ParkAndRide":case"Tube":case"Train":return n+t;default:return n}},e.prototype.prepareInstructionListViewModelForPrint=function(n){for(var i,r,t=0;t<n.routeLegs.length;t++)i=n.routeLegs[t],r=i.instructionSteps,i.startWaypointAddress=r[0].stepText,i.endWaypointAddress=r[r.length-1].stepText,i.startIconType=t==0?1:3,i.endIconType=t==n.routeLegs.length-1?2:3,i.resources=this.resources;for(t=0;t<this.waypoints.length;t++)this.waypoints[t].waypointType=t==0?1:t==this.waypoints.length-1?2:3;return n.resources=this.resources,n},e.prototype._onDownloadRouteCallback=function(n,t,r,u){var c,l;if(!this.discarded){var e=n.requestOptions,o=n.isDragRequest,h=n.needBestMapView,a=n.setResultPanelFocus,s;(o&&(s="DR"),n&&n.perfState&&n.perfState.end(s),this._requestOptions===e)&&(this.clearRoutes(),c=t?t.traceId:null,r&&r.errorCode===f.Success&&t&&t.resourceSets&&t.resourceSets.length>0?(this._rawResponse=t,this._setDirectionsResults(e,t,h,o),this._panelViewModel.updateModeBtnState(e.mode)):!r||r.errorCode===f.Success||r.errorDetails&&r.errorDetails.length||(l=i.L_Directions_Error_No_Results,r.errorDetails=[l]),u(c,r,e,h,o,a),!o&&this._totalDirectionsRequestPerfState&&(this._totalDirectionsRequestPerfState.end(s),this._totalDirectionsRequestPerfState=undefined))}},e.getAttributeFromHtmlElement=function(n,t){return o.Internals.parseJSON(n.getAttribute(t))},e.prototype.setReportProblemLink=function(n){this._feedBackState=n;this._feedBackState.entryPoint=3},e.prototype.reportProblem=function(n){n.preventDefault();this.reportProblemClicked.invoke();a.invokeHandler(l.taskDataHandlerKey,{type:y.feedbackTask,activateOptions:{parentId:this._taskId},state:this._feedBackState})},e.prototype.attributionClick=function(n){if(n.preventDefault(),n&&n.srcElement){var t=n.srcElement.getAttribute("href");t&&window.open(t)}},e.prototype.onGetReturnDirectionsClick=function(n){n&&n.preventDefault&&n.preventDefault();n.stopPropagation&&n.stopPropagation();this._routeSets&&this._routeSelected&&this._routeSelected<this._routeSets.length&&this._panelViewModel.processReturnDirectionsRequest(this._routeSets[this._routeSelected].waypointEntities)},e.prototype._validateItineraryItemDetails=function(n){return n&&n.details&&n.details.length>0&&n.details[0].startPathIndices&&n.details[0].startPathIndices.length>0&&n.details[n.details.length-1].endPathIndices&&n.details[n.details.length-1].endPathIndices.length>0},e.prototype._getCurrentRouteMode=function(i){var r=this._requestOptions.mode;if(t.bestModeEnabled&&i)switch(i.travelMode){default:case"Driving":r=n.driving;break;case"Transit":r=n.transit;break;case"Walking":r=n.walking;break;case"Multimodal":r=n.multimode}return r},e.prototype._setDirectionsResults=function(n,t,i,r){var s,u,f,e,o;if(n===this._requestOptions&&(r||(s=at.logPerfEvent(st.PD,n.mode)),u=t&&t.resourceSets[0],this.transitAttributions=[],u&&u.resources&&u.resources.length&&(this._routeSets=u.resources,f=this._processResources(n,t,r),r&&this._routeMapEntitiesCollection.show(i,!0,n.mode,!r)),!r)){if(this.directionsResultsTitleSet.length>0)for(this._panelViewModel.updateModeBtnState(n.mode),this._updateWaypoints(f?f.stopPoints:[]),this._setTransitLineWidth(f?f.maxDuration:0),this._buildDisclaimer(),e=0;e<this.directionsResultsTitleSet.length;e++)o=this.directionsResultsTitleSet[e],o.disclaimerText=this.getDisclaimerText(),o.showDisclaimer=this.getShowDisclaimer(),o.showTransitLogo=this.getShowTransitLogo();s&&s.end()}},e.prototype._processResources=function(i,r,u){for(var f,o,l,v,it=r.resourceSets[0],y=it.resources,p=0,c,h=0;h<y.length;h++)if(f=y[h],o=this._getCurrentRouteMode(f),t.enableMultiMode||o!==n.multimode){l=e._directionsFormattedTextProviders[n[o]]();l.setMap(this._map);l.setRenderOptions(this._renderOptions);var w=[],b=[],k=[],s=new oi(h,this._map,this.controlTemplateFactory),d=[],a=f.travelDuration,g=[],nt=[],tt=f.entitiesAlongRoute;(o===n.driving||o===n.truck)&&(a=f.travelDurationTraffic);p=Math.max(a,p);f.routeLegs&&f.routeLegs.length&&(v=[],c=[],t.enableMultiMode&&o===n.multimode?this._processMultiModeRouteLegs(f,c,nt,k,b,g,s,a,d,o,v,w,u):this._processRouteLegs(f,c,nt,k,l,b,g,s,a,d,o,v,w,r.traceId,u),this._processInstructionSteps(h,i,b,f,o,w,g,d,a,l,v,s,u),this._createRoutePolyline(f,s,c,k,u,o));o!==n.driving||!tt||u||this.isSDK||s.createCameraPins(tt);t.trafficIncidentV2Enabled&&o===n.driving&&!u&&s.createIncidentPins(this.getWarningsOnRoute(f));this.routeStopPointPathIndices.push(nt.slice(0));this._routeMapEntitiesCollection.addRoute(s,f,this._directionsFormattedTextProvider,o,h,y.length>1)}return{maxDuration:p,stopPoints:c}},e.prototype.getWarningsOnRoute=function(n){var e=[],r,t,u,i,f;if(n&&n.routeLegs&&n.routeLegs.length>0)for(r=0;r<n.routeLegs.length;r++)if(t=n.routeLegs[r],t.itineraryItems&&t.itineraryItems.length>0)for(u=0;u<t.itineraryItems.length;u++)if(i=t.itineraryItems[u],i.warnings&&i.warnings.length>0)for(f=0;f<i.warnings.length;f++)e.push(i.warnings[f]);return e},e.prototype._processRouteLegs=function(n,r,u,f,e,o,s,h,l,a,y,p,w,b,k){for(var it,nt,ft,et,d=0;d<n.routeLegs.length;d++){var tt=[],g=n.routeLegs[d],ut=[];this._processStopPoints(g,r,u,ut);var ht=0,rt=[],yt=oi.getViaIndexes(g),ct=0;if(g.itineraryItems&&g.itineraryItems.length){for(rt=this._createItineraryList(g),it=0;it<rt.length;it++)rt[it].instructionIndex=rt[it].parentInstructionIndex=it+1;nt=this._directionsFormattedTextProvider.getStartInstruction(this._panelViewModel.waypoints[d],g,ut,d===0,this._routeMapEntitiesCollection,n);tt.push(nt);this.disposables.push(nt);f.push(nt);ft=this._processItineraryItems(n,ht,ct,rt,h,yt,ut,d,e,tt,s,l,a,y,p,k);ht=ft.subLegIndex;ct=ft.lastStopIndex;et=d===n.routeLegs.length-1;nt=e.getEndInstruction(this._panelViewModel.waypoints[d+1],g,ut,this._routeMapEntitiesCollection,et,n);tt.push(nt);this.disposables.push(nt);et&&f.push(nt);o.push.apply(o,tt);var lt=tt[0].stepText,at=this._panelViewModel.waypoints[d+1].getWaypointTitle(),pt=t.bestModeEnabled?i.L_Directions_Leg_Title_To:i.L_Directions_Leg_Title,wt=pt.replace("{from}",lt).replace("{to}",at),vt=e.getDurationString(g.travelDuration),ot=g.travelDistance?e.getFormattedDistanceText(g.travelDistance,n):"",bt=g.travelDistance?i.L_Directions_Leg_TimeDist_Text.replace("{time}",vt).replace("{distance}",ot):i.L_Directions_Leg_TimeOnly_Text.replace("{time}",vt),st=new nu(this._renderOptions,tt,wt,bt,d,n.routeLegs.length);st.startWaypointAddress=lt;st.endWaypointAddress=at;w.push(st);ot&&ot!==undefined||v.logInstrumentationEvent(c.DBG,{distance:"undefined",traceId:b})}}},e.prototype._processMultiModeRouteLegs=function(r,u,f,o,s,h,c,l,a,v,y,p,w){for(var g,ft,st,et,nt,d=[],ot,ct,b=0;b<r.routeLegs.length;b++){var k=r.routeLegs[b],wt=this._getLegTravelMode(k),it=e._directionsFormattedTextProviders[n[wt]](),rt=[];this._processStopPoints(k,u,f,rt);var lt=0,ut=[],bt=oi.getViaIndexes(k),at=0;if(k.itineraryItems&&k.itineraryItems.length){for(ut=this._createItineraryList(k,n.multimode),g=0;g<ut.length;g++)ut[g].instructionIndex=ut[g].parentInstructionIndex=g+1;ft=b===0?this._directionsFormattedTextProvider.getStartInstruction(this._panelViewModel.waypoints[b],k,rt,!0,this._routeMapEntitiesCollection,r):new pt(this._routeMapEntitiesCollection,rt[0].routeLegStopPoint,null,"ParkAndRide",new wi(new tt(null,null,r.routeLegs[b-1].endLocation.name,null,null,r.waypointEntities&&r.waypointEntities.length===3&&r.waypointEntities[1].entityId),null),it.renderOptions);d.push(ft);this.disposables.push(ft);o.push(ft);st=this._processItineraryItems(r,lt,at,ut,c,bt,rt,b,it,d,h,l,a,v,y,w);lt=st.subLegIndex;at=st.lastStopIndex;b===r.routeLegs.length-1&&(et=it.getEndInstruction(this._panelViewModel.waypoints[this._panelViewModel.waypoints.length-1],k,rt,this._routeMapEntitiesCollection,!0,r),d.push(et),this.disposables.push(et),o.push(et),ot=it.getDurationString(r.travelDuration),ct=r.travelDistance?it.getFormattedDistanceText(r.travelDistance,r):"")}}s.push.apply(s,d);var vt=d[0].stepText,yt=this._panelViewModel.waypoints[this._panelViewModel.waypoints.length-1].getWaypointTitle(),kt=t.bestModeEnabled?i.L_Directions_Leg_Title_To:i.L_Directions_Leg_Title,dt=kt.replace("{from}",vt).replace("{to}",yt),gt=r.travelDistance?i.L_Directions_Leg_TimeDist_Text.replace("{time}",ot).replace("{distance}",ct):i.L_Directions_Leg_TimeOnly_Text.replace("{time}",ot),ht=new nu(this._renderOptions,d,dt,gt,1,1);if(ht.startWaypointAddress=vt,ht.endWaypointAddress=yt,p.push(ht),r.waypointEntities&&r.waypointEntities.length>=2&&r.waypointEntities.length===u.length)for(nt=1;nt<u.length-1;nt++)u[nt].categoryName=r.waypointEntities[nt].categoryName,u[nt].routeLegStopPoint.isVia=!0},e.prototype._processStopPoints=function(n,t,i,r){if(n.routeSubLegs){t.length>0&&(t.pop(),i.pop());r.push.apply(r,this._getRouteLegPoint(n));var u=this._getRouteLegIndices(r);t.push.apply(t,r);this.allStopPoints=this.allStopPoints.concat(r);i.push.apply(i,u)}},e.prototype._getLegTravelMode=function(t){var i=n.driving,r;if(t.itineraryItems&&t.itineraryItems.length>0){r=t.travelMode;switch(r){case"Driving":i=n.driving;break;case"Transit":i=n.transit}}return i},e.prototype._processItineraryItems=function(n,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){for(var b,d,g,nt=0,k=0,tt=u.length;k<tt;k++)b=u[k],w||(d=[],this._validateItineraryItemDetails(b)&&(d=oi.getViasInSegment(e,b.details[0].startPathIndices[0],b.details[b.details.length-1].endPathIndices[0])),(e.indexOf(r)!==-1||d.length>0)&&i++,this._validateItineraryItemDetails(b)&&(r=b.details[b.details.length-1].endPathIndices[0])),g=this._createInstructions(n,b,f,o,s,i,h),c.push.apply(c,g),g.forEach(function(n){l.push(n.stepText)}),nt=this._buildTransitTimeline(b,c,nt,a,v,y),this._buildTransitAttributions(b,t.bestModeEnabled?p:this.transitAttributions);return{subLegIndex:i,lastStopIndex:r}},e.prototype._processInstructionSteps=function(i,r,u,f,e,o,s,h,c,l,a,v,y){var w,p,b,k,d;u.length>0&&(this._fillMissingPushpins(u,e),w=new ne,w.routeLegs=o,w.numberOfInstructions=u.length,w.routeId=f.id,w.stepStrings=s,this.directionsResultsListSet.push(w),p=this._buildTitleViewModel(f,h,c,e,r.mode,l,w),p.index=i,b=(e===n.transit||e===n.multimode&&t.enableMultiMode)&&this._buildTransitSummary(f),p.transitSummary=b&&b.transitSegmentSummary,p.setHasWarning(this.enableNewDiretionsAnswerAlert&&b&&b.hasWarning),p.setWarningSeverity(b.highestWarningSeverity),p.showGetReturnDirectionsLink=t.enableMultiMode&&e===n.multimode&&!this._requestOptions.isReturnDirection,p.transitSummary&&p.transitSummary.length==1&&p.transitSummary[0].icon==="Walk"&&(p.routeMode=n.walking,f.travelMode="Walking"),t.bestModeEnabled&&(this._cleanupAttributionArray(a),p.showAttribution=a.length>0,p.transitAttributions=a,this._panelViewModel.hasViaPoints()&&this._panelViewModel.getResultsExpanded()&&(w.setShowResults(!0),p.setShowInstructions(!0))),this.directionsResultsTitleSet.push(p),y||this._buildRouteLabel(f,p,v,e),this.showTransitSpecialMessage||(k=b&&b.transitScheduleImpacted,d=e===n.transit||e===n.multimode,this.showTransitSpecialMessage=t.showTransitSpecialMessage&&d&&k))},e.prototype.onLegTitleClick=function(n){var r,u;n&&n.stopImmediatePropagation();n&&n.preventDefault&&n.preventDefault();var f=this.directionsResultsListSet[this._routeSelected],i=e.getAttributeFromHtmlElement(n.currentTarget,"data-index"),t=f.routeLegs[i],s=t.instructionSteps,o=!t.getShowInstructions();t.setShowInstructions(o);r=c.COL;o&&(this._map.setView(this._map.getMode().getMapViewForLocationsInView(t.legItemsLocations)),r=c.EXP);u={};u.CI=i===0?3:i===f.routeLegs.length-1?5:4;v.logInstrumentationEvent(r,u)},e.prototype.indexToIconTextStart=function(n){return String.fromCharCode(n+65)},e.prototype.arrowBoolToClass=function(n){return"instructionDetailsHeader "+(n?"upArrow":"downArrow")},e.prototype.indexToIconTextEnd=function(n){return String.fromCharCode(n+66)},e.prototype.timeDurationToTextAlignment=function(n){return n?"left":"center"},e.prototype.indexToStartClass=function(n){var t=Math.max(0,this._routeSelected),i=this.directionsResultsListSet[t],r=i.routeLegs.length;return n===0?"dirLegStart verticalTop":n<r-1?"dirLegStop verticalTop":"dirLegStop verticalTop"},e.prototype.indexToEndClass=function(n){var t=Math.max(0,this._routeSelected),i=this.directionsResultsListSet[t],r=i.routeLegs.length;return n===0?"dirLegStop verticalBottom":n<r-1?"dirLegStop verticalBottom":"dirLegEnd verticalBottom"},e.prototype.showGroupToClass=function(n){return n?"upArrow":"downArrow"},e.prototype.arrayToDisplay=function(n){return this.boolToDisplay(n&&n.length>0)},e.prototype.lineColorToIconClass=function(n){var i="dirIcon",t=parseInt(n&&n.substr(1),16),r;return t&&t<=16777215&&(r=u._calcLuminance(t),i+=r>.65?" darkSymbol":" lightSymbol"),i},e.prototype._createInstructions=function(n,t,i,r,u,f,e){var s=this,h=e?e:this._directionsFormattedTextProvider,o;return h.setRenderOptions(this._renderOptions),o=h.getInstruction(t,n,this._routeMapEntitiesCollection),o.forEach(function(t){if(s.disposables.push(t),t.needPushpin){var e=t.itineraryItem&&t.itineraryItem.iconType||t.stepIconClass;i.addItineraryPin(e,t,u,f,s._getCurrentRouteMode(n),!t.getShow());r&&r.length>0&&r[0].itineraryItems&&r[0].itineraryItems.push(t.itineraryItem)}}),o},e.prototype._getRouteLegPoint=function(n){for(var r,t=[],i=0;i<n.routeSubLegs.length;i++)r=n.routeSubLegs[i],t.length==0&&t.push({routeLegStopPoint:r.startWaypoint,itineraryItems:[]}),t.push({routeLegStopPoint:r.endWaypoint,itineraryItems:[]});return t},e.prototype._getRouteLegIndices=function(n){for(var i,r=[],t=0;t<n.length;t++)i=n[t].routeLegStopPoint,i.isVia===!1&&r.push(i.routePathIndex);return r},e.prototype._buildTitleViewModel=function(i,r,f,e,o,s,h){var c=new tu(this),a,l,v,y,p;return c.result=h,c.setDetailsHint(this.resources.L_Directions_InstructionDetailsMore),a=e?e:this._getCurrentRouteMode(i),c.routeMode=a,l=s?s:this._directionsFormattedTextProvider,t.enableMultiMode&&a===n.multimode&&(l=this._directionsFormattedTextProvider),l.setRenderOptions(this._renderOptions),(a!==n.transit||t.bestModeEnabled)&&(v=i.travelDuration,i.travelDurationTraffic&&(v=i.travelDurationTraffic),t.enableMultiMode&&a===n.multimode&&(v=i.travelDuration),y=Math.round(v/60),p=Math.floor(y/60),c.minutes=p===0&&y===0?"1":u._format2Digit(p?"mm":"m","m",y%60),c.hours=p),a===n.driving&&t.displayTraffic&&c.setTrafficCondition(i.trafficCongestion),c.mainTitle=l.getTitle(i),c.subtitle=a===n.transit&&o===n.multimode?"":l.getSubtitle(i),c.descriptionVia=l.getDescriptionVia(i),c.descriptionTimeNoTraffic=l.getDescriptionTimeNoTraffic(i),c.startTime=l.getStartTime(i),c.embellishment=l.getRouteEmbellishments(i),this._updateTransitTimeInfo(i,a,c),t.displayCost&&(c.cost=l.getCost(i)),r.length>0&&(c.timelineSegments=r,c.timelineWidth=f),c.buildAriaSummary(i,this._directionsFormattedTextProvider),c},e.prototype._setTransitLineWidth=function(t){if((this._requestOptions.mode===n.transit||this._requestOptions.mode===n.multimode)&&t>0)for(var i=0;i<this.directionsResultsTitleSet.length;i++)this.directionsResultsTitleSet[i].timelineWidth/=t},e.prototype._getRealTimeTransitItem=function(n){var t,i,r,u;if(n&&n.routeLegs&&n.routeLegs.length>0&&(t=n.routeLegs[0],t.itineraryItems))for(i=0;i<t.itineraryItems.length;i++)if(t.itineraryItems[i].childItineraryItems)for(r=0;r<t.itineraryItems[i].childItineraryItems.length;r++)if(u=t.itineraryItems[i].childItineraryItems[r],u.isRealTimeTransit)return u;return null},e.prototype._updateTransitTimeInfo=function(r,f,e){var h,c,o,s;(f===n.transit||t.enableMultiMode&&f===n.multimode)&&(h={},c=ut.getIconsInRouteLeg(r,f,h),e.frequency=h.transitFrequency,o=this._getRealTimeTransitItem(r),c&&c.length===1&&o&&o.isRealTimeTransit&&(Math.abs(o.realTimeTransitDelay)<=30?(e.embellishment=i.L_Transit_RunningOnTime,e.isTransitEmbellishment=!0):(s=Math.round(o.realTimeTransitDelay/60),s&&(e.isLate=s>0,e.embellishment=u._formatString(s<0?i.L_Transit_Early:i.L_Transit_Late,Math.abs(s)),e.isTransitEmbellishment=!0))))},e.prototype._updateWaypoints=function(n){for(var t,r,f,u=0,i=0;i<n.length;i++)(t=n[i].routeLegStopPoint,t.isVia)||(r=this._panelViewModel.waypoints[u],r.getInputText()===""&&(f=new k(t.coordinates[0],t.coordinates[1]),r.update(t.description,f)),this.stopPoints.push(t),u++)},e.prototype._fillMissingPushpins=function(t,i){var u,f,e,r;if(i===n.transit)for(u=null,f=0,e=t.length-1;f<e;f++)r=t[f],r.pushpin||r.stepIconClass!=="TransitArrive"?u&&r.pushpin&&(u.pushpin=r.pushpin,u=null):(u=r,r.pushpin=t[f+1].pushpin)},e.prototype._buildRouteLabel=function(i,r,u,f){if(t.enableRouteLabel){var e,o;f===n.transit?e=r.subtitle:(e=this._directionsFormattedTextProvider.getDescriptionTime(i),o=r.subtitle);u.setLabel(e,o)}},e.prototype._buildDisclaimer=function(){var t,r=nt.dynamicProperties.market.toLowerCase()==="ja-jp";this._requestOptions.mode===n.transit?(this.transitAttributions.length>0&&(this._cleanupAttributionArray(this.transitAttributions),this.showAttribution=!0),t=r?i.L_TransitDisclaimer_Text_Japan:i.L_TransitDisclaimer_Text,this.setShowTransitLogo(r)):(t=r?i.L_DirectionsDisclaimer_Text_Japan:i.L_DirectionsDisclaimer_TomTom_Text.replace("{0}",i.L_TermsOfUse_Text).replace(/{year}/,(new Date).getFullYear()),this.setShowTransitLogo(!1));this.setDisclaimerText(t)},e.prototype._cleanupAttributionArray=function(n){var i,t;if(n&&n.length>0)for(n.sort(function(n,t){return n.agencyName<t.agencyName?-1:n.agencyName>t.agencyName?1:n.uri<t.uri?-1:n.uri>t.uri?1:0}),i=n[0],t=1;t<n.length;t++)i.agencyName===n[t].agencyName?(n.splice(t,1),t--):i=n[t]},e.prototype._buildTransitAttributions=function(n,i){var r=n.transitLine;r&&(r.uri&&r.uri.indexOf(t.specialAttributionLink)>-1&&r.uri.indexOf("&")>-1&&(r.uri=r.uri.slice(0,r.uri.indexOf("&"))),i&&i.push(r))},e.prototype._buildTransitSummary=function(n){var i=[],b=!1,p=!1,c=-1,k=!1,l,f,r,g,v,o,nt,w,y,h,tt;if(n&&n.routeLegs&&n.routeLegs.length>0)for(l=0;l<n.routeLegs.length;l++){var s=n.routeLegs[l],d=0,a=0;if(s&&s.itineraryItems&&s.itineraryItems.length>0){for(t.enableMultiMode&&s.travelMode!=="Transit"&&(i.length===0?(i.push({icon:"Car"}),i.push({icon:"Spacer"})):(i.push({icon:"Spacer"}),i.push({icon:"Car"}))),f=0;f<s.itineraryItems.length;f++){r=s.itineraryItems[f];switch(r.iconType){case"Tube":case"Ferry":case"Bus":case"Train":g=r.transitLine&&r.transitLine.abbreviatedName;d<3?(i.push({icon:"Spacer"}),v={icon:r.iconType,text:g},r.transitLine.lineColor&&(v.lineColor=u._formatHexColorString(r.transitLine.lineColor,e.defaultLineColor)),r.transitLine.lineTextColor&&(v.lineTextColor=u._formatHexColorString(r.transitLine.lineTextColor,"")),i.push(v)):a++;d++;break;case"Walk":(f===0||f===s.itineraryItems.length-1||r.travelDuration>180)&&(f===0||f>0&&i.length>0&&i[i.length-1].icon!=="Walk")&&(a===0?(f>0&&i.push({icon:"Spacer"}),i.push({icon:r.iconType})):b=!0)}if(o=r.warnings,nt=r.travelMode.toLocaleLowerCase()==="walking",!nt&&o&&o.length){for(w=!1,y=o.length,h=0;h<y;h++)o[h].warningType&&o[h].warningType.toLowerCase()==="scheduleimpacted"?(o[h].text="",k=!0,w=!0):(tt=e.severities.indexOf(o[h].severity.toLowerCase()),c=Math.max(c,tt));p||(p=y>1||y===1&&!w)}}a&&(i.push({icon:"Spacer"}),i.push({icon:"Extra",text:this._directionsFormattedTextProvider.getExtraTransitSegments(a)}),b&&(i.push({icon:"Spacer"}),i.push({icon:"Walk"})))}}return{transitSegmentSummary:i,hasWarning:p,highestWarningSeverity:c>=0?e.severities[c]:"",transitScheduleImpacted:k}},e.prototype._buildTransitTimeline=function(t,i,r,u,f,e){var o,s;return e===n.transit&&u>0&&(o=i[i.length-1],r&&o.transitDepartTime&&(s=(o.transitDepartTime-r)/1e3,s>0&&f.push({width:s/u,className:"ttWait",lineColor:""})),f.push({width:t.travelDuration/u,className:"tt"+t.iconType,lineColor:o.transitLineColor}),o.transitArriveTime?r=o.transitArriveTime:r&&(r+=t.travelDuration*1e3)),r},e.prototype._createRoutePolyline=function(n,t,i,r,u,f){n.routePath&&n.routePath.line&&(this.routelines.push(n.routePath.line),t.createPolyLineAndStopPins(n,this._routeMapEntitiesCollection.getMapType(),f,i,r,u,this._renderOptions,n.routePath?n.routePath.annotations:null,this._routeDraggable))},e.prototype._createItineraryList=function(n){var u=[],i,f,t,r,e;if(n.itineraryGroups&&n.itineraryGroups.length){for(i=0,f=n.itineraryGroups.length;i<f;i++)if(t=n.itineraryGroups[i],t.itineraryIndices&&t.itineraryIndices.length>1)for(t.iconType=n.itineraryItems[t.itineraryIndices[0]].iconType,t.childItineraryItems=[],r=0;r<t.itineraryIndices.length;r++)e=t.itineraryIndices[r],t.childItineraryItems.push(n.itineraryItems[e]);else n.itineraryGroups[i]=n.itineraryItems[t.itineraryIndices[0]];u=n.itineraryGroups}else u=n.itineraryItems;return u},e._initProviders=function(){var t={};return t[n[n.driving]]=function(){return new hi},t[n[n.truck]]=function(){return new ki},t[n[n.transit]]=function(){return new dr},t[n[n.walking]]=function(){return new ki},t[n[n.multimode]]=function(){return new hi},t},e.prototype.seeAllRoutesClick=function(){},e.prototype.onSeeAllRoutesReturnClick=function(){},e.prototype.boolToSeeAllRoutesClassName=function(){return"directionsPanel"},e.prototype.getRawResponse=function(){return this._rawResponse},e.prototype._setRenderOptions=function(n){this._renderOptions=n;n&&n.displayDisclaimer!==undefined&&this.setShowDisclaimer(n.displayDisclaimer)},e.prototype.waitingOnRoadShieldEvent=function(){return this._directionsFormattedTextProvider.unloadedRoadShields>0},e.prototype._onRoadShieldReadyEvent=function(){o(".svg",this.getControl()[0]).inlineDataSvgs().remove_class("svg")},e.defaultLineColor="#FFFFFF",e._directionsFormattedTextProviders=e._initProviders(),e.severities=["none","lowimpact","minor","moderate","serious"],e}(ft),gr=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return w(t,n),t.prototype.seeAllRoutesClick=function(){this.setShowSeeAllRoutes(!0)},t.prototype.onSeeAllRoutesReturnClick=function(n){n.preventDefault();this.setShowSeeAllRoutes(!1);this.seeAllRoutesReturnClick.invoke()},t.prototype.boolToSeeAllRoutesClassName=function(){return this.getShowSeeAllRoutes()?"seeAllRoutes":""},t}(di),gi=function(){function n(n){var i=this;this._parkAndRideImage={records:[{vectorType:2,centerX:14,centerY:14,radiusX:12.75,radiusY:12.75,style:{fillStyle:"#2FA3EB",lineWidth:1.5,strokeStyle:"#fff"}},{vectorType:4,pathData:"M12.7652,9.44104C12.5996,8.587036,11.7992,8,10.9292,8L8.599998,8C8.268799,8,8,8.269043,8,8.599976L8,13.40002C8,13.73096,8.268799,14,8.599998,14C8.931198,14,9.199997,13.73096,9.199997,13.40002L9.199997,11.59998L11,11.59998C12.11,11.59998,12.9884,10.58997,12.7652,9.44104Z M11,10.40002L9.199997,10.40002L9.199997,9.199951L11,9.199951C11.3312,9.199951,11.6,9.468994,11.6,9.800049C11.6,10.13098,11.3312,10.40002,11,10.40002Z M18.8,10.40002C18.8,9.735962,18.2624,9.199951,17.6,9.199951L14,9.199951C13.9796,9.199951,13.9616,9.207031,13.9412,9.208008C13.9412,9.209961,13.9424,9.212036,13.9424,9.213013C14.0204,9.613037,14.006,10.01404,13.9268,10.40002L17.3,10.40002C17.4656,10.40002,17.6,10.53296,17.6,10.69995L17.6,11.30005C17.6,11.46704,17.4656,11.59998,17.3,11.59998L13.3844,11.59998C13.3592,11.63501,13.3424,11.67297,13.3148,11.70703C12.872,12.24304,12.266,12.59705,11.6,12.73401L11.6,19.09998C11.6,19.59705,12.0032,20,12.5,20C12.9968,20,13.4,19.59705,13.4,19.09998L13.4,18.80005L18.2,18.80005L18.2,19.09998C18.2,19.59705,18.6032,20,19.1,20C19.5968,20,20,19.59705,20,19.09998L20,11.59998C20,10.93604,19.4624,10.40002,18.8,10.40002Z M14,17.30005C14,17.46594,13.8656,17.59998,13.7,17.59998L13.1,17.59998C12.9344,17.59998,12.8,17.46594,12.8,17.30005L12.8,16.69995C12.8,16.53406,12.9344,16.40002,13.1,16.40002L13.7,16.40002C13.8656,16.40002,14,16.53406,14,16.69995L14,17.30005Z M18.8,17.30005C18.8,17.46594,18.6656,17.59998,18.5,17.59998L17.9,17.59998C17.7344,17.59998,17.6,17.46594,17.6,17.30005L17.6,16.69995C17.6,16.53406,17.7344,16.40002,17.9,16.40002L18.5,16.40002C18.6656,16.40002,18.8,16.53406,18.8,16.69995L18.8,17.30005Z M18.8,14.90002C18.8,15.06702,18.6656,15.19995,18.5,15.19995L13.1,15.19995C12.9344,15.19995,12.8,15.06702,12.8,14.90002L12.8,13.09998C12.8,12.93298,12.9344,12.80005,13.1,12.80005L18.5,12.80005C18.6656,12.80005,18.8,12.93298,18.8,13.09998L18.8,14.90002Z",style:{fillStyle:"#fff",lineWidth:1}}]};this._map=n;this._bucketPrimitiveTemplateSelector=new rf(n);t.isSDK&&(this._sdkPrimitiveTemplateSelector=new e.SDKPrimitiveTemplateSelector(n));this._disposables=[];this._disposables.push(n.mapTypeChanged.add(function(n){n.newMapTypeId!==n.oldMapTypeId&&(i._reset=!0)}))}return n.prototype.selectorReady=function(){var n=this;return(!this._readyPromise||this._reset)&&(this._baseMapTemplateSelectorPromise=this._map.getTemplateSelector().then(function(t){return n._baseMapTemplateSelector=t,t.selectorReady()}),this._directionsImagesPromise=new Promise(function(t){n._baseMapTemplateSelectorPromise.then(function(i){i.prefetchImages(n._getDirectionsBucketIds(),null,!0).then(function(){t()})})}),this._readyPromise=new Promise(function(t){var i=[n._baseMapTemplateSelectorPromise,n._bucketPrimitiveTemplateSelector.selectorReady(),n._directionsImagesPromise],r;n._sdkPrimitiveTemplateSelector&&i.push(n._sdkPrimitiveTemplateSelector.selectorReady());r=Promise.all(i);r.then(function(){t(n)})})),this._readyPromise},n.prototype.getMarkupStyle=function(n,t){return this._bucketPrimitiveTemplateSelector.getMarkupStyle(n,t,1)},n.prototype.getTemplates=function(n,i){var r,u,f,e,o;return t.isSDK&&typeof b.DirectionsSDKPushpin!="undefined"&&n instanceof b.DirectionsSDKPushpin?(u=n,u.image?r=this._sdkPrimitiveTemplateSelector.getTemplates(n,i):(r=this._getRoutePinTemplates(u),r=this._colorDirectionsPinTemplates(r,u))):n instanceof pu?(f=n,r=[new fu(f.image,1,f.anchor)]):n instanceof tr?(e=n,r=e.getTemplates()):n instanceof ri?r=t.enableMultiMode&&n.pushpinIconType===h.parkAndRide?[new ci(this._parkAndRideImage)]:this._getRoutePinTemplates(n):n instanceof gt?(o=it.getMercatorZoomLevel(this._map),r=n.viewState===3?null:this._bucketPrimitiveTemplateSelector.getTemplates(n,i,9)):n.getTemplates?r=n.getTemplates():n.getTemplate&&(r=[n.getTemplate()]),r},n.prototype.dispose=function(){this._map=null;this._baseMapTemplateSelector=null;this._baseMapTemplateSelectorPromise=null;this._bucketPrimitiveTemplateSelector=null;this._sdkPrimitiveTemplateSelector=null;this._directionsImagesPromise=null;this._readyPromise=null;u._clearDisposables(this._disposables)},n.prototype._colorDirectionsPinTemplates=function(n,t){var i=t.getColor();return i?(i.toRgba&&(i=i.toRgba()),n&&n.map(function(n){var t=n.getVectorImage(),r=t.records,u=r.map(function(n){var t=JSON.parse(JSON.stringify(n)),r;return t.vectorType===2&&(r=t.style,t.fillStylePaletteKey&&t.fillStylePaletteKey.endsWith(".FillColor")&&(r.fillStyle=i)),t});return new ci({hitTest:1,records:u},n.getScale())})):n},n.prototype._getDirectionsBucketIds=function(){var t=[],n=dt.directionIconTypeBuckets;for(var i in n)n.hasOwnProperty(i)&&t.push(n[i]);return t},n.prototype._getRoutePinTemplates=function(t){var i=t.pushpinIconType,f=t.isRouteSelected,r=t.isPinHighlighted,u;return t.isRouteSelected?t.taskState!==1&&!n.majorPinTypes[h[i]]?null:(u=t.taskState===3?r?3:5:r?3:2,n.majorPinTypes[h[i]]||(i=h.turn),this._baseMapTemplateSelector&&this._baseMapTemplateSelector.getRoutePoiVectorImageTemplate(h[i],u,t.currentZoomLevel)):null},n.majorPinTypes={start:!0,end:!0,middle:!0,infopin:!0,via:!0},n}(),wf=function(){function n(n,t){this._primitives=t;this._map=n}return n.prototype.getPrimitives=function(n,t){var r=[],u,i,f,e;if(this._primitives&&this._primitives.length)for(u=0;u<this._primitives.length;u++)i=this._primitives[u],i instanceof cr||i instanceof ni?(f=i,f.isRouteSelected()&&r.push(i)):i instanceof ri||i instanceof wt?(e=i,e.isRouteSelected&&r.push(i)):r.push(i);t&&t({primitives:r})},n}(),nr=nr||e.TransitLandmarkOverlayTemplate,bf=bf||e.CameraMiniOverlayTemplate,uo,ut=function(e){function p(n,i,r,u,f,o){var h=e.call(this,o)||this;return h._minZoomToShowStreetside=16,h._currentPrimitiveMovedArg=null,h._zoomLevelBestMapView=0,at.setClientPerf(o),h._listeners=[],h._map=i,h._activationState=null,h._categoriesBar=null,h._reverseGeocoder=u,f&&!t.isSDK&&f.instanceAsync("TrafficLayerV2",function(n){h._trafficLayer=n}),f&&!t.isSDK&&t.customSATREnabled&&f.instanceAsync("TaskBar",function(n){h._taskbar=n}),h.displayState={colorIndex:0,groupName:"Directions"},h.invalidated=new s,h.type=y.directionsTask,h._controlTemplateFactory=n,h.inputData=new vt,h.showCloseButton=!0,h._geolocationProvider=r,h._primitives=[],h._dragonflyContainer=f,h._keyRoutePoints=[],h._isDistanceIntentMapViewSet=!1,t.enableHightlightInstruction&&(h.scrollLane=new s),h.directionsManagerCallback=new s,t.trafficCameraV2Enabled&&(h._trafficIncident=yi.getInstance(),h._trafficIncident.initialize(i,h._controlTemplateFactory)),h.panelRoot[0].id="directionsPanelRoot",hu.addDataTag(h.panelRoot,"directionsPanelRoot"),h}return w(p,e),p.prototype.activate=function(r,u){var o=this,w,p,f,y,b,h,s,k;for(e.prototype.activate.call(this,r,u),this._map=r,w=!1,p=!1,this.setTitle(i.L_DirectionsTaskTitle_Text),f=u,!t.bestModeEnabled&&f&&f.mode===n.multimode&&(f.mode=n.driving),this._taskState=f,y=f&&f.waypoints&&f.waypoints.length===1&&f.waypoints[0],b=y&&(y.waypointType===3||y.waypointType===null)&&this._hasRoute(),this.inputData=vt.inputDataFromDirectionState(f,this.inputData,!b),f&&f.waypoints&&(b&&this._optimizedAddWaypoint(y),p=this._taskState&&this._taskState.longDistanceDisplay&&this._taskState.waypoints&&this._taskState.waypoints.length>1&&this._taskState.waypoints[0].point&&this._taskState.waypoints[1].point?!0:!1,w=p?!1:!0),this.clearExistingRoutes(),this.disposables.push(this._directionsPanelViewModel=this._createDirectionsPanelViewModel()),this.disposables.push(this._directionsPanelViewModel.getDirectionsRequested.add(function(){f&&f.taskStartTime?(o._directionsRequestStartTime=f.taskStartTime.getTime(),f.taskStartTime=null):o._directionsRequestStartTime=Date.now()})),this.disposables.push(this._directionsPanelViewModel.waypointResolvedEvent.add(function(n){o._waypointResolved(n)})),this._directionsPanelViewModel.initializeControls(this._dragonflyContainer),this.disposables.push(this._directionsPanelViewModel.directionsResultsRequested.add(function(n){var t=!0;o._renderOptions&&typeof o._renderOptions.autoUpdateMapView=="boolean"?t=o._renderOptions.autoUpdateMapView:f&&f.renderOptions&&typeof f.renderOptions.autoUpdateMapView=="boolean"&&(t=f.renderOptions.autoUpdateMapView);o._onDirectionsResultsRequested(n.DirectionsInputData,t,!1,null,null,null,n.viaPointRemoved,n.routeIndex,n.routeId||f&&f.routeId)})),this.disposables.push(this._directionsPanelViewModel.directionsModeChanged.add(function(){if(o.changed.invoke({name:"iconClass"}),o._flipTaskId){var n={action:"remove",id:o._flipTaskId};a.invokeHandler(l.taskDataHandlerKey,n)}})),this.addControl(this._directionsPanelViewModel.getControl()),p||this._initAutosuggest(),w&&this._directionsPanelViewModel.getDirections(!0,f.routeIndex,f.routeId),h=0;h<this._directionsPanelViewModel.waypoints.length;h++)s=this._directionsPanelViewModel.waypoints[h].getWayPointModel(),!s.address&&!s.name&&s.point&&this._reverseGeocoder&&(k="{0}, {1}".replace("{0}",(Math.round(s.point.latitude*1e6)/1e6).toString()).replace("{1}",(Math.round(s.point.longitude*1e6)/1e6).toString()),this._directionsPanelViewModel.waypoints[h].update(k,s.point),this._submitGeoCodeRequest(s.point,h));this.disposables.push(this._directionsPanelViewModel.clearDirectionsResults.add(function(){o.clearExistingRoutes();o._updateKeyRoutePoints()}));this.disposables.push(this._directionsPanelViewModel.taskTitleRequestedEvent.add(function(n){o.setTitle(n)}));this.disposables.push(this._map.viewChanged.add(function(n){return o._onViewChanged(n)}));this.disposables.push(this._map.mapTypeChanged.add(function(n){return o._onMapTypeChanged(n)}));f&&f.entryPoint&&(this._activatedFromPermaLink=f.entryPoint===4||f.entryPoint===5,v.logInstrumentationEvent(c.A,{EP:f.entryPoint}));this._activatedFromHistoryManager=f&&f.preventHistoryPoint;this._showIfLongDistanceIntent();this.setPercentLoaded(1)},p.prototype.calculateDirections=function(n){this._map&&(this._taskState=n,this.inputData=vt.inputDataFromDirectionState(n,this.inputData),t.isSDK&&n&&n.renderOptions&&(this._renderOptions=n.renderOptions),this.clearExistingRoutes(),this._directionsPanelViewModel&&(this._directionsPanelViewModel.updateInputControlsFromState(this._taskState),this._directionsPanelViewModel.resolveWaypointsInRoutingService=this._taskState.resolveWaypointsInRoutingService),this._taskState&&this._taskState.waypoints&&this._taskState.waypoints.length>1&&this._directionsPanelViewModel.getDirections())},p.prototype.deactivate=function(){this._notifyListenersBeforeDeactivation();e.prototype.deactivate.call(this);this.clearExistingRoutes();this._layer&&(this._map.getLayers().remove(this._layer),this._layer.dispose(),this._layer=null);this._resultsViewModel&&(this._resultsViewModel.clearRoutesLabels(),this._resultsViewModel.discarded=!0,this._resultsViewModel.dispose());this._removeCategoriesBar();u._clearDisposables([this.templateSelector]);this.templateSelector=null;this._directionsPanelViewModel&&this._directionsPanelViewModel.dispose();u._clearDisposables(this._primitives);u._disposeEvents(this)},p.prototype.dispose=function(){this.deactivate();e.prototype.dispose.call(this)},p.prototype.serialize=function(n){var t=vt.inputDataToDirectionsState(this.inputData,n),i;return t.taskTitle=this.getTitle(),n||(t.preventHistoryPoint=!0),this._resultsViewModel&&(i=this._resultsViewModel.getRouteSelected(),i>=0&&(t.routeIndex=i)),this._taskState&&this._taskState.longDistanceDisplay&&(t.longDistanceDisplay=this._taskState.longDistanceDisplay),t},p.prototype.process=function(n,t){var r=n.requestState,c,l,w,a,b,v,k;if(this._canProcess(r)){var d=this._directionsPanelViewModel.getMode(),g=this.displayState.activationState,f=null;if(r.action===0){var e=this._directionsPanelViewModel.getRouteTitle(),u=this._directionsPanelViewModel.waypoints,s=u.length>=2&&!u[0].isEmpty()&&!u[u.length-1].isEmpty();if(s){for(var nt=e,o=0,h="",y=0,p=0;o<u.length;)c=u[o].getWaypointTitle(),c!==""&&(y++,h===""&&(h=c,p=o)),o++;y!==u.length&&(e=(p===0?i.L_Directions_Add_From:i.L_Directions_Add_To).replace("{0}",h));e===nt&&(s=!1)}f={mode:d,activationState:g,routeTitle:e,isIncomplete:s,pendingRemoval:this.displayState.pendingRemoval};this._directionsPanelViewModel&&this._directionsPanelViewModel.isLongDistanceIntent&&(f.longDistanceIntent=!0)}else r.action===1?f={TraceId:this.getTraceId()}:r.action===2?r.listenerId&&(this._listeners.push(r.listenerId),this._hasRoute()&&(this._listeners.length==1?(this._setMapViewIfPrimitivesOutOfBound(this._primitives,!0),this._updateKeyRoutePoints()):this._sendNotificationMessage(this._keyRoutePoints,[r.listenerId]))):r.action===3?r.listenerId&&(l=this._listeners.indexOf(r.listenerId),l!=-1&&this._listeners.splice(l,1)):r.action===4?(w={prominence:2},this.setDisplayState(w)):r.action===5&&this._selectedTrafficPin?(this._flipTaskId=n.requestorId,this._resultsViewModel&&this._resultsViewModel.taskStateChanged(1),this._selectedTrafficPin.updatePinIcon(!0),a=it.getMapBounds(this._map,!0),b=this._selectedTrafficPin.getLocation(),a.contains(b)||(v=this._mapBoundsBeforeFlipTask.center,k=this._mapBoundsBeforeFlipTask.bounds[3]-a.bounds[3],v.longitude+=k/2,it.setMapCenter(this._map,v)),this._invalidateMap(),this._activationState=1):r.action===6&&(this._selectedTrafficPin&&this._selectedTrafficPin.updatePinIcon(!1),this._selectedTrafficPin=null,this._flipTaskId=null,this._invalidateMap());t&&t({processorId:this.id,data:f})}else t&&t({processorId:this.id,data:null})},p.prototype.processCallback=function(n){var u,r,t,f,i,e,o;if(n)if(n.processorType===y.localDetailsTask||n.processorType===y.polygonEntityDetailsTask){if(n.outData){for(t=n.outData,n.processorType===y.localDetailsTask?p.localDetailCardsData=t:p.polygonEntityDetailCardsData=t,u=[],i=0;i<t.length;i++)r=t[i].data,r&&r.length&&u.push(r[0]);this._directionsPanelViewModel.updateCurrentLocalDetailCards(u)}}else if(n.processorType===y.transitStopTask){if(n.outData){for(t=n.outData,p.transitStopCardsData=t,f=[],i=0;i<t.length;i++)e=t[i].data,e&&f.push(e);this._directionsPanelViewModel.updateCurrentTransitStopCards(f)}}else n.inData&&n.inData.requestState&&n.inData.requestorState&&n.inData.requestorState.callbackState&&this._directionsPanelViewModel&&(o=n.inData.requestState,o.entryPoint===ii.DirectionsWaypointSearch&&this._directionsPanelViewModel.waypointResolved(n))},p.prototype.setDisplayState=function(n){var i=this,r,u,t,f,o,h;if(this._isRouteBeingCalculated&&!(this._directionsPanelViewModel&&this._directionsPanelViewModel.isLongDistanceIntent)){r={activationState:n.activationState,prominence:n.prominence,animationState:n.animationState};this._delaySetDisplay||(this._delaySetDisplay=new s);this.disposables.push(this._delaySetDisplay.addOne(function(){i.setDisplayState(r);i._delaySetDisplay=null}));return}u=this._activationState;e.prototype.setDisplayState.call(this,n);n.activationState&&(this._activationState=n.activationState);n.activationState===1&&n.prominence===1?(this._primitives&&this._primitives.length>0&&(this._setMapViewIfPrimitivesOutOfBound(this._primitives),this._resultsViewModel&&this._resultsViewModel.taskStateChanged(1),this._invalidateMap()),this._directionsPanelViewModel.resetLocalDetailsCards(),t={searchEntitiesRequested:!0},f={requestorType:"DirectionsTask",requestorId:this.id,type:y.localDetailsTask,requestState:t,useActiveTasks:!0},a.invokeHandler(l.taskProcessDataHandlerKey,f),o={requestorType:"DirectionsTask",requestorId:this.id,type:y.polygonEntityDetailsTask,requestState:t,useActiveTasks:!0},a.invokeHandler(l.taskProcessDataHandlerKey,o),h={requestorType:"DirectionsTask",requestorId:this.id,type:y.transitStopTask,requestState:{searchEntitiesRequested:!0},useActiveTasks:!0},a.invokeHandler(l.taskProcessDataHandlerKey,h)):n.prominence&&this._primitives&&this._primitives.length>0?(n.prominence===1?this._resultsViewModel&&this._resultsViewModel.taskStateChanged(2):this._resultsViewModel&&this._resultsViewModel.taskStateChanged(3),this._invalidateMap()):n.activationState===2&&n.activationState!==u&&(this._resultsViewModel&&this._resultsViewModel.taskStateChanged(2),this._invalidateMap());this._directionsPanelViewModel.onTaskStateChanged(n)},p.prototype.getPrimitives=function(n,t){var i=[];this._primitives&&this._primitives.length&&i.push.apply(i,this._primitives);t&&t({primitives:i})},p.prototype.getAllStopPoints=function(){return this._resultsViewModel.allStopPoints},p.prototype.getMapLayer=function(){return this._layer},p.prototype.setMapLayer=function(n){this._layer=n},p.prototype.getCardIconInfo=function(){var r=this._directionsPanelViewModel.getMode(),i;if(t.bestModeEnabled)i="multiTsk";else switch(r){case n.driving:i="dirTsk";break;case n.transit:i="trnsTsk";break;case n.walking:i="wlkTsk";break;case n.multimode:i="multiTsk";break;default:i="dirTsk"}return{iconClass:i}},p.prototype.getPrintInstrumentationData=function(){return{RI:this._resultsViewModel?this._resultsViewModel.getRouteSelected():-1,LOC:"H"}},p.prototype.hasPrintContent=function(){return et.isEnabled&&this._hasRoute()&&!(this._directionsPanelViewModel&&this._directionsPanelViewModel.isLongDistanceIntent)},p.prototype.getPrintContent=function(){var f=this,n,t,i,r;return et.isEnabled?(n=null,this._resultsViewModel&&(this._updatePrintImages(),n=this._resultsViewModel.getDirectionsHtmlContentForPrint()),t=new vi,this._layer&&(i=new lr(this._layer.getId(),new wf(this._map,this._primitives),this._layer.getTemplateSelector(),this._layer.getZIndex()),i.setRenderTarget(this._layer.getRenderTarget()),t.insert(i)),r=new au(n,null,t),r.setCssScope(this.type),p.printCardClick?hr.onPrintDialogClose.addOne(function(){Microsoft.Maps.setTimeout(function(){var t=f.panelRoot.select(".dirPrintSelect"),n;t.length>0&&(n=t.select("a"),n.length>0&&n[0].focus(),p.printCardClick=!1)},50)}):hr.onPrintDialogClose.addOne(function(){return u._refocusPrintDropDownMenu(f.id)}),n!==null?r:null):null},p.prototype.getRoutePoints=function(){return this._keyRoutePoints&&this._keyRoutePoints.length!==0||this._updateKeyRoutePoints(!0),this._keyRoutePoints},p.prototype._getGeodesicPath=function(n,t){var h,c,i,r,u,s;for((!t||t<=0)&&(t=15),h=n.length,c=[],h>0&&(i=lt.degreesToRadians(n[0].latitude),r=lt.degreesToRadians(n[0].longitude)),u=1;u<h;u++){var f=lt.degreesToRadians(n[u].latitude),e=lt.degreesToRadians(n[u].longitude),d=Math.sin(i),g=Math.sin(f),nt=Math.sin(r),tt=Math.sin(e),l=Math.cos(i),a=Math.cos(f),it=Math.cos(r),rt=Math.cos(e),o=2*Math.asin(Math.sqrt(Math.pow(Math.sin((i-f)/2),2)+l*a*Math.pow(Math.sin((r-e)/2),2)));for(s=0;s<=t;s++){var p=s/t,v=Math.sin((1-p)*o)/Math.sin(o),y=Math.sin(p*o)/Math.sin(o),w=v*l*it+y*a*rt,b=v*l*nt+y*a*tt,ut=v*d+y*g,ft=Math.atan2(ut,Math.sqrt(Math.pow(w,2)+Math.pow(b,2))),et=Math.atan2(b,w);c.push(new k(lt.radiansToDegrees(ft),lt.radiansToDegrees(et)))}i=f;r=e}return c},p.prototype._showIfLongDistanceIntent=function(){var r,t,n;this._layer&&this._taskState&&this._taskState.longDistanceDisplay&&this._taskState.waypoints&&this._taskState.waypoints.length>1&&this._taskState.waypoints[0].point&&this._taskState.waypoints[1].point&&this._directionsPanelViewModel&&(r=this._getGeodesicPath([this._taskState.waypoints[0].point,this._taskState.waypoints[1].point],32),r&&(t=new Microsoft.Maps.Polyline(r,{strokeColor:"rgb(0, 0, 0)"}),this._primitives&&t&&(t._options&&(t._options.cursor=""),this.setTitle(i.L_DirectionsTaskDistanceTitle_Text),this._primitives.push(t),this._directionsPanelViewModel.isLongDistanceIntent=!0,this._directionsPanelViewModel.setLongDistanceText(this._taskState.longDistanceDisplay),this._directionsPanelViewModel.setShowWaypoints(!1),this._directionsPanelViewModel.setShowSuggestionsPanel(!1),this._directionsPanelViewModel.hideMessage(),this._taskState.waypoints[0].address&&this._taskState.waypoints[0].eid&&this._taskState.waypoints[1].address&&this._taskState.waypoints[1].eid&&(n={},n.query=this._taskState.waypoints[0].address,n.id=this._taskState.waypoints[0].eid,this._directionsPanelViewModel.setTaskOptionFrom(JSON.stringify({type:y.localSearchTask,requestState:n})),n.query=this._taskState.waypoints[1].address,n.id=this._taskState.waypoints[1].eid,this._directionsPanelViewModel.setTaskOptionTo(JSON.stringify({type:y.localSearchTask,requestState:n})),this._directionsPanelViewModel.setLongDistanceFrom(this._taskState.waypoints[0].address),this._directionsPanelViewModel.setLongDistanceSeparator(" → "),this._directionsPanelViewModel.setLongDistanceTo(this._taskState.waypoints[1].address)),this._taskState.options?this._taskState.options.routeDraggable=!1:this._taskState.options={routeDraggable:!1})))},p.prototype._optimizedAddWaypoint=function(n){for(var i,p,s,t,l,h,c,r,d=n.waypointType,a=tt.createObjectFrom(n),v=Number.MAX_VALUE,y=this.inputData.waypoints.length,w=it.getMapBounds(this.map,!0),u,e,b,f,o=0;o<this._resultsViewModel.routelines.length;o++){for(u=this._resultsViewModel.routeStopPointPathIndices[o],e=this._resultsViewModel.routelines[o].coordinates,b=this._resultsViewModel.directionsResultsListSet[o],f=[],t=0;t<e.length;t++)i=e[t],w.containsLatLong(i[0],i[1])&&f.push({location:new k(i[0],i[1]),index:t});if(!f.length)for(t=0;t<e.length;t++)i=e[t],p=new k(i[0],i[1]),f.push({location:p,index:t});for(s=-1,t=0;t<f.length;t++)(l=f[t],h=u.indexOf(l.index),h>0&&h<u.length-1)||(c=fr.greatCircleDistance(a.point,l.location),(h===0||h===u.length-1)&&(c=c*.9),c<v&&(v=c,s=l.index));if(s>=0)for(r=0;r<this._resultsViewModel.stopPoints.length;r++)if(u[r]>=s){y=r===this._resultsViewModel.stopPoints.length-1&&u[r]===s?r+1:r;break}}this.inputData.tryAddWaypoint(a,y)},p.prototype._processCategorySelection=function(n,t){var i={};i.taskTitle=n.displayName;i.query=n.altQuery?n.altQuery:n.displayName;i.category=n.category;i.directionsTaskId=t;i.forceDisableMicroPoi=!0;i.entryPoint=ii.CategoriesBar;i.directionsTraceId=this.getTraceId();i.selectedCategoryId=n.categoryId;i.disableComputingMapViewForLoadingOnly=!0;this._updateKeyRoutePoints(!0);i.keyRoutePoints=this._keyRoutePoints;a.invokeHandler(l.taskProcessDataHandlerKey,{requestState:i,type:y.localSearchTask})},p.prototype._updateCategoriesBarVisibility=function(){var t=this,n=p._getSupportedCategoriesBarCreator(this._taskbar),i;n!=null&&(n.shouldCategoriesBarBeVisible(this)&&!this._categoriesBar&&(this._categoriesBar=n.createCategoriesBar(this),this._categoriesBar.setIsVisible(!1),this._categoriesBar.categorySelected.add(function(n){t._processCategorySelection(n,t.id)})),this._categoriesBar&&(i=n.shouldCategoriesBarBeVisible(this),this.showOrHideCategoriesBar(i)))},p.prototype.showOrHideCategoriesBar=function(n){var t,i;this._categoriesBar&&(this._categoriesBar.setIsVisible(n),this._categoriesBar.getControl().getParent()&&this._categoriesBar.getControl().getParent().has_class(p.RouteCategoriesBarPanelCssClass)?(this._addXSRIcons(),t=this._categoriesBar.getControl().select(".category .customSatrIcon"),t&&t.length>0&&t[0].childElementCount>0&&(i=t.select(".bm_itemImage"),i.length>0&&i.remove_class("hidden")),this._categoriesBarContainer=this._categoriesBar.getControl().getParent(),this._directionsPanelViewModel.setShowRouteCategoriesPanel(this._categoriesBar.getIsVisible())):n&&this._categoriesBarContainer&&this._categoriesBarContainer.length>0&&!this._categoriesBarContainer[0].hasChildNodes()&&(this._categoriesBarContainer.append(this._categoriesBar.getControl()),this._directionsPanelViewModel.setShowRouteCategoriesPanel(this._categoriesBar.getIsVisible())),this.id&&this._fireCardRefreshEvent())},p.convertIntervalToTransitFrequency=function(n){var t=null,r;return n&&(r=n<60?1:n/60,t=i.L_Transit_Frequency_Text.replace("{0}",Math.round(r))),t},p.getIconsInRouteLeg=function(t,i,r){var f=[],u,s,h,c,e,l,o;if(i===n.multimode)u=t.routeLegs,u&&u.length>=2&&u[0].itineraryItems&&u[0].itineraryItems.length>0&&u[u.length-1].itineraryItems&&u[u.length-1].itineraryItems.length>0&&(s=u[0],h=u[u.length-1],s.travelMode==="Driving"&&h.travelMode==="Transit"?(f.push("car"),f.push("bus"),r.transitFrequency=p._getTransitFrequencyFromLeg(h)):s.travelMode==="Transit"&&h.travelMode==="Driving"&&(f.push("bus"),f.push("car"),r.transitFrequency=p._getTransitFrequencyFromLeg(s)));else if(i===n.transit){if(t.routeLegs&&t.routeLegs.length>0)for(c=0;c<t.routeLegs.length;c++)if(e=t.routeLegs[c],e.itineraryItems&&e.itineraryItems.length>0)for(l=0;l<e.itineraryItems.length;l++)o=e.itineraryItems[l],(o.iconType==="Bus"||o.iconType==="Train"||o.iconType==="Ferry")&&f.push(o.iconType.toLowerCase());f.length===1&&t.routeLegs.length>0&&t.routeLegs[0].transitFrequencies&&t.routeLegs[0].transitFrequencies.length>0&&(r.transitFrequency=p.convertIntervalToTransitFrequency(e.transitFrequencies[0].intervalBetweenDepartures));f.length===0&&f.push("walk")}else i===n.driving?f.push("car"):i===n.walking&&f.push("walk");return f},p._getSupportedCategoriesBarCreator=function(i){for(var e={isSupported:function(){return t.enableRouteCategoriesBar&&!t.isSDK},createCategoriesBar:function(n){var r=af,u,f;return t.customSATREnabled&&!t.isSDK&&r.indexOf(p.CustomCategorySearchTCFItem)===-1&&r.push(p.CustomCategorySearchTCFItem),u=new ou(n._map,r,n._controlTemplateFactory,!1,i,n),f=n._directionsPanelViewModel.getControl().select("div."+p.RouteCategoriesBarPanelCssClass),f.append(u.getControl()),u},shouldCategoriesBarBeVisible:function(t){return t._hasRoute()&&t._directionsPanelViewModel.getMode()!==n.transit}},f=[e],u,r=0;r<f.length;r++)if(u=f[r],u.isSupported())return u;return null},p._getTransitFrequencyFromLeg=function(n){return n.transitFrequencies&&n.transitFrequencies.length>0?p.convertIntervalToTransitFrequency(n.transitFrequencies[0].intervalBetweenDepartures):""},p.prototype._addXSRIcons=function(){for(var r,t,n,u,f,s,e=o(".bm_categoriesBar"),i=0;i<e.length;i++)if(r=o(".categories",e[i]),r.length>0)for(t=o(".category",r[0]),n=0;n<t.length;n++)u=o(t[n].querySelector("a")),f=u.length>0?u.get_attr("data-category"):null,f&&(s=o(".bm_itemImage",t[n]),this._updateCategoryIconAfterDownload(f,s))},p.prototype._updateCategoryIconAfterDownload=function(n,t){this._selectorReady().then(function(i){i.getCategoryIconTemplate(function(n){var r=n&&n.icon,u=n&&n.iconColor,i;r&&(i=r.renderIcon(),i&&(t.clear(),t.remove_class("hidden"),t.set_style({"background-color":u}),t.append(i)))},n,"#FFF",18,18)})},p.prototype._selectorReady=function(){var n=this;return this._baseMapTemplateSelector?this._baseMapTemplateSelector.selectorReady():this._map.getTemplateSelector().then(function(t){return n._baseMapTemplateSelector=t,n._baseMapTemplateSelector.selectorReady()})},p.prototype._removeCategoriesBar=function(){this._categoriesBar&&(this._directionsPanelViewModel.setShowRouteCategoriesPanel(!1),this._categoriesBar.getControl().removeFromParent(),this._categoriesBar.deactivate(),this._categoriesBar=null,this._fireCardRefreshEvent())},p.prototype._fireCardRefreshEvent=function(){sj_evt&&sj_evt.fire("OnCardRefresh",o(document).select("[data-subtaskid='"+this.id+"']"),this.stackId)},p.prototype._canProcess=function(n){return this._directionsPanelViewModel?!n||n.action==null?!1:n.taskId!=null&&n.taskId!=this.id?!1:!0:!1},p.prototype.hasDefaultFocusElement=function(){return!0},p.prototype._calculateKeyRoutePoints=function(){var i=[],r,t,f,e;if(!this._hasRoute())return i;var o=it.getMapBounds(this.map,!0),u=this._resultsViewModel.routelines[this._resultsViewModel.getRouteSelected()].coordinates,n=[];for(r=0;r<u.length;r++)t=u[r],o.containsLatLong(t[0],t[1])&&n.push(new k(t[0],t[1]));return n.length>p.KeyPointsCount?(f=this._calculateRouteLength(n),e=f/p.KeySegmentCount,i=this._filterRoutePoints(n,e)):i=n,i},p.prototype._calculateRouteLength=function(n){for(var i=0,t=0;t<n.length-1;t++)i+=fr.greatCircleDistance(n[t],n[t+1]);return i},p.prototype._filterRoutePoints=function(n,t){var u,e,f,i;if(n.length<2)return[];for(u=[],u.push(n[0]),e=n[0],f=0,i=1;i<n.length-1;i++)f+=r.MapMath.greatCircleDistance(n[i-1],n[i]),f>t&&(u.push(n[i]),e=n[i],f=0);return u.push(n[n.length-1]),u},p.prototype._initAutosuggest=function(){this._directionsPanelViewModel.initAutosuggest()},p.prototype._onPrimitiveMoveStarted=function(n){if(this._currentPrimitiveMovedArg=null,this._isDragging=!0,this._processDragRequest(n),this._updateDragPin(!1,null,!1,!1,!1),this.displayState.activationState!==1&&!t.isSDK){var i={action:"focus",id:this.id};a.invokeHandler(l.taskDataHandlerKey,i)}},p.prototype._updateDragPin=function(n,t,i,r,u){var f=this._primitives.length;f>0&&(n?yt.showDragTipPin(this._map,this._controlTemplateFactory,t,i,r,u):yt.hideDragTipPin(this._map))},p.prototype._onPrimitiveMoveContinued=function(n){if(this._isDragging){var t=n.location;this._updateDragPin(!0,t,!1,!1,!0);this._currentPrimitiveMovedArg=n}},p.prototype._processDragRequest=function(n){var i=n.location,t,u,f,e,r;p.isIDirectionsPushpin(n.primitive)?(t=n.primitive,t.pushpinIconType===h.start||t.pushpinIconType===h.end||t.pushpinIconType===h.middle?(t=n.primitive,this.inputData.waypoints[t.stopPointIndex].point=i,this.inputData.waypoints[t.stopPointIndex].locationIdentifier=null,this._onDirectionsResultsRequested(this.inputData,!1,!0)):t.pushpinIconType===h.via?(u=t.stopPointIndex,f=t.viaPointIndex,this.inputData.waypoints[u].viaWaypoints[f].point=i,this.inputData.waypoints[u].viaWaypoints[f].locationIdentifier=null,this._onDirectionsResultsRequested(this.inputData,!1,!0)):(r=new tt(null,i,null,!0),this._onDirectionsResultsRequested(this.inputData,!1,!0,r,t.stopPointIndex,t.viaPointIndex))):(e=n.primitive,r=new tt(null,i,null,!0),this._onDirectionsResultsRequested(this.inputData,!1,!0,r,e.legIndex,e.subLegIndex))},p.prototype._onPrimitiveMoveStopped=function(n){var l=this,i,t,e,o,s,c,u,r;if(this.primitiveInteracted.invoke(),this._currentPrimitiveMovedArg=null,this._isDragging=!1,this._updateDragPin(!1,null,!1,!1,!1),i=n.location,p.isIDirectionsPolyline(n.primitive)){var f=n.primitive,u=new tt(null,i,null,!0),r=this.inputData.waypoints[f.legIndex].viaWaypoints;f.subLegIndex>=r.length?r.push(u):r.splice(f.subLegIndex,0,u)}else t=n.primitive,t.pushpinIconType===h.start||t.pushpinIconType===h.end||t.pushpinIconType===h.middle?(e=this.inputData.waypoints[t.stopPointIndex],o=si.formatLatLonString(i.latitude,i.longitude),this._directionsPanelViewModel.waypoints[t.stopPointIndex].setInputText(o),this._reverseGeocoder&&this._reverseGeocoder.reverseGeocode(i,function(n){return l._processGeocodeResponse(n,t.stopPointIndex)}),e.point=i):t.pushpinIconType===h.via?(s=t.stopPointIndex,c=t.viaPointIndex,this.inputData.waypoints[s].viaWaypoints[c].point=i):(u=new tt(null,i,null,!0),r=this.inputData.waypoints[t.stopPointIndex].viaWaypoints,t.viaPointIndex>=r.length?r.push(u):r.splice(t.viaPointIndex,0,u));this._onDirectionsResultsRequested(this.inputData,!1,!1,null,null,null,!1,null,null,!0)},p.prototype._onPrimitiveHover=function(r,u){var s=this,f,e,h,l,o;if(p.isIDirectionsPushpin(r.primitive))f=r.primitive,f.instructionViewModel&&f.instructionViewModel.transitStopID&&f.instructionViewModel.transitStopID>0?f.instructionViewModel.transitStaticResources?(u&&this.showOverlay(nr,f.instructionViewModel.transitStaticResources,f),u||ei.hideOverlay(this._map,f)):(f.instructionViewModel.transitStopInfoReadyPromise||(f.instructionViewModel.transitStopInfoReadyPromise=new Promise(function(n){f.instructionViewModel.processTransitStopInfo(f.instructionViewModel.transitStopID,n)})),f.instructionViewModel.transitStopInfoReadyPromise.then(function(){return new Promise(function(){u&&s.showOverlay(nr,f.instructionViewModel.transitStaticResources,f);u||ei.hideOverlay(s._map,f)})})):(e=u&&f.isMoveEnabled()&&this._isDraggable(),this._isMajorPoint(f)||(h=f.stopPointIndex,l=this.inputData.waypoints[h].viaWaypoints.length,e=e&&l<p.showDragMax),this._updateDragPin(u,r.location,e,fi&&fi.isEnabled&&!t.isSDK,!1)),f.instructionViewModel&&f.instructionViewModel.setHover(u),yt.highlight(u?f:null);else if(p.isIDirectionsPolyline(r.primitive)){var y=r.primitive.legIndex,w=this.inputData.waypoints[y].viaWaypoints.length,a=r.primitive._routeMode,b=u&&a!==n.transit&&a!==n.multimode&&this._isDraggable()&&w<p.showDragMax;this._updateDragPin(b,r.location,u,!1,!0);this._isHovering=u}else r.primitive instanceof gt&&(t.trafficCameraV2Enabled&&this._trafficIncident?u?(o=r.primitive,yi.isCamera(o)?(this._trafficIncident.show(o,!0,!0),v.logInstrumentationEvent(c.CAMHVR,{})):t.trafficIncidentV2Enabled&&(this._trafficIncident.show(o,!0),v.logInstrumentationEvent(c.INCHVR,{}))):this._trafficIncident.hide(!0):(u&&this.showOverlay(ff,{tooltip:i.Directions_Camera_Tip},r.primitive),u||ei.hideOverlay(this._map,r.primitive)))},p.prototype._onPointerMoved=function(t){if(this._isHovering&&t.primitive&&p.isIDirectionsPolyline(t.primitive)){var r=t.primitive.legIndex,u=this.inputData.waypoints[r].viaWaypoints.length,i=t.primitive._routeMode,f=i!==n.transit&&i!==n.multimode&&this._isDraggable()&&u<p.showDragMax;this._updateDragPin(f,t.location,!0,!1,!0)}},p.prototype.showOverlay=function(n,t,i){var r={overlayTemplate:new li(n,t),overlayAnchor:new kt(-10,-10)};ei.showOverlay(this._map,r,i)},p.prototype._onPrimitiveTapped=function(n){var r,w,u,b,f,e,k,i,h,d,o,s,g;if(this.primitiveInteracted.invoke(),r=p.isIDirectionsPushpin(n.primitive)&&n.primitive,!r||!t.isSDK){if(w=r&&r.instructionViewModel&&r.instructionViewModel.transitStopID&&r.instructionViewModel.transitStopID>0,w){r.instructionViewModel.showTransitStop();v.logInstrumentationEvent(c.RPPC,{});return}if(n.primitive instanceof gt&&this._selectedTrafficPin!==n.primitive){u=n.primitive;t.trafficCameraV2Enabled&&this._trafficIncident?this._trafficIncident.show(u,!1,!0):t.trafficIncidentV2Enabled&&this._trafficIncident?this._trafficIncident.show(u):(this._selectedTrafficPin&&this._selectedTrafficPin.updatePinIcon(!1),this._selectedTrafficPin=u,this._mapBoundsBeforeFlipTask=it.getMapBounds(this._map,!0),this._flipTaskId?(b={requestorType:"DirectionsTask",requestorId:this.id,type:y.directionsFlipTask,requestState:{incident:u.incident},taskId:this._flipTaskId,useActiveTasks:!!this._flipTaskId},a.invokeHandler(l.taskProcessDataHandlerKey,b)):(f={},f.activateOptions={parentId:this.id},f.type=y.directionsFlipTask,e={},e.incident=u.incident,e.parentId=this.id,f.state=e,a.invokeHandler(l.taskDataHandlerKey,f)));v.logInstrumentationEvent(yi.isCamera(u)?c.CAMCLK:c.INCCLK,{});return}this.displayState.activationState===1||t.isSDK||(k={action:"focus",id:this.id},a.invokeHandler(l.taskDataHandlerKey,k));this._hasRoute()&&(i=this._resultsViewModel,h=i&&i.getRouteMode(i.getRouteSelected()),r&&fi&&fi.isEnabled?(this._showStreetsideBubble(r),v.logInstrumentationEvent(c.RPPC,{})):p.isIDirectionsPolyline(n.primitive)?(d=n.primitive,o=d.getIndex(),i&&i.getRouteSelected()!==o&&(i.select(o,!1,!1,!0),v.logInstrumentationEvent(c.ARCM,{I:o,M:i.getPanelRouteMode(),ORM:h,NRM:i.getRouteMode(i.getRouteSelected())}))):n.primitive instanceof tr&&(s=n.primitive,s.routeIndex>-1&&i&&(i.select(s.routeIndex,!1,!1,!0),g={I:s.routeIndex,M:i.getPanelRouteMode(),ORM:h,NRM:i.getRouteMode(i.getRouteSelected())},v.logInstrumentationEvent(c.ARCB,g))))}},p.prototype._submitGeoCodeRequest=function(n,t){var i=this;this._reverseGeocoder.reverseGeocode(n,function(n){i._processGeocodeResponse(n,t)})},p.prototype._processGeocodeResponse=function(n,t){n&&n.success&&n.addressList&&n.addressList.length>0&&n.addressList[0].formattedAddress&&this._directionsPanelViewModel.waypoints[t].update(n.addressList[0].formattedAddress,n.location)},p.prototype._showStreetsideBubble=function(n){var t=n.getLocation(),i=n.routeMapEntities&&n.routeMapEntities.getRoutepointNeighbors(t),u,r,f,e;i&&i.length===2&&(u=t,r=i[0],r||(u=i[1],r=t),f=this.perfLog.start(yu.DirectionsIntegrationTime),e={action:"showDirectionsBubbleOverlay",location:t,directionsStartupOptions:{locationToLookAt:u,locationToLookFrom:r,maneuverType:this._resultsViewModel.instructionRowClass(n.getManeuverType()),perfState:f}},a.invokeHandler(l.streetsideDataHandlerKey,e))},p.prototype._onMapTypeChanged=function(n){var t,i;if(n.newMapTypeId!==n.oldMapTypeId)for(t=0;t<this._primitives.length;t++)i=this._primitives[t],p.isIDirectionsPolyline(i)&&(i.changeMapType(n.newMapTypeId),i.update())},p.prototype._updatePrimitivesZoom=function(n){for(var t,i=0;i<this._primitives.length;i++)t=this._primitives[i],p.isIDirectionsPushpin(t)?(t.changeZoom(n),t.update()):p.isIDirectionsPolyline(t)&&(t.changeZoom(n),t.update())},p.prototype._onViewChanged=function(n){var i=this._map.getMode(),t;i&&i.mapModeType!==2&&(t=it.getMercatorZoomLevel(this._map),p.currentZoomLevel!==t&&(p.currentZoomLevel=t,this._zoomLevelBestMapView<0&&(this._zoomLevelBestMapView=Math.floor(p.currentZoomLevel)),p.currentZoomLevel<=this._zoomLevelBestMapView-1?this._resultsViewModel&&this._resultsViewModel.clearRoutesLabels():this._resultsViewModel&&this._resultsViewModel.showRoutesLabels(),this._updatePrimitivesZoom(t),this._invalidateMap()));this._updateKeyRoutePoints(!1,n&&n.cause)},p.prototype._onDirectionsResultsRequested=function(r,u,f,e,o,s,h,c,l,a){var v=this,w,p,y,b;this._isRouteBeingCalculated=!0;this._directionsPanelViewModel.setShowSuggestionsPanel(!1);this._directionsPanelViewModel.hideMessage();w=at.logPerfEvent(st.TD,r.mode);p=new yt(this._map);this._resultsViewModel&&(this._resultsViewModel.clearRoutesLabels(),this._resultsViewModel.discarded=!0);this.disposables.push(this._resultsViewModel=this._createDirectionsResultsSetViewModel(r,p,w));y=this._resultsViewModel.reportProblemClicked.add(function(){v.isReportable()&&v._resultsViewModel.setReportProblemLink(v._getFeedbackTaskState())});this.disposables.push(y);y=this._resultsViewModel.routeSelectedEvent.add(function(){if(v._updateKeyRoutePoints(),v._resultsViewModel.setShowSeeAllRoutes(!1),v._resultsViewModel.seeAllRoutesReturnClick.invoke(),t.bestModeEnabled){var i=v._resultsViewModel.getRouteMode(v._resultsViewModel.getRouteSelected());v.showOrHideCategoriesBar(i!==n.transit)}});this.disposables.push(y);y=this._resultsViewModel.seeAllRoutesReturnClick.add(function(){v._directionsPanelViewModel.seeAllRoutesReturnClick();v.setTitle(v.getTitle().replace(i.L_Directions_See_All_Routes_Title,""))});this.disposables.push(y);y=p.invalidateMap.add(function(){v._invalidateMap()});this.disposables.push(y);y=p.addMapLayerPrimitives.add(function(n){v._addMapLayerPrimitives(n.primitives,n.needBestMapView)});this.disposables.push(y);y=p.setMapViewIfPrimitivesOutOfBound.add(function(n){var t=v._taskState&&!!v._taskState.category;v._setMapViewIfPrimitivesOutOfBound(n,t,t)});this.disposables.push(y);y=p.instructionClicked.add(function(n){t.enableHightlightInstruction&&v.scrollLane&&v.scrollLane.invoke(n)});this.disposables.push(y);t.bestModeEnabled&&r.mode===n.multimode&&(r.waypoints.length>2||a&&this._hasVias(r.waypoints))&&(r.mode=n.driving,this._directionsPanelViewModel.forceDrivingMode());t.bestModeEnabled&&!f&&(b=tu.hasExpandedInstructions(this.panelRoot),this._directionsPanelViewModel.setResultsExpanded(b));this._resultsViewModel.getDirections(function(n,t,i,r,u,f){v._onDirectionsCallback(n,t,i,r,u,c,l,f)},u,f,e,o,s,h);y=this._directionsPanelViewModel.seeAllRoutesClick.add(function(){v._resultsViewModel.seeAllRoutesClick();v.setTitle(i.L_Directions_See_All_Routes_Title+v.getTitle())});this.disposables.push(y)},p.prototype._clearResultsControl=function(){this._currentResultsControl&&this._currentResultsControl.removeFromParent();this._currentResultsControl=null},p.prototype._hasVias=function(n){if(n&&n.length>0)for(var t=0;t<n.length;t++)if(n[t].viaWaypoints&&n[t].viaWaypoints.length>0)return!0;return!1},p.prototype._onDirectionsCallback=function(r,u,e,s,h,c,l,a){var d=this,y,g,p,w,b,nt,tt,it,k,v;if(this._isRouteBeingCalculated=!1,h){this._currentPrimitiveMovedArg&&this._processDragRequest(this._currentPrimitiveMovedArg);return}if(this._traceId=r,this._directionsPanelViewModel.setShowProgress(!1),u.errorCode===f.Success||!u.errorDetails){if(this._clearResultsControl(),this._resultsViewModel.waypoints=this._directionsPanelViewModel.waypoints,this._directionsPanelViewModel&&this._directionsPanelViewModel.setResultsShowingFlag(!0),this._currentResultsControl=this._resultsViewModel.getControl(),t.isSDK||(this.appendControl(this._currentResultsControl),this._resultsViewModel.waitingOnRoadShieldEvent()||o(".svg",this._currentResultsControl[0]).inlineDataSvgs().remove_class("svg")),c=c||0,(c>=this._resultsViewModel.directionsResultsTitleSet.length||c<0)&&(c=0),l&&(y=l.split(","),y&&y.length>=2))for(g=y[1],v=0;v<this._resultsViewModel.directionsResultsListSet.length;v++)if(p=this._resultsViewModel.directionsResultsListSet[v].routeId,w=p&&p.split(","),w&&w[1]===g){c=v;break}if(b=!1,this._taskState.category&&this._activatedFromPermaLink&&this._taskState.mode!==n.transit&&(s=!0,b=!0),this._resultsViewModel.select(c,s,!0,a),this._taskState.mode!==n.transit&&(this.displayState.prominence===undefined||this.displayState.prominence===1)&&this._updateCategoriesBarVisibility(),nt=this._directionsPanelViewModel.waypoints[0].getWaypointTitle(),tt=this._directionsPanelViewModel.waypoints[this._directionsPanelViewModel.waypoints.length-1].getWaypointTitle(),this.setTitle(i.L_Directions_Process_Title_Text_Line.replace("{0}",nt).replace("{1}",tt)),this._activatedFromPermaLink||this._activatedFromHistoryManager||this.serializableObjectChanged.invoke({magnitude:2}),this._updateKeyRoutePoints(!0),this._delaySetDisplay&&this._delaySetDisplay.invoke(),this._directionsPanelViewModel.showEditAndCollapseCard(),b){for(it=this._taskState.category.toLowerCase(),v=0;v<pi.length;v++)if(pi[v].category.toLowerCase()===it){k=pi[v];break}k&&this._dragonflyContainer.instanceAsync("BrowserHistoryManager",function(n){n.nextHistoryPointReplace();d._processCategorySelection(k,d.id)})}this._activatedFromPermaLink=!1}else this._directionsPanelViewModel.clearResultsAndShowMessage(u,r),this._clearResultsControl()},p.prototype._updateLocationIdentifiers=function(){for(var r=0,t=-1,u=0,i,n;r<this.inputData.waypoints.length;)i=this.inputData.waypoints[r],t<0?(n=this._resultsViewModel.stopPoints[r],i.locationIdentifier=n&&n.locationIdentifier):(n=this._resultsViewModel.allStopPoints[u].routeLegStopPoint,i.viaWaypoints[t].locationIdentifier=n&&n.locationIdentifier),t++,u++,i&&t>=i.viaWaypoints.length&&(r++,t=-1)},p.prototype._getWaypointLabel=function(n){return this._directionsPanelViewModel!=null?this._directionsPanelViewModel.indexToIconText(n):"%20"},p.prototype._updatePrintImages=function(){var o,n,u,t;if(this._hasRoute()){var i=et.printImgMiniMapUrlFormat,e="",f=this._resultsViewModel,r=f.waypoints;for(n=0;n<r.length;n++)u=r[n],t=u.getWayPointModel().point,e+="wp."+n+"="+t.latitude+","+t.longitude+";"+(n==0?p.startPrintIcon:n===r.length-1?p.endPrintIcon:p.stopPrintIcon)+";"+this._getWaypointLabel(n)+"&";for(i=i.replace("{wp}",e).replace("{credentials}",et.credentials).replace("{cmnPltParam }",nt.platformCommonParam),o=f.getRouteSelected(),i=i.replace("{rid}",f.directionsResultsListSet[o].routeId),n=0;n<r.length;n++)u=r[n],t=u.getWayPointModel().point,u.setPrintImagePath(i.replace("{lat}",""+t.latitude).replace("{lon}",""+t.longitude))}},p.prototype._updateKeyRoutePoints=function(n,t){if(this._listeners.length!=0||n){var i=this._keyRoutePoints;this._keyRoutePoints=this._calculateKeyRoutePoints();this._arePointsDifferent(i,this._keyRoutePoints)&&this._notifyListeners(t)}},p.prototype._arePointsDifferent=function(n,t){if(n.length!=t.length)return!0;for(var i=0;i<n.length;i++)if(!k.areEqual(n[i],t[i]))return!0;return!1},p.prototype._notifyListeners=function(n){this._listeners.length!=0&&this._sendNotificationMessage(this._keyRoutePoints,this._listeners,n)},p.prototype._sendNotificationMessage=function(n,t,i){for(var u,f,r=0;r<this._listeners.length;r++)u={action:0,cause:i,keyRoutePoints:n,directionsTaskId:this.id},f={requestorType:"DirectionsTask",requestorId:this.id,type:y.localListingTask,requestState:u,taskId:t[r]},a.invokeHandler(l.taskProcessDataHandlerKey,f)},p.prototype._notifyListenersBeforeDeactivation=function(){for(var t,i,n=0;n<this._listeners.length;n++)t={action:1},i={requestorType:"DirectionsTask",requestorId:this.id,type:y.localListingTask,requestState:t,taskId:this._listeners[n]},a.invokeHandler(l.taskProcessDataHandlerKey,i)},p.prototype._addMapLayerPrimitives=function(n,t){var i=this,r,u,f;this._clearPrimitives();n&&n.length>0&&(r=this._map.getFrameManager(),r&&r.frameRendered.addOne(function(){i._directionsRequestStartTime>0&&(vu.log("Maps_DTTG",i._directionsRequestStartTime),i._directionsRequestStartTime=-1)}),this._primitives=this._primitives.concat(n),this._associatePrimitivesWithLayer(n),u=it.getMercatorZoomLevel(this._map),this._updatePrimitivesZoom(u),t&&(f=ai.getLocationsForPrimitivesInView(this._primitives),this._setMapViewWithPadding(f),this._zoomLevelBestMapView=-1),this._currentPrimitiveMovedArg||this.directionsManagerCallback.invoke(),this._invalidateMap())},p.prototype._invalidateMap=function(){var n=this;this._layerInitiated||(this.templateSelector||(this.templateSelector=new gi(this._map)),this._layer||(this._layer=new lr("DirectionsTask_"+ai.getUniqueId(),this,this.templateSelector,gu.foregroundZOrder),this._map.getLayers().insert(this._layer)),this._layer.setTemplateSelector(this.templateSelector),this._layer.setRenderTarget(2),this._associatePrimitivesWithLayer(this._primitives),this.disposables.push(this._layer.primitiveTapped.add(function(t){n._onPrimitiveTapped(t)})),this._isDraggable()&&(this.disposables.push(this._layer.primitiveMoveStarted.add(function(t){n._onPrimitiveMoveStarted(t)})),this.disposables.push(this._layer.primitiveMoveContinued.addThrottled(function(t){n._onPrimitiveMoveContinued(t)},200)),this.disposables.push(this._layer.primitiveMoveStopped.add(function(t){n._onPrimitiveMoveStopped(t)}))),this.disposables.push(this._layer.primitiveHoverStarted.add(function(t){n._onPrimitiveHover(t,!0)})),this.disposables.push(this._layer.primitiveHoverStopped.add(function(t){n._onPrimitiveHover(t,!1)})),this.disposables.push(this._map.pointerMoved.add(function(t){return n._onPointerMoved(t)})),this._layerInitiated=!0);this.invalidated.invoke();r.Layer!==undefined&&this._layer instanceof r.Layer&&this._layer.raiseInvalidatedEvent()},p.prototype._clearMap=function(){this._updateDragPin(!1,null,!1,!1,!1);this._primitives&&this._primitives.length&&(this._clearPrimitives(),this._invalidateMap())},p.prototype.clearExistingRoutes=function(){this._currentResultsControl&&(this._clearResultsControl(),this._resultsViewModel&&this._resultsViewModel.clearRoutes(),this._resultsViewModel=null,this._clearMap(),this.routeClearedEvent&&this.routeClearedEvent.invoke());this._removeCategoriesBar();this._directionsPanelViewModel&&this._directionsPanelViewModel.setResultsShowingFlag(!1)},p.prototype._waypointResolved=function(){var u,n,i,r,f,t;if(!this._hasRoute()){for(this._clearPrimitives(),u=this._directionsPanelViewModel.waypoints.length,n=0;n<u;n++)i=this._directionsPanelViewModel.waypoints[n].getWayPointModel(),i.point&&(r=h.middle,n===0?r=h.start:n===u-1&&(r=h.end),f=i.name||i.address,t=yt.createStopPointPin(i.point,r,this._directionsPanelViewModel.getMode(),!1,null,n,0,null,f,this._renderOptions),t.changeCardTaskState(1),t.changeRouteSelectionState(!0),t.changeZoom(it.getMercatorZoomLevel(this._map)),t.update(),this._primitives.push(t),this._associatePrimitivesWithLayer([t]));this._invalidateMap()}},p.prototype._associatePrimitivesWithLayer=function(n){var t=this._layer,i,u;if(t)if(r.Layer!==undefined&&t instanceof r.Layer)t.add(n);else for(i=0,u=n.length;i<u;i++)n[i].layer=t},p.prototype._setMapViewIfPrimitivesOutOfBound=function(n,t,i){var r;t===void 0&&(t=!1);i===void 0&&(i=!1);var e=it.getMapBounds(this._map,!0),u=ai.getLocationsForPrimitivesInView(n),f=!1;for(r=0;r<u.length;r++)if(e.contains(u[r])){f=!0;break}(!f||i||this._directionsPanelViewModel&&this._directionsPanelViewModel.isLongDistanceIntent&&!this._isDistanceIntentMapViewSet)&&this._setMapViewWithPadding(u,t)},p.prototype._setMapViewWithPadding=function(n,t){var i,r;t===void 0&&(t=!1);i=this._map.getMapType();i.id!==lu.birdseyeV2&&(t||!this.displayState.activationState||this.displayState.activationState===1)&&(r=this._getAdditionalPadding(),this._map.setView(this._map.getMode().getMapViewForLocationsInView(n,r)),this._directionsPanelViewModel&&this._directionsPanelViewModel.isLongDistanceIntent&&(this._isDistanceIntentMapViewSet=!0))},p.prototype._getAdditionalPadding=function(){var t=this._map.getViewport(),i=Math.min(.07*t.pixelWidth,.07*t.pixelHeight),n=Math.max(10+23/2,i);return{left:n,top:n,right:n,bottom:n}},p.prototype.isSharable=function(){return this._primitives&&this._primitives.length>0},p.prototype.isReportable=function(){return this._resultsViewModel?!0:!1},p.prototype._getFeedbackTaskState=function(){return{entryPoint:2,feedbackTaskType:5,activeTaskId:this.id,title:this.getTitle(),options:this.getReportOptions()}},p.prototype.getReportOptions=function(){var n=this._resultsViewModel.directionsResultsListSet[this._resultsViewModel.getRouteSelected()],t=[];return n&&n.stepStrings&&(t=n.stepStrings),{reportType:this.getReportType(),taskState:this.serialize(),directionStepsList:t,directionRouteIndex:this._resultsViewModel.getRouteSelected()}},p.prototype.getReportType=function(){return 7},p.prototype._setMapLayerZIndex=function(n){this._layer&&this._layer.setZIndex(n)},p.prototype.getTraceId=function(){return this._traceId},p.prototype._hasRoute=function(){return this._resultsViewModel&&this._resultsViewModel.getRoutesLength()>0},p.prototype._createDirectionsPanelViewModel=function(){return nt.isMobile?new kr(this.inputData,this._controlTemplateFactory,this._dragonflyContainer,this._geolocationProvider,this.id,this._map,this.perfLog,this.directionsManagerCallback,this._renderOptions,this._taskState&&this._taskState.resolveWaypointsInRoutingService):new bi(this.inputData,this._controlTemplateFactory,this._dragonflyContainer,this._geolocationProvider,this.id,this._map,this.perfLog,this.directionsManagerCallback,this._renderOptions,this._taskState&&this._taskState.resolveWaypointsInRoutingService)},p.prototype._createDirectionsResultsSetViewModel=function(n,t,i){return nt.isMobile?new gr(this._map,this._controlTemplateFactory,n,this._directionsPanelViewModel,t,this.perfLog,i,this.id,this._renderOptions):new di(this._map,this._controlTemplateFactory,n,this._directionsPanelViewModel,t,this.perfLog,i,this.id,this._renderOptions,this._taskState.options&&this._taskState.options.routeDraggable)},p.prototype.getResultsPanel=function(){return this._resultsViewModel&&this._resultsViewModel.getControl()},p.prototype.clearDisplay=function(){this._layer&&this._map.getLayers().remove(this._layer)},p.prototype.getDirectionsResponse=function(){return this._resultsViewModel&&this._resultsViewModel.getRawResponse()},p.prototype.getPanelViewModel=function(){return this._directionsPanelViewModel},p.isIDirectionsPushpin=function(n){return n instanceof wt?!0:typeof r.Directions.DirectionsSDKPushpin!="undefined"?n instanceof r.Directions.DirectionsSDKPushpin:!1},p.isIDirectionsPolyline=function(n){return n instanceof ni?!0:!1},p.prototype._clearPrimitives=function(){this._primitives=[];r.Layer!==undefined&&this._layer instanceof r.Layer&&this._layer.clear()},p.prototype._isDraggable=function(){return this._taskState&&this._taskState.options&&typeof this._taskState.options.routeDraggable=="boolean"?this._taskState.options.routeDraggable:!0},p.prototype._isMajorPoint=function(n){var t=n.getManeuverType();return t==="start"||t==="middle"||t==="end"||t==="via"},p.KeySegmentCount=10,p.KeyPointsCount=p.KeySegmentCount+1,p.CustomCategorySearchItem=new g("customSatrIcon",i.L_Directions_Categories_Bar_Entity_Custom,7,"Custom",""),p.CustomCategorySearchTCFItem=new g("customSatrIcon",i.L_Directions_Categories_Bar_Entity_More,7,"Custom",""),p.localDetailCardsData=[],p.polygonEntityDetailCardsData=[],p.transitStopCardsData=[],p.RouteCategoriesBarPanelCssClass="routecategoriesbar",p.startPrintIcon=155,p.stopPrintIcon=156,p.endPrintIcon=157,p.showDragMax=10,p.printCardClick=!1,p}(rr),fo=function(){function n(){this.changed=new s}return n.prototype.getIgnoreOverlayOnTapped=function(){return!0},n}(),yt=function(){function n(n){this.routeMapEntitiesCollection=[];this._primitives=[];this._globalPushpinPrimitives=[];this.addMapLayerPrimitives=new s;this.instructionClicked=new s;this.instructionClickedDone=new s;this.setMapViewIfPrimitivesOutOfBound=new s;this.invalidateMap=new s;this._map=n}return n.prototype.select=function(n,t,i,r){var e,u,f,o;if(this.routeMapEntitiesCollection&&this.routeMapEntitiesCollection.length!==0){for(this._selectedIndex=n,this._primitives=[],u=0;u<this.routeMapEntitiesCollection.length;u++)f=this.routeMapEntitiesCollection[u],u===n?(f.select(),e=f.getPrimitives(!1)):(f.unSelect(),this._primitives=this._primitives.concat(f.getPrimitives(!0)));if(e&&(this._primitives=this._primitives.concat(e)),this._globalPushpinPrimitives.length>0){for(o=0;o<this._globalPushpinPrimitives.length;o++)this._globalPushpinPrimitives[o].updateSelectedRoute(n);this._primitives=this._primitives.concat(this._globalPushpinPrimitives)}t&&this.setMapViewIfPrimitivesOutOfBound.invoke(e);this.show(t,i,r,!0)}},n.prototype.getMapType=function(){return this._map.getMapType().id},n.prototype.getMap=function(){return this._map},n.showDragTipPin=function(t,i,r,u,f,e){n._tipOverlay||(n._tipOverlay=new pf(i));n._tipOverlayShowing||(t.getOverlays().insert(n._tipOverlay),n._tipOverlayShowing=!0);n._tipOverlay.setAlignment(r);n._tipOverlay.setShowPin(e);n._tipOverlay.setShowTip(u,f)},n.hideDragTipPin=function(t){n._tipOverlay&&(n._tipOverlayShowing=!1,t.getOverlays()&&t.getOverlays().remove(n._tipOverlay))},n.prototype.clearRoutes=function(){this.clearRoutesLabels()},n.prototype.clearRoutesLabels=function(){if(t.enableRouteLabel)for(var n=0;n<this.routeMapEntitiesCollection.length;n++)this.routeMapEntitiesCollection[n].hideLabel()},n.prototype.centerMap=function(n){it.setMapCenter(this._map,n,16)},n.prototype.highlightAndInvalidate=function(t){n.highlight(t)},n.prototype.dispose=function(){u._clearDisposables(this.routeMapEntitiesCollection);u._clearDisposables(this._primitives);u._disposeEvents(this);this._globalPushpinPrimitives=null;this._map=null},n.highlight=function(t){if(t instanceof wt){var i=n._highlightedPin;i!==t&&(i&&i.entity&&(i.isPinHighlighted=!1,i.update(),i.entity.changed.invoke()),t&&t.entity&&(t.isPinHighlighted=!0,t.update(),t.entity.changed.invoke()),n._highlightedPin=t)}},n.createStopPointPin=function(n,i,u,f,e,o,s,c,l,a){if(n){var v="",y=null,p;return i===h.start?(v="start",y=a&&(a.firstWaypointPushpinOptions||a.waypointPushpinOptions)):i===h.end?(v="end",y=a&&(a.lastWaypointPushpinOptions||a.waypointPushpinOptions)):i===h.middle?(v="middle",y=a&&a.waypointPushpinOptions):v=i===h.infopin?"infopin":i===h.parkAndRide?"parkAndRide":"via",p=t.isSDK&&typeof r.Directions.DirectionsSDKPushpin!="undefined"?new r.Directions.DirectionsSDKPushpin(n,y,i,e,u,f,c,v,o,s,l,String.fromCharCode(o+65)):new wt(n,i,e,u,f,c,v,o,s,l,String.fromCharCode(o+65)),p.entity.poiType=7,p}return null},n.prototype.addRoute=function(n,i,r,u,f,e){if(this._primitives.push.apply(this._primitives,n.getPrimitives(f>0)),this.routeMapEntitiesCollection.push(n),!t.isSDK&&i){var o=this._createInfoboxPin(i,n,u,f,e);o&&(o.timeSummary=r.getDurationString(i.travelDurationTraffic&&!t.enableMultiMode?i.travelDurationTraffic:i.travelDuration),o.distanceSummary=r.getFormattedDistanceText(i.travelDistance,i,!0),this._globalPushpinPrimitives.push(o),o.distanceSummary&&o.distanceSummary!==undefined||v.logInstrumentationEvent(c.DBG,{infodist:"undefined"}))}},n.prototype._createInfoboxPin=function(n,t,i,r,u){var f=n&&n.routeInfoHint;return f&&f.hintPoint?new tr(new k(f.hintPoint.coordinates[0],f.hintPoint.coordinates[1]),f.orientation,this._map,i,t,n,r,u):null},n.prototype.show=function(n,t,i,r){var h=this,e,o,u,f,s;for(t&&(e=at.logPerfEvent(st.MR,i),o=this._map.getFrameManager(),e&&o&&o.frameRendered.addOne(function(){e.end()})),u=0;u<this.routeMapEntitiesCollection.length;u++)this.routeMapEntitiesCollection[u].show();for(f=0;f<this._globalPushpinPrimitives.length;f++)s=this._globalPushpinPrimitives[f],s.changeCardTaskState(1),s.update();this.addMapLayerPrimitives.invoke({primitives:this._primitives,needBestMapView:n});r&&Microsoft.Maps.setTimeout(function(){h.showRouteLabels()},0)},n.prototype.showRouteLabels=function(){var r,i,e,l,h,o,c,s;if(t.enableRouteLabel)for(r=0;r<this.routeMapEntitiesCollection.length;r++){var u=[],f=[],n=this.routeMapEntitiesCollection[r];if(n.labelLocation){n.showLabel();continue}for(i=n.routeLinePoints,e=0;e<this.routeMapEntitiesCollection.length;e++)if(u=[],l=this.routeMapEntitiesCollection[e],h=l.routeLinePoints,e!==r)for(o=0;o<i.length;o++){for(c=!1,s=0;s<h.length;s++)if(k.areEqual(i[o],h[s])){c=!0;break}c?(u.length>f.length&&(f=u),u=[]):u.push(i[o])}f.length?n.setLabelLocation(f[Math.floor(f.length/2)]):n.setLabelLocation(i[Math.floor(i.length/2)],!0);n.showLabel()}},n.prototype.setTaskPrimitiveState=function(n){for(var t=0;t<this.routeMapEntitiesCollection.length;t++)this.routeMapEntitiesCollection[t].setTaskPrimitiveState(n);for(t=0;t<this._globalPushpinPrimitives.length;t++)this._globalPushpinPrimitives[t].setTaskPrimitiveState(n)},n.prototype.getRoutepointNeighbors=function(n){return this.routeMapEntitiesCollection[this._selectedIndex].getRoutepointNeighbors(n)},n}(),pt=function(n){function r(u,f,e,o,s,h){var c=this,l={},p,w;if(c=n.call(this,l)||this,c.itineraryItem=e,c.itineraryItem&&(c.stepIndex=c.itineraryItem.instructionIndex,c.parentStepIndex=c.itineraryItem.parentInstructionIndex),c.itineraryItem&&c.itineraryItem.maneuverPoint?c.location=c._getLocation(c.itineraryItem.maneuverPoint):f&&(c.location=c._getLocation(f)),s){var v=s.getWayPointModel(),a=s.getWaypointTitle(),y=v.address;y&&a!==y&&(c.stepAddress=y);c.stepText=a;c.formattedText=a;c.isClickable=!(a===i.L_Directions_MyLocation||a===i.L_Directions_Home||a===i.L_Directions_Work)&&!t.isSDK;c.entityId=v.eid;c.searchFilter=v.filterUrlParam;t.enableMultiMode?(p=s.getIndex(),p>=0?c._setIconTextFromIndex(p):c.iconText=null):c._setIconTextFromIndex(s.getIndex());c._setWaypointTitleFromIndex(s)}return c.needPushpin=!0,c._routeMapEntitiesCollection=u,c._cssClassNormal=r._defaultCssClass,c.resources=i,l.defineProperty("cssClass",null,null,{defaultValue:r._defaultCssClass}),l.defineProperty("show",null,null,{defaultValue:!0}),l.defineProperty("showGroup",null,null,{defaultValue:!1}),l.defineProperty("roadShieldUrl"),w=nt.isSDK||o!=="dirRouteStart"&&o!="dirRouteEnd",w&&l.defineProperty("role",null,null,{defaultValue:"button"}),o&&c.setStepIconClass(o),c.showHints=c.showIcon=c.showWarnings=!0,c.setRenderOptions(h),c}return w(r,n),r.prototype._setIconTextFromIndex=function(n){this.iconText=String.fromCharCode(n+65)},r.prototype.setStepIconClass=function(n){this.stepIconClass=n;this._cssClassNormal=this._stepIconClassToCssClass(n);this._updateCssClass()},r.prototype._setWaypointTitleFromIndex=function(n){var t=n.getIndex()?i.L_Directions_Add_To:i.L_Directions_Add_From;t=t.replace("{0}",n.getWaypointTitle());this.waypointTitle=t},r.prototype.setHover=function(n){this._isHover!==n&&(this._isHover=n,this._updateCssClass())},r.prototype.showGroupToClass=function(n){return n?"upArrow":"downArrow"},r.prototype.arrayToDisplay=function(n){return this.boolToDisplay(n&&n.length>0)},r.prototype.lineColorToIconClass=function(n){var i="dirIcon",t=parseInt(n),r;return t&&t<=16777215&&(r=u._calcLuminance(t),i+=r>.65?" darkSymbol":" lightSymbol"),i},r.prototype.onMouseEnter=function(){this._routeMapEntitiesCollection.highlightAndInvalidate(this.pushpin)},r.prototype.onInstructionClick=function(n){var t,r,u,i;this._routeMapEntitiesCollection.instructionClicked.invoke(o(n.currentTarget));this.groupItems&&this.groupItems.length?(t=!this.getShowGroup(),this.groupItems.forEach(function(n){n.setShow(t);n.pushpin.setVisibility(t)}),r=c.COL,t&&(u=this._routeMapEntitiesCollection.getMap(),u.setView(u.getMode().getMapViewForLocationsInView(this.groupItemsLocations)),r=c.EXP),this.setShowGroup(t),i={},i.CI=2,this.itineraryItem&&this.itineraryItem.transitStops&&this.itineraryItem.transitStops.length?i.CI=6:this.groupItems[0].itineraryItem&&this.groupItems[0].itineraryItem.details[0].startPathIndices[0]===0&&(i.CI=1),v.logInstrumentationEvent(r,i)):this.location&&(this.location.latitude||this.location.longitude)&&(this._routeMapEntitiesCollection.centerMap(this.location),this.transitStopID&&this.showTransitStop());this._routeMapEntitiesCollection.instructionClickedDone.invoke()},r.prototype.onInstructionKeyDown=function(n){var t=n,i=t.keyCode||t.which;if(i==13){n&&n.stopImmediatePropagation();n&&n.preventDefault&&n.preventDefault();this.onInstructionClick(n)}},r.prototype._updateCssClass=function(){var n=this._cssClassNormal;this._isHover&&(n+=" hover");this.setCssClass(n)},r.prototype._getLocation=function(n){var t=n.coordinates,i=new k(t[0],t[1]);return ar.toLocation(i,17,!0)},r.prototype._stepIconClassToCssClass=function(n){var i=" circleIcon",t=" "+r._defaultCssClass;switch(n){case"TurnLeft":case"TurnLeftThenBearLeft":case"TurnLeftThenBearRight":case"TurnLeftThenTurnLeft":case"TurnLeftThenTurnRight":return"turnLeft"+i+t;case"TurnRight":case"TurnRightThenBearLeft":case"TurnRightThenBearRight":case"TurnRightThenTurnLeft":case"TurnRightThenTurnRight":return"turnRight"+i+t;case"UTurn":case"TurnBack":return"uTurnLeft"+i+t;case"KeepStraight":case"Continue":case"KeepOnRampStraight":case"KeepToStayStraight":case"RoadNameChange":case"TakeRampStraight":case"Transfer":return"keepStraight"+i+t;case"BearLeft":case"BearLeftThenBearLeft":case"BearLeftThenBearRight":case"BearLeftThenTurnLeft":case"BearLeftThenTurnRight":case"KeepOnRampLeft":return"slightLeft"+i+t;case"BearRight":case"BearRightThenBearLeft":case"BearRightThenBearRight":case"BearRightThenTurnLeft":case"BearRightThenTurnRight":case"KeepOnRampRight":return"slightRight"+i+t;case"KeepLeft":case"KeepToStayLeft":return"keepLeft"+i+t;case"KeepRight":case"KeepToStayRight":return"keepRight"+i+t;case"EnterRoundabout":case"EnterThenExitRoundabout":return"enterRoundaboutRight"+i+t;case"TakeRampRight":case"TakeRampLeft":case"ExitRoundabout":case"EnterRoundaboutLeft":case"Merge":case"TurnToStayLeft":case"TurnToStayRight":case"UTurnRight":case"RampThenHighwayRight":case"RampThenHighwayLeft":case"DepartStart":return n+i+t;case"Bus":case"Walk":case"Ferry":case"Tube":case"Train":return n+i+t;default:return n?n+t:t}},r.prototype.onNearbyParkingClick=function(n){if(n&&n.stopImmediatePropagation(),n&&n.preventDefault&&n.preventDefault(),this.location){var t={location:this.location,title:this.stepText,entryPoint:1};a.invokeHandler(l.taskDataHandlerKey,{type:y.nearbyParkingTask,state:t})}},r.prototype.showTransitStop=function(){if(this.transitStopID&&this.transitStopID>0){var n={id:this.transitStopID,title:this.transitStopName,location:this.location,activationEntryPoint:6};a.invokeHandler(l.taskDataHandlerKey,{action:"activate",type:y.transitStopTask,state:n})}},r.prototype.processTransitStopInfo=function(n,t){var i=this;nf.downloadTransitStop({stopId:n.toString(),dateTime:new Date},function(n,r){var f={},e,o,u,s;if(r&&r.resourceSets&&r.resourceSets.length&&r.resourceSets[0].resources&&r.resourceSets[0].resources.length){for(f=r.resourceSets[0].resources[0],e={},o=[],u=0;u<f.realTimeDataAtStop.length;u++)s=f.realTimeDataAtStop[u].line,o.push(s.abbreviatedName);e.stops=[{id:i.transitStopID,name:i.transitStopName,routes:[{count:u,names:o}]}];i.transitStaticResources=i._buildTransitStaticResources(e);t()}})},r.prototype._buildTransitStaticResources=function(n){var o="",s="",u=[],h=0,f=!1,i,t,r,e;if(n&&n.stops&&n.stops.length&&(s=n.stops[0].name,n.stops[0].routes&&n.stops[0].routes.length)){for(i=n.stops[0].routes,t=0;t<i.length;t++)for(r=0;r<i[t].names.length;r++)e=i[t].names[r],e.length>5&&h++,u.push(e);f=h>=u.length/2;o=u.join(f?"\n":", ")}return{transitLandmark:n,routeList:o,showLongList:f,stopName:s,addNewLines:this._addNewLines}},r.prototype._addNewLines=function(n){return n?"enableNewLines":""},r.prototype.setRenderOptions=function(n){n&&((n.displayPostItineraryItemHints===!1||n.displayPreItineraryItemHints===!1)&&(this.showHints=!1),n.displayManeuverIcons!==undefined&&(this.showIcon=n.displayManeuverIcons),n.displayStepWarnings!==undefined&&(this.showWarnings=n.displayStepWarnings),n.displayWalkingWarning!==undefined&&this.stepIconClass=="Walk"&&(this.showWarnings=n.displayWalkingWarning))},r._defaultCssClass="bm_dirInstructionRowGroup",r}(ft),ni=function(i){function r(n,t,r,u,f,e,o,s,h){return i.call(this,n,t,r,u,f,e,o,s,h)||this}return w(r,i),r.prototype._isAddingViaAllowed=function(){return this._routeMode!==n.transit&&this._routeMode!==n.multimode&&this._numberOfViaPoints<t.maxViaPoints},r}(cr),wt=function(n){function t(t,i,r,u,f,e,o,s,h,c,l,a,v){var y=n.call(this,t,i,u,f,o,s,h,c,l,a)||this;return y.routeMapEntities=e,y.instructionViewModel=r,y._isItineraryPin=v,y.setLabel(c,l),y}return w(t,n),t.prototype.setLabel=function(n,i){n&&(!this.routeMapEntities||this.isRouteSelected)&&(this.entity.name=n,this.entity.iconText=i);this._isItineraryPin?(this.entity.collisionBehavior=0,this.zIndex=t.ItineraryPinZIndex,this.bucket=null):this.bucket=this.isRouteSelected?dt.bucketIdForDirectionsPins:null;this.pushpinIconType&&!gi.majorPinTypes[h[this.pushpinIconType]]&&(this.entity.collisionBehavior=0)},t.prototype.dispose=function(){u._nullifyClass(this)},t.ItineraryPinZIndex=1e3,t}(ri),tr=function(t){function i(n,r,u,f,e,o,s,c){var l=t.call(this,n,h.infopin,f,!0)||this;return l._route=o,l._congestion=o&&o.trafficCongestion,l.orientation=r,l.currentZoomLevel=u.getMercatorZoomLevel(),l.routeMapEntities=e,l.entity.collisionBehavior=0,l.isRouteSelected=s===0,l.routeIndex=s,l._isClickable=c,l.bucket=dt.bucketIdForDirectionsPins,l.zIndex=l.isRouteSelected?i.SelectedZIndex:i.AlternateZIndex,l}return w(i,t),i.prototype.dispose=function(){u._nullifyClass(this)},i.prototype.setLabel=function(){this.bucket=dt.bucketIdForDirectionsPins},i.prototype.getTemplates=function(){var r=[],s,f,c,t,e,o,n;if(this.taskState===3||this.taskState===2&&!this.isRouteSelected)return r;var l=["ib",this.routeMode.toString(),this.orientation,this.timeSummary,this.distanceSummary,this.isRouteSelected?"S":"U"],h=l.join(":"),u=i._primitiveTemplateCache.getItem(h);if(u&&u.length>1)for(n=0;n<u.length;n++)r.push(u[n]);else{for(s={},f=ut.getIconsInRouteLeg(this._route,this.routeMode,s),this._transitFrequency=s.transitFrequency,c=this._getInfopinVectorPathForOrientation(f),t=new ci(this._createInfoPinImage(c,f.length),1,this._boxAnchorLocation),t.setHitTestShape(2),t.shadowStyle=this._getShadowStyle(),r.push(t),e=[],e.push(t),o=this._getVectorImagesForModes(t,f),n=0;n<o.length;n++)r.push(o[n]),e.push(o[n]);i._primitiveTemplateCache.addItem(h,e)}return r},i.prototype.updateSelectedRoute=function(n){this.isRouteSelected=n===this.routeIndex;this.zIndex=this.isRouteSelected?i.SelectedZIndex:i.AlternateZIndex},i.prototype.setTaskPrimitiveState=function(n){this.taskState=n;this.bucket=n===1||n===2&&this.isRouteSelected?dt.bucketIdForDirectionsPins:null},i.prototype.isMoveEnabled=function(){return!1},i.prototype.isTapEnabled=function(){return this.isClickResponseEnabled()},i.prototype.isHoverEnabled=function(){return this.isClickResponseEnabled()},i.prototype.isClickResponseEnabled=function(){return this._isClickable&&!this.isRouteSelected},i.prototype._createChildTemplate=function(n,t,i){return new su(n,this._createIconImage(t),1,0,i)},i.prototype._getVectorImagesForModes=function(n,t){var r=[],i=new p(this.orientation.toLowerCase()==="right"?12:6,this._modeAnchorPoint.y),u=t&&t.length;return u<1?r:(r.push(this._createChildTemplate(n,t[0],i.clone())),i.x+=18,u>1&&(r.push(this._createChildTemplate(n,"spacer",i.clone())),i.x+=12,u>3?(r.push(this._createChildTemplate(n,"more",new p(i.x,i.y+6))),i.x+=16,r.push(this._createChildTemplate(n,"spacer",i.clone())),i.x+=14):u>2&&(r.push(this._createChildTemplate(n,t[1],i.clone())),i.x+=18,r.push(this._createChildTemplate(n,"spacer",i.clone())),i.x+=14),r.push(this._createChildTemplate(n,t[t.length-1],i.clone())),i.x+=24),r)},i.prototype._createInfoPinImage=function(n,t){var r={records:[],hotspotX:0,hotspotY:0,hitTest:1},i=r.records;return i.push(n),i.push(this._getTextRecord(this.timeSummary,!0)),t===1&&i.push(this._getTextRecord(this._transitFrequency?this._transitFrequency:this.distanceSummary,!1)),r},i.prototype._createIconImage=function(n){var t={records:[],hotspotX:0,hotspotY:0,hitTest:1};return t.records.push(this._getRouteModeRecord(n)),t},i.prototype._getShadowStyle=function(){return{shadowColor:i.shadowColor,shadowBlur:i.shadowBlur,shadowOffset:i.shadowOffset}},i.prototype._getHighlightColor=function(){var t=this.routeMode===n.driving?i.lowTrafficHighlightColor:i.defaultTextColor;if(this._congestion)switch(this._congestion.toLowerCase()){case"medium":t=i.mediumTrafficHighlightColor;break;case"heavy":t=i.heavyTrafficHighlightColor}return t},i.prototype._getTextRecord=function(n,t){return{vectorType:3,text:n?n:"",anchor:t?this._timeTextAnchor:this._distanceTextAnchor,horizontalAutoScaling:t?1:0,style:{fillStyle:t?this._getHighlightColor():i.defaultHighlightColor,font:i.textFont,fontSize:t?i.timeTextSize:i.distanceTextSize,fontStyle:t?1:32,horizontalAutoScaling:1,horizontalAlignment:1}}},i.prototype._calculateTextBoxWidth=function(){var n={styleStatic:{verticalAlignment:0,horizontalAlignment:1},styleDynamic:{font:i.textFont,fontSize:11,fontColor:i.lowTrafficHighlightColor,outlineColor:i.lowTrafficHighlightColor}};return eu.getTextSize(this.timeSummary,null,n,i.timeTextSize,i.distanceTextSize)},i.prototype._buildPinPath=function(n,t,r,u){var f=i.beakWidth/2,e=(u-i.beakWidth)/2,o=(r-i.beakWidth)/2;this._pinPath=n.replace("{start}",t.x+","+t.y).replace(new RegExp("{halfBeakWd}","g"),f.toString()).replace(new RegExp("{beakHt}","g"),i.beakHeight.toString()).replace(new RegExp("{beakSideHalfWidth}","g"),e.toString()).replace(new RegExp("{beakSideHalfHeight}","g"),o.toString()).replace(new RegExp("{height}","g"),r.toString()).replace(new RegExp("{width}","g"),u.toString())},i.prototype._getRouteModeRecord=function(n){var t;switch(n){default:case"car":t=i.drivingModePath;break;case"train":t=i.trainModePath;break;case"ferry":t=i.ferryModePath;break;case"bus":t=i.transitModePath;break;case"walk":t=i.walkingModePath;break;case"spacer":t=i.spacerPath;break;case"more":t=i.moreModePath}return{pathData:t,vectorType:4,scalePaletteKey:"0",shapePaletteKey:"0",style:{strokeStyle:i.modeStrokeStyle,fillStyle:i.modeFillStyle}}},i.prototype._calculateIconWidth=function(n){return n>=3?(i.iconWidth+i.spacerWidth)*2+i.iconWidth:n===2?i.spacerWidth+i.iconWidth*2:i.iconWidth},i.prototype._calculateBoxSize=function(n,t){return new wu(n.width+this._calculateIconWidth(t)+i.boxBuffer,t>1?i.singleLineHeight:i.doubleLineHeight)},i.prototype._getInfopinVectorPathForOrientation=function(n){if(!this._offsetsComputed){var s=this._calculateTextBoxWidth(),e=this._calculateBoxSize(s,n&&n.length),u=e.width,r=e.height,o=(u-i.beakWidth)/2,t=new p(6,0),f=void 0;switch(this.orientation.toLowerCase()){default:case"unknown":case"up":this._boxAnchorLocation=new kt(.5,1,0);this._modeAnchorPoint=new p(6,6);t=t.add(new p(6,17));f=new p(6,32);this._buildPinPath(i.upInfoboxPath,new p(i.infoboxCurveAdjustment/2+o+i.beakWidth,i.infoboxCurveAdjustment+r),r,u);break;case"down":this._boxAnchorLocation=new kt(.5,0,0);this._modeAnchorPoint=new p(6,12);t=t.add(new p(6,22));f=new p(6,37);this._buildPinPath(i.downInfoboxPath,new p(i.infoboxCurveAdjustment/2+o,i.beakHeight),r,u);break;case"left":this._boxAnchorLocation=new kt(1,.5,0);this._modeAnchorPoint=new p(6,n&&n.length>1?8:6);t=t.add(new p(6,16));f=new p(6,30);this._buildPinPath(i.leftInfoboxPath,new p(i.infoboxCurveAdjustment+u,(r+i.infoboxCurveAdjustment-i.beakWidth)/2),r,u);break;case"right":this._boxAnchorLocation=new kt(0,.5,0);this._modeAnchorPoint=new p(12,n&&n.length>1?8:6);t=t.add(new p(12,16));f=new p(12,30);this._buildPinPath(i.rightInfoboxPath,new p(i.beakHeight,(i.beakWidth+r+i.infoboxCurveAdjustment)/2),r,u)}this._timeTextAnchor=t.add(new p(this._calculateIconWidth(n.length),0));this._distanceTextAnchor=f;this._offsetsComputed=!0}return this._pinPath?{pathData:this._pinPath,vectorType:4,scalePaletteKey:"0",shapePaletteKey:"0",style:{fillStyle:this.isRouteSelected?i.selectedFillStyle:i.fillStyle,lineWidth:i.lineWidth,strokeStyle:i.boxBorderStroke,strokeWidth:i.lineWidth}}:null},i._primitiveTemplateCache=new cu(30),i.SelectedZIndex=11100,i.AlternateZIndex=11e3,i.fillStyle="#ECECEC",i.selectedFillStyle="#FFFFFF",i.lineWidth=1,i.boxBorderStroke="rgba(118, 118, 118, 0.3)",i.modeStrokeStyle="#767676",i.modeFillStyle="#767676",i.lowTrafficHighlightColor="#006D21",i.mediumTrafficHighlightColor="#BB5D00",i.heavyTrafficHighlightColor="#C80000",i.defaultHighlightColor="#767676",i.defaultTextColor="#111111",i.textFont="Arial",i.shadowColor="#BBB",i.shadowBlur=4,i.shadowOffset=new p(0,2),i.beakHeight=6,i.beakWidth=12,i.infoboxCurveAdjustment=9,i.timeTextSize=9,i.distanceTextSize=8,i.spacerWidth=12,i.iconWidth=18,i.singleLineHeight=22,i.doubleLineHeight=33,i.boxBuffer=15,i.upInfoboxPath="M{start} l-{halfBeakWd},{beakHt} l-{halfBeakWd},-{beakHt} h-{beakSideHalfWidth} c-2.2,0-4-1.8-4-4 v-{height} c0-2.2,1.8-4,4-4 h{width} c2.2,0,4,1.8,4,4 v{height} c0,2.2-1.8,4-4,4 h-{beakSideHalfWidth} z",i.downInfoboxPath="M{start} l{halfBeakWd},-{beakHt} l{halfBeakWd},{beakHt} h{beakSideHalfWidth} c2.2,0,4,1.8,4,4 v{height} c0,2.2-1.8,4-4,4 h-{width} c-2.2,0-4-1.8-4-4 v-{height} c0-2.2,1.8-4,4-4 H{beakSideHalfWidth} z",i.rightInfoboxPath="M{start} l-{halfBeakWd},-{beakHt} l{halfBeakWd}-{beakHt} v-{beakSideHalfHeight} c0-2.2,1.8-4,4-4 h{width} c2.2,0,4,1.8,4,4 v{height} c0,2.2-1.8,4-4,4 h-{width} c-2.2,0-4-1.8-4-4 v-{beakSideHalfHeight} z",i.leftInfoboxPath="M{start} l{halfBeakWd},{beakHt} l-{halfBeakWd},{beakHt} v{beakSideHalfHeight} c0,2.2-1.8,4-4,4 h-{width} c-2.2,0-4-1.8-4-4 v-{height} c0-2.2,1.8-4,4-4 h{width} c2.2,0,4,1.8,4,4 v{beakSideHalfHeight} z",i.drivingModePath="M14.6,6l-0.7,0.7l-0.7-2.9c-0.1-0.4-0.5-0.8-1-0.8H3.8c-0.5,0-0.9,0.3-1,0.8L2.1,6.7L1.4,6H0v1h1l0.5,0.6 L1,9c0,0.1,0,4,0,4c0,0.6,0.4,1,1,1h1c0.6,0,1-0.4,1-1h8c0,0.6,0.4,1,1,1h1c0.6,0,1-0.4,1-1V9c0-0.1-0.5-1.3-0.5-1.4L15,7h1V6H14.6z  M4,10c-0.6,0-1-0.4-1-1c0-0.6,0.4-1,1-1c0.6,0,1,0.4,1,1c0,0.3-0.1,0.5-0.3,0.7C4.5,9.9,4.3,10,4,10z M5,12l1-2h4l1,2H5z M12,10 c-0.6,0-1-0.4-1-1c0-0.6,0.4-1,1-1c0.6,0,1,0.4,1,1c0,0.3-0.1,0.5-0.3,0.7C12.5,9.9,12.3,10,12,10z M3,7l0.7-2.6 C3.7,4.2,3.9,4,4.1,4h7.7c0.2,0,0.4,0.2,0.5,0.4L13,7H3z",i.transitModePath="M15,4v2h-1v8c0,0.1,0,0.3-0.1,0.4c-0.1,0.2-0.3,0.4-0.5,0.5C13.3,15,13.1,15,13,15h-1c-0.1,0-0.3,0-0.4-0.1 c-0.2-0.1-0.4-0.3-0.5-0.5C11,14.3,11,14.1,11,14H4c0,0.1,0,0.3-0.1,0.4c-0.1,0.2-0.3,0.4-0.5,0.5C3.3,15,3.1,15,3,15H2 c-0.1,0-0.3,0-0.4-0.1c-0.2-0.1-0.4-0.3-0.5-0.5C1,14.3,1,14.1,1,14V6H0V4h1V1.5c0-0.2,0-0.4,0.1-0.6C1.3,0.4,1.9,0,2.5,0h10 c0.2,0,0.4,0,0.6,0.1C13.6,0.3,14,0.9,14,1.5V4H15z M2,8h5V4H2V8z M13,12H2v1h11V12z M4,10.5C4,10.2,3.8,10,3.5,10 c-0.1,0-0.3,0.1-0.3,0.1C3.1,10.2,3,10.4,3,10.5V11h1V10.5z M13,4H8v4h5V4z M12,11v-0.5c0-0.3-0.2-0.5-0.5-0.5S11,10.2,11,10.5V11 H12z",i.walkingModePath="M13.5,6c-0.1-0.3-0.3-0.5-0.6-0.6c-0.1-0.1-0.3-0.1-0.4-0.1h-1.6l-0.8-0.8C9.7,4.2,9.3,3.9,8.7,3.8L6.1,3.2  H5.6c-0.3,0-0.7,0.1-1,0.2L3,4.2C2.8,4.3,2.7,4.5,2.6,4.6C2.5,4.8,2.4,5,2.4,5.2V8c0,0.1,0,0.3,0.1,0.4C2.7,9,3.3,9.2,3.9,9  c0,0,0,0,0,0C4,8.9,4.1,8.9,4.2,8.8c0.1-0.1,0.2-0.2,0.2-0.3C4.5,8.3,4.5,8.1,4.5,8V5.9l1-0.5c-0.2,1-0.5,2.1-0.7,3.1  s-0.5,2.1-0.7,3.1c-0.1,0.5-0.2,1-0.3,1.5c-0.1,0.5-0.2,1-0.3,1.5c0,0.1,0,0.1,0,0.2c0,0.1,0,0.3,0.1,0.4c0.1,0.1,0.1,0.2,0.2,0.3  c0.1,0.1,0.2,0.2,0.3,0.2C4.3,16,4.4,16,4.5,16c0.2,0,0.5-0.1,0.7-0.2c0.2-0.2,0.3-0.4,0.4-0.6c0.1-0.3,0.1-0.5,0.2-0.8  s0.1-0.5,0.2-0.8l0.7-3l2.2,2.2v2.1c0,0.1,0,0.3,0.1,0.4c0.2,0.5,0.9,0.8,1.4,0.6c0,0,0,0,0,0c0.1-0.1,0.2-0.1,0.3-0.2  c0.1-0.1,0.2-0.2,0.2-0.3c0.1-0.1,0.1-0.3,0.1-0.4v-2.8c0-0.1,0-0.3-0.1-0.4c-0.1-0.1-0.1-0.2-0.2-0.3L8.2,9l0.6-2.6l0.4,0.4  l0.4,0.4c0.1,0.1,0.2,0.2,0.3,0.2c0.1,0.1,0.3,0.1,0.4,0.1h2.2c0.1,0,0.3,0,0.4-0.1c0.1-0.1,0.2-0.1,0.3-0.2  C13.6,6.9,13.7,6.4,13.5,6L13.5,6z M7.1,2.7C7.3,2.9,7.5,3,7.6,3.1c0.4,0.2,0.8,0.2,1.2,0c0.4-0.2,0.7-0.5,0.9-0.9  c0.2-0.4,0.2-0.8,0-1.2C9.6,0.6,9.3,0.3,8.9,0.1C8.5,0,8,0,7.6,0.1C7.3,0.3,6.9,0.6,6.8,1c-0.2,0.4-0.2,0.8,0,1.2  C6.9,2.4,7,2.6,7.1,2.7z",i.trainModePath="M14.7,16h-1.4l-2-2H4.7l-2,2H1.3l2-2c-0.2,0-0.4-0.1-0.5-0.2c-0.2-0.1-0.3-0.2-0.4-0.3 c-0.1-0.1-0.2-0.3-0.3-0.5C2,12.8,2,12.7,2,12.5v-11c0-0.2,0-0.4,0.1-0.6c0.1-0.4,0.4-0.6,0.8-0.8C3.1,0,3.3,0,3.5,0h9 c0.2,0,0.4,0,0.6,0.1c0.2,0.1,0.3,0.2,0.5,0.3c0.1,0.1,0.2,0.3,0.3,0.5C14,1.1,14,1.3,14,1.5v11c0,0.2,0,0.4-0.1,0.5 c-0.1,0.2-0.2,0.3-0.3,0.5c-0.1,0.1-0.3,0.2-0.4,0.3c-0.2,0.1-0.3,0.2-0.5,0.2L14.7,16z M13,9V5H3v4H13z M4.5,12 C4.8,12,5,11.8,5,11.5S4.8,11,4.5,11S4,11.2,4,11.5C4,11.8,4.2,12,4.5,12z M6,3h4V2H6V3z M11.5,12c0.3,0,0.5-0.2,0.5-0.5 S11.8,11,11.5,11S11,11.2,11,11.5C11,11.8,11.2,12,11.5,12z",i.ferryModePath="M13.8,13H15v1h-1.7c-0.1,0.1-0.1,0.3-0.2,0.4c-0.1,0.1-0.2,0.2-0.3,0.3c-0.1,0.1-0.2,0.2-0.4,0.2 C12.3,15,12.1,15,12,15c-0.2,0-0.4,0-0.6-0.1c-0.1,0-0.3-0.1-0.4-0.2c-0.1-0.1-0.2-0.2-0.3-0.2c-0.1-0.1-0.2-0.2-0.3-0.2 c-0.1-0.1-0.2-0.1-0.3-0.2c-0.2-0.1-0.5-0.1-0.7,0c-0.1,0-0.2,0.1-0.3,0.2c-0.1,0.1-0.2,0.1-0.3,0.2c-0.1,0.1-0.2,0.2-0.3,0.2 c-0.1,0.1-0.3,0.1-0.4,0.2C7.9,15,7.7,15,7.5,15c-0.2,0-0.4,0-0.6-0.1c-0.1,0-0.3-0.1-0.4-0.2c-0.1-0.1-0.2-0.1-0.3-0.2 c-0.1-0.1-0.2-0.2-0.3-0.2c-0.1-0.1-0.2-0.1-0.3-0.2c-0.2-0.1-0.5-0.1-0.7,0c-0.1,0.1-0.2,0.1-0.3,0.2c-0.1,0.1-0.2,0.2-0.3,0.2 c-0.1,0.1-0.2,0.2-0.3,0.2c-0.1,0.1-0.3,0.1-0.4,0.2C3.4,15,3.2,15,3,15c-0.2,0-0.3,0-0.4-0.1c-0.1-0.1-0.2-0.1-0.4-0.2 c-0.1-0.1-0.2-0.2-0.3-0.3c-0.1-0.1-0.2-0.2-0.2-0.4l0,0L0,14v-1h1.2L0,10.6V9.4l2-0.7V5h1.2l1-2H6V1h3v2h1.8l1,2H13v3.7l2,0.7v1.2 L13.8,13z M12,8.4V6H3v2.4l4.5-1.5L12,8.4z M7,3h1V2H7V3z",i.moreModePath="M10.7,1.3C10.5,1.1,10.3,1,10,1S9.5,1.1,9.3,1.3S9,1.7,9,2\ts0.1,0.5,0.3,0.7S9.7,3,10,3s0.5-0.1,0.7-0.3S11,2.3,11,2S10.9,1.5,10.7,1.3z M2,1C1.7,1,1.5,1.1,1.3,1.3S1,1.7,1,2s0.1,0.5,0.3,0.7\tS1.7,3,2,3s0.5-0.1,0.7-0.3S3,2.3,3,2S2.9,1.5,2.7,1.3S2.3,1,2,1z M6,1C5.7,1,5.5,1.1,5.3,1.3S5,1.7,5,2s0.1,0.5,0.3,0.7S5.7,3,6,3\ts0.5-0.1,0.7-0.3S7,2.3,7,2S6.9,1.5,6.7,1.3S6.3,1,6,1z",i.spacerPath="m2 1 l6 6 l-6 6 h-2 l6-6 l-6-6 z",i}(ri),kf=function(n){function t(t){var r=this,u={};return r=n.call(this,u,t,cf)||this,r._zIndexLabelSelected=999,r._zIndexLabelNotSelected=998,u.defineProperty("isSelected",function(n,t){return r._onSelectionChanged(n,t)},null,{defaultValue:!1}),u.defineProperty("labelRootClass",null,null,{defaultValue:"labelOverlay"}),u.defineProperty("distanceText",null,null,{defaultValue:""}),u.defineProperty("timeText",null,null,{defaultValue:""}),u.defineProperty("zIndex",null,null,{defaultValue:998}),r.resources=i,r}return w(t,n),t.prototype._onSelectionChanged=function(n,t){if(n!==t){var i=t?this._zIndexLabelSelected:this._zIndexLabelNotSelected;this.setZIndex(i)}},t}(ft),df=function(n){function t(t){var i=this,r=new k(0,0),u=new p(23,15);return i=n.call(this,null,r,u)||this,i._overlayViewModel=new kf(t),i.setOverlayElement(i._overlayViewModel.getControl()),i}return w(t,n),t.prototype.setIsSelected=function(n){this._overlayViewModel.setIsSelected(n);var t=n?"labelOverlay selected":"labelOverlay";this._overlayViewModel.setLabelRootClass(t)},t.prototype.setMessage=function(n,t){this._overlayViewModel.setTimeText(n);this._overlayViewModel.setDistanceText(t)},t}(sr),ir;(function(n){n[n.none=0]="none";n[n.minimizeHighways=1]="minimizeHighways";n[n.minimizeToll=2]="minimizeToll";n[n.avoidHighways=4]="avoidHighways";n[n.avoidToll=8]="avoidToll";n[n.avoidExpressTrain=16]="avoidExpressTrain";n[n.avoidAirline=32]="avoidAirline";n[n.avoidBulletTrain=64]="avoidBulletTrain";n[n.avoidFerry=128]="avoidFerry";n[n.avoidBorder=256]="avoidBorder"})(ir||(ir={}));var gf=function(n){function t(t,i,r,u){var f=n.call(this,t,i,r)||this;return f._taskId=u,f}return w(t,n),t.prototype.onBackClick=function(n){n.preventDefault();var t={action:"remove",id:this._taskId};a.invokeHandler(l.taskDataHandlerKey,t)},t.prototype.updateUrlInstrumentation=function(n){return n+t._intrumentParam},t._intrumentParam="&routeCamera=1",t}(uf),nu=function(n){function t(t,i,r,u,f,e){var o=this,c={},h,s;if(o=n.call(this,c)||this,c.defineProperty("showInstructions",null,null,{defaultValue:!0}),o.instructionSteps=i,o.legTitle=r,o.index=f,o.timeDistanceText=u,o.showLegTitle=!1,h="dirLeg",o.legClassName=t&&t.displayManeuverIcons===!1?h+" hideManeuver":h,o.legInstructionsClassName="dirInstructions",o.legItemsLocations=[],e>1&&(o.showLegTitle=!0,o.legClassName+=" nLegs",o.legClassName+=f==0?" firstLeg":f==e-1?" lastLeg":"",o.legInstructionsClassName+=" nLegs",o.instructionSteps))for(s=0;s<o.instructionSteps.length;s++)o.instructionSteps[s]&&o.legItemsLocations.push(o.instructionSteps[s].location);return o}return w(t,n),t}(ft),ne=function(n){function t(){var t=this,i={};return t=n.call(this,i)||this,i.defineProperty("showResults"),t.setShowResults(!1),t}return w(t,n),t}(ft),tu=function(r){function u(n){var f=this,u={};return f=r.call(this,u)||this,u.defineProperty("isSelected"),u.defineProperty("trafficConditionClassName"),u.defineProperty("trafficConditionTimeClassName"),u.defineProperty("detailsHint"),u.defineProperty("detailsArrow"),u.defineProperty("showInstructions"),u.defineProperty("hasWarning"),u.defineProperty("warningSeverityIconClassName"),f._parentViewModelSet=n,f.isSDK=t.isSDK,f.showPrint=et.isEnabled,f.resources=i,f.showGetReturnDirectionsLink=!1,f}return w(u,r),u.prototype.onShowInstructionClick=function(n){var r;if(n&&n.preventDefault&&n.preventDefault(),n&&n.currentTarget){this._updateSelectedRoute();var t=o(n.currentTarget),u=t.select(".instructionDetailsHeader"),i=u.has_class("downArrow");this.toggleShowHideDetails(t,i);r={I:this.index,M:this._parentViewModelSet&&this._parentViewModelSet.getPanelRouteMode(),NRM:this.routeMode,CT:i?"EXP":"COL"};v.logInstrumentationEvent(c.SI,r)}},u.prototype.showHideInstructions=function(n,t){var i,r,u;n&&(i=n.select(".multimodeInstructions"),r=i.length>this.index?i[this.index]:null,r&&(u=o(r).select(".instructionDetails"),this.toggleShowHideDetails(u,t)))},u.hasExpandedInstructions=function(n){var t,i;if(n&&(t=n.select(".multimodeInstructions"),t.length>0))for(i=0;i<t.length;i++){var r=t[i],u=o(r).select(".instructionDetails"),f=u.select(".instructionDetailsHeader");if(f.has_class("upArrow"))return!0}return!1},u.prototype.onResultsTitleClick=function(n){n.preventDefault();this._updateSelectedRoute(!0)},u.prototype.setTrafficCondition=function(n){n==="Heavy"?(this.trafficCondition=i.L_Directions_Heavy_Traffic,this._trafficConditionClassName="traffic heavy",this._trafficConditionTimeClassName="drDurationTable heavy"):n==="Medium"?(this.trafficCondition=i.L_Directions_Moderate_Traffic,this._trafficConditionClassName="traffic moderate",this._trafficConditionTimeClassName="drDurationTable moderate"):(this.trafficCondition=i.L_Directions_Light_Traffic,this._trafficConditionClassName="traffic light",this._trafficConditionTimeClassName="drDurationTable light");this.setTrafficConditionClassName(this._trafficConditionClassName);this.setTrafficConditionTimeClassName(this._trafficConditionTimeClassName)},u.prototype.setWarningSeverity=function(n){this._warningSeverityIconClassName=n?"dr_alert_icon alert_"+n:"";this.setWarningSeverityIconClassName(this._warningSeverityIconClassName)},u.prototype._updateSelectedRoute=function(n){var t=this._parentViewModelSet,i;this.index!==t.getRouteSelected()&&(i=t.getRouteMode(t.getRouteSelected()),t.select(this.index,!1,!1,!0),n&&v.logInstrumentationEvent(c.ARC,{I:this.index,M:t.getPanelRouteMode(),NRM:t.getRouteMode(this.index),ORM:i}));this.routeMode=t.getRouteMode(this.index)},u.prototype._getLocalizedNameForMode=function(t){switch(t){default:case n.driving:return i.L_Directions_Title_Drive;case n.transit:return i.L_Directions_Title_Transit;case n.walking:return i.L_Directions_Title_Walking}},u.prototype.buildAriaSummary=function(r,u){var e=this.routeMode===n.transit||t.enableMultiMode&&this.routeMode===n.multimode,f=e?i.DirectionRouteSummaryAriaLabelTransit:i.DirectionRouteSummaryAriaLabelDrive;f=f.replace("{mode}",this._getLocalizedNameForMode(this.routeMode)).replace("{via}",this.descriptionVia?this.descriptionVia:"").replace("{embellishment}",this.embellishment?this.embellishment:"").replace("{duration}",u.getDurationString(r.travelDurationTraffic));f=e?f.replace("{frequency}",this.frequency?this.frequency:"").replace("{routeTimes}",this.mainTitle):f.replace("{distance}",this.subtitle).replace("{traffic}",this.trafficCondition?this.trafficCondition:"").replace("{embellishment}",this.embellishment?this.embellishment:"");this.ariaSummary=f},u.prototype.toggleShowHideDetails=function(n,t){if(n){var i=n.select(".instructionDetailsHeader");n.set_attr("aria-expanded",t?"true":"false");i.swap_class(t?"downArrow":"upArrow",t?"upArrow":"downArrow");this.setDetailsHint(t?this._parentViewModelSet.resources.L_Directions_InstructionDetailsLess:this._parentViewModelSet.resources.L_Directions_InstructionDetailsMore);this.setShowInstructions(t)}},u}(ft),ti=function(r){function u(u,f){var e=this,o={};return e=r.call(this,o)||this,o.defineProperty("btnClass"),o.defineProperty("ariaPressed"),o.defineProperty("ariaSelected"),o.defineProperty("ariaDisabled"),e.supportViaPoint=!0,u===n.driving?(e.maxWaypoints=t.maxDriveWaypoints,e.tooltip=i.L_Directions_Title_Drive):u===n.transit?(e.maxWaypoints=t.maxTransitWaypoints,e.tooltip=i.L_Directions_Title_Transit,e.supportViaPoint=!1):u===n.walking?(e.maxWaypoints=t.maxWalkWaypoints,e.tooltip=i.L_Directions_Title_Walk):u===n.truck?e.maxWaypoints=t.maxDriveWaypoints:t.bestModeEnabled&&u===n.multimode&&(e.maxWaypoints=t.maxDriveWaypoints,e.tooltip=i.L_Directions_Title_MultiMode),e.mode=u,e.modeName=f,e.enabled=!1,e}return w(u,r),u}(or);b.DefaultDirectionsFormattedTextProvider=hi;b.DirectionsInputData=vt;b.DirectionsPanelViewModel=nt.isMobile?kr:bi;b.DirectionsPolyline=ni;b.DirectionsPushpin=wt;b.DirectionsResultsSetViewModel=nt.isMobile?gr:di;b.DirectionsTask=ut;b.DirectionsFlipTask=vf;b.DirectionsTemplateSelector=gi;b.Optimize=rt;b.RouteResultsDataModel=br;b.TransitDirectionsFormattedTextProvider=dr;b.WaypointViewModel=wi;b.WalkingDirectionsFormattedTextProvider=ki;b.DirectionsResultsPanelTemplate=wr;b.DirectionsMultimodeResultsPanelTemplate=pr;b.RouteAvoidance=ir;b.DistanceUnit=ct;b.RouteErrorType=f}catch(iu){if(r.logger)r.logger.logCriticalError(iu);else throw iu;}}).call(window)