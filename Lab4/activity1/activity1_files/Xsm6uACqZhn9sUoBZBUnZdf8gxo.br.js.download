(function(){try{var i=window.$MicrosoftMaps8,r=i.Internal,sr=i.Tasks=i.Tasks||{},a=i.Traffic=i.Traffic||{},hr=r.TaskData=r.TaskData||{},ii=i.Anchor,st=r.BaseTask,ht=r.BaseTaskViewModel,cr=r._BaseMapTemplateSelector,lr=i.BitmapImageTemplate,ri=i.BucketPrimitiveTemplateSelector,ct=r.ControlTemplate,ui=r.Control,g=i.DataHandlerKeys,ar=i.Internal._Debug,vr=i.DefaultTemplateSelector,h=i.GlobalConfig,nt=i.GlobalDataEventHandler,yr=r._EntityHelper,pr=r._EntryPoints,wr=r._FeatureNames,u=r._Gimme,f=r._Helper,fi=i.ImageryMapLayer,br=i.ImageFromCssHelper,kr=i.InfoboxOptions,rt=r._JSEvent,ei=r._LatLonCrs,lt=r._LocalStorageCache,at=i.LocationRect,oi=i.MapView,w=i.Location,o=r.MapHelper,si=i.MapsInfobox,hi=r.MapInteractionBehavior,vt=i.MapMath,k=i.MapTypeId,yt=r._Network,dr=r._Observable,pt=r._ObservableObject,wt=r._ObservableCollection,ci=r._Overlay,bt=r._OverlayEntity,li=r.CameraMiniOverlayTemplate,kt=i.Point,ut=i.PrimitiveOverlayHelper,ai=r.PyramidTileSpatialIndex,vi=i.RasterImageryScene,yi=i.MercatorCubeCrs,gr=i.Rectangle,n=i.ResourceManager.MapDelay,nu=r._TaskDataHandlerHelper,ft=i.TaskTypes,t=h.features.traffic,pi=i.VectorMapLayer,wi=i.ZoomLevel,it=r._MapAuthentication;
/*!
    Copyright (c) 2011 Shachaf Ben-Kiki
    Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
    The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
(function(n,t){typeof define=="function"&&define.amd?define([],t):typeof exports=="object"?module.exports=t():n.SuperGif=t()})(this,function(){var n=function(n){return n.reduce(function(n,t){return n*2+t},0)},t=function(n){for(var i=[],t=7;t>=0;t--)i.push(!!(n&1<<t));return i},i=function(n){this.data=n;this.len=this.data.length;this.pos=0;this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return n instanceof Uint8Array?n[this.pos++]:n.charCodeAt(this.pos++)&255};this.readBytes=function(n){for(var t=[],i=0;i<n;i++)t.push(this.readByte());return t};this.read=function(n){for(var t="",i=0;i<n;i++)t+=String.fromCharCode(this.readByte());return t};this.readUnsigned=function(){var n=this.readBytes(2);return(n[1]<<8)+n[0]}},r=function(n,t){for(var o=0,c=function(n){for(var r=0,i=0;i<n;i++)t.charCodeAt(o>>3)&1<<(o&7)&&(r|=1<<i),o++;return r},s=[],u=1<<n,h=u+1,f=n+1,i=[],l=function(){i=[];f=n+1;for(var t=0;t<u;t++)i[t]=[t];i[u]=[];i[h]=null},r,e;;){if(e=r,r=c(f),r===u){l();continue}if(r===h)break;if(r<i.length)e!==u&&i.push(i[e].concat(i[r][0]));else{if(r!==i.length)throw new Error("Invalid LZW code.");i.push(i[e].concat(i[e][0]))}s.push.apply(s,i[r]);i.length===1<<f&&f<12&&f++}return s},u=function(i,u,f){u||(u={});var o=function(n){for(var t=[],r=0;r<n;r++)t.push(i.readBytes(3));return t},e=function(){var n,t="";do n=i.readByte(),t+=i.read(n);while(n!==0);return t},h=function(){var r={},f;if(r.sig=i.read(3),r.ver=i.read(3),r.sig!=="GIF")throw new Error("Not a GIF file.");r.width=i.readUnsigned();r.height=i.readUnsigned();f=t(i.readByte());r.gctFlag=f.shift();r.colorRes=n(f.splice(0,3));r.sorted=f.shift();r.gctSize=n(f.splice(0,3));r.bgColor=i.readByte();r.pixelAspectRatio=i.readByte();r.gctFlag&&(r.gct=o(1<<r.gctSize+1));u.hdr&&u.hdr(r)},c=function(r){var f=function(r){var e=i.readByte(),f=t(i.readByte());r.reserved=f.splice(0,3);r.disposalMethod=n(f.splice(0,3));r.userInput=f.shift();r.transparencyGiven=f.shift();r.delayTime=i.readUnsigned();r.transparencyIndex=i.readByte();r.terminator=i.readByte();u.gce&&u.gce(r)},o=function(n){n.comment=e();u.com&&u.com(n)},s=function(n){var t=i.readByte();n.ptHeader=i.readBytes(12);n.ptData=e();u.pte&&u.pte(n)},h=function(n){var t=function(n){var t=i.readByte();n.unknown=i.readByte();n.iterations=i.readUnsigned();n.terminator=i.readByte();u.app&&u.app.NETSCAPE&&u.app.NETSCAPE(n)},r=function(n){n.appData=e();u.app&&u.app[n.identifier]&&u.app[n.identifier](n)},f=i.readByte();n.identifier=i.read(8);n.authCode=i.read(3);switch(n.identifier){case"NETSCAPE":t(n);break;default:r(n)}},c=function(n){n.data=e();u.unknown&&u.unknown(n)};r.label=i.readByte();switch(r.label){case 249:r.extType="gce";f(r);break;case 254:r.extType="com";o(r);break;case 1:r.extType="pte";s(r);break;case 255:r.extType="app";h(r);break;default:r.extType="unknown";c(r)}},l=function(f){var c=function(n,t){for(var r,u=new Array(n.length),e=n.length/t,o=function(i,r){var f=n.slice(r*t,(r+1)*t);u.splice.apply(u,[i*t,t].concat(f))},s=[0,4,2,1],h=[8,8,4,2],f=0,i=0;i<4;i++)for(r=s[i];r<e;r+=h[i])o(r,f),f++;return u},s,h;f.leftPos=i.readUnsigned();f.topPos=i.readUnsigned();f.width=i.readUnsigned();f.height=i.readUnsigned();s=t(i.readByte());f.lctFlag=s.shift();f.interlaced=s.shift();f.sorted=s.shift();f.reserved=s.splice(0,2);f.lctSize=n(s.splice(0,3));f.lctFlag&&(f.lct=o(1<<f.lctSize+1));f.lzwMinCodeSize=i.readByte();h=e();f.pixels=r(f.lzwMinCodeSize,h);f.interlaced&&(f.pixels=c(f.pixels,f.width));u.img&&u.img(f)},s=function(){var n={};n.sentinel=i.readByte();switch(String.fromCharCode(n.sentinel)){case"!":n.type="ext";c(n);break;case",":n.type="img";l(n);break;case";":n.type="eof";u.eof&&u.eof(n);break;default:throw new Error("Unknown block: 0x"+n.sentinel.toString(16));}n.type!=="eof"&&f.push(setTimeout(s,0))},a=function(){h();f.push(setTimeout(s,0))};a()};return function(n){var t={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(var lt in n)t[lt]=n[lt];t.vp_w&&t.vp_h&&(t.is_vp=!0);var rt,e,ut=null,g=!1,at=!1,ft=null,et=null,ot=null,nt=null,tt=null,s=null,h=null,v=!0,ri=!0,vt=!1,o=[],y=[],w=[],r=t.gif;typeof t.auto_play=="undefined"&&(t.auto_play=!r.getAttribute("rel:auto_play")||r.getAttribute("rel:auto_play")=="1");var yt=t.hasOwnProperty("on_end")?t.on_end:null,ui=t.hasOwnProperty("loop_delay")?t.loop_delay:0,fi=t.hasOwnProperty("loop_mode")?t.loop_mode:"auto",pt=t.hasOwnProperty("draw_while_loading")?t.draw_while_loading:!0,wt=function(){ft=null;et=null;tt=ot;ot=null;s=null},bt=function(){try{u(rt,ci,w)}catch(n){st("parse")}},kt=function(n,t){c.width=n*k();c.height=t*d();l.width=n;l.height=t;l.style.width=n+"px";l.style.height=t+"px";l.getContext("2d").setTransform(1,0,0,1,0,0)},ei=function(n,t){if(!y[n]){y[n]=t;return}typeof t.x!="undefined"&&(y[n].x=t.x);typeof t.y!="undefined"&&(y[n].y=t.y)},st=function(n){ut=n;e={width:r.width,height:r.height};o=[];f&&f.parentNode&&f.parentNode.removeChild(f);ct&&ct(ut)},oi=function(n){e=n;kt(e.width,e.height)},si=function(n){dt();wt();ft=n.transparencyGiven?n.transparencyIndex:null;et=n.delayTime;ot=n.disposalMethod},dt=function(){s&&(o.push({data:s.getImageData(0,0,e.width,e.height),delay:et}),y.push({x:0,y:0}))},hi=function(n){var u,r,i;s||(s=l.getContext("2d"));u=o.length;r=n.lctFlag?n.lct:e.gct;u>0&&(tt===3?nt!==null?s.putImageData(o[nt].data,0,0):s.clearRect(h.leftPos,h.topPos,h.width,h.height):nt=u-1,tt===2&&s.clearRect(h.leftPos,h.topPos,h.width,h.height));i=s.getImageData(n.leftPos,n.topPos,n.width,n.height);n.pixels.forEach(function(n,t){n!==ft&&(i.data[t*4+0]=r[n][0],i.data[t*4+1]=r[n][1],i.data[t*4+2]=r[n][2],i.data[t*4+3]=255)});s.putImageData(i,n.leftPos,n.topPos);vt||(p.scale(k(),d()),vt=!0);pt&&(p.drawImage(l,0,0),pt=t.auto_play);h=n},a=function(){var n=-1,e=0,i=!1,h=function(){i&&clearTimeout(i);i=!1},c=function(){var t=ri?1:-1;return(n+t+o.length)%o.length},s=function(t){n=n+t;f()},u=function(){var t=!1,f=function(){yt!==null&&yt(r);e++;fi!==!1||e<0?u():(t=!1,v=!1)},u=function(){var r,e;(t=v,t)&&(s(1),r=o[n].delay*10,r||(r=100),e=c(),e===0?(r+=ui,i=setTimeout(f,r)):i=setTimeout(u,r))};return function(){t||(i=setTimeout(u,0))}}(),f=function(){var i;if(n=parseInt(n,10),n>o.length-1&&(n=0),n<0&&(n=0),i=y[n],l.getContext("2d").putImageData(o[n].data,i.x,i.y),p.globalCompositeOperation="copy",p.drawImage(l,0,0),t.onFrame)t.onFrame(n,o.length)},a=function(){v=!0;u()},w=function(){v=!1};return{init:function(){ut||(t.c_w&&t.c_h||p.scale(k(),d()),t.auto_play?u():(n=0,f(),v=!1))},step:u,play:a,pause:w,playing:v,move_relative:s,current_frame:function(){return n},length:function(){return o.length},dispose:h,move_to:function(t){n=t;f()}}}(),gt=function(){},b=function(n){return function(t){n(t)}},ci={hdr:b(oi),gce:b(si),com:b(gt),app:{NETSCAPE:b(gt)},img:b(hi,!0),eof:function(){f.style.display="";r&&r.parentNode&&r.parentNode.removeChild(r);at||(dt(),t.c_w&&t.c_h||(c.width=e.width*k(),c.height=e.height*d()),a.init());g=!1;it&&it(r)}},ni=function(){var n=r.parentNode;f=document.createElement("div");c=document.createElement("canvas");p=c.getContext("2d");l=document.createElement("canvas");f.width=c.width=r.width;f.height=c.height=r.height;f.className="b_jsgif";f.appendChild(c);n.insertBefore(f,r);f.style.display="none";t.c_w&&t.c_h&&kt(t.c_w,t.c_h);ht=!0},k=function(){return t.c_w&&e&&e.width?t.c_w/e.width:1},d=function(){return t.c_h&&e&&e.height?t.c_h/e.height:1},c,p,l,f,ht=!1,it=!1,ct=!1,ti=function(n,t){return g?!1:(n&&(it=n),t?ct=t:it=!1,g=!0,o=[],wt(),nt=null,tt=null,s=null,h=null,!0)},ii=function(){return o.reduce(function(n,t){return n+t.delay},0)},li=function(){w.forEach(function(n){clearTimeout(n)});w=[];a.dispose();f&&f.parentNode&&f.parentNode.removeChild(f);at=!0};return{play:a.play,pause:a.pause,move_relative:a.move_relative,move_to:a.move_to,get_playing:function(){return v},get_canvas:function(){return c},get_canvas_scale_x:function(){return k()},get_canvas_scale_y:function(){return d()},get_loading:function(){return g},get_auto_play:function(){return t.auto_play},get_length:function(){return a.length()},get_frames:function(){return o},get_duration:function(){return ii()},get_duration_ms:function(){return ii()*10},get_current_frame:function(){return a.current_frame()},load_url:function(n,t,r){if(ti(t,r)){var u=new XMLHttpRequest;u.open("GET",n,!0);"overrideMimeType"in u?u.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in u?u.responseType="arraybuffer":u.setRequestHeader("Accept-Charset","x-user-defined");u.onloadstart=function(){ht||ni()};u.onload=function(){this.status!=200&&st("xhr - response");"response"in this||(this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join(""));var n=this.response;n.toString().indexOf("ArrayBuffer")>0&&(n=new Uint8Array(n));rt=new i(n);w.push(setTimeout(bt,0))};u.onerror=function(){st("xhr")};u.send()}},load:function(n,t){this.load_url(r.getAttribute("rel:animated_src")||r.src,n,t)},load_raw:function(n,t){ti(t)&&(ht||ni(),rt=new i(n),w.push(setTimeout(bt,0)))},set_frame_offset:ei,dispose:li}}});var bi='<div class="bm_cameraCardRoot" data-tag="cameraCardRoot">    <div class="backArrowDiv cameraBack">            <a class="commonButton backArrowButton trafficBackButton" event:click="onBackClick" href="#" role="button" data-tag="backToProblemTypeSelectButton">                <div class="trafficBackButtonText">                    <TextBlock Text="{Binding resources.L_TrafficBackButtonText}" />                <\/div>            <\/a>    <\/div>    <div class="cameraImgHolder">        <img src="{Binding cameraImageUrl}" style:display="{Binding IsImageError Converter=boolToNotDisplay}" class="cameraImg" data-tag="cameraImg" event:error="onImageError" />        <div style:display="{Binding IsImageError Converter=boolToDisplay}" class="cameraImageError">            <TextBlock Text="{Binding resources.L_CameraImageErrorText}"/>        <\/div>    <\/div>      <div class="copyright">        <TextBlock Text="{Binding copyright}"/>    <\/div>    <div class="cameraDisclaimer" style:display="{Binding disclaimer Converter=nullToDisplayNone}">        <TextBlock Text="{Binding disclaimer}"/>    <\/div><\/div>',ki='<div id="{Binding primitive.entity.id}" class="infoboxOverlay trafficInfoboxOverlay">\t<a href="#" class="dialogClose closeIcon" data-tag="Infobox.Close" event:click="onCloseClick" title="{StaticBinding resources.L_NavBarCloseRadialMenuToolTip_Text}" role="button" ><\/a>\t<div class="infoboxTitle">\t\t<TextBlock Text="{Binding primitive.entity.title}" />\t<\/div>\t    <img src="{Binding primitive.entity.cameraImageUrl}" width="320" /><\/div>',di='<div class="{Binding rootClassName}" data-tag="trafficCameraPopupRoot">    <a class="cameraClose" data-tag="cameraClose" event:click="onCameraCloseClick" role="button" aria-label="{StaticBinding resources.L_CameraCloseAriaLabel}"/>    <div class="cameraDesc" data-tag="cameraDesc">        <TextBlock Text="{Binding description}" />    <\/div>    <div class="trfcLoading loading"><\/div>    <img src="{Binding imageUrl}" class="cameraImg loading" alt="{Binding altImageText}" data-tag="cameraImg" event:load="onCameraImageLoad"/>    <div class="trfCamAgencyAttrib">        <TextBlock Text="{Binding copyright}" />    <\/div>    <div class="trfCamCtrl">        <div class="trfcPlayPause">            <svg class="trfcCtrlBtn trfcPlayBtn" width="13" height="14" viewBox="0 0 13 14" fill="none" xmlns="http://www.w3.org/2000/svg">                <path d="M12.2221 5.68458C13.2586 6.25438 13.2586 7.74373 12.2221 8.31354L2.22259 13.8105C1.22292 14.36 -5.23707e-08 13.6367 0 12.496L5.04711e-07 1.50214C5.57082e-07 0.361374 1.22292 -0.361883 2.22259 0.187655L12.2221 5.68458Z" />            <\/svg>            <svg class="trfcCtrlBtn trfcPauseBtn" width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg">                <path d="M9 1.5C9 0.671573 9.67157 0 10.5 0H12.5C13.3284 0 14 0.671573 14 1.5V14.5C14 15.3284 13.3284 16 12.5 16H10.5C9.67157 16 9 15.3284 9 14.5V1.5ZM0 1.5C0 0.671573 0.671573 0 1.5 0H3.5C4.32843 0 5 0.671573 5 1.5V14.5C5 15.3284 4.32843 16 3.5 16H1.5C0.671573 16 0 15.3284 0 14.5V1.5Z" />            <\/svg>        <\/div>        <div class="trfcProgress">            <div class="trfcProgressBarBack">                <div class="trfcProgressBarFront"><\/div>                <div class="trfcProgressSlider"><\/div>            <\/div>        <\/div>    <\/div><\/div>',gi='<div data-tag="incidentCardRoot">   <div class="backArrowDiv cameraBack">            <a class="commonButton backArrowButton trafficBackButton" event:click="onBackClick" href="#" role="button" data-tag="backToProblemTypeSelectButton">                <div class="trafficBackButtonText">                    <TextBlock Text="{Binding resources.L_TrafficBackButtonText}" />                <\/div>            <\/a>    <\/div>    <div>        <div class="incidentTitleRoot">            <div class="incidentTitle" data-tag="incidentTitle"> <TextBlock Text="{Binding incidentTitle}" /><\/div>            <p class="{Binding severityType Converter=severityTypeToClass}" data-tag="severity"><span><TextBlock Text="{Binding severity}" /><\/span><\/p>        <\/div>        <div class="incidentDescriptionRoot">            <p class="incidentDescription"  data-tag="trafficDescription">            <TextBlock Text="{Binding trafficDescription}" /><\/p>            <p class="incidentTime" data-tag="start">            <span><TextBlock Text="{StaticBinding resources.L_TrafficPopupStartTime_Text}" /><\/span><span><TextBlock Text="{Binding start}" /><\/span><\/p>            <p class="incidentTime" data-tag="end">            <span><TextBlock Text="{StaticBinding resources.L_TrafficPopupEstEndTime_Text}" /><\/span><span><TextBlock Text="{Binding end}" /><\/span><\/p>        <\/div>    <\/div><\/div>',nr='<div data-tag="trafficCardRoot">    <div class="contentRoot trafficCard">        <div class="moduleRoot" data-tag="legendRoot">            <p class="moduleTitle" data-tag="legendTitle" aria-label="{Binding resources.L_TrafficLegendsTitle}" tabindex="0"><TextBlock Text="{Binding resources.L_TrafficLegendsTitle}" /><\/p>            <div class="legendTable" data-tag="legendContainer">                <table role="presentation">                    <tbody>                        <tr>                            <td>                                <div class="tableRow" tabindex="0">                                    <div class="tableCell" aria-label="{Binding resources.L_TrafficLegendsHeavyAriaLabel}" >                                        <div class="legendHeavy" data-tag="legendHeavy"><\/div>                                    <\/div>                                    <div class="tableCell">                                        <div data-tag="legendHeavyText"><TextBlock Text="{Binding resources.L_TrafficLegendsHeavy}" /><\/div>                                    <\/div>                                <\/div>                            <\/td>                            <td>                                <div class="tableRow" tabindex="0">                                    <div class="tableCell" aria-label="{Binding resources.L_TrafficLegendsLightAriaLabel}">                                        <div class="legendLight" data-tag="legendLight"><\/div>                                    <\/div>                                    <div class="tableCell">                                        <div data-tag="legendLightText"><TextBlock Text="{Binding resources.L_TrafficLegendsLight}" /><\/div>                                    <\/div>                                <\/div>                            <\/td>                        <\/tr>                        <tr>                            <td>                                <div class="tableRow" tabindex="0">                                    <div class="tableCell" aria-label="{Binding resources.L_TrafficLegendsModerateAriaLabel}">                                        <div class="legendModerate" data-tag="legendModerate"><\/div>                                    <\/div>                                    <div class="tableCell">                                        <div data-tag="legendModerateText"><TextBlock Text="{Binding resources.L_TrafficLegendsModerate}" /><\/div>                                    <\/div>                                <\/div>                            <\/td>                            <td>                                <div class="tableRow" tabindex="0">                                    <div class="tableCell" aria-label="{Binding resources.L_TrafficLegendsNoTrafficAriaLabel}">                                        <div class="legendNoTraffic" data-tag="legendNoTraffic"><\/div>                                    <\/div>                                    <div class="tableCell">                                        <div data-tag="legendNoTrafficText"><TextBlock Text="{Binding resources.L_TrafficLegendsNoTraffic}" /><\/div>                                    <\/div>                                <\/div>                            <\/td>                        <\/tr>                        <tr>                            <td>                                <div class="tableRow" tabindex="0">                                    <div class="tableCell" aria-label="{Binding resources.L_TrafficLegendsClosedAriaLabel}">                                        <div class="legendClosed" data-tag="legendClosed"><\/div>                                    <\/div>                                    <div class="tableCell">                                        <div data-tag="legendClosedText"><TextBlock Text="{Binding resources.L_TrafficLegendsClosed}" /><\/div>                                    <\/div>                                <\/div>                            <\/td>                        <\/tr>                    <\/tbody>                <\/table>            <\/div>        <\/div>            <\/div>    <ItemsControl ItemsSource="{Binding modules}" PanelTagName="ul">      <ItemsControl.ItemTemplate>        <DataTemplate>                <li class="contentRoot trafficCard" style:display="{Binding showModule Converter=boolToDisplay}">                    <div class="moduleRoot recentCameras" data-tag="moduleRoot">                        <p class="moduleTitle" data-tag="moduleTitle"><TextBlock Text="{Binding title}" /><\/p>                        <div>                            <ItemsControl ItemsSource="{Binding collection}" PanelTagName="ul">                                <ItemsControl.ItemTemplate>                                    <DataTemplate>                                        <li class="{Binding incidentType Converter=typeToClass}" data-tag="moduleItem {Binding incidentType Converter=typeToClass}" style:display="{Binding show Converter=boolToDisplay}">                                            <a href="#" event:click="onModuleItemClick" role="button" aria-label="{Binding incidentAriaLabel}">                                                <div style:display="{Binding incidentType Converter=cameraTypeToDisplay}">                                                    <div class="{Binding IsImageError Converter=errorToImagePaneClass}" data-tag="imgPreviewPlaceHolder">                                                        <img src="{Binding cameraImageUrl}" alt="{Binding altDescription}" class="imgPreview" style:display="{Binding IsImageError Converter=boolToNotDisplay}" event:error="onImageError" />                                                    <\/div>                                                    <div class="cameraTitle" data-tag="cameraTitle">                                                        <TextBlock Text="{Binding incidentTitle}" />                                                    <\/div>                                                <\/div>                                                <div style:display="{Binding incidentType Converter=incidentTypeToDisplay}" class="incidentContainer" data-tag="incidentContainer">                                                    <div class="tableCell">                                                        <div class="{Binding incidentType Converter=incidentTypeToIconClass}" data-tag="incidentIcon"><\/div>                                                    <\/div>                                                    <div class="tableCell">                                                        <div class="trafficDescriptionText" data-tag="incidentTrafficDescription"><TextBlock Text="{Binding trafficDescription}" /><\/div>                                                        <div class="trafficDescriptionText" data-tag="incidentSeverity"><TextBlock Text="{Binding severity}" /><\/div>                                                    <\/div>                                                <\/div>                                            <\/a>                                            <a href="#" class="removeRecentCamera" role="button" event:click="onRemoveRecentCameraClick" aria-label="{Binding removeCameraAriaLabel}" data-tag="removeRecentCameraLink">                                            <\/a>                                        <\/li>                                    <\/DataTemplate>                                <\/ItemsControl.ItemTemplate>                            <\/ItemsControl>                        <\/div>                        <a href="#" class="removeAllRecentCameras" event:click="onRemoveAllRecentCamerasClick" data-tag="removeAllRecentCamerasLink" role="button">                            <div class="removeAllRecentCamerasText" data-tag="removeAllRecentCamerasText"><TextBlock Text="{Binding resources.L_TrafficRemoveAllRecentCamerasLink}" /><\/div>                        <\/a>                        <a href="#" class="moreLink" style:display="{Binding showMoreLink Converter=boolToDisplay}" event:click="onMoreClick" data-tag="moreLink" role="button">                            <div class="moreLinkText" data-tag="moreLinkText"><TextBlock Text="{Binding moreLinkText}" /><\/div>                            <div data-tag="arrow" class="{Binding arrowClass}"><\/div>                        <\/a>                        <div class="clear"><\/div>                    <\/div>                <\/li>            <\/DataTemplate>                  <\/ItemsControl.ItemTemplate>    <\/ItemsControl>    <div class="clear"><\/div>    <div class="cameraSettings" tabindex="0" event:keyup="onCamerasKeyUp" event:click="onCamerasClick" role="checkbox" aria-checked="{Binding ariaChecked}">        <div class="switchSlot labelToggle" for="cameraToggleInput">            <div class="labelToggle_Container labelStyle">                <div class="labelStyleSwitch" id="toggleSwitchLabel" title="{Binding resources.L_TrafficsToggleCameras}" data-tag="cameraToggleSwitch">                    <input id="cameraToggleInput" type="checkbox" class="labelToggle_Input" checked="checked" tabindex="-1" aria-hidden="true" aria-labelledby="{Binding camerasToggleUniqueId}" aria-checked="{Binding ariaChecked}"/>                    <label class="labelToggle_label" id="{Binding camerasToggleUniqueId}">                        <TextBlock Text="{Binding resources.L_TrafficsToggleCameras}" />                    <\/label>                <\/div>            <\/div>        <\/div>        <div class="zoomInNotification" style:display="{Binding showCameraNotification Converter=boolToDisplay}" data-tag="zoomInNotification">            <TextBlock Text="{Binding cameraNotification}" />        <\/div>    <\/div><\/div>',tr='<div class="trafficLegend" data-tag="trafficLegend">    <div class="tlGroup">        <div class="tlLegend">            <span class="tlSlow" data-tag="tlSlow"><TextBlock Text="{StaticBinding resources.L_TrafficLegendsSlow}" /><\/span>            <span class="tlFast" data-tag="tlFast"><TextBlock Text="{StaticBinding resources.L_TrafficLegendsFast}" /><\/span>            <div class="tlKey" data-tag="tlKey"><\/div>        <\/div>    <\/div><\/div>',ir='<div class="infoboxOverlay trafficMiniInfobox">    <p>        <span><TextBlock Text="{Binding primitive.entity.trafficDescription}" /><\/span>    <\/p>    <p>        <span><TextBlock Text="{StaticBinding resources.L_TrafficPopupStartTime_Text}" /><\/span>        <span><TextBlock Text="{Binding primitive.entity.start}" /><\/span>    <\/p>    <p>        <span><TextBlock Text="{StaticBinding resources.L_TrafficPopupEstEndTime_Text}" /><\/span>        <span><TextBlock Text="{Binding primitive.entity.end}" /><\/span>    <\/p><\/div>',rr='<div id="{Binding primitive.entity.id}" class="infoboxOverlay trafficInfoboxOverlay">\t<a href="#" class="dialogClose closeIcon" data-tag="Infobox.Close" event:click="onCloseClick" title="{StaticBinding resources.L_NavBarCloseRadialMenuToolTip_Text}" role="button" ><\/a>\t<div class="infoboxTitle">\t\t<TextBlock Text="{Binding primitive.entity.title}" />\t<\/div>\t<div class="trafficInfo">\t\t<p>\t\t\t<span><TextBlock Text="{StaticBinding resources.L_TrafficPopupSeverity_Text}" /><\/span>\t\t\t<span><TextBlock Text="{Binding primitive.entity.severity}" /><\/span>\t\t<\/p>\t\t<p>\t\t\t<span><TextBlock Text="{StaticBinding resources.L_TrafficPopupDescription_Text}" /><\/span>\t\t\t<span><TextBlock Text="{Binding primitive.entity.trafficDescription}" /><\/span>\t\t<\/p>\t\t<p>\t\t\t<span><TextBlock Text="{StaticBinding resources.L_TrafficPopupStartTime_Text}" /><\/span>\t\t\t<span><TextBlock Text="{Binding primitive.entity.start}" /><\/span>\t\t<\/p>\t\t<p>\t\t\t<span><TextBlock Text="{StaticBinding resources.L_TrafficPopupEstEndTime_Text}" /><\/span>\t\t\t<span><TextBlock Text="{Binding primitive.entity.end}" /><\/span>\t\t<\/p>\t<\/div><\/div>',v=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),et=function(n){function t(i){var r=n.call(this,i.description,null)||this;return r.id="TCAM"+t._cameraId++,r.trafficDescription=i.description,r.cameraImageUrl=i.images&&i.images.length&&i.images[0].imageUrl,r.collisionBehavior=2,r}return v(t,n),t._cameraId=1,t}(bt),dt=function(){function i(r,u,f){r&&(this.imageUrl=i.getCameraImageUrl(r,u,f),this.altImageText=n.L_TrafficCurrentCameraImage_Text.replace("{0}",r.description),this.description=r.description,this.copyright=r.copyright,this.rootClassName="bm_trfcCamWrapper"+(t.cameraAnimationEnabled?" camAnimation":""))}return i.getCameraImageUrl=function(n,i,r){var e=n.images&&n.images.length>0?n.images[0]:null,u=t.cameraUrlFormat.replace("{imageUrl}",e?e.imageUrl+(r?"&routeCamera=1":""):"").replace("{credentials}",i).replace("{cmnPltParam}",h.platformCommonParam),f="&setfeatures=",o=f+"gifcameras",s=u.indexOf(f);return s===-1?u+=o:u=u.replace(f,o+","),u},i}(),ur=function(n){function t(t){var i=n.call(this)||this;return i.type=ft.trafficFlipTask,i._controlTemplateFactory=t,i.displayState={colorIndex:6,groupName:"Traffic"},i}return v(t,n),t.prototype.activate=function(i,r){var u,f;r&&(this._taskState=r,u=r.incident,u&&u.type===12&&(this._taskState.location=new w(u.point.coordinates[0],u.point.coordinates[1]),this._taskState.description=u.description));this.setTitle(this._taskState.incident.description);n.prototype.activate.call(this,i,r);l.trafficTaskId=this.id;f=this._viewModel=new tt(this._controlTemplateFactory,this._taskState.incident,i);c.selectedPin||(c.selectedPin=new d(this._taskState.incident),c.selectedPin.updatePinIcon(!0));f.pin=c.selectedPin;this.addControl(f.getControl());t.trafficTaskId=this.id;this._taskState.incident.type===12&&(p.saveIncident(this._taskState.incident),l.mostRecentCameras.push(f));this.setPercentLoaded(1)},t.close=function(){var n={action:"remove",id:t.trafficTaskId};nt.invokeHandler(g.taskDataHandlerKey,n)},t.prototype.deactivate=function(){var t=c.selectedPin;t&&this._viewModel.incidentData&&this._viewModel.incidentData.incidentId===t.incident.incidentId&&(t.updatePinIcon(!1),c.selectedPin=null);n.prototype.deactivate.call(this)},t.prototype.processCallback=function(){},t.prototype.serialize=function(){return this._taskState},t.prototype.setDisplayState=function(i){n.prototype.setDisplayState.call(this,i);t.trafficTaskId=this.id},t.prototype.getCardIconInfo=function(){return{iconClass:"trfkTsk"}},t.prototype.isSharable=function(){return!1},t.prototype.hasDefaultFocusElement=function(){return!0},t}(st),fr=function(n){function t(t,i,r,u,f,e,o,s,h,c,l,a){a===void 0&&(a=256);var v=n.call(this,t,i,r,u,f,e,o,s,h,c,l,a)||this;return v._disposables.push(v.mapTypeChanged=new rt),t&&(v._disposables.push(v._map.mapTypeChanged.add(function(n){return v._onMapTypeChanged(n)})),t.getMapType().id===k.roadDark&&(v.addDarkStyleToUrl(),v.tileUrlTemplateChanged.invoke(v))),v}return v(t,n),t.prototype._onMapTypeChanged=function(n){n&&(n.oldMapTypeId===k.roadDark||n.newMapTypeId===k.roadDark)&&(n.newMapTypeId===k.roadDark?this.addDarkStyleToUrl():this.removeDarkStyleFromUrl(),this.tileUrlTemplateChanged.invoke(this))},t.prototype.addDarkStyleToUrl=function(){typeof this._tileUrlTemplate=="string"&&this._tileUrlTemplate.indexOf(t.CSTL_DARK_TRAFFIC)===-1&&(this._tileUrlTemplate+=t.CSTL_DARK_TRAFFIC)},t.prototype.removeDarkStyleFromUrl=function(){typeof this._tileUrlTemplate=="string"&&(this._tileUrlTemplate=this._tileUrlTemplate.replace(t.CSTL_DARK_TRAFFIC,""))},t.CSTL_DARK_TRAFFIC="&cstl=vbd",t}(vi),c=function(){function r(i,r,u,f){var o=this,e;this._map=i;this._perfLog=u;this._layer=new pi("TrafficIncidents_"+hi.getUniqueId(),this,new ri(i),t.incidentsLayerZIndex);this._layer.setRenderTarget(1);this.inflateRegionOnDataFetch=!0;this._refreshInterval=t.incidentsLayerRefreshInterval;this._incidentPins={};this._incidentExpirationTimes={};this.invalidated=new rt;this.resources=n;this.spatialIndex=new ai(2);this._trafficLayer=f;this._controlTemplateFactory=r;this._cameraOverlay=this._constructOverlay(r,ki);this._primitiveOverlay=this._constructOverlay(r,rr);this._primitiveMiniOverlay=this._constructOverlay(r,ir);this._cameraMiniOverlay=this._constructOverlay(r,li);this._infoboxOptions={showCloseButton:!1,zIndex:1006,showPointer:!1,visible:!0,htmlContent:null,location:null,autoAlignment:!0};e=[];e.push(this._layer.primitiveTapped.add(function(n){o._onPrimitiveTapped(n)}));e.push(this._layer.primitiveHoverStarted.add(function(n){o._onPrimitiveHoverChanged(n,!0)}));e.push(this._layer.primitiveHoverStopped.add(function(n){o._onPrimitiveHoverChanged(n,!1)}));this._layer.overlayEvent=0;this._disposables=e}return r.prototype._constructOverlay=function(n,t){return{overlayTemplate:n({templateText:t,staticResources:this}),overlayAnchor:new ii(-10,-10)}},r.prototype._showAndLogIncident=function(n){if(n){var t=b.getInstance();t.initialize(this._map,this._controlTemplateFactory);t.show(n,!0);this._logTrafficInstrumentation(n.incident,b.isCamera(n)?2:1)}},r.prototype._onPrimitiveHoverChanged=function(n,i){var r=n&&n.primitive,e,u,f;i?!h.isMapsVertical||r.entity instanceof et?(this._overlayPrimitive&&ut.hideOverlay(this._map,this._overlayPrimitive),t.trafficCameraV2Enabled||t.trafficIncidentV2Enabled?this._showAndLogIncident(r):(e=r.entity instanceof et?this._cameraMiniOverlay:this._primitiveMiniOverlay,ut.showOverlay(this._map,e,r)),this._overlayPrimitive=r):(u=r.entity,f=new w(u.point.coordinates[0],u.point.coordinates[1]),this._infoboxOptions.offset=new kt(10,10),this._infoboxOptions.location=f,this._infoboxOptions.htmlContent=this._getInfoBoxHtmlContent(u),t.trafficIncidentV2Enabled?this._showAndLogIncident(r):this._infobox?this._infobox.setOptions(this._infoboxOptions):(this._infobox=new si(f,this._infoboxOptions),this._infobox.setMap(this._map))):(this._infobox&&this._infobox.getVisible()&&(this._infobox.preventAutoClose||this._infobox.setOptions({visible:!1,closeDelayTime:800})),this._overlayPrimitive&&(ut.hideOverlay(this._map,r),this._overlayPrimitive=null),(t.trafficCameraV2Enabled||t.trafficIncidentV2Enabled)&&b.getInstance().hide(!0))},r.prototype._logTrafficInstrumentation=function(n,t,i){var u=t===2||t===3?i?e.CAMCLK:e.CAMHVR:i?e.INCCLK:e.INCHVR,r={};r.IUT=t;r.Z=o.getMercatorZoomLevel(this._map);t===1&&(r.ST=n.severity,r.IT=n.type,r.IC=n.roadClosed,r.IID=n.incidentId);y.logInstrumentationEvent(u,r)},r.prototype._onPrimitiveTapped=function(n){var l,r,c,s,a,u;(f._isLargeMapShownOnSerp()||h.isMapsVertical)&&(l=n.primitive,r=l,this._overlayPrimitive&&(ut.hideOverlay(this._map,this._overlayPrimitive),this._overlayPrimitive=null),s=r.incident,s.type===12?(c=2,a=this._cameraOverlay):(c=1,a=this._primitiveOverlay),this._overlayPrimitive&&i.PrimitiveOverlayHelper.hideOverlay(this._map,this._overlayPrimitive),this._overlayPrimitive=null,r.select(!0),this._logTrafficInstrumentation(r.incident,b.isCamera(r)?2:1,!0),t.trafficCameraV2Enabled&&this._trafficLayer&&this._trafficLayer.updateRecentCameras&&r.incident&&r.incident.type===12&&this._trafficLayer.updateRecentCameras.invoke(r.incident),u={},u.IUT=c,u.Z=o.getMercatorZoomLevel(this._map),u.ST=s.severity,u.IT=s.type,u.IC=s.roadClosed,u.IID=s.incidentId,y.logInstrumentationEvent(e.ID,u))},r.prototype.onCloseClick=function(n){n.preventDefault();i.PrimitiveOverlayHelper.hideOverlay(this._map,this._overlayPrimitive);this._overlayPrimitive=null},r.prototype.show=function(){var n=this._map.getLayers();n.indexOf(this._layer)<0&&n.insert(this._layer)},r.prototype.hide=function(){this._overlayPrimitive&&i.PrimitiveOverlayHelper.hideOverlay(this._map,this._overlayPrimitive);this._overlayPrimitive=null;r.selectedPin&&r.selectedPin.updatePinIcon(!1);r.selectedPin=null;this._infobox&&(this._infobox.setOptions({visible:!1}),this._infobox.preventAutoClose=!1);this._map.getLayers().remove(this._layer)},r.prototype.toggleCameras=function(){this._hideCameras=!this._hideCameras;this._incidentExpirationTimes={};this._map.getLayers().remove(this._layer);this._map.getLayers().insert(this._layer);y.logInstrumentationEvent(e.TC,{CTO:!this._hideCameras})},r.prototype.getCamerasHidden=function(){return this._hideCameras},r.prototype.getPrimitives=function(n,i){var r=o.getMercatorZoomLevel(this._map);r>=t.minZoomLevelToShowIncidents?this._updateTraffic(n,i,r):i({primitives:[]})},r.prototype.getDataUniquenessKey=function(n){var i=at.fromRegionId(n),t=this._getBoundingBoxKey(i),r=this._incidentExpirationTimes[t];return t+"_"+r},r.prototype._updateTraffic=function(n,i,r){var u=this,s=this._getSeverityFilters(),e=at.fromRegionId(n),f=this._getBoundingBoxKey(e),o;if(this._isIncidentFileExpired(f)){if(o=this._getTrafficIncludeItemsParam(r),!o)return i({primitives:[]});it.instance.authenticateClientAndRetrieveSessionId(function(n){var c=t.incidentsUrlFormat.replace("{bounds}",f).replace("{sev}",s).replace("{credentials}",n),h;c+=o;u._perfLog&&(h=null,h=u._perfLog.start("T_IR"));yt.downloadJsonp(c,"trfinc",function(n,t){return u._processIncidents(n,t,r,e)},function(n){return u._processErrors(n)},null,!1,{key:f,callback:i,state:h},3)})}else this._addIncidentPins(f,i,r,e)},r.prototype._getTrafficIncludeItemsParam=function(n){var i=[],r=this._map.getMapOptions().trafficOptions;return(f._isLargeMapShownOnSerp()||h.isMapsVertical||r&&r.camerasVisible)&&n>t.minZoomForAllCameras&&!this._hideCameras&&i.push("cameras"),r&&r.incidentsVisible===!1||i.push("incidents"),i.length&&"&includeItems="+i.join("|")},r.prototype._processIncidents=function(n,t,i,r){var s=t.state,f,e,o,u,h;for(s&&s.end(),f=t.key,this._incidentExpirationTimes[f]=Date.now()+this._refreshInterval,e=n.resourceSets&&n.resourceSets.length>0&&n.resourceSets[0].resources,o=[],u=0,h=e.length;u<h;u++)o[u]=new d(e[u]);this._incidentPins[f]=o;this._addIncidentPins(f,t.callback,i,r)},r.prototype._processErrors=function(n){var t=n.state;t&&t.end()},r.prototype._addIncidentPins=function(n,i,r,u){var o=this._incidentPins[n],h=[],l,c,e,f;if(o){for(l=o.length,e=0;e<l;e++)f=o[e],c=s.findExistingRecentCamera(f.incident),c>=0&&(f=s.recentCameraVMs[c].pin),this._shouldShowIncident(f.incident,r)&&(f.layer=this._layer,h.push(f));if(r<=t.minZoomForAllCameras&&!this._hideCameras)for(e=0;e<s.recentCameraVMs.length;e++)f=s.recentCameraVMs[e].pin,f&&u.contains(f.getLocation())&&(f.layer=this._layer,h.push(f));i({primitives:h})}},r.prototype._shouldShowIncident=function(n,i){var r=!0;switch(n.type){case 12:r=!0;break;case 2:r=!1;break;case 4:r=n.severity!=1;break;case 11:r=n.severity>2}return r&&(i<=9&&n.severity!==4?r=!1:i<=10&&(n.severity===1||n.severity===2)?r=!1:i<=t.minZoomForAllCameras&&n.severity===0?r=!1:i<=12&&n.severity===1&&(r=!1)),r},r.prototype._getSeverityFilters=function(){var n="",t=o.getMercatorZoomLevel(this._map);return t<=9?n="4":t<=10?n="3,4":t<=12&&(n="0,2,3,4"),n},r.prototype._isIncidentFileExpired=function(n){var t=this._incidentExpirationTimes[n];return!t||Date.now()>t},r.prototype._getBoundingBoxKey=function(n){return[n.getSouth(),n.getWest(),n.getNorth(),n.getEast()].join(",")},r.prototype._getInfoBoxHtmlContent=function(n){return'<div class="trafficInfobox" data-tag="trafficInfobox"><div class="bm_ib_title" data-tag="trafficInfoBoxTitle"><span>'+n.trafficDescription+'<\/span><\/div><div class="bm_ib_metadata_noImg" data-tag="trafficInfoboxData"><span>'+this.resources.L_TrafficPopupStartTime_Text+"<\/span> <span>"+n.start+'<\/span><\/div><div class="bm_ib_metadata_noImg" data-tag="trafficInfoboxData"><span>'+this.resources.L_TrafficPopupEstEndTime_Text+"<\/span><span>"+n.end+"<\/span><\/div><\/div>"},r.prototype.dispose=function(){this.hide();f._clearDisposables(this._disposables)},r._mouseoverTimeout=800,r}(),b=function(){function i(){this._animationGifWidth=320;this._animationGifHeight=221}return i.getInstance=function(){return i._instance||(i._instance=new i),i._instance},i.prototype.initialize=function(t,i){var r=this;this._initialized||(this._map=t,this._controlTemplateFactory=i,this._hoverInstatiated=!1,this.resources=n,it.instance.authenticateClientAndRetrieveSessionId(function(n){r._trafficCameraCreds=n}),t.mapTapped.add(function(){return r.hide()}),t.mapTypeChanged.add(function(n){return r._onMapTypeChanged(n)}),this._initialized=!0)},i.prototype.hide=function(n){this._currentCamera&&(!n||n&&this._hoverInstatiated)&&(this._currentCamera.setOptions({visible:!1,closeDelayTime:300}),this._hoverInstatiated=!1)},i.prototype.show=function(n,t,r){var o=this,f,e;this._currentCamera&&this.hide();n&&n.incident&&(this._hoverInstatiated=t,f={showCloseButton:!1,zIndex:1006,showPointer:!0,visible:!0,htmlContent:null,location:null,autoAlignment:!0},f.htmlContent=this._getHtmlContentForIncident(n.incident,i.isCamera(n),r),f.visible=!0,f.location=new Microsoft.Maps.Location(n.geometry.y,n.geometry.x),f.offset=new kt(6,6),this._currentCamera?this._currentCamera.setOptions(f):(this._currentCamera=new Microsoft.Maps.Infobox(location,f),this._currentCamera.setMap(this._map)),e=u(i._trafficCamClsPrefix+" .cameraClose"),e&&e.length>0&&(e[0].onclick=function(n){o._onCloseClick(n)}),u(""+i._trafficCamClsPrefix).getParent().add_class("bm_trfcCam"),!t&&i.isCamera(n)&&p&&p.saveIncident(n.incident))},i.isCamera=function(n){return n.incident.images&&n.incident.images.length>0},i.prototype.nullToDisplayNone=function(n){return n?"":"none"},i.prototype._onMapTypeChanged=function(n){n.newMapTypeId!==n.oldMapTypeId&&n.newMapTypeId===k.streetside&&this.hide()},i.prototype._onCameraImageLoaded=function(){var n=this,f=function(){var n="loading",t="loaded";u(i._trafficCamClsPrefix+" .trfcLoading").swap_class(n,t);u(i._trafficCamClsPrefix+" .cameraImg").swap_class(n,t)},e=u(".cameraImg")[0],r;t.cameraAnimationEnabled&&e?(this._animationGif&&this._animationGif.dispose(),r=new SuperGif({gif:e,draw_while_loading:!1,auto_play:!!t.cameraAnimationAutoPlay,c_w:this._animationGifWidth,c_h:this._animationGifHeight,onFrame:function(t,i){var r=t/(i-1);n._setAnimationProgressUI(r)}}),r.load(function(){if(n._animationGif===r){var e=n._animationGif.get_length();e>1&&(n._animationGif.move_to(e-1),u(i._trafficCamClsPrefix+" ."+(t.cameraAnimationAutoPlay?"trfcPauseBtn":"trfcPlayBtn")).add_class(i._camBtnActiveCls),u(i._trafficCamClsPrefix+" .trfCamCtrl").set_style({display:"flex"}),n._setUpAnimationHandlers());f()}},f),this._animationGif=r):f()},i.prototype._onCloseClick=function(){this.hide()},i.prototype._setUpAnimationHandlers=function(){var n=this,t=u(i._trafficCamClsPrefix+" .trfcPlayPause");t.length&&(t[0].onclick=function(){n._playOrPauseCameraAnimation(!(n._animationGif&&n._animationGif.get_playing()),!0)});this._setUpAnimationSliderHandlers()},i.prototype._setUpAnimationSliderHandlers=function(){var n=this,o=u(i._trafficCamClsPrefix+" .trfCamCtrl"),s=u(i._trafficCamClsPrefix+" .trfcProgressSlider");if(o.length&&s.length){var r=o[0],h=s[0],t=!1,c=0,l=0,p=36,a=254,v=function(t,i){var o=f._clamp(t.pageX-c+l,0,a),s=n._animationGif.get_length(),r=Math.max(s-1,1),u=o/a,e=i?Math.round(u*r)/r:u;n._setAnimationProgressUI(e);i&&n._animationGif.move_to(e*r)},y=function(i){t&&n._animationGif&&(t=!1,v(i,!0),n._logCameraAnimationInteractions(e.CAMDRAG))};h.onmousedown=function(i){n._animationGif&&(n._playOrPauseCameraAnimation(!1,!1),t=!0,l=h.offsetLeft-p,c=i.pageX)};r.onmousemove=function(i){t&&n._animationGif&&v(i,!1)};r.onmouseup=function(n){y(n)};r.onmouseleave=function(n){y(n)}}},i.prototype._setAnimationProgressUI=function(n){var t=100*n;u(i._trafficCamClsPrefix+" .trfcProgressBarFront").set_style({width:t+"%"});u(i._trafficCamClsPrefix+" .trfcProgressSlider").set_style({marginLeft:"calc(-8px + "+t+"%)"})},i.prototype._playOrPauseCameraAnimation=function(n,t){if(this._animationGif){var o=u(i._trafficCamClsPrefix+" .trfcPlayBtn"),s=u(i._trafficCamClsPrefix+" .trfcPauseBtn"),r=i._camBtnActiveCls,f=null;n?(o.remove_class(r),s.add_class(r),this._animationGif.play(),f=e.CAMPLAY):(s.remove_class(r),o.add_class(r),this._animationGif.pause(),f=e.CAMPAUSE);t&&this._logCameraAnimationInteractions(f)}},i.prototype._getHtmlContentForIncident=function(n,t,i){var r=this,f="",e={severityTypeToClass:function(n){return tt.ConvertSeverityTypeToClass(n)},nullToDisplayNone:function(n){return r.nullToDisplayNone(n)},onCameraImageLoad:function(){r._onCameraImageLoaded()},onCameraCloseClick:function(n){r._onCloseClick(n)},resources:this.resources};if(n){var o=t?di:a.IncidentPopupTemplate,s=t?new dt(n,this._trafficCameraCreds,i):new tt(this._controlTemplateFactory,n,this._map),h=new ct(o,e),u=h.applyDataTemplate(s);u&&u.length>0&&(f=u[0].outerHTML)}return f},i.prototype._logCameraAnimationInteractions=function(n){var t=this._animationGif&&this._animationGif.get_length();n&&t&&y.logInstrumentationEvent(n,{L:t})},i._trafficCamClsPrefix=".MicrosoftMap .bm_trfcCamWrapper",i._camBtnActiveCls="active",i}(),e;(function(n){n[n.A=1]="A";n[n.D=2]="D";n[n.ID=3]="ID";n[n.IH=4]="IH";n[n.ML=5]="ML";n[n.TC=6]="TC";n[n.TCF=7]="TCF";n[n.CAMCLK=8]="CAMCLK";n[n.CAMHVR=9]="CAMHVR";n[n.INCCLK=10]="INCCLK";n[n.INCHVR=11]="INCHVR";n[n.CAMPLAY=12]="CAMPLAY";n[n.CAMPAUSE=13]="CAMPAUSE";n[n.CAMDRAG=14]="CAMDRAG"})(e||(e={}));var y=function(){function n(){}return n.logInstrumentationEvent=function(t,i){var r={logData:{feature:n.featureName,action:e[t],data:i}};nt.invokeHandler(g.instrumentationDataHandlerKey,r)},n.callMapSnRInstrumentation=function(){nt.invokeHandler(g.callServerInstrumentationDataHandlerKey,{logData:{feature:"trfc",data:"traffic"}})},n.featureName="T",n}(),er=function(n){function i(i,r,u){var f=this,e={},o;return f=n.call(this,e)||this,e.defineProperty("isShowing",null,null,{defaultValue:!1}),f._map=i,f._controlTemplateFactory=r,f._perfLog=u,f.updateRecentCameras=new rt,o=f._map.getMapOptions(),o.trafficOptions.legendVisible&&f._addTrafficLegend(),f._trafficLayerOpacity=f._map.getConfig().liteMode?t.defaultTrafficLayerOpacityLiteMode:t.defaultTrafficLayerOpacity,f._disposables=[],f._disposables.push(i.mapTypeChanged.add(function(n){n.newMapTypeId===k.birdseye?(f._wasTrafficShowing=f.getIsShowing(),f._wasTrafficShowing&&f.toggle()):n.oldMapTypeId===k.birdseye&&f._wasTrafficShowing&&f.toggle()})),f}return v(i,n),i.prototype.getTrafficLayer=function(){return this.getIsShowing()?this._trafficMapLayer:null},i.prototype.show=function(n){var i,r,t;this.getIsShowing()||(this.setIsShowing(!0),this._perfLog&&(i=this._perfLog.start("T_LD"),r=this._map.getFrameManager(),i&&r&&r.frameRendered.addOne(function(){i.end()})),!l.isCardShowing&&h.isMapsVertical&&(t={},t.type=ft.trafficTask,t.id=l.trafficTaskId,nt.invokeHandler(g.taskDataHandlerKey,t),l.isCardShowing=!0),this.showTrafficMapLayer(),this.showIncidentsLayer(),y.logInstrumentationEvent(e.A,{EP:n,C:!0}),(n===1||n===3)&&y.callMapSnRInstrumentation(),this.showTrafficLegend())},i.prototype.hide=function(n,t){this.getIsShowing()&&(this.setIsShowing(!1),this._trafficMapLayer&&(this.hideTrafficMapLayer(),h.isSDK||(t?this._map.mapTapped.invoke(t):this._map.mapTapped.invoke()),this.hideIncidentsLayer()),p.commitChanges(),!n&&l.isCardShowing&&h.isMapsVertical&&l.close(),this.hideTrafficLegend(),y.logInstrumentationEvent(e.D,{}))},i.prototype.toggle=function(n){this.getIsShowing()?this.hide():this.show(n)},i.prototype.toggleCameras=function(){this._trafficIncidentLayer&&this._trafficIncidentLayer.toggleCameras()},i.prototype.getCamerasHidden=function(){return this._trafficIncidentLayer&&this._trafficIncidentLayer.getCamerasHidden()},i.prototype.showTrafficLegend=function(){this._trafficLegendControl&&this._map.getMapOptions().trafficOptions.legendVisible&&this._trafficLegendControl.setVisible(!0)},i.prototype.hideTrafficLegend=function(){this._trafficLegendControl&&this._trafficLegendControl.setVisible(!1)},i.prototype.hideIncidentsLayer=function(){this._trafficIncidentLayer&&this._trafficIncidentLayer.hide()},i.prototype.showIncidentsLayer=function(){var n=this._map.getMapOptions().trafficOptions||{};(n.incidentsVisible||n.camerasVisible)&&(this._trafficIncidentLayer||this.createTrafficIncidentsLayer(),this._trafficIncidentLayer&&this._trafficIncidentLayer.show())},i.prototype.hideTrafficMapLayer=function(){var n=this._map.getLayers();this._trafficMapLayer&&n&&n.indexOf(this._trafficMapLayer)>=0&&this._map.getLayers().remove(this._trafficMapLayer)},i.prototype.showTrafficMapLayer=function(){this._map.getMapOptions().trafficOptions.flowVisible&&(this._trafficMapLayer||this.createTrafficMapLayer(),this._trafficMapLayer&&this._map.getLayers().indexOf(this._trafficMapLayer)<0&&this._map.getLayers().insert(this._trafficMapLayer))},i.prototype.setOpacity=function(n){this._trafficLayerOpacity!=n&&(this._trafficLayerOpacity=n,this._trafficMapLayer&&this._trafficMapLayer.setOpacity(n))},i.prototype.dispose=function(){if(this.hideTrafficMapLayer(),n.prototype.dispose.call(this),f._clearDisposables(this._disposables),this._trafficIncidentLayer&&this._trafficIncidentLayer.dispose(),this._trafficIncidentLayer=null,this._trafficMapLayer&&this._trafficMapLayer.dispose(),this._trafficMapLayer=null,this._trafficLegendControl&&this._trafficLegendControl.dispose(),this._trafficLegendControl=null,this._map&&this._trafficLegendOverlay){var t=this._map.getOverlays();t&&t.remove(this._trafficLegendOverlay)}this._trafficLegendOverlay=null;this._perfLog=null},i.prototype._addTrafficLegend=function(){var n=this;this._trafficLegendControl=new gt;this.getIsShowing()||this.hideTrafficLegend();this._trafficLegendOverlay=new ni(this._trafficLegendControl);this._map.getOverlayManager().then(function(){n._map.getOverlays().insert(n._trafficLegendOverlay)})},i.prototype.createTrafficMapLayer=function(){var n=this;this._trafficMapLayer=new fi("Microsoft.Maps.Traffic",t.trafficLayerZIndex,this._trafficLayerOpacity,!1,!0,2,t.trafficTileCacheDuration,this._map.getMapOptions().enableCORS,!0,"TrafficLayer");it.instance.authenticateClientAndRetrieveSessionId(function(i){var r=t.trafficUriFormat.replace("{credentials}",i);n._trafficMapLayer.addScene(10,new fr(n._map,new oi(wi.toLocation(new w(0,0),0,!0)),yi.instance,"TrafficLayerV2",r,"",null),0)})},i.prototype.createTrafficIncidentsLayer=function(){this._trafficIncidentLayer=new c(this._map,this._controlTemplateFactory,this._perfLog,this)},i}(pt),gt=function(t){function i(){var i=t.call(this)||this;return i.setTemplate(new ct(tr,{resources:n})),i}return v(i,t),i}(ui),ni=function(n){function t(t){var i=this;return t&&(i=n.call(this,t.getRootElement(),null,null)||this),i}return v(t,n),t}(ci),p=function(){function n(){}return n.saveIncident=function(t){var r,i,u;if(n.getIncidents(),n.recentlyUsed){for(r=-1,i=0;i<n.recentlyUsed.length;i++)if(u=n.recentlyUsed[i],u.description===t.description){r=i;break}r!==-1?n.recentlyUsed.splice(r,1):n.recentlyUsed.length===n.Max_limit&&n.recentlyUsed.splice(0,1);n.recentlyUsed.push(t)}n.commitChanges()},n.commitChanges=function(){var r,i,t,u;if(n.recentlyUsed){for(r="",i=0;i<n.recentlyUsed.length;i++)t=n.recentlyUsed[i],t.usedCount||(t.usedCount=0),u=n.SerializedCameraFormat.replace("{lat}",t.point.coordinates[0].toString()).replace("{long}",t.point.coordinates[1].toString()).replace("{description}",t.description).replace("{usage}",t.usedCount.toString()),i!==n.recentlyUsed.length-1&&(u+="$"),r+=u;lt.setItem(n.TrafficLocalStorageKey,r)}},n.getIncidents=function(){var u,f,r,i,t;if(!n.recentlyUsed&&(u=lt.getItem(n.TrafficLocalStorageKey),n.recentlyUsed=[],u))for(f=u.split("$"),r=0;r<f.length;r++)i=f[r].split("|"),t={},t.point={coordinates:[parseFloat(i[0]),parseFloat(i[1])]},t.description=i[2],t.usedCount=parseInt(i[3]),t.recentlyUsed=!0,n.recentlyUsed.push(t);return n.recentlyUsed},n.removeIncident=function(t){var i,r;if(n.recentlyUsed){for(i=0;i<n.recentlyUsed.length;i++)if(r=n.recentlyUsed[i],r.description===t.description){n.recentlyUsed.splice(i,1);break}n.commitChanges()}},n.removeAllIncidents=function(){n.recentlyUsed&&(n.recentlyUsed.splice(0,n.recentlyUsed.length),n.commitChanges())},n.TrafficLocalStorageKey="TrafficCameras",n.Max_limit=10,n.SerializedCameraFormat="{lat}|{long}|{description}|{usage}",n}(),or=function(t){function i(r){var u=t.call(this,i._getIncidentTypeTitle(r.type),null)||this;return u.id=r.incidentId,u.point=r.point,u.trafficDescription=r.description,u.end=r.isEndTimeBackfilled?n.L_IncidentEndTimeUnknown_Text:u._getFormattedDateTime(r.end),u.roadClosed=r.roadClosed,u.severity=u._getSeverityTitle(r.severity),u.start=u._getFormattedDateTime(r.start),u.toPoint=r.toPoint,u.incidentType=r.type,u.verified=r.verified,u}return v(i,t),i._getIncidentTypeTitle=function(t){switch(t){case 9:return n.L_TrafficScheduledConstruction_Text;case 6:return n.L_TrafficOtherNews_Text;case 2:return n.L_TrafficCongestion_Text;case 1:return n.L_TrafficAccident_Text;case 3:return n.L_TrafficDisabledVehicle_Text;case 8:return n.L_TrafficRoadHazard_Text;case 10:return n.L_TrafficUnScheduledContruction_Text;case 7:return n.L_TrafficPlannedEvent_Text;case 4:return n.L_TrafficMassTransit_Text;case 11:return n.L_TrafficWeather_Text;case 5:return n.L_TrafficMiscellaneous_Text;default:return""}},i.prototype._getSeverityTitle=function(t){switch(t){case 1:return n.L_TrafficSeverityLowImpact_Text;case 2:return n.L_TrafficSeverityMinor_Text;case 3:return n.L_TrafficSeverityModerate_Text;case 4:return n.L_TrafficSeveritySerious_Text;default:return""}},i.prototype._getFormattedDateTime=function(t){var u="",e,i,r;return t&&(e=/\(([\d]+)\)/,i=e.exec(t),i&&i.length>1&&(r=new Date(parseInt(i[1],10)),u=f._formatString(n.L_TrafficDateTimeFormat,f._formatShortDateString(r),f._formatTimeString(r)))),u},i}(bt),d=function(){function i(t,i,r){this.geometryType=1;this.crs=ei.instance;this.geometry={x:0,y:0,bounds:null};this.geometryType=1;this.layer=i;this._location=new w(t.point.coordinates[0],t.point.coordinates[1]);this._updatePointGeometry(this._location);this.incident=t;this._isDirectionsTrafficPin=r;this.resources=n;this.incident.type===12?(this.entity=new et(t),this.entity.collisionBehavior=r?0:2):this.entity=new or(t);this.entity.poiType=9;this.bucket=this.incident.type===12?"1441":this.incident.severity===4?"1443":this.incident.severity===3?"1442":"344";this.updatePinIcon(!1)}return i.prototype.updatePinIcon=function(n){this._isDirectionsTrafficPin&&(this.entity.collisionBehavior=n?2:0);this.viewState=n?2:0;this.zIndex=n?1:0;this.entity.changed.invoke()},i.prototype.isTapEnabled=function(){return!0},i.prototype.isHoverEnabled=function(){return!0},i.prototype.getLocation=function(){return this._location},i.prototype.getTemplate=function(){return this._template},i.prototype.select=function(){var n,i;t.trafficCameraV2Enabled&&this.incident&&this.incident.type===12?b.getInstance().show(this):t.trafficIncidentV2Enabled&&this.incident&&this.incident.type!==12?b.getInstance().show(this):(n={},n.activateOptions={parentId:l.trafficTaskId},n.type=ft.trafficFlipTask,i={},i.incident=this.incident,n.state=i,nt.invokeHandler(g.taskDataHandlerKey,n),c.selectedPin&&c.selectedPin.updatePinIcon(!1),c.selectedPin=this,c.selectedPin.updatePinIcon(!0))},i.prototype._updatePointGeometry=function(n){var t=n.latitude,i=n.longitude;this.geometry.x=i;this.geometry.y=t;this.geometry.bounds=[t,i,t,i]},i}(),s=function(i){function r(u,e,s,c){var l=this,a={};return l=i.call(this,a,u,nr)||this,l._map=e,l.resources=n,l._controlTemplateFactory=u,l.modules=new wt,l._maxRecentlyUsedCamerasPreviews=4,a.defineProperty("showCameraNotification",null,null,{defaultValue:!1}),a.defineProperty("hideCamera",function(){s&&s.invoke()},null,{defaultValue:!1}),a.defineProperty("cameraNotification",null,null,{defaultValue:n.L_TrafficsZoomInNotification}),a.defineProperty("ariaChecked",null,null,{defaultValue:!0}),a.defineProperty("camerasToggleUniqueId"),l.setShowCameraNotification(o.getMercatorZoomLevel(e)<=t.minZoomForAllCameras),l.setCamerasToggleUniqueId("camToggle"+c),(f._isLargeMapShownOnSerp()||h.isMapsVertical)&&(r.recentCamerasModule=new ot(l._map,l._maxRecentlyUsedCamerasPreviews,n.L_TrafficRecentCamerasTitle),l.modules.insert(r.recentCamerasModule)),l}return v(r,i),r.prototype.initializeRecentCameras=function(){var n,t,i,u;if(f._isLargeMapShownOnSerp()||h.isMapsVertical){if(r.recentCameraVMs=[],n=p.getIncidents(),n&&n.length)for(t=n.length-1;t>=0;t--)i=n[t],i.type=12,u=new tt(this._controlTemplateFactory,i,this._map),u.pin=new d(i),r.recentCameraVMs.push(u);this.updateCameraImages()}},r.prototype.updateRecentCameras=function(){for(var t,n=0;n<l.mostRecentCameras.length;n++)t=r.findExistingRecentCamera(l.mostRecentCameras[n].incidentData),t>=0&&r.recentCameraVMs.splice(t,1),r.recentCameraVMs.unshift(l.mostRecentCameras[n]);r.recentCameraVMs=r.recentCameraVMs.slice(0,p.Max_limit);this.updateCameraImages();l.mostRecentCameras=[]},r.prototype.addCameraToRecentCameras=function(n){var i=r.findExistingRecentCamera(n),t;i>=0&&r.recentCameraVMs.splice(i,1);n.type=12;t=new tt(this._controlTemplateFactory,n,this._map);t.pin=new d(n);r.recentCameraVMs.unshift(t);r.recentCameraVMs=r.recentCameraVMs.slice(0,p.Max_limit);this.updateCameraImages()},r.prototype.updateCameraImages=function(){var i,n,t;if(f._isLargeMapShownOnSerp()||h.isMapsVertical){for(r.recentCamerasModule.collection.clear(),i=[],n=0;n<r.recentCameraVMs.length;n++)t=r.recentCameraVMs[n],t.incidentWithinMap()?r.recentCamerasModule.collection.insert(t):i.push(t);r.recentCamerasModule.collection.insertAll(i)}},r.findExistingRecentCamera=function(n){for(var i,t=0;t<r.recentCameraVMs.length;t++)if(i=r.recentCameraVMs[t].pin&&r.recentCameraVMs[t].pin.incident,i&&n.description&&i.description===n.description)return t;return-1},r.prototype.typeToClass=function(n){return n===12?"bm_moduleItem":"bm_moduleItem notificationItem"},r.prototype.incidentTypeToIconClass=function(n){switch(n){case 9:return"notification construction";case 1:return"notification accident";default:return"notification otherincident"}},r.prototype.cameraTypeToDisplay=function(n){return n===12?"":"none"},r.prototype.errorToImagePaneClass=function(n){return n?"imgErrorPlaceHolder":"imgPreviewPlaceHolder"},r.prototype.incidentTypeToDisplay=function(n){return n!==12?"":"none"},r.prototype.onCamerasKeyUp=function(n){var t=n,i=t.keyCode||t.which;i===13&&this._toggleCameras()},r.prototype.onCamerasClick=function(n){n.stopPropagation();this._toggleCameras()},r.prototype._toggleCameras=function(){this.setHideCamera(!this.getHideCamera());this.updateCameraMessage();var n=u("#cameraToggleInput")[0];n.checked=!this.getHideCamera();this.setAriaChecked(!this.getHideCamera())},r.prototype.isCameraAvailable=function(){for(var n,r=this._map.getFrameManager(),u=r.getFrameData(),i=u.getPrimitives(2,!0),t=0;t<i.length;t++)if(n=i[t],n instanceof d&&n.incident.type===12&&this._map.isLocationInView(n.getLocation()))return!0;return!1},r.prototype.updateCameraMessage=function(i){i===void 0&&(i=!1);var r=this.isCameraAvailable();this.getHideCamera()?this.setShowCameraNotification(!1):o.getMercatorZoomLevel(this._map)<=t.minZoomForAllCameras?(this.setShowCameraNotification(!0),this.setCameraNotification(n.L_TrafficsZoomInNotification)):i&&!r?(this.setShowCameraNotification(!0),this.setCameraNotification(n.L_TrafficsNoCameraNotification)):this.setShowCameraNotification(!1)},r.recentCameraVMs=[],r}(ht),l=function(i){function r(n,u,f){var e=i.call(this)||this;return e.type=ft.trafficTask,e.map=f,e.toggleCameras=new rt,r.controlTemplateFactory=n,e._cameraListenerAdded=!1,e._overlayCloseBtnListenerAdded=!1,(t.trafficCameraV2Enabled||t.trafficIncidentV2Enabled)&&b.getInstance().initialize(f,n),e.displayState={colorIndex:6,groupName:"Traffic"},u.instanceAsync("TrafficLayerV2",function(n){e._trafficLayer=n;e._taskState&&e._trafficLayer.show(3);e._trafficLayer.getCamerasHidden()&&e._trafficLayer.toggleCameras();t.trafficCameraV2Enabled&&e._addRecentCameraListener()}),e.disposables.push(f.viewChanged.add(function(){var n=e.map.getFrameManager();n.frameRendered.addOne(function(){Microsoft.Maps.setTimeout(function(){e._viewModel&&e._viewModel.updateCameraMessage(!0)},0)})})),e.disposables.push(e.toggleCameras.add(function(){e._trafficLayer&&e._trafficLayer.toggleCameras()})),e}return v(r,i),r.prototype.activate=function(u,e){var y=this,l,v,a;r.isCardShowing=!0;this.setTitle(n.L_TrafficTaskTitle_Text);this._taskState=e||{taskTitle:this.getTitle()};i.prototype.activate.call(this,u,e);r.trafficTaskId=this.id;this._viewModel=new s(r.controlTemplateFactory,u,this.toggleCameras,this.id);this.addControl(this._viewModel.getControl());this.map=u;(f._isLargeMapShownOnSerp()||h.isMapsVertical)&&this._viewModel.initializeRecentCameras();this._taskState&&this._trafficLayer&&this._trafficLayer.show(3);this._taskState.description&&this._taskState.location&&(l={},l.point={coordinates:[this._taskState.location.latitude,this._taskState.location.longitude]},l.description=this._taskState.description,l.type=12,v=new d(l),c.selectedPin=v,o.setMapCenter(u,this._taskState.location),v.select());t.trafficCameraV2Enabled&&this._addRecentCameraListener();f._isLargeMapShownOnSerp()&&!this._overlayCloseBtnListenerAdded&&(a=Microsoft.Maps.Internal._Gimme&&Microsoft.Maps.Internal._Gimme(".overlayCloseBtn"),a.length>0&&a[0].addEventListener&&a[0].addEventListener("click",function(n){return y._overlayCloseButtonHandler(n)}));this.setPercentLoaded(1)},r.prototype.deactivate=function(){i.prototype.deactivate.call(this);this._overlayCloseBtnListenerAdded||this._trafficLayer.hide();var n=Microsoft.Maps.Internal._Gimme&&Microsoft.Maps.Internal._Gimme(".overlayCloseBtn");n.length>0&&n[0].removeEventListener&&(this._overlayCloseBtnListenerAdded=!1,n[0].removeEventListener("click",this._overlayCloseButtonHandler))},r.close=function(){r.isCardShowing=!1;var n={action:"remove",id:r.trafficTaskId};nt.invokeHandler(g.taskDataHandlerKey,n)},r.prototype.processCallback=function(){},r.prototype.serialize=function(){return this._taskState},r.prototype.setDisplayState=function(n){i.prototype.setDisplayState.call(this,n);r.trafficTaskId=this.id;n.activationState&&n.prominence&&(this._trafficLayer&&this._trafficLayer.show(3),r.mostRecentCameras&&r.mostRecentCameras.length&&(f._isLargeMapShownOnSerp()||h.isMapsVertical)&&this._viewModel&&this._viewModel.updateRecentCameras());n.prominence===3&&this._trafficLayer.hide(!0)},r.prototype.getCardIconInfo=function(){return{iconClass:"trfkTsk"}},r.prototype.isSharable=function(){return!0},r.prototype.hasDefaultFocusElement=function(){return!1},r.prototype._addRecentCameraListener=function(){var n=this;!this._cameraListenerAdded&&this._trafficLayer&&this._viewModel&&t.trafficCameraV2Enabled&&(this._trafficLayer.updateRecentCameras.add(function(t){n._viewModel.addCameraToRecentCameras(t)}),this._cameraListenerAdded=!0)},r.prototype._overlayCloseButtonHandler=function(n){n&&n.preventDefault&&(n.preventDefault(),n.stopPropagation());this._overlayCloseBtnListenerAdded=!0;this._trafficLayer&&this._trafficLayer.hide(!1,n)},r.mostRecentCameras=[],r}(st),tt=function(i){function r(t,r,u){var f=this,e={},o=r.recentlyUsed||r.type===12?bi:gi;return f=i.call(this,e,t,o)||this,f._map=u,f.resources=n,e.defineProperty("cameraImageUrl"),e.defineProperty("isImageError"),f.setIncident(r),e.defineProperty("show",null,null,{defaultValue:!1}),r.type!==12||r.images||f.getCamera(),f}return v(r,i),r.prototype.setIncident=function(i){var r=this;this.incidentType=i.type;this.incidentData=i;this.pin&&(this.pin.incident=i);i.recentlyUsed||i.images&&i.images.length>0?(this.id=i.incidentId,this.point=i.point,this.incidentTitle=i.description,this.copyright=i.copyright,this.trafficDescription=i.description,this.cameraDirection=i.view,i.images&&i.images.length&&it.instance.authenticateClientAndRetrieveSessionId(function(t){var u=dt.getCameraImageUrl(i,t,!1);u=r.updateUrlInstrumentation(u);r.altDescription=n.L_TrafficPreviewCameraImage_Text.replace("{0}",i.description);r.removeCameraAriaLabel=n.L_TrafficRemoveRecentCameraToolTip_Text.replace("{0}",i.description);r.incidentAriaLabel=n.TrafficCameraAriaLabel.replace("{0}",i.description);r.setCameraImageUrl(u);r.setIsImageError(!1)}),t.showCameraDisclaimer&&(this.disclaimer=n.L_TrafficCameraDisclaimer_Text)):(this.id=i.incidentId,this.point=i.point,this.copyright=i.copyright,this.trafficDescription=i.description,this.end=i.isEndTimeBackfilled?n.L_IncidentEndTimeUnknown_Text:this._getFormattedDateTime(i.end),this.roadClosed=i.roadClosed,this.severityType=i.severity,this.severity=this._getSeverityTitle(i.severity),this.start=this._getFormattedDateTime(i.start),this.toPoint=i.toPoint,this.verified=i.verified,this.incidentTitle=this._getIncidentTypeTitle(i.type))},r.prototype.severityTypeToClass=function(n){return r.ConvertSeverityTypeToClass(n)},r.ConvertSeverityTypeToClass=function(n){switch(n){case 4:return"incidentSeverity high";case 3:return"incidentSeverity moderate";default:return"incidentSeverity mild"}},r.prototype.onImageError=function(){this.setIsImageError(!0);var n={};n.IID=this.incidentData.incidentId;y.logInstrumentationEvent(e.TCF,n)},r.prototype.onBackClick=function(n){n.preventDefault()},r.prototype.onModuleItemClick=function(n){var i,r,h;n.preventDefault();this.pin.select();i={};r=5;var f=this.incidentData.point.coordinates,c=o.getMapBounds(this._map),s=new w(f[0],f[1]);c.contains(s)||(h=Math.max(t.minZoomLevelToShowIncidents,o.getMercatorZoomLevel(this._map)),o.setMapCenter(this._map,s,h));t.trafficCameraV2Enabled||Microsoft.Maps.setTimeout(function(){var t=u(".trfkTsk.titleIcon"),n;t.length>1&&(n=u(t[1]).get_ancestor(1,0)[0],n.focus(),n.style.border="none")},500);i.IUT=r;i.Z=o.getMercatorZoomLevel(this._map);y.logInstrumentationEvent(e.ID,i)},r.prototype.onRemoveRecentCameraClick=function(n){if(n.preventDefault(),ot.removeCamera(this),this._map&&c&&o.getMercatorZoomLevel(this._map)<=t.minZoomForAllCameras){var i=this._map.getFrameManager();i&&i.hackHackSetFrame()}},r.prototype.incidentWithinMap=function(){var n=this.incidentData.point.coordinates,t=o.getMapBounds(this._map);return t.contains(new w(n[0],n[1]))},r.prototype._getCameraDirection=function(t){switch(t){case"N":return n.L_TrafficCameraDirectionNorth_Text;case"S":return n.L_TrafficCameraDirectionSouth_Text;case"E":return n.L_TrafficCameraDirectionEast_Text;case"W":return n.L_TrafficCameraDirectionWest_Text;default:return null}},r.prototype._getIncidentTypeTitle=function(t){if(t)switch(t){case 9:return n.L_TrafficScheduledConstruction_Text;case 6:return n.L_TrafficOtherNews_Text;case 2:return n.L_TrafficCongestion_Text;case 1:return n.L_TrafficAccident_Text;case 3:return n.L_TrafficDisabledVehicle_Text;case 8:return n.L_TrafficRoadHazard_Text;case 10:return n.L_TrafficUnScheduledContruction_Text;case 7:return n.L_TrafficPlannedEvent_Text;case 4:return n.L_TrafficMassTransit_Text;case 11:return n.L_TrafficWeather_Text;case 5:return n.L_TrafficMiscellaneous_Text;default:return""}return""},r.prototype._getSeverityTitle=function(t){switch(t){case 1:return n.L_TrafficSeverityLowImpact_Text;case 2:return n.L_TrafficSeverityMinor_Text;case 3:return n.L_TrafficSeverityModerate_Text;case 4:return n.L_TrafficSeveritySerious_Text;default:return""}},r.prototype._getFormattedDateTime=function(t){var u="",e,i,r;return t&&(e=/\(([\d]+)\)/,i=e.exec(t),i&&i.length>1&&(r=new Date(parseInt(i[1],10)),u=f._formatString(n.L_TrafficDateTimeFormat,f._formatShortDateString(r),f._formatTimeString(r)))),u},r.prototype.getCamera=function(){var i=this,n=this.incidentData,r=vt.getMapLocationFromLocationHeadingAndDistance(new w(n.point.coordinates[0],n.point.coordinates[1]),Math.PI*3/4,5),u=vt.getMapLocationFromLocationHeadingAndDistance(new w(n.point.coordinates[0],n.point.coordinates[1]),Math.PI*7/4,5),f=r.latitude+","+u.longitude+","+u.latitude+","+r.longitude;it.instance.authenticateClientAndRetrieveSessionId(function(n){var r=t.cameraByLocationUrlFormat.replace("{bounds}",f).replace("{credentials}",n);r=i.updateUrlInstrumentation(r);yt.downloadJsonp(r,"trfcam",function(n,t){return i._processCameraDetails(n,t)},function(n){return i._processErrors(n)},null,!1,{})})},r.prototype.updateUrlInstrumentation=function(n){return n},r.prototype._processCameraDetails=function(n){var r=n.resourceSets&&n.resourceSets.length>0&&n.resourceSets[0].resources||[],u=this.incidentData,f=!1,i,t;if(r.length)for(i=0;i<r.length;i++)if(t=r[i],t.description===u.description){t.recentlyUsed=u.recentlyUsed;this.setIncident(t);this.pin&&(this.pin.incident=t);f=!0;break}f||ot.removeCamera(this)},r.prototype._processErrors=function(){},r}(ht),ot=function(i){function r(t,r,u){var f=this,e={};return f=i.call(this,e)||this,f._map=t,f.resources=n,f.collection=new wt,f.collection.changed.add(function(n){f._onCollectionChanged(n)}),e.defineProperty("showModule",null,null,{defaultValue:!1}),e.defineProperty("showMoreLink",null,null,{defaultValue:!1}),e.defineProperty("moreLinkText",null,null,{defaultValue:n.L_TrafficModuleMoreLink}),e.defineProperty("arrowClass",null,null,{defaultValue:"downArrow trafficArrow"}),f.title=u,f._maxItemsPreviews=r,f}return v(r,i),r.prototype.onMoreClick=function(t){var r,u;t.preventDefault();var i=this.getMoreLinkText()===n.L_TrafficModuleMoreLink,f=this.collection.length>this._maxItemsPreviews,o=i?n.L_TrafficModuleLessLink:n.L_TrafficModuleMoreLink,s=i?"upArrow trafficArrow":"downArrow trafficArrow";if(f)for(this.setMoreLinkText(o),this.setArrowClass(s),r=this._maxItemsPreviews;r<this.collection.length;r++)this.collection[r].setShow(i);this.title===n.L_TrafficRecentCamerasTitle&&(u=1);y.logInstrumentationEvent(e.ML,{M:u,ILM:i})},r.prototype._onCollectionChanged=function(){var i,t;if(this.collection.length)for(this.getShowModule()||this.setShowModule(!0),this.setShowMoreLink(this.collection.length>this._maxItemsPreviews),i=this.getMoreLinkText()===n.L_TrafficModuleMoreLink,t=0;t<this.collection.length;t++)this.collection[t].setShow(!(t>=this._maxItemsPreviews&&i));else this.setShowModule(!1)},r.prototype.onRemoveAllRecentCamerasClick=function(n){if(n.preventDefault(),r.removeAllCameras(),o.getMercatorZoomLevel(this._map)<=t.minZoomForAllCameras){var i=this._map.getFrameManager();i&&i.hackHackSetFrame()}},r.removeAllCameras=function(){s.recentCamerasModule.collection.clear();s.recentCameraVMs.splice(0,s.recentCameraVMs.length);p.removeAllIncidents()},r.removeCamera=function(n){var t,i;if(n&&p.removeIncident(n.incidentData),s.recentCameraVMs&&s.recentCamerasModule)for(s.recentCamerasModule.collection.remove(n),t=0;t<s.recentCameraVMs.length;t++)i=s.recentCameraVMs[t],i.id===n.id&&s.recentCameraVMs.splice(t,1)},r}(pt);a.TrafficLegendControl=gt;a.TrafficLegendOverlay=ni;a.TrafficLayerV2=er;a.TrafficTask=l;a.TrafficFlipTask=ur;a.TrafficPinV2=d;a.CameraOverlayEntity=et;a.IncidentViewModel=tt;a.TrafficIncidentPopup=b;a.TrafficLocalStorageHelper=p;a.IncidentPopupTemplate='<div class="bm_trfcIncidentWrapper">    <div data-tag="incidentPopupRoot">        <div>            <div class="incidentTitleRoot">                <div class="incidentTitle" data-tag="incidentTitle">                    <TextBlock Text="{Binding incidentTitle}" />                <\/div>                <p class="{Binding severityType Converter=severityTypeToClass}" data-tag="severity">                    <span>                        <TextBlock Text="{Binding severity}" />                    <\/span>                <\/p>            <\/div>            <div class="incidentDescriptionRoot">                <p class="incidentDescription" data-tag="trafficDescription">                    <TextBlock Text="{Binding trafficDescription}" />                <\/p>                <p class="incidentTime" data-tag="start" style:display="{Binding start Converter=nullToDisplayNone}">                    <span><TextBlock Text="{StaticBinding resources.L_TrafficPopupStartTime_Text}" /><\/span><span><TextBlock Text="{Binding start}" /><\/span>                <\/p>                <p class="incidentTime" data-tag="end" style:display="{Binding end Converter=nullToDisplayNone}">                    <span><TextBlock Text="{StaticBinding resources.L_TrafficPopupEstEndTime_Text}" /><\/span><span><TextBlock Text="{Binding end}" /><\/span>                <\/p>            <\/div>        <\/div>    <\/div><\/div>'}catch(ti){if(i.logger)i.logger.logCriticalError(ti);else throw ti;}}).call(window)