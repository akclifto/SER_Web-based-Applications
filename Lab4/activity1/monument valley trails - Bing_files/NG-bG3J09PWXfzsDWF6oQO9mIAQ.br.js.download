(function(){try{(function(){var n={L_Link_Generating_Text:"Creating the link â€¦",L_Link_GenerationFailed_Text:"There was a problem creating the link. Try again.",L_Permalink_Prompt:"Share this map",L_TaskBar_Label_SearchBox:"Add a search",L_TaskBar_Label_Clear:"Clear Search Term",L_TaskBar_Label_Search:"Search",L_TaskBar_Label_Directions:"Directions",L_TaskBar_Label_Traffic:"Traffic",L_TaskBar_Label_Favorites:"My Places",L_TaskBar_Label_More:"More",L_SearchNearbyTransit:"Nearby Transit",L_SearchNearbyParking:"Parking",L_Permalink_Email_Button_Tooltip:"Email link",L_Print_Submit:"Print",L_PrintPreview:"Print Preview",L_PrintMapAndText:"Map & Text",L_PrintMapOnly:"Map only",L_PrintTextOnly:"Text only",L_PermalinkCopy_Text:"Copy",L_PermalinkEmail_Text:"Email",L_Permalink_Email_Button_Text:"Email",L_PermalinkFacebook_Text:"Facebook",L_PermalinkTwitter_Text:"Twitter",L_Twitter_Tag_Text:"on #BingMaps",L_PermalinkHeaderPrompt_Text:"Share",ShareHeaderTitle:"Select what to share",L_PermalinkLink_Text:"Link",L_PermalinkPrompt_Text:"Select the cards that you would like to share",L_Link_TooManyItemsSelected_Text:"Unable to share. Please unselect some items and try sharing in smaller groupings (5-10 items at a time).",L_Link_EmailTitleManyCards_Text:"Bing Maps session shared with you",L_Link_EmailFooter_Text:"Shared from Bing Maps",L_LengthenButton_Text:"Show full URL",L_ShortenButton_Text:"Shorten",L_EditMapDone_Text:"Done",L_EditMap_Text:"Move or zoom map",L_SlideOutMenu_MapType:"Map",L_SlideOutMenu_MapType_Road:"Road View",L_SlideOutMenu_MapType_Aerial:"Aerial View",L_SlideOutMenu_MapType_Birdseye:"Birds View",L_SlideOutMenu_SeeAllCards:"See all card",L_SlideOutMenu_BingHome:"Bing Home",L_SlideOutMenu_Feedback:"Feedback",L_SlideOutMenu_ExitPreview:"Exit preview",L_PrintNotes:"Notes",L_PrintNotesWatermark:"Type your notes here",L_PermalinkEmbed_Text:"Embed",L_Menu_Exit_Text:"Previous Version",L_Menu_Feedback_Text:"Feedback",L_TaskBar_Label_Print:"Print",L_TaskBar_Label_Embed:"Embed a map",L_TaskBar_Label_Share:"Share",L_Menu_Tips_Text:"Tips",L_TaskBar_Label_Fullscreen:"Full Screen",Taskbar_Label_ExitFullScreen:"Exit Full Screen",TaskBarLogoTitle:"Back to Bing search",BEV2DetailsInstruction:"1. In cards",BEV2Introduction:"New and crisp Bird's Eye imagery is available in many metropolitan areas.",BEV2TransientLensInstruction:"2. Right-click on the map",BEV2WelcomeText:"Bird's Eye has changed",BEV2ImageIntroduction:"There are two ways of viewing the new Bird's Eye.",BEV2TipNote:"Note: Bird's Eye may not be available in your area as outdated imagery is no longer available.",L_CategoryLayerDropdownButton:"All {0}",L_CategoryLayerDropdownTitle:"Show on map",L_CategoryLayer_Schools:"Schools",L_CategoryLayer_Transit:"Transit",L_CategoryLayer_Commutability:"Commute",ShareEmailToolTip:"Send in email",ShareFBToolTip:"Share to Facebook",ShareTwitterToolTip:"Post to Twitter",L_CmtControlTitleText:"Enter your location to see a 15 min commute range.",L_CmtControlAddLocationText:"Add location",L_CmtControlCommuteTime30Text:"30 min",L_CmtControlCommuteTime45Text:"45 min",L_CmtControlCommuteTime60Text:"1 hr",L_CmtControlCommuteTime15Text:"15 min",L_CmtControlCommutePeak_Text:"Peak",L_CmtControlCommuteOffPeak_Text:"Off Peak",L_CmtControlPushpinTitle:"A",L_CmtControlPushpinTwoTitle:"B",L_CmtEditText:"Options",L_CmtDoneText:"Done",L_CmtPlaceHolderText:"Commute to (e.g. work, home, school)",L_CmtTitle:"{time} min commute to {addresses} in {trafficCondition} traffic",L_CmtTooltipTitle:"{time} min drive time",L_CmtTooltipDescription:"click to change address or drag to new location",L_CmtTitleAddresses:"both {addr1} and {addr2}",L_CmtErrorMessage:"Can't retreive boundary, please try again later",ShareClose:"Close",ShareUrlLabel:"Copy URL",L_CategoryUserTip_Header:"Show on map",L_CategoryUserTip_Message1:"We've turned on the map layers you selected",L_CategoryUserTip_Message2:"Pan and Zoom to see more results",L_ZoomInUserTip_Message:"Zoom in or use filters to narrow your search",L_Tooltip_Itinerary_Saved_Text:"Itinerary saved to My Places",L_Tooltip_Rename_Button:"Rename",L_Tooltip_Update_Button:"Update",SearchGhostText:"Search Bing Maps",ViewAllSearches:" View all your searches",L_MoreSearchTip:"Search for more businesses",L_RemoveFromMap:"Remove from map",L_EditYourSearch:"Edit your search",BingMapsLogo:"Bing Maps logo",AddAnotherSearchGhostText:"Add another search",PrintMiniMapAltText:"Mini map",ShareActionsTitle:"Choose where to share",OrSeparatorText:"Or",OverflowActivateSearchText:"Select a search to activate",OverflowClearAllText:"Clear All",ClearSearch:"Clear search",ClearText:"Clear text",CloseMapView:"Close the map view",LocalGuide_Title:"Local Guide",L_TaskBar_Label_LocalGuide:"Local",L_TaskBar_Label_MyContributions:"My Contributions",TaskBar_Banner_New:"*"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("InternalControls",n):window.$MicrosoftMaps8.ResourcesObject=n})();var i=window.$MicrosoftMaps8,r=i.Internal,pi=r.TaskData,pu=i.Anchor,wi=i.GlobalConfig.features.autosuggest,bi=i.CommonControls.AutosuggestViewModel,ki=i.CommonControls.AutosuggestV2,di=r._BaseMapTemplateSelector,wu=r.BaseTask,et=r.BaseTaskViewModel,bu=i.BitmapImageTemplate,ni=pi.CollectionActions,ot=r.Control,rt=r.ControlTemplate,o=i.DataHandlerKeys,ti=r._Debug,ku=i.DefaultTemplateSelector,tt=i.GlobalConfig.features.directions,du=i.CommonControls.DropdownItem,l=r._EntryPoints,v=r._FeatureNames,gu=i.GlobalConfig.features.feedback,nf=i.FiltersBarModuleViewModel,tf=i.FiltersBar,rf=i.FiltersBarItem,uf=i.FiltersBarItemData,ff=r.GeolocationProvider,n=r._Gimme,c=i.GlobalConfig,s=i.GlobalDataEventHandler,h=r._Helper,ef=i.CommonControls.IDropDownListData,of=i.ImageFromCssHelper,ct=i.ImageryMapLayer,gi=i.Infobox,u=r._JSEvent,ii=i.Layer,sf=i.LocationRect,hf=i.LocalSearchTask,cf=r._LocalStorageCache,ft=r._LruCache,lf=r.MapInteractionBehavior,ut=r.MapHelper,lt=i.Location,af=i.MapsFeedback,a=i.MapTypeId,nr=i.MapView,at=i.CommonControls.ModalDialogViewModel,vf=i.MoveableSimplePointPrimitive,tr=r._Network,yf=i.GlobalConfig.features.notification,vt=r._ObservableObject,yt=r._ObservableCollection,pf=r._OverlayEntity,ri=r._Overlay,ir=r._PerfV2Logger,g=i.Point,rr=i.CommonControls.PopOutButtonViewModel,wf=c.features.parking,b=r.Permalink,bf=i.PrimitiveOverlayHelper,d=i.GlobalConfig.features.print,ur=r.PrintContent,fr=i.Pushpin,t=i.ResourceManager.InternalControls,ui=r.ReverseGeocoder,er=i.CommonControls.SearchBoxAutosuggestDataModel,kf=r.SDKPrimitiveTemplateSelector,df=i.SimplePointPrimitive,fi=i.Size,k=i.GlobalConfig.features.sharing,it=r.SharingInstrumentationAction,or=r.TaskData.TimeTypes,ei=i.LabelVisibility,gf=r._StreetsidePerfConstants,ne=i.GlobalConfig.features.streetside,e=i.GlobalConfig.features.taskBar,te=r._TaskDataHandlerHelper,sr=i.CommonControls.TaskBarDropdownViewModel,oi=i.GlobalConfig.features.taskFramework,f=i.TaskTypes,ie=c.features.traffic,re=r._Url,ue=i.MouseEventArgs,pt=i.VectorMapLayer,fe=i.VenueMaps,si=r.TaskData.Waypoint,st=i.ZoomLevel,hr='<div>    <div class="sliBack" event:click="clickBackgroundHandler"><\/div>    <div class="sliMenu">        <ItemsControl ItemsSource="{Binding menuItems}">            <ItemsControl.Template>                <DataTemplate>                    <ul class="sliMenuList"><ItemsPresenter /><\/ul>                <\/DataTemplate>            <\/ItemsControl.Template>            <ItemsControl.ItemTemplate>                <DataTemplate>                    <li class="{Binding type}" >                        <a href="#" id="{Binding htmlId}" class="{Binding cssClass}" event:click="clickHandler">                            <TextBlock text="{Binding name}" />                        <\/a>                    <\/li>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>        <\/div>  <\/div>',cr='<div class="bm_BirdsEyeV2Dialog">    <div class="bm_BEMessageTitleContainer" data-tag="BEMessageTitleContainer">        <div class="BEV2TitleText" title="{TemplateBinding resources.BEV2WelcomeText}">            <TextBlock Text="{TemplateBinding resources.BEV2WelcomeText}" />        <\/div>    <\/div>    <div class="bm_BEMessageContainer" data-tag="BEMessageContainer">        <div class="bm_BEV2Introduction" title="{TemplateBinding resources.BEV2Introduction}">            <TextBlock Text="{TemplateBinding resources.BEV2Introduction}" />        <\/div>    <\/div>    <div class="bm_BEImageIntroContainer" data-tag="BEImageIntroContainer">        <div class="bm_ImageIntroText" title="{TemplateBinding resources.BEV2ImageIntroduction}">            <TextBlock Text="{TemplateBinding resources.BEV2ImageIntroduction}" />        <\/div>    <\/div>    <div class="bm_BEImagesContainer" data-tag="BEImagesContainer">        <div class="bm_DetailsImageContainer" data-tag="DetailsImageContainer">            <div class="bm_DetailsInstructionText" title="{TemplateBinding resources.BEV2DetailsInstruction}">                <TextBlock Text="{TemplateBinding resources.BEV2DetailsInstruction}" />            <\/div>            <img src="" class="bm_DetailsBEV2Image" data-tag="DetailsBEV2Image"/>        <\/div>        <div class="bm_TransientImageContainer" data-tag="TransientImageContainer">            <div class="bm_TransientInstructonText" title="{TemplateBinding resources.BEV2TransientLensInstruction}">                <TextBlock Text="{TemplateBinding resources.BEV2TransientLensInstruction}" />            <\/div>            <img src="" class="bm_TransientBEV2Image" data-tag="TransientBEV2Image" />        <\/div>    <\/div>    <div class="bm_BEv2TipNoteContainer" data-tag="BEv2TipNoteContainer">        <div class="bm_BEv2NoteText" title="TemplateBinding resources.BEV2TipNote">            <TextBlock Text="{TemplateBinding resources.BEV2TipNote}"/>        <\/div>    <\/div><\/div>',wt='<div id="cmt_container" class="cmt_container collapsed" event:mouseover="stopEvent" event:mouseenter="stopEvent" event:click="stopEvent" event:mousedown="stopEvent" event:mouseup="stopEvent" event:mouseout="stopEvent" event:contextmenu="stopEvent" event:focus="stopEvent">    <div id="cmt_topArea" class="cmt_topArea">        <div id="cmt_titleWrapper" class="cmt_titleWrapper">            <div id="cmt_title" class="cmt_title">{commuteControlTitle}<\/div>        <\/div>        <button id="cmt_edit" class="cmt_button" event:click="onEditClicked" event:touchstart="onEditClicked">{editText}<\/button>        <button id="cmt_done" class="cmt_button hidden" event:click="onDoneClicked" event:touchstart="onDoneClicked">{doneText}<\/button>    <\/div>    <div id="cmt_body" class="cmt_body hidden">        <div class="cmt_addresses" id="cmt_addresses">            <div class="cmt_addressDiv" id="cmt_addressDivOne">                <input type="text" class="cmt_address" id="cmt_addressOne" autocomplete="off" placeholder="{placeHolder}" value="{StaticBinding addressValue Mode=TwoWay}" />                <div id="cmt_delete_1" class="cmt_delete hidden" event:click="onDeleteClicked" event:touchstart="onDeleteClicked"><\/div>            <\/div>            <div class="cmt_addressDiv hidden" id="cmt_addressDivTwo">                <input type="text" class="cmt_address" id="cmt_addressTwo" autocomplete="off" placeholder="{placeHolder}" value="{StaticBinding addressTwoValue Mode=TwoWay}" />                <div id="cmt_delete_2" class="cmt_delete" event:click="onDeleteClicked" event:touchstart="onDeleteClicked"><\/div>            <\/div>        <\/div>        <div class="cmt_settings">            <div class="cmt_timeArea">                <button id="cmt_time15" class="cmt_button cmt_time selected" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime15}<\/button>                <button id="cmt_time30" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime30}<\/button>                <button id="cmt_time45" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime45}<\/button>                <button id="cmt_time60" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime60}<\/button>            <\/div>            <div class="cmt_Depart">                <button id="cmt_peak" class="cmt_button selected" event:click="onPeakClicked" event:touchstart="onPeakClicked">{commutePeak}<\/button>                <button id="cmt_offpeak" class="cmt_button" event:click="onPeakClicked" event:touchstart="onPeakClicked">{commuteOffPeak}<\/button>            <\/div>        <\/div>        <div id="cmt_BtmArea" class="cmt_BtmArea" event:click="onAddLocClicked" event:touchstart="onAddLocClicked">            <div id="cmt_addIcon" class="cmt_addIcon"><\/div>            <div id="cmt_addAdr" class="cmt_addAddr">{commuteAddLoc}<\/div>        <\/div>    <\/div>    <div id="cmt_loader" class="cmt_loader">        <div id="cmt_spinner" class="cmt_spinner"><\/div>    <\/div><\/div>',bt='<div id="cmt_container" class="cmt_container cmt_v2" event:mouseover="stopEvent" event:mouseenter="stopEvent" event:click="stopEvent" event:mousedown="stopEvent" event:mouseup="stopEvent" event:mouseout="stopEvent" event:contextmenu="stopEvent" event:focus="stopEvent">    <div id="cmt_topArea" class="cmt_topArea">        <div id="cmt_titleWrapper" class="cmt_titleWrapper">            <div id="cmt_title" class="cmt_title">{commuteControlTitle}<\/div>        <\/div>    <\/div>    <div id="cmt_body" class="cmt_body">        <div class="cmt_addresses" id="cmt_addresses">            <div class="cmt_addressDiv" id="cmt_addressDivOne">                <input type="text" class="cmt_address" id="cmt_addressOne" autocomplete="off" placeholder="{placeHolder}" value="{StaticBinding addressValue Mode=TwoWay}" />            <\/div>        <\/div>        <div class="cmt_settings">            <div class="cmt_timeArea">                <button id="cmt_time15" class="cmt_button cmt_time selected" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime15}<\/button>                <button id="cmt_time30" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime30}<\/button>                <button id="cmt_time45" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime45}<\/button>                <button id="cmt_time60" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime60}<\/button>            <\/div>            <div class="cmt_Depart">                <button id="cmt_peak" class="cmt_button selected" event:click="onPeakClicked" event:touchstart="onPeakClicked">{commutePeak}<\/button>                <button id="cmt_offpeak" class="cmt_button" event:click="onPeakClicked" event:touchstart="onPeakClicked">{commuteOffPeak}<\/button>            <\/div>        <\/div>    <\/div>    <div id="cmt_btm" class="cmt_btm">        <span id="cmt_err" class="cmt_err hidden">{errorMessage}<\/span>        <button id="cmt_done" class="cmt_button disabled" event:click="onDoneClicked" event:touchstart="onDoneClicked">{doneText}<\/button>    <\/div>    <div id="cmt_loader" class="cmt_loader">        <div id="cmt_spinner" class="cmt_spinner"><\/div>    <\/div><\/div>',hi='<div id="cmt_infobox">    <b id="cmt_infoboxTitle">{title}<\/b>    <div id="cmt_infoboxDescription">{description}<\/div><\/div>',lr='<div class="taskBar" role="search" aria-label="{Binding resources.L_Landmark_TaskBar_Aria_Label}" data-tag="TaskBar">    <ul>        <li class="sbElement">            <a href="/" class="logo" data-tag="TaskBar.Logo"><\/a>        <\/li>        <li class="inputbox">            <div id="maps_sb_container" data-tag="maps_sb_container">                <div class="searchbox">                    <input id="maps_sb" type="search" title="{Binding resources.L_TaskBar_Label_SearchBox}" length="20" maxlength="1000" value="{Binding searchTerm Mode=TwoWay}" data-tag="TaskBar.SearchBox"><\/input>                    <a href="#" class="clrSb" title="{Binding resources.L_TaskBar_Label_Clear}" role="button" data-tag="TaskBar.SearchBoxCancel"><\/a>                <\/div>            <\/div>            <div class="searchButton">                <a href="#" class="searchIcon" data-instrumentation="{Binding searchInstData}" title="{Binding resources.L_TaskBar_Label_Search}" role="button" event:click="invokeLocalSearchHandler" data-tag="TaskBar.SearchButton" />            <\/div>        <\/li>    <\/ul>    <ItemsControl ItemsSource="{Binding taskBarItems}">        <ItemsControl.Template>            <DataTemplate>                <ul class="actions"><ItemsPresenter /><\/ul>            <\/DataTemplate>        <\/ItemsControl.Template>        <ItemsControl.ItemTemplate>            <DataTemplate>                <li style:display="{Binding isActive Converter=boolToDisplay}" class="action">                    <a href="#" class="{Binding cssClass}" data-task="{Binding taskOption Converter=stringify}" data-instrumentation="{Binding instrumentationData}" event:click="clickHandler" title="{Binding name}" role="button" data-tag="{Binding dataTag}">                        <span style:display="{Binding showLabel Converter=boolToDisplay}" class="actionLabel">                            <TextBlock Text="{Binding name}" />                        <\/span>                    <\/a>                <\/li>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>        <div class="clear"><\/div><\/div>',ar='<div class="bm_l2OverlayCloseBtn">    <a href="#" class="l2OverlayClose" role="button" aria-label="{Binding ariaLabel}">        <div class="icon svg"><\/div>    <\/a><\/div>',vr='<div class="printDialog" data-tag="printDialog" role="dialog">    <p class="printDlgHdr">        <div class="printPreviewTitle">            <TextBlock Text="{TemplateBinding resources.L_PrintPreview}" />        <\/div>        <div class="mapAndTextPrint">            <ul>                <li>                    <a href="#" role="button" aria-label="{TemplateBinding resources.L_PrintMapAndText}" class="printMapAndText mapTextOptions selected" data-tag="printMapAndText" event:click="onMapTextClick">                        <TextBlock Text="{TemplateBinding resources.L_PrintMapAndText}" />                    <\/a>                <\/li>                <li>                    <a href="#" role="button" aria-label="{TemplateBinding resources.L_PrintMapOnly}" class="printMapOnly mapTextOptions" data-tag="printMapOnly" event:click="onMapOnlyClick">                        <TextBlock Text="{TemplateBinding resources.L_PrintMapOnly}" />                    <\/a>                <\/li>                <li>                    <a href="#" role="button" aria-label="{TemplateBinding resources.L_PrintTextOnly}" class="printTextOnly mapTextOptions" data-tag="printTextOnly" event:click="onTextOnlyClick">                        <TextBlock Text="{TemplateBinding resources.L_PrintTextOnly}" />                    <\/a>                <\/li>            <\/ul>        <\/div>    <\/p>    <div>        <div class="printContent" data-tag="printContent" event:mousewheel="onMouseWheel">            <div class="printHeader" style:display="block">                <img class="bingMapsLogo" alt="{TemplateBinding resources.BingMapsLogo}" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFcAAAATCAMAAADS32EkAAAAP1BMVEX///9RUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFAbX/lHAAAAFHRSTlMAECAwQFBgcHSAkKCwuMDQ4Obw8rSbhEIAAAGTSURBVHhe1ZLdjtwwCEY/DHbqn2KX8v7P2mGSrLKNVrPSqBc9F8jGcGQh4KMk/AP8gfznXi8IkIa85+WEK14RgH17z1t8bnz3vj+H5e6ryYc31QKAhMD8OFNkuVZhRiCQeOd9lVKORmKkshtypsO7+ROrCHzGeYO4QJc9yEB9FuhRsJrxXOoSD9oXQbTbsElINoYfXrJdfLR5JZ6enl6vRDbBrkL1LOhAsQ7UAcSnW4H4IJB21HrZB6rr4l0Aim9PrwHojuoJwDq8DKQIst+ROyTuKIbaL17kq7ch+urTG6nqGB4CPbxnIAW4T58KmYiEI+mU0yv6aQ59X7Krt33670dQJN8SysULbFbDW06rr4zADUBzvnqLF4D97o0RY+g5hyhAcrj/6H5Q6dy91ZYPXL00fXS/eyGLUCy8mlAsIxNo4fdP34n0gW7DrRFYGa0dv+BuVvXuRbc1s0K0u3kFmunM+HUZwWvWwB1KEUWRhBBwJPs5ghdkjtqCrxD9u8FiBC/xoOP7XqSM7yDbxvgabrjwB0awHHyuA7RgAAAAAElFTkSuQmCC" />            <\/div>            <div class="baseMapPrint" data-tag="baseMapPrint">                <div>                        <ul>                            <li data-tag="baseMapNotes" class="baseMapNotes">                                <div id="printNotesLabel">                                    <TextBlock Text="{TemplateBinding resources.L_PrintNotes}" />                                <\/div>                                <div class="baseMapTextArea screenNotes">                                    <textarea rows="9" cols="45" id="baseMapNotes" role="textbox" aria-label="{TemplateBinding resources.L_PrintNotesWatermark}" class="baseMapNotes" style:color="black" placeholder="{TemplateBinding resources.L_PrintNotesWatermark}" maxlength="{TemplateBinding notesMaxCharSize}"> <\/textarea>                                <\/div>                                <div class="printedNotes">                                <\/div>                            <\/li>                            <li data-tag="baseMapMiniMap" class="baseMapOverviewMap">                                <img src="{TemplateBinding overviewContextMap}" alt="{TemplateBinding resources.PrintMiniMapAltText}"/>                            <\/li>                        <\/ul>                        <div>                                <div class="printArea" data-tag="printArea">                                    <div class="printMap" data-tag="printMap">                                    <\/div>                                <\/div>                        <\/div>                <\/div>            <\/div>            <div class="taskPrintContent" data-tag="taskPrintContent">            <\/div>        <\/div>            <div class="printFooter" style:display="block">            <p class="printDlgFoot printButton">                <a class="textButton" aria-label="{TemplateBinding resources.L_Print_Submit}" event:click="onPrintClick" href="#" role="button" data-tag="printButton">                    <TextBlock Text="{TemplateBinding resources.L_Print_Submit}" />                <\/a>            <\/p>        <\/div>    <\/div><\/div>',yr='<div class="bm_sharePanel" data-tag="Share.SharePanel">    <div class="shareHeader" data-tag="Share.Header">        <div class="shareTextTitle">            <TextBlock text="{Binding titleText}" />        <\/div>        <a href="#" class="panelClose" title="{StaticBinding resources.ShareClose}" role="button" data-tag="Share.CloseButton" data-share=\'{ "action": "closeShare" }\'><div class="icon svg"><\/div><\/a>    <\/div>    <div class="content">        <div class="body">            <div class="textAndEmbed" style:display="{Binding hasAtLeastOneSharableStack Converter=boolToDisplay}">                <div class="text">                    <TextBlock text="{StaticBinding resources.L_PermalinkPrompt_Text}" />                <\/div>            <\/div>            <div class="taskList" style:display="{Binding hasAtLeastOneSharableStack Converter=boolToDisplay}">                <ul class="taskListContainer" role="list">                <\/ul>            <\/div>            <div class="actions">                <div class="actionTitle">                    <span>                        <TextBlock text="{StaticBinding resources.ShareActionsTitle}" />                    <\/span>                <\/div>                <div class="actionsContainer">                    <div class="actionContainer" style:display="{Binding enableSocialSharing Converter=boolToDisplay}">                        <a href="#" class="{Binding sharingLinkAvailable Converter=availableToShareButtonClass}" id="facebookIcon" data-tag="Share.Facebook" event:click="openFacebook" role="button" title="{StaticBinding resources.ShareFBToolTip}">                            <div class="actionText">                                <TextBlock text="{StaticBinding resources.L_PermalinkFacebook_Text}" />                            <\/div>                        <\/a>                    <\/div>                    <div class="actionContainer" style:display="{Binding enableSocialSharing Converter=boolToDisplay}">                        <a href="#" class="{Binding sharingLinkAvailable Converter=availableToShareButtonClass}" id="twitterIcon" data-tag="Share.Twitter" event:click="openTwitter" role="button" title="{StaticBinding resources.ShareTwitterToolTip}">                            <div class="actionText">                                <TextBlock text="{StaticBinding resources.L_PermalinkTwitter_Text}" />                            <\/div>                        <\/a>                    <\/div>                    <div class="actionContainer">                        <a href="#" class="{Binding sharingLinkAvailable Converter=availableToShareButtonClass}" id="emailIcon" data-tag="Share.Email" event:click="openEmail" role="button" title="{StaticBinding resources.ShareEmailToolTip}">                            <div class="actionText">                                <TextBlock text="{StaticBinding resources.L_Permalink_Email_Button_Text}" />                            <\/div>                        <\/a>                    <\/div>                <\/div>            <\/div>            <div class="orSeparator">                <hr class="separator" />                <div class="orText">                    <TextBlock text="{StaticBinding resources.OrSeparatorText}" />                <\/div>                <hr class="separator" />            <\/div>            <div class="copyAndLinkText">                <div class="inputContainer">                    <input class="text urlBox" data-tag="Share.UrlBox" type="text" role="textbox" readonly="readonly" aria-readonly="true" value="{Binding permalinkString}" onclick="this.select();" aria-label="{StaticBinding resources.ShareUrlLabel}" />                    <a href="#" class="{Binding sharingLinkAvailable Converter=availableToLinkClass}" role="button" id="copyButton" style:display="{Binding errorMessage Converter=errorMessageToNotDisplay}" data-tag="Share.Copy" event:click="copyToClipboard" >                        <TextBlock text="{StaticBinding resources.L_PermalinkCopy_Text}" />                    <\/a>                <\/div>            <\/div>            <div class="linkBox">                <a href="#" class="{Binding sharingLinkAvailable Converter=availableToLinkClass}" id="linkStyleButton" style:display="{Binding errorMessage Converter=errorMessageToNotDisplay}" style:visibility="{Binding enableSharingVisibility}" data-tag="Share.ToggleLinkLength" event:click="toggleLinkLength" role="button">                    <TextBlock text="{Binding isShortPermalinkDisplayed Converter=displayStateToLinkText}" />                <\/a>            <\/div>            <div class="errorMessage" data-tag="Share.ErrorMessage" style:visibility="{Binding errorMessage Converter=errorMessageToVisibility}">                <TextBlock text="{Binding errorMessage}" />            <\/div>        <\/div>    <\/div><\/div>',pr='<div class="sharePrompt">    <TextBlock text="{TemplateBinding resources.L_Permalink_Prompt}" /><\/div><input class="shareUrlBox" data-tag="Share.UrlBox" type="text" value="{TemplateBinding permalinkString}" onclick="this.select();" readonly="readonly" /><a href="#" class="shareUrlShortenLink" data-tag="Share.ShortenButton" event:click="shortenClick"><TextBlock text="{TemplateBinding shortenButtonText}" /><\/a><a href="#" class="submitBtn padded" data-tag="Share.EmailButton" event:click="emailClick" role="button">    <TextBlock text="{TemplateBinding resources.L_Permalink_Email_Button_Text}" /><\/a>',wr='<div class="{Binding className}" role="search" aria-label="{Binding resources.L_Landmark_TaskBar_Aria_Label}" data-tag="TaskBar">\t<ul>\t\t<li class="sbElement">\t\t\t<a href="/" class="b_logoArea" alt="{Binding resources.TaskBarLogoTitle}" title="{Binding resources.TaskBarLogoTitle}">\t\t\t\t<h1 class="b_logo b_taskLogo"><\/h1>\t\t\t<\/a>\t\t<\/li>\t\t<li class="inputbox">\t\t\t<div id="maps_sb_container" data-tag="maps_sb_container">\t\t\t\t<div class="searchbox">\t\t\t\t\t<a class="bm_overflowCountContainer" href="#" style:display="{Binding OverflowCapsuleListCount Converter=overflowCapsuleListToDisplay}" role="button" event:click="overflowClick" event:mouseover="overflowMouseOver" event:mouseout="overflowMouseOut" event:touchend="overflowClick" event:keydown="overflowKeyDown" data-tag="TaskBar.overflowContainer" aria-label="{StaticBinding resources.ViewAllSearches}" aria-expanded="{Binding overflowExpanded}">\t\t\t\t\t\t<div class="bm_overflowCounter">\t\t\t\t\t\t\t<div class="bm_overflowBox">\t\t\t\t\t\t\t\t<div class="bm_overflowLink" aria-label="{StaticBinding resources.ViewAllSearches}" data-tag="TaskBar.overflowButton">\t\t\t\t\t\t\t\t\t<TextBlock Text="{Binding OverflowCapsuleListCount Converter=overflowCapsuleListToCount}" />\t\t\t\t\t\t\t\t\t<div class="bm_overflowDropDown">\t\t\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t<\/div>\t\t\t\t\t<\/a>\t\t\t\t\t\t\t\t<input id="maps_sb" type="search" role="combobox" title="{Binding resources.L_TaskBar_Label_SearchBox}" length="20" maxlength="1000" value="{Binding searchTerm Mode=TwoWay}" autocomplete="off" aria-haspopup="true" aria-expanded="{Binding asExpanded}" aria-controls="as_containerSearch" aria-autocomplete="both" aria-activedescendant="{Binding selectedSuggestionId}" data-tag="TaskBar.SearchBox" placeholder="{Binding searchboxPlaceHolderText}"><\/input>\t\t\t\t\t<div class="inPrivateIcon" style:display="{Binding displayInPrivate}"><\/div>\t\t\t\t\t<div class="searchButton">\t\t\t\t\t\t<a href="#" class="searchIcon" tabindex="-1" data-instrumentation="{Binding searchInstData}" title="{Binding resources.SearchGhostText}" role="button" event:click="invokeLocalSearchHandler" data-tag="TaskBar.SearchButton" />\t\t\t\t\t<\/div>\t\t\t\t<\/div>                    <div class="bm_outsideBeak" ><\/div>\t\t\t\t\t<div class="bm_overflowPopout" style="display: none;" event:mouseover="popoutMouseoverHandler" event:mouseout="popoutMouseoutHandler" data-tag="TaskBar.overflowPopout">\t\t\t\t\t\t<div class="bm_popoutTop1">\t\t\t\t\t\t\t<div class="bm_clearallSection">\t\t\t\t\t\t\t\t<span class="bm_selectToActivateSection">\t\t\t\t\t\t\t\t\t<TextBlock Text="{Binding resources.OverflowActivateSearchText}" />\t\t\t\t\t\t\t\t<\/span>\t\t\t\t\t\t\t\t<a class="bm_clearAllLink" role="button" href="#" event:click="clearAllClickHandler" event:touchend="clearAllClickHandler" event:keydown="clearAllKeyDownHandler">\t\t\t\t\t\t\t\t\t<TextBlock Text="{Binding resources.OverflowClearAllText}" />\t\t\t\t\t\t\t\t<\/a>\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t\t<div class="bm_popOutInner1">\t\t\t\t\t\t\t\t<ItemsControl ItemsSource="{Binding OverflowCapsuleList}">\t\t\t\t\t\t\t\t\t<ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t\t\t<DataTemplate>\t\t\t\t\t\t\t\t\t\t\t<div class="bm_overflowItem" id="{Binding id}">\t\t\t\t\t\t\t\t\t\t\t\t<a class="bm_overflowCardText" role="button" href="#" event:mouseover="overflowTitleMouseoverHandler" event:mouseout="overflowTitleMouseoutHandler" event:click="overflowTitleClickHandler" event:touchend="overflowTitleTouchHandler" event:keydown="overflowTitleKeyDownHandler" aria-label="{Binding title}" data-tag="TaskBar.overflowPopLink">\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="{Binding imageClass}" style:background-color="{Binding backgroundColor}"/>\t\t\t\t\t\t\t\t\t\t\t\t\t<span id="bm_overflowText">\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TextBlock Text="{Binding title}" />\t\t\t\t\t\t\t\t\t\t\t\t\t<\/span>\t\t\t\t\t\t\t\t\t\t\t\t<\/a>\t\t\t\t\t\t\t\t\t\t\t\t<a class="bm_overflowCardClose" role="button" href="#" event:click="cardCloseHandler" event:touchend="cardCloseHandler" event:keydown="cardCloseKeyDownHandler" title="{Binding closeTitle}" />\t\t\t\t\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t\t\t\t\t<\/DataTemplate>\t\t\t\t\t\t\t\t\t<\/ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t<\/ItemsControl>\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t<\/div>\t\t\t\t\t<\/div>\t\t\t\t<div class="as_container" id="as_containerSearch" aria-owns="maps_sb" style:visibility="hidden"><\/div>\t\t\t<\/div>\t\t<\/li>\t<\/ul>\t<div id="PreviousSearchTip">        <TextBlock Text="{Binding resources.ViewAllSearches}" />\t<\/div>\t<ItemsControl ItemsSource="{Binding taskBarItems}">\t\t<ItemsControl.Template>\t\t\t<DataTemplate>\t\t\t\t<ul class="actions"><ItemsPresenter /><\/ul>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.Template>\t\t<ItemsControl.ItemTemplate>\t\t\t<DataTemplate>\t\t\t\t<li style:display="{Binding isActive Converter=boolToDisplay}" class="action">\t\t\t\t\t<a href="{Binding url}" class="{Binding cssClass}" data-task="{Binding taskOption Converter=stringify}" data-instrumentation="{Binding instrumentationData}" event:click="clickHandler" event:touchend="clickHandler" event:mouseover="mouseoverHandler" event:mouseout="mouseoutHandler" event:keydown="keydownHandler" title="{Binding altName}" role="button" data-tag="{Binding dataTag}" aria-expanded="{Binding ariaExpanded}" aria-haspopup="{Binding ariaHasPopout}" aria-controls="{Binding ariaControls}">\t\t\t\t\t\t<span style:display="{Binding showLabel Converter=boolToDisplay}" class="actionLabel">\t\t\t\t\t\t\t<TextBlock Text="{Binding name}" />\t\t\t\t\t\t<\/span>\t\t\t\t\t\t<span style:display="{Binding isNew Converter=boolToDisplay}" class="bm_newBanner">\t\t\t\t\t\t\t<TextBlock Text="{Binding banner}" />\t\t\t\t\t\t<\/span>\t\t\t\t\t<\/a>\t\t\t\t<\/li>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.ItemTemplate>\t<\/ItemsControl>\t<div class="clear"><\/div>\t<!-- The following is the close button for local overlay on serp -->\t<div class="overlayCloseBtn">\t\t<a role="button" class="overlayCloseLink" href="#" title="{StaticBinding resources.L_CloseTask_Text}" event:click="onOverlayCloseButtonClicked" event:keydown="onOverlayCloseKeydown">\t\t\t<div class="icon svg"><\/div>\t\t<\/a>\t<\/div><\/div>',br='<div class="bm_tooltips saveOnSerpConfirmation" data-tag="UserTip" style:display="{TemplateBinding IsHidden Converter=boolToNotDisplay}" event:mouseenter="onTipHoverOver" event:mouseleave="onTipHoverOut">    <div class="tooltipBeak" style:display="{TemplateBinding ShowBeak Converter=boolToDisplay}"><\/div>    <div class="tooltipsText">        <div class="tooltipsIcon">        <\/div>        <div class="tooltipsIconText">            <TextBlock Text="{TemplateBinding IconText}" />        <\/div>        <div class="tooltipsLinkMessage" style:display="{TemplateBinding Link Converter=nullToDisplayNone}">            <TextBlock Text="{TemplateBinding PreLink}" />            <a href="#" event:click="onLinkClicked" class="tooltipsLink">                <TextBlock Text="{TemplateBinding Link}" />            <\/a>            <TextBlock Text="{TemplateBinding PostLink}" />        <\/div>    <\/div><\/div>',kr='<div class="{TemplateBinding IsFaded Converter=boolToFadedClass}" data-tag="UserTip" style:display="{TemplateBinding IsHidden Converter=boolToNotDisplay}">    <div class="tooltipBeak" style:display="{TemplateBinding ShowBeak Converter=boolToDisplay}"><\/div>    <div class="tooltipsText">        <a class="tooltipsClose" href="#" title="{TemplateBinding resources.L_Tooltip_Close_Text}" event:click="closeClicked" style:display="{TemplateBinding ShowClose Converter=boolToDisplay}">        <\/a>        <div class="tooltipsMessage">            <TextBlock Text="{TemplateBinding resources.L_Tooltip_Itinerary_Saved_Text}" />        <\/div>        <div class="tooltipsMessage secondLine" style:display="{TemplateBinding showEditName Converter=boolToNotDisplay}">            <TextBlock Text="{TemplateBinding Name}" />            <TextBlock Text="{TemplateBinding separator}" />            <a class="bm_renameLink" href="#" event:click="renameClicked"><TextBlock Text="{TemplateBinding resources.L_Tooltip_Rename_Button}" /><\/a>        <\/div>        <div class="nameInputContainer" style:display="{TemplateBinding showEditName Converter=boolToDisplay}">            <input type="text" class="nameEditBox" maxlength="100" value="{StaticBinding Name Mode=TwoWay}" event:keydown="onKeyPressed" />            <a href="#" class="bm_tooltipSaveButton" event:click="onSaveLinkClick" event:touchend="onSaveLinkClick">                <TextBlock Text="{TemplateBinding resources.L_Tooltip_Update_Button}" />            <\/a>        <\/div>    <\/div><\/div>',dr='<div class="{TemplateBinding IsFaded Converter=boolToFadedClass}" data-tag="UserTip" style:display="{TemplateBinding IsHidden Converter=boolToNotDisplay}" event:mouseenter="onTipHoverOver" event:mouseleave="onTipHoverOut">    <div class="tooltipBeak" style:display="{TemplateBinding ShowBeak Converter=boolToDisplay}"><\/div>    <a class="tooltipsClose" href="#" title="{TemplateBinding resources.L_Tooltip_Close_Text}" event:click="closeClicked" style:display="{TemplateBinding ShowClose Converter=boolToDisplay}">    <\/a>    <div class="tooltipsText">        <div class="tooltipsHeader" style:display="{TemplateBinding Title Converter=nullToDisplayNone}">            <TextBlock Text="{TemplateBinding Title}" />        <\/div>        <ItemsControl ItemsSource="{TemplateBinding MessageLines}">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <div class="tooltipsMessage">                        <TextBlock Text="{Binding $self$}" />                    <\/div>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>        <div class="tooltipsLinkMessage" style:display="{TemplateBinding Link Converter=nullToDisplayNone}">            <span>                <TextBlock Text="{TemplateBinding PreLink}" />            <\/span>            <a href="{TemplateBinding linkUrl}" event:click="onLinkClicked" class="tooltipsLink" target="_blank">                <TextBlock Text="{TemplateBinding Link}" />            <\/a>            <span>                <TextBlock Text="{TemplateBinding PostLink}" />            <\/span>        <\/div>        <div style:display="{TemplateBinding SignInTitle Converter=nullToDisplayNone}">            <SignInPopUpControl SignInMessage="{TemplateBinding SignInTitle}" event:signedIn="onSignedIn" />        <\/div>    <\/div><\/div>',y=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ci=function(n){function i(){var i=this,r=t;return i=n.call(this,cr,"bm_BirdsEyeV2DialogContainer",{onCloseClick:function(n){return i._onCloseClick(n)}},{},r)||this}return y(i,n),i.prototype.showBEDialog=function(){this.OpenDialog()},i.prototype._onCloseClick=function(n){n&&n.preventDefault();this.CloseDialog();this.dispose()},i}(at),gr=function(r){function u(n,f,e){var o=r.call(this,e)||this;return wt=wt.replace("{commuteControlTitle}",t.L_CmtControlTitleText).replace("{commuteAddLoc}",t.L_CmtControlAddLocationText).replace("{commuteTime30}",t.L_CmtControlCommuteTime30Text).replace("{commuteTime45}",t.L_CmtControlCommuteTime45Text).replace("{commuteTime60}",t.L_CmtControlCommuteTime60Text).replace("{commuteTime15}",t.L_CmtControlCommuteTime15Text).replace("{commutePeak}",t.L_CmtControlCommutePeak_Text).replace("{commuteOffPeak}",t.L_CmtControlCommuteOffPeak_Text).replace("{editText}",t.L_CmtEditText).replace("{doneText}",t.L_CmtDoneText).replace("{placeHolder}",t.L_CmtPlaceHolderText).replace("{placeHolder}",t.L_CmtPlaceHolderText),o.setTemplate(new rt(wt,{stopEvent:function(n){return o._stopEvent(n)},onAddLocClicked:function(){return o._onAddLocClicked()},onDeleteClicked:function(n){return o._onDeleteClicked(n)},onTimeClicked:function(n){return o._onTimeClicked(n)},onPeakClicked:function(n){return o._onPeakClicked(n)},onEditClicked:function(){return o._onEditClicked()},onDoneClicked:function(){return o._onDoneClicked()}})),o._map=n,o._cmtFeatureConfig=c.features.commutability,o.defineProperty("addressValue"),o.defineProperty("addressTwoValue"),o._secondAddrEnabled=!1,o._time=u._defaultSelectedTime,o._departureTime=o._cmtFeatureConfig.peakTime,o._location=o._map.getBounds(!0).center,o._pushpinLayer=new ii("Commutability_Layer"),o._pushpin=new i.Pushpin(o._location,{icon:u._iconSvg,draggable:!0,text:t.L_CmtControlPushpinTitle}),o._pushpinLayer.add(o._pushpin),i.Events.addHandler(o._pushpin,"dragend",function(n){return o._pushpinDragEnd(o._pushpin,n)}),o._isochroneOptions={intersectionOptions:{fillColor:o._cmtFeatureConfig.intersectFillColor,strokeColor:o._cmtFeatureConfig.isochroneStrokeColor,strokeThickness:o._cmtFeatureConfig.isochroneStrokeThickness,secondaryStrokeColor:o._cmtFeatureConfig.isochroneSecondaryStrokeColor,secondaryStrokeThickness:o._cmtFeatureConfig.isochroneSecondaryStrokeThickness},showIntersection:!!o._cmtFeatureConfig.showIntersection,showUnion:!!o._cmtFeatureConfig.showUnion,showIsochrones:!!o._cmtFeatureConfig.showIsochrones,applyCardinalSpline:typeof o._cmtFeatureConfig.applyCardinalSpline=="boolean"?o._cmtFeatureConfig.applyCardinalSpline:!1},o._isochroneLayer=f,o._isochroneLayer.attachMap(o._map),o._isochroneLayer.setOptions(o._isochroneOptions),o._updateCompleteHandler=function(){return o._updateIsochroneCompleted()},o._isochroneLayer.downloadCompleted.add(o._updateCompleteHandler),o._isochroneLayers=[],i.loadModule("Microsoft.Maps.AutoSuggest",function(){var r=o._cmtFeatureConfig.autoSuggestMaxResult||5,n={maxResults:r,map:o._map,serpOptions:{showMyLocation:!0,suggestionTypes:"place,business,address",selectFirstOnEnter:!0}},t=i.AutosuggestManager;o._asManagerOne=new t(n);o._asManagerOne.attachAutosuggest("#cmt_addressOne","#cmt_addressDivOne",function(n){o._processAutoSuggestResult(n.location,n.formattedSuggestion,!0);p.logAddressChange(l.Autosuggest,!1)});o._asManagerTwo=new t(n);o._asManagerTwo.attachAutosuggest("#cmt_addressTwo","#cmt_addressDivTwo",function(n){o._processAutoSuggestResult(n.location,n.formattedSuggestion,!1);p.logAddressChange(l.Autosuggest,!0)});o.disposables.push(o._asManagerOne,o._asManagerTwo)}),o}return y(u,r),u.prototype.attachIsochrone=function(){this._map.getLayers().insertAll([this._isochroneLayer,this._pushpinLayer]);p.logColtrolActivation()},u.prototype.detachIsochrone=function(){this._map.getLayers().remove(this._isochroneLayer);this._map.getLayers().remove(this._pushpinLayer);p.logColtrolDeactivation()},u.prototype.dispose=function(){var n,t,i;for(this.detachIsochrone(),n=0,t=this._isochroneLayers;n<t.length;n++)i=t[n],i.dispose();this._isochroneLayer&&this._isochroneLayer.dispose();this._pushpinLayer.dispose();r.prototype.dispose.call(this);h._clearDisposables(this.disposables);h._nullifyClass(this)},u.prototype.postInit=function(){var f=this,e,r,t;if((this._cmtContainer=n("#cmt_container"),this._cmtContainer)&&(this._title=n("#cmt_title"),this._addAddressButton=n("#cmt_BtmArea"),this._addressesSection=n("#cmt_addresses"),this._address=n("#cmt_addressOne"),this._addressOneClose=n("#cmt_delete_1"),this._addressTwo=n("#cmt_addressTwo"),this._addressTwoContainer=n("#cmt_addressDivTwo"),this._editButton=n("#cmt_edit"),this._doneButton=n("#cmt_done"),this._peakButton=n("#cmt_peak"),this._loader=n("#cmt_loader"),this._currentSelectedTimeElement=n(".cmt_time.selected"),this._currentSelectedDepartureElement=n(".cmt_Depart .selected"),this._setControlBusy(!1),this._cmtFeatureConfig.prefetch))for(e=i.IsochroneLayer,r=0;r<u._times.length;r++){if(u._times[r]===this._time){this._isochroneLayers.push(this._isochroneLayer);this._isochroneLayer.downloadError.add(function(n){return f._handleIsochroneError(n)});continue}t=new e;t.setOptions(this._isochroneOptions);t.attachMap(this._map);t.downloadError.add(function(n){return f._handleIsochroneError(n)});this._isochroneLayers.push(t)}},u.prototype._stopEvent=function(n){n.stopPropagation()},u.prototype._onEditClicked=function(){var r=n("#cmt_body"),t,i;r.remove_class("hidden");this._cmtContainer.remove_class("collapsed");this._editButton.add_class("hidden");this._doneButton.remove_class("hidden");this._adjustAutosuggestWidth();t=this._map.getNavigationBar().getLocateMeControl();i=t&&t.getGeochainControl();i&&i.setIsCollapsed(!0);p.logButtonClick(this._editButton.get_attr("id"))},u.prototype._onDoneClicked=function(){var t=n("#cmt_body");t.add_class("hidden");this._cmtContainer.add_class("collapsed");this._doneButton.add_class("hidden");this._editButton.remove_class("hidden");p.logButtonClick(this._doneButton.get_attr("id"))},u.prototype._onAddLocClicked=function(){var n=this;this._downloadingIsochrone||this._addAddressButton.has_class("hidden")||(this._addAddressButton.add_class("hidden"),this._addressOneClose.remove_class("hidden"),this._addressTwoContainer.remove_class("hidden"),this._secondAddrEnabled=!0,this.setAddressTwoValue(""),this._addressTwo.set_attr("value",""),this._locationTwo=this._map.getBounds(!0).center,this._pushpinTwo=new fr(this._locationTwo,{icon:u._iconSvg,draggable:!0,text:t.L_CmtControlPushpinTwoTitle}),this._pushpinLayer&&this._pushpinLayer.add(this._pushpinTwo),i.Events.addHandler(this._pushpinTwo,"dragend",function(t){return n._pushpinDragEnd(n._pushpinTwo,t)}),this._cmtContainer.add_class("expanded"),this._addressesSection.add_class("expanded"),this._adjustAutosuggestWidth(),p.logButtonClick(this._addAddressButton.get_attr("id")))},u.prototype._onDeleteClicked=function(n){if(!this._downloadingIsochrone){var t=n.target,i=t.id;i==="cmt_delete_1"&&(this._location=this._locationTwo,this._pushpin.setLocation(this._location),this.setAddressValue(this.getAddressTwoValue()),this._address.set_attr("value",this.getAddressValue()));this._addAddressButton.remove_class("hidden");this._addressOneClose.add_class("hidden");this._addressTwoContainer.add_class("hidden");this._cmtContainer.remove_class("expanded");this._addressesSection.remove_class("expanded");this._pushpinLayer.remove(this._pushpinTwo);this._secondAddrEnabled=!1;this._updateMapView();this._updateIsochrone();this._updateTitle();this._adjustAutosuggestWidth()}},u.prototype._onTimeClicked=function(t){var f=t.target,i=f.id,r;this._downloadingIsochrone||i===this._currentSelectedTimeElement.get_attr("id")||n("#"+i).has_class("disabled")||(r=u._timeButtonIds.indexOf(i),this._changeSelectedTime(r),p.logButtonClick(i))},u.prototype._onPeakClicked=function(t){var r=t.target,i=r.id;this._downloadingIsochrone||i===this._currentSelectedDepartureElement.get_attr("id")||(this._departureTime=i==="cmt_peak"?this._cmtFeatureConfig.peakTime:this._cmtFeatureConfig.offPeakTime,this._currentSelectedDepartureElement.remove_class("selected"),this._currentSelectedDepartureElement=n("#"+i),this._currentSelectedDepartureElement.add_class("selected"),this._updateIsochrone(),this._updateTitle(),p.logButtonClick(i))},u.prototype._processAutoSuggestResult=function(n,t,i){var r=i?this._location:this._locationTwo;lt.areEqual(r,n,!0)||(i?(this._location=n,this.setAddressValue(t),this._pushpin.setLocation(n)):(this._locationTwo=n,this.setAddressTwoValue(t),this._pushpinTwo.setLocation(n)),this._updateMapView(),this._updateIsochrone(),this._updateTitle())},u.prototype._updateIsochrone=function(){var i,n,t,f,r,e;for(this._resetTimeButtons(),this.getAddressValue()||this._reverseGeocode(this._location,1),this.getAddressValue()!==this._address.get_attr("value")&&this._address.set_attr("value",this.getAddressValue()),this._secondAddrEnabled&&this._addressTwo.set_attr("value",this.getAddressTwoValue()),i=null,(!this._peakButton||this._peakButton.has_class("selected"))&&(i="timeWithTraffic"),n=0;n<u._times.length;n++)(t=u._times[n],this._cmtFeatureConfig.prefetch||t===this._time)&&(f=this._buildRequest(t,i,1),r=[f],this._secondAddrEnabled&&this.getAddressTwoValue()&&(e=this._buildRequest(t,i,2),r.push(e)),t===this._time?(this._setControlBusy(!0),this._isochroneLayer.setRequests(r)):this._isochroneLayers&&this._isochroneLayers.length>n&&this._isochroneLayers[n]&&this._isochroneLayers[n].setRequests(r))},u.prototype._buildRequest=function(n,t,i){var u=this._location,f=this._cmtFeatureConfig.isochroneOneFillColor,r;return i===2&&(u=this._locationTwo,f=this._cmtFeatureConfig.isochroneTwoFillColor),r={maxTime:n,startPoint:u,departTime:this._departureTime,optimize:t,displayOptions:{fillColor:f,strokeColor:this._cmtFeatureConfig.isochroneStrokeColor}},r.displayOptions.strokeThickness=this._cmtFeatureConfig.isochroneStrokeThickness,r.displayOptions.secondaryStrokeColor=this._cmtFeatureConfig.isochroneSecondaryStrokeColor,r.displayOptions.secondaryStrokeThickness=this._cmtFeatureConfig.isochroneSecondaryStrokeThickness,r},u.prototype._updateMapView=function(){var i=[this._location];this._locationTwo&&!lt.areEqual(this._location,this._locationTwo)&&i.push(this._locationTwo);var n=this._map.getMode().getMapViewForLocationsInView(i),r=st.fromLocation(n.cameraLocation,!1),u=this._map.getMercatorZoomLevel();if(r>u){var t=this._map.getViewportPadding(),f=this._map.getViewport(),e=new g(t.left,t.top),o=new g(f.pixelWidth-t.right,f.pixelHeight-t.bottom),s=new g((e.x+o.x)/2,(e.y+o.y)/2);n=this._map.getMode().getMapViewZoomedAboutLocationAtPoint(n,n.cameraLocation,s,u-r)}this._map.setView(n)},u.prototype._adjustAutosuggestWidth=function(){var n=this._address.get_size().width;this._asManagerOne.setOptions({serpOptions:{width:n}});this._asManagerTwo.setOptions({serpOptions:{width:n}})},u.prototype._pushpinDragEnd=function(n,t){n===this._pushpin?(this._location=t.location,this._reverseGeocode(t.location,1),p.logAddressChange(l.POI,!1)):n===this._pushpinTwo&&(this._locationTwo=t.location,this._reverseGeocode(t.location,2),p.logAddressChange(l.POI,!0));this._downloadingIsochrone?this._updateWhenDownloadFinish=!0:(this._updateIsochrone(),this._updateWhenDownloadFinish=!1)},u.prototype._updateIsochroneCompleted=function(){this._setControlBusy(!1);this._updateWhenDownloadFinish&&(this._updateIsochrone(),this._updateWhenDownloadFinish=!1)},u.prototype._updateTitle=function(){var u=this.getAddressValue(),i=u&&u.split(",")[0],n,r,f;this._secondAddrEnabled&&this.getAddressTwoValue()&&(n=this.getAddressTwoValue(),n&&(n=n.split(",")[0]),i!==n&&(i=t.L_CmtTitleAddresses.replace("{addr1}",i).replace("{addr2}",n)));r=this._peakButton.has_class("selected")?t.L_CmtControlCommutePeak_Text:t.L_CmtControlCommuteOffPeak_Text;r=r.toLowerCase();f=t.L_CmtTitle.replace("{time}",this._time).replace("{addresses}",i).replace("{trafficCondition}",r);this._title.set_text(f);var e=parseInt(this._title.get_style("height")),o=parseInt(this._title.get_style("lineHeight")),s=Math.round(e/o);s===1?this._title.set_style({padding:"9px 0px"}):this._title.set_style({padding:"0px"})},u.prototype._setControlBusy=function(n){this._downloadingIsochrone=n;n?(this._loader&&this._loader.remove_class("hidden"),this._cmtContainer&&this._cmtContainer.add_class("disabled")):(this._cmtContainer&&this._cmtContainer.remove_class("disabled"),this._loader&&this._loader.add_class("hidden"))},u.prototype._handleIsochroneError=function(t){var f=t.isochroneLayer,i,e,r;if(f&&(i=0,i=this._cmtFeatureConfig.prefetch?this._isochroneLayers.indexOf(f):u._times.indexOf(this._time),e=u._timeButtonIds[i],r=n("#"+e),(r&&r.has_class("selected")||!this._cmtFeatureConfig.prefetch)&&(this._setControlBusy(!1),this._changeSelectedTime(0)),!r.has_class("disabled")))while(i<u._timeButtonIds.length)this._enableTimeButton(i,!1),i++},u.prototype._changeSelectedTime=function(n){if(this._selectTimeButton(n),this._cmtFeatureConfig.prefetch){this._isochroneLayer.downloadCompleted.remove(this._updateCompleteHandler);var t=this._map.getLayers();t.remove(this._isochroneLayer);this._isochroneLayer=this._isochroneLayers[n];this._isochroneLayer.downloadCompleted.add(this._updateCompleteHandler);t.insert(this._isochroneLayer);this._isochroneLayer.downloading||this._isochroneLayer.getIsochrones().length!==0||this._updateIsochrone()}else this._updateIsochrone();this._isochroneLayer.downloading&&this._setControlBusy(!0);this._updateTitle()},u.prototype._selectTimeButton=function(t){if(t>=0){this._currentSelectedTimeElement.remove_class("selected");var i=u._timeButtonIds[t];this._currentSelectedTimeElement=n("#"+i);this._currentSelectedTimeElement&&this._currentSelectedTimeElement.add_class("selected");this._time=u._times[t]}},u.prototype._resetTimeButtons=function(){for(var f,r,t=0,i=u._timeButtonIds;t<i.length;t++)f=i[t],r=n("#"+f),r&&r.remove_class("disabled")},u.prototype._enableTimeButton=function(t,i){var r=n("#"+u._timeButtonIds[t]);r&&(i?r.remove_class("disabled"):r.add_class("disabled"))},u.prototype._reverseGeocode=function(n,t){var i=this,r=new ui;r.reverseGeocode(n,function(r){var u="";u=r&&r.success&&r.addressList&&r.addressList.length>0&&r.addressList[0].formattedAddress?r.addressList[0].formattedAddress:n.latitude.toFixed(4)+","+n.longitude.toFixed(4);t===1?(i.setAddressValue(u),i._address.set_attr("value",u)):(i.setAddressTwoValue(u),i._addressTwo.set_attr("value",u));i._updateTitle()})},u._timeButtonIds=["cmt_time15","cmt_time30","cmt_time45","cmt_time60"],u._defaultSelectedTime=15,u._times=[15,30,45,60],u._iconSvg='<svg width="24" height="31" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M11 0C4.924 0 0 4.924 0 11c.011 1.666.708 3.474 1.68 5.348 1.668 3.173 4.223 6.517 6.125 8.822a91.61 91.61 0 0 0 2.517 2.898.906.906 0 0 0 1.35 0 91.509 91.509 0 0 0 2.516-2.898 76.508 76.508 0 0 0 2.587-3.306c1.278-1.734 2.561-3.648 3.54-5.516C21.292 14.474 21.99 12.667 22 11 22 4.924 17.076.002 11 0z" id="a"/><path id="b" d="M0 .25h12v7.008H0z"/><path id="d" d="M0 9.75h12V1H0z"/><\/defs><g fill="none" fill-rule="evenodd"><g transform="translate(1 1)" fill-rule="nonzero"><use fill="#111" fill-rule="evenodd" xlink:href="#a"/><path stroke="#FFF" d="M11-.5c6.352.002 11.5 5.149 11.5 11.503-.01 1.617-.6 3.386-1.742 5.577-.907 1.73-2.117 3.595-3.58 5.58a76.458 76.458 0 0 1-2.604 3.328c-.75.91-1.638 1.926-2.53 2.915a1.406 1.406 0 0 1-2.094 0 89.323 89.323 0 0 1-2.531-2.915c-2.55-3.09-4.732-6.15-6.184-8.91C.097 14.382-.489 12.618-.5 11-.5 4.648 4.648-.5 11-.5z"/><\/g><g transform="translate(6 7.75)"><mask id="c" fill="#fff"><use xlink:href="#b"/><\/mask><path d="M2.88 5.12a1.25 1.25 0 1 0-1.76 1.777A1.25 1.25 0 0 0 2.88 5.12zM10 3H1a1 1 0 0 0-1 1v1.39a2.09 2.09 0 0 1 3.48-.87c.396.391.619.923.62 1.48h2.8a2.1 2.1 0 1 1 4.2 0h.9V5a2 2 0 0 0-2-2zM8.11 5.11A1.25 1.25 0 1 0 9 4.75a1.25 1.25 0 0 0-.88.37l-.01-.01zM7.29.54a.997.997 0 0 0-.71-.29h-4a1 1 0 0 0-.89.55L1 2.25h8L7.29.54z" fill="#FFF" mask="url(#c)"/><\/g><\/g><\/svg>',u}(ot),nu=function(n){function t(t){var i=this;if(t){var r=t.getRootElement(),u=new g(0,0);i=n.call(this,r,1,u)||this}return i}return y(t,n),t}(ri),tu=function(r){function f(n,e,o){var s=r.call(this,o)||this;return bt=bt.replace("{commuteControlTitle}",t.L_CmtControlTitleText).replace("{commuteTime30}",t.L_CmtControlCommuteTime30Text).replace("{commuteTime45}",t.L_CmtControlCommuteTime45Text).replace("{commuteTime60}",t.L_CmtControlCommuteTime60Text).replace("{commuteTime15}",t.L_CmtControlCommuteTime15Text).replace("{commutePeak}",t.L_CmtControlCommutePeak_Text).replace("{commuteOffPeak}",t.L_CmtControlCommuteOffPeak_Text).replace("{doneText}",t.L_CmtDoneText).replace("{placeHolder}",t.L_CmtPlaceHolderText).replace("{placeHolder}",t.L_CmtPlaceHolderText).replace("{errorMessage}",t.L_CmtErrorMessage),s.setTemplate(new rt(bt,{stopEvent:function(n){return s._stopEvent(n)},onTimeClicked:function(n){return s._onTimeClicked(n)},onPeakClicked:function(n){return s._onPeakClicked(n)},onDoneClicked:function(){return s._onDoneClicked()}})),s._map=n,s._cmtFeatureConfig=c.features.commutability,s.defineProperty("addressValue"),s._time=f._defaultSelectedTime,s._departureTime=s._cmtFeatureConfig.peakTime,s._location=s._map.getBounds(!0).center,s._pushpinLayer=new ii("Commutability_Layer"),s._isochroneOptions={intersectionOptions:{fillColor:s._cmtFeatureConfig.intersectFillColor,strokeColor:s._cmtFeatureConfig.isochroneStrokeColor,strokeThickness:s._cmtFeatureConfig.isochroneStrokeThickness,secondaryStrokeColor:s._cmtFeatureConfig.isochroneSecondaryStrokeColor,secondaryStrokeThickness:s._cmtFeatureConfig.isochroneSecondaryStrokeThickness},showIntersection:!!s._cmtFeatureConfig.showIntersection,showUnion:!!s._cmtFeatureConfig.showUnion,showIsochrones:!!s._cmtFeatureConfig.showIsochrones,applyCardinalSpline:typeof s._cmtFeatureConfig.applyCardinalSpline=="boolean"?s._cmtFeatureConfig.applyCardinalSpline:!1},s._isochroneLayer=e,s._isochroneLayer.attachMap(s._map),s._isochroneLayer.setOptions(s._isochroneOptions),s._updateCompleteHandler=function(){return s._updateIsochroneCompleted()},s._isochroneLayer.downloadCompleted.add(s._updateCompleteHandler),s._isochroneLayer.downloadError.add(function(n){return s._handleIsochroneError(n)}),s.disposables.push(s.doneClickedEvent=new u),s.disposables.push(s.pushpinClickedEvent=new u),i.loadModule("Microsoft.Maps.AutoSuggest",function(){var n=s._cmtFeatureConfig.autoSuggestMaxResult||5,t={maxResults:n,map:s._map,serpOptions:{showMyLocation:!0,suggestionTypes:"place,business,address",selectFirstOnEnter:!0}},r=i.AutosuggestManager;s._asManagerOne=new r(t);s._asManagerOne.attachAutosuggest("#cmt_addressOne","#cmt_addressDivOne",function(n){s._processAutoSuggestResult(n.location,n.formattedSuggestion);p.logAddressChange(l.Autosuggest,!1)});s._adjustAutosuggestWidth();s.disposables.push(s._asManagerOne)}),s}return y(f,r),f.prototype.attachIsochrone=function(){this._map.getLayers().insertAll([this._isochroneLayer,this._pushpinLayer]);p.logColtrolActivation()},f.prototype.detachIsochrone=function(){this._map.getLayers().remove(this._isochroneLayer);this._map.getLayers().remove(this._pushpinLayer);p.logColtrolDeactivation()},f.prototype.dispose=function(){this.detachIsochrone();this._isochroneLayer&&this._isochroneLayer.dispose();this._pushpinLayer&&this._pushpinLayer.dispose();this._pushpin&&this._pushpin.dispose();r.prototype.dispose.call(this);h._clearDisposables(this.disposables);h._nullifyClass(this)},f.prototype.postInit=function(){(this._cmtContainer=n("#cmt_container"),this._cmtContainer)&&(this._title=n("#cmt_title"),this._address=n("#cmt_addressOne"),this._doneButton=n("#cmt_done"),this._peakButton=n("#cmt_peak"),this._loader=n("#cmt_loader"),this._error=n("#cmt_err"),this._currentSelectedTimeElement=n(".cmt_time.selected"),this._currentSelectedDepartureElement=n(".cmt_Depart .selected"),this._setControlBusy(!1))},f.prototype._stopEvent=function(n){n.stopPropagation()},f.prototype._onDoneClicked=function(){if(!this._doneButton.has_class("disabled")){if(this._pushpin){this._pushpin.setLocation(this._location);var n=t.L_CmtTooltipTitle.replace("{time}",this._time),i=t.L_CmtTooltipDescription;this._infobox.setHtmlContent(hi.replace("{title}",n).replace("{description}",i));this._infobox.setLocation(this._location)}else this._showPinAndInfobox();this._updateIsochrone();this._updateTitle();this.doneClickedEvent.invoke();p.logButtonClick(this._doneButton.get_attr("id"))}},f.prototype._onTimeClicked=function(t){var u=t.target,i=u.id,r;this._downloadingIsochrone||i===this._currentSelectedTimeElement.get_attr("id")||n("#"+i).has_class("disabled")||(r=f._timeButtonIds.indexOf(i),this._changeSelectedTime(r),p.logButtonClick(i))},f.prototype._onPeakClicked=function(t){var r=t.target,i=r.id;this._downloadingIsochrone||i===this._currentSelectedDepartureElement.get_attr("id")||(this._departureTime=i==="cmt_peak"?this._cmtFeatureConfig.peakTime:this._cmtFeatureConfig.offPeakTime,this._currentSelectedDepartureElement.remove_class("selected"),this._currentSelectedDepartureElement=n("#"+i),this._currentSelectedDepartureElement.add_class("selected"),p.logButtonClick(i))},f.prototype._processAutoSuggestResult=function(n,t){this._doneButton.remove_class("disabled");var i=this._location;this._pushpin&&lt.areEqual(i,n,!0)||(this._location=n,this.setAddressValue(t),this._hideInfobox(0),this._updateMapView())},f.prototype._updateIsochrone=function(){var n,t,i;this._resetTimeButtons();this._hideInfobox(0);this._error.add_class("hidden");this.getAddressValue()||this._reverseGeocode(this._location);this.getAddressValue()!==this._address.get_attr("value")&&this._address.set_attr("value",this.getAddressValue());n=null;(!this._peakButton||this._peakButton.has_class("selected"))&&(n="timeWithTraffic");t=this._buildRequest(this._time,n);i=[t];this._setControlBusy(!0);this._isochroneLayer.setRequests(i)},f.prototype._buildRequest=function(n,t){var r=this._location,u=this._cmtFeatureConfig.isochroneOneFillColor,i={maxTime:n,startPoint:r,departTime:this._departureTime,optimize:t,displayOptions:{fillColor:u,strokeColor:this._cmtFeatureConfig.isochroneStrokeColor}};return i.displayOptions.strokeThickness=this._cmtFeatureConfig.isochroneStrokeThickness,i.displayOptions.secondaryStrokeColor=this._cmtFeatureConfig.isochroneSecondaryStrokeColor,i.displayOptions.secondaryStrokeThickness=this._cmtFeatureConfig.isochroneSecondaryStrokeThickness,i},f.prototype._updateMapView=function(){var o=[this._location],n=this._map.getMode().getMapViewForLocationsInView(o),i=st.fromLocation(n.cameraLocation,!1),r=this._map.getMercatorZoomLevel();if(i>r){var t=this._map.getViewportPadding(),u=this._map.getViewport(),f=new g(t.left,t.top),e=new g(u.pixelWidth-t.right,u.pixelHeight-t.bottom),s=new g((f.x+e.x)/2,(f.y+e.y)/2);n=this._map.getMode().getMapViewZoomedAboutLocationAtPoint(n,n.cameraLocation,s,r-i)}this._map.setView(n)},f.prototype._adjustAutosuggestWidth=function(){var n=this._address.get_size().width;this._asManagerOne.setOptions({serpOptions:{width:n}})},f.prototype._pushpinDragEnd=function(n,t){this._location=t.location;this._reverseGeocode(t.location);this._hideInfobox(0);p.logAddressChange(l.POI,!1);this._downloadingIsochrone?this._updateWhenDownloadFinish=!0:(this._updateIsochrone(),this._updateWhenDownloadFinish=!1)},f.prototype._updateIsochroneCompleted=function(){this._setControlBusy(!1);this._updateWhenDownloadFinish&&(this._updateIsochrone(),this._updateWhenDownloadFinish=!1)},f.prototype._updateTitle=function(){var i=this.getAddressValue(),u=i&&i.split(",")[0],n=this._peakButton.has_class("selected")?t.L_CmtControlCommutePeak_Text:t.L_CmtControlCommuteOffPeak_Text,r;n=n.toLowerCase();r=t.L_CmtTitle.replace("{time}",this._time).replace("{addresses}",u).replace("{trafficCondition}",n);this._title.set_text(r)},f.prototype._setControlBusy=function(n){this._downloadingIsochrone=n;n?(this._loader&&this._loader.remove_class("hidden"),this._cmtContainer&&this._cmtContainer.add_class("disabled")):(this._cmtContainer&&this._cmtContainer.remove_class("disabled"),this._loader&&this._loader.add_class("hidden"))},f.prototype._handleIsochroneError=function(){this._setControlBusy(!1);this._error.remove_class("hidden")},f.prototype._changeSelectedTime=function(n){this._selectTimeButton(n);this._isochroneLayer.downloading&&this._setControlBusy(!0)},f.prototype._selectTimeButton=function(t){if(t>=0){this._currentSelectedTimeElement.remove_class("selected");var i=f._timeButtonIds[t];this._currentSelectedTimeElement=n("#"+i);this._currentSelectedTimeElement&&this._currentSelectedTimeElement.add_class("selected");this._time=f._times[t]}},f.prototype._resetTimeButtons=function(){for(var u,r,t=0,i=f._timeButtonIds;t<i.length;t++)u=i[t],r=n("#"+u),r&&r.remove_class("disabled")},f.prototype._enableTimeButton=function(t,i){var r=n("#"+f._timeButtonIds[t]);r&&(i?r.remove_class("disabled"):r.add_class("disabled"))},f.prototype._reverseGeocode=function(n){var t=this,i=new ui;i.reverseGeocode(n,function(i){var r="";r=i&&i.success&&i.addressList&&i.addressList.length>0&&i.addressList[0].formattedAddress?i.addressList[0].formattedAddress:n.latitude.toFixed(4)+","+n.longitude.toFixed(4);t.setAddressValue(r);t._address.set_attr("value",r);t._updateTitle()})},f.prototype._showPinAndInfobox=function(){var u=this,n,r;this._pushpin=new i.Pushpin(this._location,{icon:f._iconSvg,draggable:!0,text:t.L_CmtControlPushpinTitle});this._attachPushpinEventHandlers();this._pushpinLayer.add(this._pushpin);n=t.L_CmtTooltipTitle.replace("{time}",this._time);r=t.L_CmtTooltipDescription;this._infobox=new gi(this._location,{htmlContent:hi.replace("{title}",n).replace("{description}",r),visible:!0,closeDelayTime:f._closeDelayTime,offset:f._tooltipAnchorOffset});this._infobox.setMap(this._map);this._infobox.mouseleave.addOne(function(){u._hideInfobox(0)})},f.prototype._hideInfobox=function(n){this._infobox&&this._infobox.getVisible()&&this._infobox.setOptions({closeDelayTime:n,visible:!1})},f.prototype._attachPushpinEventHandlers=function(){var n=this;this._pushpin.mouseover=new u;this._pushpin.mouseout=new u;this._pushpin.dragstart=new u;this._pushpin.dragend=new u;this._pushpin.click=new u;this.disposables.push(this._pushpin.mouseout.add(function(){return n._hideInfobox(0)}),this._pushpin.mouseover.add(function(){n._infobox.setOptions({visible:!0})}),this._pushpin.dragstart.add(function(){return n._hideInfobox(0)}),this._pushpin.dragend.add(function(t){n._infobox.setLocation(n._pushpin.getLocation());n._pushpinDragEnd(n._pushpin,t)}),this._pushpin.click.add(function(){n.pushpinClickedEvent&&n.pushpinClickedEvent.invoke()}))},f._timeButtonIds=["cmt_time15","cmt_time30","cmt_time45","cmt_time60"],f._defaultSelectedTime=15,f._times=[15,30,45,60],f._iconSvg='<svg width="24" height="31" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M11 0C4.924 0 0 4.924 0 11c.011 1.666.708 3.474 1.68 5.348 1.668 3.173 4.223 6.517 6.125 8.822a91.61 91.61 0 0 0 2.517 2.898.906.906 0 0 0 1.35 0 91.509 91.509 0 0 0 2.516-2.898 76.508 76.508 0 0 0 2.587-3.306c1.278-1.734 2.561-3.648 3.54-5.516C21.292 14.474 21.99 12.667 22 11 22 4.924 17.076.002 11 0z" id="a"/><path id="b" d="M0 .25h12v7.008H0z"/><path id="d" d="M0 9.75h12V1H0z"/><\/defs><g fill="none" fill-rule="evenodd"><g transform="translate(1 1)" fill-rule="nonzero"><use fill="#111" fill-rule="evenodd" xlink:href="#a"/><path stroke="#FFF" d="M11-.5c6.352.002 11.5 5.149 11.5 11.503-.01 1.617-.6 3.386-1.742 5.577-.907 1.73-2.117 3.595-3.58 5.58a76.458 76.458 0 0 1-2.604 3.328c-.75.91-1.638 1.926-2.53 2.915a1.406 1.406 0 0 1-2.094 0 89.323 89.323 0 0 1-2.531-2.915c-2.55-3.09-4.732-6.15-6.184-8.91C.097 14.382-.489 12.618-.5 11-.5 4.648 4.648-.5 11-.5z"/><\/g><g transform="translate(6 7.75)"><mask id="c" fill="#fff"><use xlink:href="#b"/><\/mask><path d="M2.88 5.12a1.25 1.25 0 1 0-1.76 1.777A1.25 1.25 0 0 0 2.88 5.12zM10 3H1a1 1 0 0 0-1 1v1.39a2.09 2.09 0 0 1 3.48-.87c.396.391.619.923.62 1.48h2.8a2.1 2.1 0 1 1 4.2 0h.9V5a2 2 0 0 0-2-2zM8.11 5.11A1.25 1.25 0 1 0 9 4.75a1.25 1.25 0 0 0-.88.37l-.01-.01zM7.29.54a.997.997 0 0 0-.71-.29h-4a1 1 0 0 0-.89.55L1 2.25h8L7.29.54z" fill="#FFF" mask="url(#c)"/><\/g><\/g><\/svg>',f._closeDelayTime=5e3,f._tooltipAnchorOffset=new g(15,-15),f}(ot),iu=function(n){function t(t){var i=this;if(t){var r=t.getRootElement(),u=new g(0,0);i=n.call(this,r,1,u)||this}return i}return y(t,n),t}(ri),p=function(){function n(){}return n.logAddressChange=function(t,i){var r={logData:{feature:v.Commutability,action:n.AddressChange,data:{METHOD:t,IS:i}}};s.invokeHandler(o.instrumentationDataHandlerKey,r)},n.logButtonClick=function(n){var t={logData:{feature:v.Commutability,action:"C",data:{BID:n}}};s.invokeHandler(o.instrumentationDataHandlerKey,t)},n.logColtrolActivation=function(){var n={logData:{feature:v.Commutability,action:"A",data:{EP:l.ContextMenu}}};s.invokeHandler(o.instrumentationDataHandlerKey,n)},n.logColtrolDeactivation=function(){var n={logData:{feature:v.Commutability,action:"D",data:{EP:l.ContextMenu}}};s.invokeHandler(o.instrumentationDataHandlerKey,n)},n}(),kt;(function(i){function g(t,f){var v=this,s,o;a||(a=!0,c=f,l=t,r=n("#b_TriviaOverlay"),h=0,i.serializableObjectChanged=new u,s=l.getContainer(),s.instanceAsync("BrowserHistoryManager",function(n){if(e=n,e)try{e.register("MktTourHelper",v)}catch(t){}},null,!0),o=r.select(".ulcSlides .slideImage"),o&&o.length>0&&(o.for_each(function(n){var i=n.getAttribute("data-task"),t;i&&(t=n.getAttribute("data-serpquery"),t||n.addEventListener("click",function(n){return nt(n)}))}),ut(),ft()),sj_cook.set("_SS","BTQID","-",!1,"/"),o&&k(o),ot(),sj_evt.bind("ovlShow",st))}function nt(n){var t=n.currentTarget,i,u,f;t.classList.contains("sldShown")||t.classList.contains("inactive")||(t.classList.add("sldShown"),h=Number(t.getAttribute("data-slideid")),p(),k(r.select(".ulcSlides .slideImage")),w(),b(t),y(),i=JSON.parse(t.getAttribute("data-task")),u=i&&i.state,s.invokeHandler(o.taskDataHandlerKey,i),f=u.query||u.taskTitle||u.title,v(f),d())}function tt(t){if(t!==null&&t.activeSlideId!=="undefined"&&t.activeSlideId>-1){var i=t.activeSlideId,u=r.select(".ulcSlides .slideImage");u.length>0&&(u.for_each(function(t){var r=Number(t.getAttribute("data-slideId"));r<=i?n(t).add_class("sldShown"):(n(t).remove_class("sldShown"),r>i+1&&n(t).add_class("inactive"))}),w(i),i>0&&y(),b(u[i]));h=i}}function it(){return{activeSlideId:h}}function rt(n){tt(n)}function ut(){var n=r.select(".nextULC .slideImage.btSINext");n&&n.length>0&&n.add_event("click",function(t){var f=_w.btULCinfo,e=n.get_attr("data-slideid"),c=Number(e),i,u;c===f.totalSlide?(t.preventDefault(),t.stopImmediatePropagation(),h=0,i=JSON.parse(n.get_attr("data-task")),i&&(p(),f.summaryPageUrl="",n.set_attr("data-url",""),s.invokeHandler(o.taskDataHandlerKey,i),v(""),et()),r.select("#rqCloseBtn").fireEvent("click")):(u=r.select(".btsImg"+n.get_attr("data-slideid")),u&&u.fireEvent("click"))})}function ft(){var n=r.select("#rqCloseBtn");n&&n.length>0&&n.add_event("click",function(){e&&e.unregister("MktTourHelper")})}function et(){var n=document.getElementById("maps_sb");n&&(n.placeholder=t.SearchGhostText,n.focus())}function v(n){var t=document.getElementById("maps_sb");t&&(t.value=n)}function y(){var n="_SS";sj_cook.set(n,"BTQID","-",!1,"/");sj_cook.set(n,"BTSID","-",!1,"/");sj_cook.set(n,"BTSlClk","-",!1,"/");sj_cook.set(n,"BTOID","-",!1,"/");sj_cook.set(n,"BTMC","-",!1,"/");sj_cook.set(n,"BTULCTtl","-",!1,"/")}function p(){c.removeAllStacks(!1)}function w(n){var i=r.select(".slideImage.btSINext"),f,t,e,u;i.length>0&&(n=n===null||n===undefined?Number(i.get_attr("data-slideid")):n,f=n+1,t=_w.btULCinfo,t&&(t.currentSlide=n,e=r.select(".btsImg"+f),u=r.select(".btULCTeaser"),i.set_attr("data-slideId",f.toString()),f===t.totalSlide?(u.length>0&&u.set_text(i.get_attr("data-title")),t.summaryPageUrl=i.get_attr("data-Url"),t.slideCompleted=!0):e.length>0&&u.length>0&&u.set_text(e.get_attr("title"))))}function b(n){var i=r.select(".bt_title"),t;i.set_text(n.getAttribute("data-title"));t=r.select(".bt_desc");t.set_text(n.getAttribute("data-description"))}function ot(){var t,i;r.select(".ulcSlides").set_style({width:"calc(100% - 280px)"});t=n("#b_footer");t&&t.length>0&&(i=n("ul",t[0]),i&&i.length>0&&t.insertBefore(r,i[0]));d()}function k(n){if(n.length!==0){var t=-1;n.for_each(function(n){n.classList.contains("sldShown")?t=Number(n.getAttribute("data-slideid")):Number(n.getAttribute("data-slideid"))-t>1?n.classList.contains("inactive")||n.classList.add("inactive"):n.classList.contains("inactive")&&n.classList.remove("inactive")})}}function d(){var t=n(".overlayPanel",r[0]),i;t&&t.length>0&&(t.set_style({"margin-top":"0","background-color":"#fafafa"}),f=t.get_style("height"),r.set_style({height:f}),i=n(".btOverlay",r[0]),i&&i.length>0&&i.set_style({bottom:"auto",height:f}))}function st(){var t,r,i,u;if(f&&(t=n(".ent_ovlc"),t&&t.length>0))for(r=0;r<t.length;r++)i=n(".ovl",t[r]),i&&i.length>0&&(i.set_style({bottom:f}),u=n("ovlbg",i[0]),u&&u.length>0&&u.set_style({bottom:f}))}var r,c,l,e,h,f,a;i.initialize=g;i.serialize=it;i.deserialize=rt})(kt||(kt={}));var w=function(){function n(){}return n.log=function(t,i,r){s.invokeHandler(o.instrumentationDataHandlerKey,{logData:{feature:n.Feature,action:t,data:i},flush:r})},n.Feature="PRT",n.Submit="S",n.Activate="A",n.Deactivate="D",n.TaskBar="T",n.Filter="FLTR",n.TaskCardHeader="H",n.TaskType="TYP",n.MapOnly="MO",n.TextOnly="TO",n.MapAndText="MAT",n}(),ru=function(r){function f(i){var f=this,o={},s=t,e={};return f=r.call(this,vr,"PrintContainer",e,o,s)||this,f._poiLayers=[],f._map=i,f._window=n(window),f.resources=s,f._printMapReady=!1,f._printDisplayOption=0,f.onPrintDialogClose=new u,f.onPrintDialogOpen=new u,f.generateContextMapUrl(),e.onPrintClick=function(n){return f._onPrintClick(n)},e.onCloseClick=function(n){return f._onCloseClick(n)},e.onMouseWheel=function(n){return f._onMouseWheel(n)},e.onMapTextClick=function(n){n.preventDefault();n.stopImmediatePropagation();f._toggleMapAndText(!0,!0,f.getRootElement().select(".printMapAndText"))},e.onMapOnlyClick=function(n){n.preventDefault();n.stopImmediatePropagation();f._toggleMapAndText(!0,!1,f.getRootElement().select(".printMapOnly"))},e.onTextOnlyClick=function(n){n.preventDefault();n.stopImmediatePropagation();f._toggleMapAndText(!1,!0,f.getRootElement().select(".printTextOnly"))},f.notesMaxCharSize=d.notesMaxChars,o.defineProperty("printContentList"),f.setPrintContentList(new yt),f}return y(f,r),f.prototype.loadPrintMap=function(){var e=this,t,u,f;r.prototype.OpenDialog.call(this);t=this.getRootElement();u=t.getParent().select(".defaultPrintMessage");u.swap_class("showPrintErrorMessage","hidePrintErrorMessage");t.select(".PrintContainer").set_attr("data-tag","PrintContainer");this._hasPrintableTasks=this._getPrintTasksAvailable();this._hasPrintableTasks&&(n(".PrintContainer .baseMapPrint").removeFromParent(),this._addPrintPreviewContent());this._mapHolder=n(".PrintContainer .printMap");f={mapType:this._map.getMapType().id,zoom:this._map.getMercatorZoomLevel(),credentials:d.credentials,navigationOptions:{lockCameraAltitude:!1,lockCameraHeading:!0},enableInertia:!1,disableDiffFrame:!0,showLandmarks:!0,isPrintMode:!0,showLogo:!0,showLocateMeButton:!1,disableStreetside:!0,disableStreetsideAutoCoverage:!0,labelOptions:{labelVisibility:this._map.getLabelController().getIsLabelsEnabled()?ei.visible:ei.hidden},heading:this._map.getView().heading};i.loadMap({element:this._mapHolder,mapOptions:f},function(n){return e._finishPrintMapSetup(n)},!0)},f.prototype.addPrintContent=function(n){n&&this.getPrintContentList().insert(n)},f.prototype.setDialogSize=function(n){if(n.height&&n.width){var t=this.getRootElement();t.select(".printContent").set_style({height:(n.height>f.BaseMapHeaderFooterPadding?n.height-f.BaseMapHeaderFooterPadding:0)+"px"})}},f.prototype.onWindowResize=function(){this.setDialogSize(new fi(window.innerWidth,window.innerHeight))},f.prototype._onMouseWheel=function(n){this._mapEditOn&&n.preventDefault();n.stopPropagation()},f.prototype._toggleMapAndText=function(n,t,i){var r=this.getRootElement(),u;r.select(".isMap").swap_class(n?"hideMap":"showMap",n?"showMap":"hideMap");r.select(".isText").swap_class(t?"hideText":"showText",t?"showText":"hideText");u=n&&!t;r.select(".taskMapPrint").swap_class(u?"taskMapPrintPageBreak":"taskMapPrintNoPageBreak",u?"taskMapPrintNoPageBreak":"taskMapPrintPageBreak");this.getRootElement().select(".mapTextOptions").remove_class("selected");i.add_class("selected");this._printDisplayOption=n?t?0:1:2;w.log(w.Filter,{CLK:n?t?w.MapAndText:w.MapOnly:w.TextOnly})},f.prototype._finishPrintMapSetup=function(t){var r=this,h,f,e,s,c,o,u;this._printMiniMap=t;h=ut.getMapCenter(this._map);f=ut.getMercatorZoomLevel(this._map);this._map.getMapType().id!==a.birdseye&&(f=f>2&&this._hasPrintableTasks?f-1:f);this._printMiniMap=t;this.disposables.push(this._printMiniMap);this._printMiniMap.setDesiredSize({width:-1,height:-1});this._printMiniMap.setView(new nr(i.ZoomLevel.toLocation(h,f,!0),this._map.getView().heading),null);this._showMiniMapNavigationBar(!1);e=this.getRootElement();s=this._hasPrintableTasks?"taskMap":"baseMap";e.select(".printMap").add_class(s);e.select(".printArea").add_class(s);this.setDialogSize(new fi(window.innerWidth,window.innerHeight));this._windowSizeHandler=function(){return r.onWindowResize()};this._window.add_event("resize",this._windowSizeHandler);e.select(".printContent")[0].scrollTop=0;n(".mapAndTextPrint").set_style({display:this._hasPrintableTasks?"inline":"none"});c=t.getContainer();c.instanceAsync("MapInteraction",function(n){r._mapInteraction=n;n.setOptions({disableAllInteractions:!0});n.disableInteractionModes(704)});n(".taskPrintContent").add_event("click",function(n){n.preventDefault();n.stopPropagation();n.cancelBubble=!0});this._printMiniMap.getOverlayManager().then(function(){var e,o,t,i,u,n,f;for(r._updateLandmarkClickBehavior(),e=r.getPrintContentList(),o=r.getRootElement().select(".taskPrintContent"),t=0;t<e.length;t++){for(i=e[t],r._hasPrintableTasks||r._addContentToDom(i,o,t),u=i.getLayers(),n=0;u&&n<u.length;n++)r._addLayer(u[n]);for(f=i.getLayerIds(),n=0;f&&n<f.length;n++)r.addLayerPois(f[n])}r.onPrintDialogOpen.invoke();r._printMapReady=!0;r._addEditButton();r._isPrinted=!1});this._hasPrintableTasks?(o=n(".printMapAndText"),o&&o.length>0?o[0].focus():(u=n(".waypointNotes")?n(".waypointNotes"):n(".searchNotes")?n(".searchNotes"):n("#baseMapNotes"),u&&u.length>0&&u[0].focus())):(u=n("#baseMapNotes"),u&&u.length>0&&u[0].focus())},f.prototype.generateContextMapUrl=function(){var i=d.printImgOverviewMapUrlFormat,t=ut.getMapCenter(this._map),r=d.credentials,n=ut.getMercatorZoomLevel(this._map);n=n>4?n-2:d.minZoomLevel;this.overviewContextMap=i.replace("{credentials}",d.credentials).replace("{zoom}",n.toString()).replace("{lat}",t.latitude.toString()).replace("{lon}",t.longitude.toString()).replace("{cmnPltParam}",c.platformCommonParam)},f.prototype._addEditButton=function(){var u=this,r=this.getRootElement().select(".printArea"),t,n,i;r&&(t=h._createElement("div"),t.add_class("bm_mapEditButton"),t.set_attr("data-tag","mapEditButton"),n=h._createElement("a"),n.add_class("textButton"),n.set_attr("href","#"),n.set_attr("role","button"),n.set_attr("data-tag","editButton"),n[0].innerHTML=this.resources.L_EditMap_Text,t.append(n),i=this.getRootElement().select(".printMap"),i&&i.length>0?r[0].insertBefore(t[0],i[0]):r.append(t),n.add_event("click",function(n){n.preventDefault();n.stopPropagation();n.cancelBubble=!0;u._toggleEditMap(n)}))},f.prototype._toggleEditMap=function(n){this._mapEditOn=n.target.innerHTML===this.resources.L_EditMap_Text;n.target.innerHTML=this._mapEditOn?this.resources.L_EditMapDone_Text:this.resources.L_EditMap_Text;this._mapInteraction.setOptions({disableAllInteractions:!this._mapEditOn});this._showMiniMapNavigationBar(this._mapEditOn)},f.prototype._addPrintPreviewContent=function(){for(var i=this.getPrintContentList(),r=this.getRootElement().select(".taskPrintContent"),t=0;t<i.length;t++)this._addContentToDom(i[t],r,t);n(".svg",this.getRootElement()[0]).inlineDataSvgs().remove_class("svg")},f.prototype._addContentToDom=function(n,t,i){var u=n&&n.getHtmlContent(),f=n&&n.getCssScope(),r;u&&(r=h._createElement("div"),r.add_class(i==0?"bm_firstTaskContent":"bm_taskContent"),r.set_attr("data-tag","taskContent-"+i),f&&r.add_class(f),r[0].innerHTML=u,t.append(r))},f.prototype._getPrintTasksAvailable=function(){for(var t=this.getPrintContentList(),n=0;n<t.length;n++)if(t[n].getHtmlContent()!=null)return!0;return!1},f.prototype._updateLandmarkClickBehavior=function(){this._printMiniMap.getLandmarksManager().then(function(n){n.removePrimitiveTapped();n.removePrimitiveHover()})},f.prototype._addLayer=function(n){if(n){var t=this._printMiniMap.getLayers();t.insert(n);this._poiLayers.push(n)}},f.prototype.addLayerPois=function(n){var r=this._printMiniMap.getLayers(),t=dt.getMapLayerById(n,this._map),s=t.getZIndex(),u,o,h,e,i;if(t.getVisible()&&n!=="Microsoft.Maps.StreetsideCoverage")if(t instanceof pt){for(u=0;u<r.length;u++)if(o=r[u],o&&o.getId()===n)return;h=t;e=new pt(f.PrintLayerPrefix+t.getId(),h.getDataSource(),t.getTemplateSelector(),s);e.setRenderTarget(t.getRenderTarget());r.insert(e);this._poiLayers.push(e)}else if(t instanceof ct){var a=t,c=this._map.getView(),l=a.getScene(null,ut.getMapCenter(this._map),st.toScale(c.cameraLocation,st.fromLocation(c.cameraLocation,!0),!0),0);l!=null&&(i=new ct(f.PrintLayerPrefix+t.getId(),s),i.setRenderTarget(t.getRenderTarget()),i.addScene(10,l,0),r.insert(i),this._poiLayers.push(i))}},f.prototype._removeLayerPois=function(){for(var t=this._printMiniMap.getLayers(),n=this._poiLayers.pop();n;)t.remove(n),n.dispose(),n=this._poiLayers.pop()},f.prototype._showMiniMapNavigationBar=function(n){var r=this,t=this._printMiniMap.getNavigationBar(),i;t?n?(t.setVisible(!0),t.setRotateButtonVisible(!1),t.setMapStyleSelectorControlVisible(!1),t.setLocateMeButtonVisible(!1),i=t.getZoomControl()?t.getZoomControl().zoomInButton:null,i&&i.getRootElement()[0].focus()):t.setVisible(!1):this._printMiniMap.navigationBarLoaded.addOne(function(){return r._showMiniMapNavigationBar(n)})},f.prototype._onPrintClick=function(n){(n.preventDefault(),this._printMapReady)&&(this.prepareForPrint(),window.print(),w.log(w.Submit,{NUM_TASKS:this.getPrintContentList().length,FLTR:this._printDisplayOption==2?w.TextOnly:this._printDisplayOption==1?w.MapOnly:w.MapAndText}),d.dialogOpenAfterPrint?this._isPrinted=!0:(this.revertPrintSetup(),this._closeDialog()))},f.prototype._onCloseClick=function(n){if(n.preventDefault(),w.log(w.Deactivate),this._isPrinted&&d.dialogOpenAfterPrint&&(this._isPrinted=!1,this.revertPrintSetup()),d.dialogOpenAfterPrint){var t=document.getElementsByName("viewport")[0];t&&t.setAttribute("content","user-scalable=no, width=device-width, maximum-scale=1.0")}this._closeDialog()},f.prototype._closeDialog=function(){var n=this.getRootElement(),t=n.getParent().select(".defaultPrintMessage");t.swap_class("hidePrintErrorMessage","showPrintErrorMessage");this._mapInteraction.setOptions({disableAllInteractions:!1});n&&(n.select(".printMap").clear(),n.select(".taskPrintContent").clear());this.onPrintDialogClose.invoke();this.CloseDialog();this.dispose()},f.prototype.prepareForPrint=function(){var t=this.getRootElement(),i=t.select(".screenNotes textarea")[0],r=t.select(".printedNotes")[0];i&&r&&(r.innerHTML=n.Internals.HTMLEncode(i.value).replace(/\n/g,"<BR>"));this._printDisplayOption==2&&(this._removeLayerPois(),t.select(".isMap").removeFromParent());n("#bingLogo").inlineDataSvgs().remove_attr("height").remove_attr("width").set_attr("viewBox","50 0 92 92")},f.prototype.revertPrintSetup=function(){var t=this.getRootElement(),n=t.select(".printedNotes")[0];n&&(n.innerHTML="")},f.prototype.dispose=function(){this._printMiniMap.dispose();this._windowSizeHandler&&(this._window.remove_event("resize",this._windowSizeHandler),this._windowSizeHandler=null);r.prototype.dispose.call(this)},f.BaseMapHeaderFooterPadding=136,f.PrintLayerPrefix="Print_",f}(at),dt=function(){function t(i,r){this._map=i;this._taskManager=r;t.onPrintDialogClose=new u;t.onPrintDialogOpen=new u;n(window).add_event("keydown",function(n){n.keyCode===27&&t.onPrintDialogClose.invoke()})}return t.prototype.showPrintDialog=function(n){var u,r,i;n&&(nt.isFullScreen&&nt.exitFullScreen(),u=window.matchMedia("(orientation: portrait)"),d.dialogOpenAfterPrint&&u&&(r=document.getElementsByName("viewport")[0],r&&r.setAttribute("content","user-scalable=no, maximum-scale=1.0")),i=new ru(this._map),i.onPrintDialogClose.addOne(function(){return t.onPrintDialogClose.invoke()}),i.onPrintDialogOpen.addOne(function(){return t.onPrintDialogOpen.invoke()}),this._createPrintContent(i,n),i.loadPrintMap(),w.log(w.Activate,{EP:n.source==1?w.TaskBar:w.TaskCardHeader,TYP:n.taskType?n.taskType:"",CD:n.data}))},t.getMapLayerById=function(n,t){for(var r=t.getLayers(),i=0;i<r.length;i++)if(n===r[i].getId())return r[i]},t.prototype._createPrintContent=function(n,t){var r,f,i;if(t.source==2&&t.taskId)r=this._taskManager.getTaskById(t.taskId),r&&r.hasPrintContent()&&n.addPrintContent(r.getPrintContent());else{var u=null,h=this._taskManager.getFocusedStack(),e=h&&h.getForegroundTask();e&&e.hasPrintContent()&&(u=e.getPrintContent(),n.addPrintContent(u));var o=new yt,c=this._map.getLayers(),s=u&&u.getLayerIds();for(f=0;f<c.length;f++)if(i=c[f],i instanceof pt||i instanceof ct){if(s&&s.length>0&&s[0]===i.getId()||i.getId().indexOf("TrafficIncidents")>=0)continue;o.insert(i.getId())}o.length>0&&n.addPrintContent(new ur(null,o))}},t}(),uu=function(n){function t(t,i,r){var f=this,u={};return f=n.call(this,u)||this,u.defineProperty("name"),u.defineProperty("isSelected"),u.defineProperty("taskAriaLabel"),u.defineProperty("index"),u.defineProperty("icon"),f.setName(t),f.setIsSelected(i),f.setTaskAriaLabel(r),f}return y(t,n),t}(vt),fu=function(i){function r(){var r=this,f={},e;return r=i.call(this,f)||this,r._privates=f,f.defineProperty("sharingLinkAvailable",null,null,{defaultValue:!1,isPrivate:!0}),f.defineProperty("permalinkString",null,null,{defaultValue:t.L_Link_Generating_Text,isPrivate:!0}),f.defineProperty("isShortPermalinkDisplayed",null,null,{defaultValue:!1,isPrivate:!0}),f.defineProperty("errorMessage",null,null,{defaultValue:"",isPrivate:!0}),f.defineProperty("enableSharingVisibility",null,null,{defaultValue:k.isShorteningEnabled?"visible":"hidden",isPrivate:!0}),f.defineProperty("hasAtLeastOneSharableStack",null,null,{defaultValue:!1,isPrivate:!0}),f.defineProperty("enableSocialSharing",null,null,{defaultValue:k.isEnableSocialSharing,isPrivate:!0}),f.defineProperty("taskList"),f.defineProperty("titleText",null,null,{defaultValue:t.L_Permalink_Prompt}),r.setTaskList([]),r.controlUpdated=new u,e={availableToLinkClass:function(n){return n?"":"nonClickable"},availableToShareButtonClass:function(n){return n?"shareButton":"shareButton nonClickable"},availableToButtonClass:function(n){return n?"textButton":" textButton nonClickable"},displayStateToLinkText:function(n){return n?t.L_LengthenButton_Text:t.L_ShortenButton_Text},errorMessageToVisibility:function(n){return n&&n.length>0?"visible":"hidden"},errorMessageToNotDisplay:function(n){return n&&n.length>0?"none":""},boolToDisplay:function(n){return n?"":"none"},boolToNotDisplay:function(n){return n?"none":""},boolToVisibility:function(n){return n?"visible":"hidden"},onDlgKeydown:function(n){var t=n,i=t.keyCode||t.which;i===27&&r._rootElement.select("*[data-tag='Share.CloseButton']")[0].click()},resources:t},r.setTemplate(new rt(yr,e)),r._keydownEventHandler=function(n){return r._onKeydownEvent(n)},n(".taskLayoutContainer").add_event("keydown",r._keydownEventHandler),r.rendered.addOne(function(n){var i=n||r,t;r._rootElement=i.getRootElement();t=document.execCommand&&typeof document.execCommand("copy")=="boolean";t||r._rootElement.select("a[data-tag='Share.Copy']").set_style({visibility:"hidden"})}),r.dataContext=r,r._lvlParam="",r._cpParam="",r._setTwitterUrl(""),r._setFacebookUrl(""),r}return y(r,i),r.prototype.toggleLinkLength=function(n){this._isDisposed||(n.preventDefault(),this.getIsShortPermalinkDisplayed()?this._updateLongPermalink():this._updateShortPermalink())},r.prototype.titleTextSelection=function(n){return n&&n.length>0?t.ShareHeaderTitle:t.L_Permalink_Prompt},r.prototype.copyToClipboard=function(n){this._isDisposed||(n.preventDefault(),this._rootElement.select("input[data-tag='Share.UrlBox']")[0].select(),document.execCommand("copy"))},r.prototype.openEmbedPage=function(n){if(!this._isDisposed){n.preventDefault();var t=k.embedPageUrl;this._lvlParam.length>0&&(t+="&"+this._lvlParam);this._cpParam.length>0&&(t+="&"+this._cpParam);t+="&form=LMLTEW";window.open(t,"EmbeddedMap");this._logEmbed(t)}},r.prototype.openEmail=function(n){var u=this,o,s,e,p,h,c,l,a;if(!this._isDisposed){n.preventDefault();o=t.L_Link_EmailTitleManyCards_Text;s=this._getOneCardShared();s!=null&&(o="Bing Maps: "+s.getTitle());var i="{0}\n",v=this._taskManager.getStacks(),f,r,y=0;for(e=0,p=v.length;e<p;e++)f=v[e],f&&f.getIsSelected()&&(r=f.getForegroundTask())&&(i+="{bullet}{0}\n".replace("{0}",r.getTitle()),(r.type==="LocalDetailsTask"||r.type==="PolygonEntityDetailsTask")&&(h=r.getOriginalName(),h&&(i+="{bullet}{0}\n".replace("{0}",h)),c=r.getNotes(),c&&(i+="{bullet}{0}\n".replace("{0}",c))),y++);i=i.replace(/{bullet}/g,y>1?" - ":"");i+="\n "+t.L_Link_EmailFooter_Text;l="mailto:?subject={0}&body={1}".replace("{0}",encodeURIComponent(o));a=function(){u._permalink.getCurrentLink(u._map,function(n){u._openEmail(n,l,i)},function(){window.console.log("Could not update permalink on the server, hence not showing email popup for stale content.")})};this.getIsShortPermalinkDisplayed()?this._permalink.shorten(function(n){u._openEmail(n,l,i)},a):a()}},r.prototype.openFacebook=function(n){if(!this._isDisposed){n.preventDefault();var i=this._getPopUpOptions(),t=this._getFacebookUrl();t&&(window.open(t,"",i),this._logSocialMedia(t,1))}},r.prototype.openTwitter=function(n){if(!this._isDisposed){n.preventDefault();var i=this._getPopUpOptions(),t=this._getTwitterUrl();t&&(window.open(t,"",i),this._logSocialMedia(t,2))}},r.prototype.setInitialData=function(n){var t=this;n.container&&(this._container=n.container,this._container&&!this._taskManager&&this._container.instanceAsyncAll([{name:"TaskManager"}],function(n){t._taskManager=n.TaskManager}))},r.prototype.onSelectionChanged=function(n,t){if(!this._isDisposed&&this._selectedPermalinkParts&&this._selectedPermalinkParts[n]){if(this._selectedPermalinkParts[n].isEnabled=t,k.isShorteningEnabled){var i=this._permalink.isShorteningAvailable();this._privates.setEnableSharingVisibility(i?"visible":"hidden");this._privates.setEnableSocialSharing(k.isEnableSocialSharing)}this._updateLongPermalink()}},r.prototype.refresh=function(){var n=this;if(!this._container)throw new Error("SharePanel cannot work without access to container");this._setState(1);this._permalink&&this._taskManager?this._recomputePanelDataAndUX():this._container.instanceAsyncAll([{name:"Permalink"},{name:"TaskManager"},{name:"Map"},{name:"ShareDataHandler"}],function(t){n._permalink=t.Permalink;n._taskManager=t.TaskManager;n._map=t.Map;n._currentSharingOptions=t.ShareDataHandler.currentSharingOptions;t.ShareDataHandler.currentSharingOptions=null;n._permalink.getGeneralPermalink(n._map,function(){return n._recomputePanelDataAndUX()},function(){n._resetSharePanelUX();n._setState(3)},n._currentSharingOptions.entryPoint)})},r.prototype._addTaskListData=function(){var n,f,e,i,o,r,u;if(this._taskManager&&(n=this._taskManager.getStacks(),n&&n.length>0)){for(f=[],e=-1,i=0,o=n.length;i<o;i++)r=n[i].getForegroundTask(),r&&r.isSharable()&&(r.type!=="CollectionsTask"||r.isPublicCollection&&r.isPublicCollection())&&(e+=1,u=new uu(r.getTitle(),n[i].getIsSelected(),n[i].getIsSelected()?t.ClickToUnselect:t.ClickToSelect),u.stackId=n[i].id,u.setIcon(r.getCardIconInfo()),u.taskId=n[i].getFirstTask().id,u.setIndex(e),f.push(u));f.length>0&&(this.setTaskList([]),this.setTaskList(f),this._buildTaskList(this.getTaskList()))}},r.prototype._buildTaskList=function(t){var a=this,u,v,s,i,r,f,e,b,p,w,o;if(t.length>0&&(u=n(".taskListContainer"),u.length>0)){if(u[0].childNodes.length>0)for(v=u[0].childNodes,s=v.length-1;s>=0;s--)u[0].removeChild(v[s]);for(i=0;i<t.length;i++){var y=t[i],c=y.getIsSelected(),l=h._createElement("li");l.add_class("taskCheckListItem"+i);l.set_attr("data-index",y.getIndex().toString());r=h._createElement("div");r.add_class("taskItem");r.add_class(c?"selected":"unselected");f=h._createElement("div");e=y.getIcon();e.iconElements?(f.append(e.iconElements[0]),f.add_class("catIcon")):(b="titleIcon",f.add_class(e.iconClass?e.iconClass:"srcTsk"),f.add_class(b));p=this._taskManager.getStackById(t[i].stackId);p&&this._setIconBackgroundColor(p,r,n(".taskList"));w=h._createElement("label");w.add_class("taskItemLabel").set_text(t[i].getName());o=h._createElement("input");o.add_class("taskItemCheckbox").add_class(c?"checked":"").set_attr("type","checkbox").set_attr("role","checkbox").set_attr("aria-label",t[i].getTaskAriaLabel()).set_attr("aria-checked",c?"true":"false");o[0].defaultChecked=c;o.add_event("change",function(t){var f,s,v,u,c,h,e;if(t&&a._taskManager){t.preventDefault();t.stopPropagation();var l="taskCheckListItem",i=n(t.target),r=i.get_ancestor(2),o=r.length>0&&r[0].className;if(o&&o.indexOf(l)>-1){if(f=Number(r.get_attr("data-index")),isNaN(f)&&(s=o.slice(l.length,o.length),f=s.indexOf(" ")>0?Number(s.split(" ")[0]):Number(s),isNaN(f)))return;v=a.getTaskList();u=v[f];u.setIsSelected(!u.getIsSelected());c=a._taskManager.getStackById(u.stackId);c&&(h=u.getIsSelected(),c.setIsSelected(u.getIsSelected()),e=n(r[0].childElementCount>0?n(r[0].children[0]):r),h&&e.has_class("unselected")?(n.Browser.is_ie&&n.Browser.ie_version<12?i[0].setAttribute("checked","checked"):i[0].checked=!0,e.remove_class("unselected").add_class("selected")):!h&&e.has_class("selected")&&(e.add_class("unselected").remove_class("selected"),n.Browser.is_ie&&n.Browser.ie_version<12?i[0].removeAttribute("checked"):i[0].checked=!1),i.set_attr("aria-checked",h?"true":"false"))}}});r[0].appendChild(f[0]);r[0].appendChild(w[0]);r[0].appendChild(o[0]);l[0].appendChild(r[0]);u[0].appendChild(l[0])}}},r.prototype._updateTaskListData=function(){var n=this;this.setTaskList([]);this._addTaskListData();Microsoft.Maps.setTimeout(function(){n.controlUpdated.invoke({state:n._currentState,control:n})},100)},r.prototype._setIconBackgroundColor=function(n,t,i){var u=this,r=n.getForegroundTask();r&&r.getIconColorAndClassName&&r.getIconColorAndClassName(function(f,e){var o=u._getCardClass(n),s;f&&e&&e!==o&&(s=r.getCardIconInfo(),o&&u.getRootElement().select(".taskItem").remove_class(o),o=e,t.add_class(u._appendCssForBackground(e,f,s&&s.iconClass?s.iconClass:"srcTsk",i)))})},r.prototype._getCardClass=function(t){var u=n(".PanelWrapper"),i=u&&u.select("[data-taskId='"+t.id+"']")[0].className,r;return t&&t.displayState&&(r="ac"+t.displayState.colorIndex,i.indexOf(r)===-1&&(i+=" "+r)),i},r.prototype._appendCssForBackground=function(n,t,i,r){if(n&&t){var u=this._createCssForBackground(n,t,i);return r.length>0?r[0].appendChild(u):this.getRootElement().append(u),n}},r.prototype._createCssForBackground=function(n,t,i){var r=document.createElement("style"),u,f;return r.type="text/css",u=".MicrosoftMap .bm_sharePanel .taskItem.",f=""+u+n+" .catIcon,\n                    "+u+n+" ."+i+".titleIcon\n                    {background-color:"+t+"}",r.innerHTML=f,r},r.prototype._setTwitterUrl=function(n){this._twitterUrl=n},r.prototype._getTwitterUrl=function(){return this._twitterUrl},r.prototype._setFacebookUrl=function(n){this._facebookUrl=n},r.prototype._getFacebookUrl=function(){return this._facebookUrl},r.prototype._onKeydownEvent=function(t){var i=t,f=i.keyCode||i.which,r,u;f===9&&(r=this.getFirstTabbableChild(n(".taskLayoutContainer")[0]),u=this._rootElement.select("*[data-tag='Share.Email']")[0],i.target!==u||i.shiftKey?i.target===r&&i.shiftKey&&(u.focus(),i.preventDefault()):(r.focus(),i.preventDefault()))},r.prototype._trimEmailBodyIfNecessary=function(n,i,r){var u=i.replace("{0}",r),f=n.length+encodeURIComponent(u).length-3,e;return f>=b.maxIeUrlLength&&(e=f+t.L_Link_EmailFooter_Text.length+10-b.maxIeUrlLength,u=u.substr(0,u.length-e)+(" ...\n\n "+t.L_Link_EmailFooter_Text)),u},r.prototype._getOneCardShared=function(){for(var n,r=this._taskManager.getStacks(),t=null,i=0,u=r.length;i<u;i++)if(n=r[i],n&&n.getIsSelected()){if(t!=null)return null;t=n.getForegroundTask()}return t},r.prototype._recomputePanelDataAndUX=function(){var n=this;this._setState(1);this._recomputeDataModel(function(){n._resetSharePanelUX();k.isShorteningEnabled?n._updateShortPermalink():n._updateLongPermalink();var t=n._rootElement.select("*[data-tag='Share.UrlBox']")[0];t.focus();t.select()})},r.prototype.dispose=function(){i.prototype.dispose.call(this);n(".taskLayoutContainer").remove_event("keydown",this._keydownEventHandler);var t=Microsoft.Maps.GlobalConfig.features.taskBar,r=n(".bm_searchBoxNavLeft");this._selectedPermalinkParts=null;this._taskManager=null;this._permalink=null;this._isDisposed=!0},r.prototype._recomputeDataModel=function(n){function h(n,t,i){n._permalink.getCurrentLink(n._map,function(u){var c,e,o,f,l,a,s;if(u&&u.length>=b.maxAllowedSharingLinkLength){c=n._findFarthestTaskId();n._selectedPermalinkParts[c].isEnabled=!1;h(n,!0,i);return}for(e=n._taskManager.getStacks(),o=n._taskManager.getFocusedStack(),f=0,l=e.length;f<l;f++)a=e[f].getForegroundTask().id,s=n._selectedPermalinkParts[a],e[f].setIsSelected(s&&s.isEnabled);o&&n._taskManager.focusTask(o.getForegroundTask().id);t==!0&&r.logError(u,3);i&&i()},function(){n._setState(3)})}var u,e,t,f,i,o;if(this._selectedPermalinkParts=this._permalink.getPermalinkParts(),this._currentSharingOptions&&this._currentSharingOptions.taskIds&&this._currentSharingOptions.taskIds.length>0)for(var s=Object.keys(this._selectedPermalinkParts),f=s.length,t=0;t<f;t++)u=s[t],this._currentSharingOptions.taskIds.indexOf(u)<0&&u!=b.osidQueryParamName&&(this._selectedPermalinkParts[u].isEnabled=!1);for(e=this._taskManager.getStacks(),t=0,f=e.length;t<f;t++)i=e[t].getForegroundTask(),!i||i.isSharable()&&(i.type!=="CollectionsTask"||i.isPublicCollection())||(o=this._selectedPermalinkParts[i.id],o&&(o.isEnabled=!1));h(this,!1,n)},r.prototype._findFarthestTaskId=function(){for(var u,n=this._taskManager.getStacks(),o=this._taskManager.getFocusedStack(),e=0,t=0,s=n.length;t<s;t++)if(n[t]===o){e=t;break}for(var i=n.length-1,r=0,f=n[i].getForegroundTask().id;i>=e&&!this._selectedPermalinkParts[f]||!this._selectedPermalinkParts[f].isEnabled;)i--,f=n[i].getForegroundTask().id;for(u=n[r].getForegroundTask().id;r<=e&&!this._selectedPermalinkParts[u]||!this._selectedPermalinkParts[u].isEnabled;)r++,u=n[r].getForegroundTask().id;return t-r>i-t?u:f},r.prototype._resetSharePanelUX=function(){var f,r,i,e,u,t;if(this._privates.setHasAtLeastOneSharableStack(!1),this._rootElement.select(".svg").inlineDataSvgs().remove_class("svg"),this._setLightOrDark(this._map.getMode().mapModeType),f=this._map.getMode(),f.mapModeType===0)for(r=this._taskManager.getStacks(),i=0,e=r.length;i<e;i++)if(u=r[i],u&&(t=u.getForegroundTask())&&t.isSharable())if(t.type!=="CollectionsTask"||t.isPublicCollection&&t.isPublicCollection()){this._privates.setHasAtLeastOneSharableStack(!0);break}else this._privates.setHasAtLeastOneSharableStack(!1);this._updateTaskListData();this._showOrHideScroll();this.setTitleText(this.titleTextSelection(this.getTaskList()));n(".taskLayoutContainer").select(".cardTitleText").set_attr("tabindex","-1")},r._getStackIndex=function(n,t,i){for(var u,r=0,f=t.length;r<f;r++)if(u=t[r],u&&(n!==null&&n===u.id||i!==null&&u.getForegroundTask().id===i))return r;return-1},r.prototype._updateLongPermalink=function(){var n=this;if(this._setState(1),this._selectedPermalinkParts===null){this.refresh();return}this._permalink.getCurrentLink(this._map,function(t){t.length>=b.maxAllowedSharingLinkLength?(n._setState(2),r.logError(t,2)):(ti.getFunctionalTestHooksEnabled()?n._privates.setPermalinkString("Test result"):(n._privates.setPermalinkString(t),n._setTempParamValues(t),n._createSocialMediaLink(t)),n._privates.setIsShortPermalinkDisplayed(!1),n._setState(0))},function(){ti.getFunctionalTestHooksEnabled()?n._privates.setPermalinkString("Test result"):(n._setState(3),r.logError("",4))})},r.prototype._updateShortPermalink=function(){var n=this;this._currentState!=2&&(this._setState(1),this._permalink.shorten(function(t,i){n._privates.setEnableSharingVisibility("visible");n._privates.setIsShortPermalinkDisplayed(!0);n._privates.setPermalinkString(t);n._createSocialMediaLink(t);i&&n._setTempParamValues(i);n._setState(0)},function(){n._privates.setEnableSharingVisibility("hidden");n._updateLongPermalink();r.logError("",1)}))},r.prototype._setState=function(n){this._currentState=n;switch(n){case 0:this._privates.setErrorMessage("");this._privates.setSharingLinkAvailable(!0);this._privates.setEnableSocialSharing(k.isEnableSocialSharing);this._rootElement.select("input[data-tag='Share.UrlBox']")[0].select();break;case 1:this._privates.setErrorMessage("");this._privates.setSharingLinkAvailable(!1);this._privates.setPermalinkString(t.L_Link_Generating_Text);break;case 2:this._privates.setSharingLinkAvailable(!1);this._privates.setIsShortPermalinkDisplayed(!1);this._privates.setPermalinkString("");this._privates.setErrorMessage(t.L_Link_TooManyItemsSelected_Text);this._privates.setEnableSocialSharing(!1);break;default:this._privates.setErrorMessage(t.L_Link_GenerationFailed_Text);this._privates.setIsShortPermalinkDisplayed(!1);this._privates.setSharingLinkAvailable(!1);this._privates.setPermalinkString("");this._privates.setEnableSocialSharing(!1);this._rootElement.select("input[data-tag='Share.UrlBox']")[0].select()}this.controlUpdated.invoke({state:n,control:this})},r.prototype._logEmail=function(n){var t={PL:n};b.instLog(it.EC,t)},r.prototype._logEmbed=function(n){var t={PL:n};b.instLog(it.EMC,t)},r.prototype._logSocialMedia=function(n,t){var i={PL:n},r=t==1?it.FB:it.TW;b.instLog(r,i)},r.logError=function(n,t){var i={PL:n,ERR:t};b.instLog(it.SEW,i)},r.prototype._setLightOrDark=function(n){var i=!0,r=this._rootElement.select(".header"),u="dark",t;n===0&&(t=this._map.getMapType().id,i=t===a.aerial||t===a.birdseye);i?r.add_class(u):r.remove_class(u)},r.prototype._setTempParamValues=function(n){var t=/lvl=([^&]*)/ig.exec(n),i=/cp=([^&]*)/ig.exec(n),r=/style=[o|b]&/ig.exec(n);t&&t.length&&(this._lvlParam=t[0]);i&&i.length&&(this._cpParam=i[0])},r.prototype._createSocialMediaLink=function(n){var t,i;n?(t=k.twitterShareUrl.replace("{text}","").replace("{related}",encodeURIComponent("BingMaps,Bing")),this._setTwitterUrl(t.replace("{url}",encodeURIComponent(n))),i=k.facebookShareUrl.replace("{facebookpage}",encodeURIComponent(k.facebookRedirectUrl)),this._setFacebookUrl(i.replace("{url}",encodeURIComponent(n)))):this._privates.setEnableSocialSharing(!1)},r.prototype._getPopUpOptions=function(){var n=(screen.availWidth-r._popupWidth)/2,t=(screen.availHeight-r._popupHeight)/2;return"width="+r._popupWidth+",height="+r._popupHeight+",screenX="+n+",screenY="+t+",left="+n+",top="+t+",status,scrollbars,resizable"},r.prototype._openEmail=function(n,t,i){i=this._trimEmailBodyIfNecessary(t,i,n);this._logEmail(n);window.location.href=t.replace("{1}",encodeURIComponent(i))},r.prototype._showOrHideScroll=function(){var i=n("#b_footer"),u;if(i.length>0){var f=i[0].getBoundingClientRect().top,r=n(".linkBox",this.getRootElement[0]),t=n(".panelWrapper");if(r.length>0&&t.length>0){if(u=r[0].getBoundingClientRect().bottom,u>=f){t.set_style({"overflow-y":"auto"});return}t.set_style({"overflow-y":""})}}},r._minEmbedHeight=530,r._minEmbedWidth=800,r._popupWidth=550,r._popupHeight=420,r}(ot);rt.registerControl("SharePanel",fu);var eu=function(t){function i(n,i,r,u){var f=this,e={};return f=t.call(this,pr,"shareContainer",{emailClick:function(n){return f._onEmailClick(n)},shortenClick:function(n){return f._onShortenClick(n)}},e)||this,e.defineProperty("permalinkString"),e.defineProperty("shortenButtonText"),f._permalink=u,f._map=n,f._taskManager=r,f.setPermalinkString(f.resources.L_Link_Generating_Text),f.setShortenButtonText(f.resources.L_ShortenButton_Text),f._isShortLinkDisplayed=!1,f.getRootElement().set_attr("data-tag","Share.Container"),f}return y(i,t),i.prototype._onPermalinkSuccess=function(t){k.isShorteningEnabled&&t.queryParameters?(n(".shareUrlShortenLink").add_class("visible"),this._permalinkResponse=t,this._makeShortenRequest(t)):this.setPermalinkString(t.permalink)},i.prototype._onPermalinkFail=function(){this.setPermalinkString(this.resources.L_Link_GenerationFailed_Text)},i.prototype._makeShortenRequest=function(n){var t=this,i=n.queryParameters,r;i.charAt(0)==="?"&&(i=n.queryParameters.substr(1));r=b.getShortenServiceUrl(i);tr.downloadJson(r,"sharedlg",function(n){t._shortPermalink=n.d;t._onShortenClick(null)},function(){t.setShortenButtonText(t.resources.L_ShortenButton_Text);t.setPermalinkString(t._permalinkResponse.permalink);t._isShortLinkDisplayed=!1})},i.prototype._onEmailClick=function(n){n&&n.preventDefault&&n.preventDefault();var t=this.getPermalinkString(),i={PL:t};window.location.href="mailto:?body="+encodeURIComponent(t);b.instLog(it.EC,i)},i.prototype._onShortenClick=function(n){n&&n.preventDefault&&n.preventDefault();this._isShortLinkDisplayed?(this.setPermalinkString(this._permalinkResponse.permalink),this.setShortenButtonText(this.resources.L_ShortenButton_Text),this._isShortLinkDisplayed=!this._isShortLinkDisplayed):this._shortPermalink?(this.setPermalinkString(this._shortPermalink),this.setShortenButtonText(this.resources.L_LengthenButton_Text),this._isShortLinkDisplayed=!this._isShortLinkDisplayed):(this.setPermalinkString(this.resources.L_Link_Generating_Text),this._makeShortenRequest(this._permalinkResponse))},i.prototype.show=function(n){var t=this;this.OpenDialog();this._permalink.getGeneralPermalink(this._map,function(n){return t._onPermalinkSuccess(n)},function(){return t._onPermalinkFail()},n)},i}(at),li=function(){function n(){}return n}(),ou=function(i){function r(n,t,r,u,f){var e=this;return e=i.call(this,{},f,u)||this,e._slideOutMenu=n,e._container=t,e._map=r,e._initializeMenuItems(),e}return y(r,i),r.prototype.showMenu=function(){this._initMapTypeSelector();this.getControl().add_class("opened")},r.prototype.hideMenu=function(){this.getControl().remove_class("opened")},r.prototype.clickBackgroundHandler=function(){this.hideMenu()},r.prototype._clickHandler=function(){this.hideMenu()},r.prototype._initializeMenuItems=function(){this.menuItems=[];this._createAndAddDirectionsMenu();this._createAndAddTrafficMenu();this._createAndAddMapTypeMenu();this.menuItems.push(this._createMenuSeparater());this._createAndAddSeeAllCardsMenu();this.menuItems.push(this._createMenuSeparater());this._createAndAddBingHomeMenu();this.menuItems.push(this._createMenuSeparater());this._createAndAddFeedbackExitPreivewMenu()},r.prototype._createMenuSeparater=function(){var n=new li;return n.type="menuSeparater",n},r.prototype._createMenuItem=function(n,t,i,r){var f=this,u;return i===void 0&&(i=undefined),r===void 0&&(r=!1),u=new li,u.type="menuItem",u.name=n,u.cssClass=t,u.clickHandler=function(n){n.preventDefault();i&&i();r||f._clickHandler()},u},r.prototype._createAndAddMenuItem=function(n,t,i,r){i===void 0&&(i=undefined);r===void 0&&(r=!1);var u=this._createMenuItem(n,t,i,r);return this.menuItems.push(u),u},r.prototype._createAndAddDirectionsMenu=function(){this._createAndAddMenuItem(t.L_TaskBar_Label_Directions,"directionsMenu",function(){var n={type:f.directionsTask,state:{entryPoint:8}};s.invokeHandler(o.taskDataHandlerKey,n)})},r.prototype._createAndAddTrafficMenu=function(){var n=this;this._container.instanceAsync("TrafficLayerV2",function(t){n._trafficLayer=t;t&&n._showTrafficLayerAfterInstantiation&&t.show(4)});this._createAndAddMenuItem(t.L_TaskBar_Label_Traffic,"trafficMenu",function(){n._map.getMapType().id!==a.birdseye&&(n._trafficLayer?n._trafficLayer.toggle(4):n._showTrafficLayerAfterInstantiation=!0)})},r.prototype._createAndAddMapTypeMenu=function(){var n=this;this._createAndAddMenuItem(t.L_SlideOutMenu_MapType,"mapMenu",null,!0);this._createAndAddMenuItem(t.L_SlideOutMenu_MapType_Road,"mapTypeItem",function(){n._changeMapType(a.road)});this._createAndAddMenuItem(t.L_SlideOutMenu_MapType_Aerial,"mapTypeItem",function(){n._changeMapType(a.aerial)});this._createAndAddMenuItem(t.L_SlideOutMenu_MapType_Birdseye,"mapTypeItem",function(){n._changeMapType(a.birdseye)})},r.prototype._createAndAddSeeAllCardsMenu=function(){this._createAndAddMenuItem(t.L_SlideOutMenu_SeeAllCards,"allCardsMenu",function(){s.invokeHandler(o.layoutDataHandlerKey,{action:"updateLayout",state:{layoutType:"listView"}})})},r.prototype._createAndAddBingHomeMenu=function(){this._createAndAddMenuItem(t.L_SlideOutMenu_BingHome,"homeMenu",function(){window.location.href="/"})},r.prototype._createAndAddFeedbackExitPreivewMenu=function(){var i=this,r=this._createAndAddMenuItem(t.L_SlideOutMenu_Feedback,"feedbackMenu",function(){var n={type:f.feedbackTask,state:{entryPoint:5,feedbackTaskType:1,activeTaskId:null,title:t.L_SlideOutMenu_Feedback}};s.invokeHandler(o.taskDataHandlerKey,n)}),n;r.htmlId="sli_feedback";n=this._createAndAddMenuItem(t.L_SlideOutMenu_ExitPreview,"exitMenu",function(){i._slideOutMenu.exitPreview.invoke()});n.htmlId="sli_exit"},r.prototype._changeMapType=function(n){this._map.getNavigationBar().getAerialBirdsEyeTransitionManager().requestMapType(n);var t=this._map.getMapTypes()[n];if(t)this._map.setBaseLayers(t);else throw new Error("Invalid map type id"+n);},r.prototype._initMapTypeSelector=function(){var t=this._map.getMapType().id,n=-1,i;t===a.road?n=0:t===a.aerial?(i=this._map.getNavigationBar(),n=i&&i.getAerialBirdsEyeTransitionManager().hasRequestedBirdsEye()?2:1):t===a.birdseye&&(n=2);n>=0&&this._selectMapType(n)},r.prototype._selectMapType=function(t){var i=n(".mapTypeItem");i.length==3&&(i.remove_class("selected"),n(i[t]).add_class("selected"))},r}(et),ai=function(){function n(n,t,i){this._viewModel=new ou(this,n,t,hr,i);this.exitPreview=new u;var f=this._viewModel.getControl(),r=t.getRootElement();r.getParent().insertBefore(f,r);typeof Feedback!="undefined"&&(Feedback.Bootstrap.InitializeFeedback({structured:!0},"sli_feedback",!1,!0,!1),Feedback.Bootstrap.InitializeFeedback({structured:!0},"sli_exit",!1,!0,!1))}return n.prototype.showMenu=function(){this._viewModel.showMenu()},n}(),su=function(i){function r(n,r){var f=this,u={};return f=i.call(this,u)||this,u.defineProperty("title"),u.defineProperty("imageClass"),u.defineProperty("id"),u.defineProperty("canvas"),u.defineProperty("closeTitle"),u.defineProperty("backgroundColor"),f.setTitle(n),f.setId(r),f.setCanvas(null),f.setCloseTitle(t.L_RemoveFromMap),f}return y(r,i),r.prototype.insertIcon=function(){var r=this.getCanvas(),i,t;r&&(i=n(document.getElementById(this.getId())),i&&i.length>0&&(t=n(".bm_cardImage",i[0]),t&&t.length>0&&(t.clear(),t.append(r))))},r}(vt),hu=function(){function t(n){this._rootElement=n;this.animationCompleted=new u}return t.prototype.startAnimation=function(n,t){var i=this;Microsoft.Maps.setTimeout(function(){i._startAnimationInternal(n,t)},1)},t.prototype._startAnimationInternal=function(t,i){this._cardList=n(".bm_cardItem",this._rootElement[0]);this._overflowCounter=n(".bm_overflowCounter",this._rootElement[0]);this._onCardChanged(t,i);this.animationCompleted.invoke()},t.prototype._onCardChanged=function(t,i){t&&t.length>0&&this._cardList.length>=1&&n(this._cardList[0]).add_class("animatedOpen");i>0&&(this._overflowCounter.has_class("animatedOpen")||this._overflowCounter.has_class("normalOpen")||this._overflowCounter.add_class("animatedOpen"))},t}(),vi=function(){function i(t,r,u,f){var e=this,o;this._capsuleClicked=!1;this._taskBarViewModel=t;this._searchBoxViewModel=f;this._taskManager=r;this._map=u;this._taskbarConfigs=c.features.taskBar;this._taskFrameworkConfigs=c.features.taskFramework;this._nonXSRCategories=[i._categoryIdForDefaultSearchTask,i._categoryIdForAddressTask,i._categoryIdForPlaceTask,i._categoryIdForDirectionsTask,i._categoryIdForTrafficTask,i._categoryIdForMyPlacesTask,i._categoryIdForFeedbackTask,i._categoryIdForTransitTask,i._categoryIdForMeasureTask,i._categoryIdForItineraryTask];this._cardsList=new ft(50);this._map&&(this._map.viewChanged.add(function(){e._map.isPanning()||e._showOrHidePopout(!1)}),this._map.mapTapped.add(function(){return e._showOrHidePopout(!1)}),this._map.mapZoomStarted.add(function(){return e._showOrHidePopout(!1)}),this._map.primitiveTapped.add(function(){return e._showOrHidePopout(!1)}));this._taskManager.newStackListCreated.add(function(){e._onNewStacksAddedFromBrowserHistory(e._taskManager.getStacks())});this._taskManager.stackAdded.add(function(n){e._onStackAdded(n.stack,n.task)});this._taskManager.stackRemoved.add(function(n){var r=n&&n.stack,u,f,o,i,s,t;if(r)if(e._stackIdToBeRemovedDueToSearchFromSearchBox)for(e._stackIdToBeRemovedDueToSearchFromSearchBox=null,i=e._cardsList.convertToArray(),e._cardsList=new ft(50),s=i.length,t=s-1;t>=0;t--)i[t].getId()!==r.id&&e._cardsList.addItem(i[t].getId(),i[t]);else{if(u=e._entrypointForCloseFromCapsule?"closeFromCapsule":"closeFromCard",e._entrypointForCloseFromCapsule)for(f=1,i=e._cardsList.convertToArray(),t=0,o=i.length;t<o;t++)if(i[t].getId()===r.id){t>f&&(u="closeFromOverflow");break}e._updateCardsList(r.id,null,1,u);e._entrypointForCloseFromCapsule=!1}});this._taskManager.secondaryTaskAdded.add(function(n){var t=n&&n.stack,i;t&&(i=e._cardsList.convertToArray(),i&&i.length>0&&i[0].getId()!==t.id&&(t.setDisplayState({isHidden:!1}),e._updateCardsList(t.id,e._getCardItem(t.id),2)))});this._taskManager.stackFocused.add(function(n){var r=n&&n.stack,t,i,u;r&&(t=e._getCardItem(r.id),i=e._cardsList.convertToArray(),i&&i.length>0&&t&&i.indexOf(t)!==0&&(u=e._taskManager.getStackById(i[0].getId()),u&&u.setDisplayState({isHidden:!0}),r&&r.setDisplayState({isHidden:!1}),e._updateCardsList(t.getId(),t,2)))});window.addEventListener("click",function(t){var i=n(t.target),r=e._taskBarViewModel.getOverflowCapsuleListCount();i.has_class("bm_overflowCardClose")&&r>0||e._showOrHidePopout(!1)});o=this._taskBarViewModel.getControl();this._cardsAnimationSearchInsideManager=new hu(o);n(window).add_event("keyup",function(n){e._onEscapeEvent(n)})}return i.prototype._onEscapeEvent=function(t){var i,u,r;this._searchTermInsertedIntoSearchBoxFromCapsule&&(i=t,i&&i.keyCode&&i.keyCode===27&&(u=this._taskBarViewModel.getControl(),r=n("#maps_sb",u[0]),this._taskBarViewModel.setOverflowExpanded(!1),r&&r[0].blur()))},i.prototype._onNewStacksAddedFromBrowserHistory=function(n){var r=this,t,o,i,s;if(n&&n.length>0){this._previousSearchTooltipShown=!0;this._reactivateTooltipShown=!0;var u=[],f=0,e=function(t){var e,i,f;if(t===n.length){for(r._cardsList=new ft(50),i=0;i<u.length;i++)u[i].dispose();for(e=void 0,i=0;i<n.length;i++)f=n[i],f&&f.displayState&&!f.displayState.isHidden?e=i:r._onStackAdded(f,f.getFirstTask());typeof e!="undefined"&&r._onStackAdded(n[e],n[e].getFirstTask())}};for(t=0;t<n.length;t++)o=n[t],i=o.getFirstTask(),i?i.getPercentLoaded()===1?e(++f):(s=i.changed.add(function(n){n&&n.name==="percentLoaded"&&n.newValue===1&&e(++f)}),u.push(s)):e(++f)}else this._cardsList=new ft(50),this._updateOverflowListOnTaskBar()},i.prototype._onStackAdded=function(r,u){var f=this,e=function(){var t,o,e;f._taskManager.getStackById(r.id)&&(f._stackIdToBeRemovedDueToSearchFromSearchBox&&f._taskManager.removeTaskStack(f._stackIdToBeRemovedDueToSearchFromSearchBox),t=f._getCardItem(r.id),t||(o=f._searchTermFromSearchBox?f._searchTermFromSearchBox:u._taskState&&u._taskState.originalQuery?u._taskState.originalQuery:u.getTitle(),f._searchTermFromSearchBox=null,t=new su(o,r.id),e=f._getCategory(u),f._setImageClass(e,t),u.getIconColorAndClassName(function(n){n?t.setBackgroundColor(n):null}),f._setCardIcon(e,t),t.cardCloseHandler=function(n){n.preventDefault();n.stopImmediatePropagation();f._entrypointForCloseFromCapsule=!0;f._taskManager.removeTaskStack(r.id)},t.cardCloseKeyDownHandler=function(i){var r,u,s,e,o;i.preventDefault();i.stopImmediatePropagation();r=i;r.keyCode===9?r.shiftKey?(o=n(".bm_overflowCardText",i.target.parentElement),o.length>0&&(o.set_attr("tabindex","0"),o[0].focus())):(u=f._cardsList.convertToArray(),s=u.indexOf(t),s>=u.length-1&&(f._showOrHidePopout(!0),s===u.length-1&&(e=n(".bm_clearAllLink"),e.length>0&&(e.set_attr("tabindex","0"),e[0].focus())))):r.keyCode===13&&t.cardCloseHandler(i)},t.overflowTitleClickHandler=function(n){var r,u,e;n.preventDefault();r=f._taskManager.getStackById(t.getId());u=f._taskManager.getFocusedStack();r!==u&&(u&&u.setDisplayState({isHidden:!0}),r&&(r.displayState.cardTitleHoveringState===1&&r.setDisplayState({cardTitleHoveringState:2}),r.setDisplayState({isHidden:!1}),f._taskManager.toggleStack(r)),e=f._cardsList.convertToArray().indexOf(t),f._log({T:"CI.SearchCardReactivated",feature:i._featureName,action:"CI.SearchCardReactivated",data:{entryPoint:"overflow"}}));f._updateCardsList(t.getId(),t,2)},t.overflowTitleTouchHandler=function(n){t.overflowTitleClickHandler(n);f._showOrHidePopout(!1)},t.overflowTitleKeyDownHandler=function(i){var u=i,o=f._cardsList.convertToArray().indexOf(t),s,e,h,r,c;u.keyCode===13?(t.overflowTitleClickHandler(i),f._showOrHidePopout(!1)):u.keyCode===40?o!==f._cardsList.getCount()-1&&(i.preventDefault(),i.stopImmediatePropagation(),e=n(document.getElementById(t.getId())),s=e.get_sibling(1),s.length>0&&(r=n(".bm_overflowCardText",s[0]),r.length>0&&r[0].focus())):u.keyCode===38?o!==1&&(i.preventDefault(),i.stopImmediatePropagation(),e=n(document.getElementById(t.getId())),h=e.get_sibling(-1),h.length>0&&(r=n(".bm_overflowCardText",h[0]),r.length>0&&r[0].focus())):u.keyCode===9&&u.shiftKey&&o===1&&(i.preventDefault(),i.stopImmediatePropagation(),f._showOrHidePopout(!1),c=n(".bm_overflowCountContainer"),c.length>0&&c[0].focus())},t.overflowTitleMouseoverHandler=function(n){var r=f._taskManager.getStackById(t.getId());r&&r.setDisplayState({cardTitleHoveringState:1});f._log({T:"CI.CapsuleTitleHover",feature:i._featureName,action:"CI.CapsuleTitleHover",data:null});n.preventDefault()},t.overflowTitleMouseoutHandler=function(i){var r,u,e;try{r=n(document.getElementById(t.getId()));r.length>0&&(u=n(".bm_overflowCardText",r[0]),u.length>0&&u[0].blur());e=f._taskManager.getStackById(t.getId());e&&e.setDisplayState({cardTitleHoveringState:2})}finally{i.preventDefault()}},f._updateCardsList(t.getId(),t,0)))},o;r&&u&&(o=this._getCardItem(r.id),o||(r.changed.add(function(n){var i,u;r.getAllTasks().length===1&&n&&n.name==="foregroundTask"&&(i=n.newValue,i&&(u=f._getCardItem(i.stackId),u&&(u.setTitle(i.getTitle()),u.setCloseTitle(t.L_RemoveFromMap),f._updateQueryTerm())))}),u.changed.add(function(n){var i,r;n&&(n.name==="percentLoaded"&&n.newValue===1?e():n.name==="title"?(i=f._getCardItem(u.stackId),i&&(i.setTitle(n.newValue),i.setCloseTitle(t.L_RemoveFromMap),f._updateQueryTerm())):(n.name==="catid"||n.name==="catId")&&(r=f._getCardItem(u.stackId),r&&u.getIconColorAndClassName(function(n){n?r.setBackgroundColor(n):null})))}),u.getPercentLoaded()===1&&e()))},i.prototype._getCardItem=function(n){for(var i=this._cardsList.convertToArray(),t=0,r=i.length;t<r;t++)if(i[t].getId()===n)return i[t];return null},i.prototype._updateCardsList=function(n,t,r,u){var f,s,o,h,e;if(r===0)this._cardsList.addItem(n,t);else if(r===2)this._changeMapModeOnCardSelection(),this._cardsList.getItem(n);else if(r===1)for(this._log({T:"CI.SearchCardDeleted",feature:i._featureName,action:"CI.SearchCardDeleted",data:{entryPoint:u}}),f=this._cardsList.convertToArray(),f&&f[0]&&f[0].getId()===n&&(s=f[1],s&&(o=this._taskManager.getStackById(s.getId()),o&&(o.setDisplayState({isHidden:!1}),this._taskManager.toggleStack(o)))),this._cardsList=new ft(50),h=f.length,e=h-1;e>=0;e--)f[e].getId()!==n&&this._cardsList.addItem(f[e].getId(),f[e]);this._updateOverflowListOnTaskBar()},i.prototype._changeMapModeOnCardSelection=function(){var t=this,n=this._map.getMode(),r,i;n&&(n.mapModeType===2||n.mapModeType===3)?(r=n.getPreviousMapType()||this._map.createMapType(a.road),this._map.setMapType(r),i=n.getPreviousMode(),i?this._map.setMode(i):this._map.getContainer().instanceAsync("CompositeMapMode",function(n){t._map.setMode(n)})):this._map.getMapType().id===a.birdseyeV2&&this._map.getBirdseyeV2Manager().then(function(n){var i=t._map.getMapTypes()[n.previousMapState.mapTypeId||a.road];i&&t._map.setBaseLayers(i)})},i.prototype._updateOverflowListOnTaskBar=function(){for(var u,h=this,s=1,t=new yt,f=this._cardsList.convertToArray(),e=0,r=s,o=f.length;r<o;r++)e>=0&&t.insert(f[r]),e++;for(e===0&&this._showOrHidePreviousSearchTip(!1),u=this._taskBarViewModel,u.setOverflowCapsuleList(t),u.getOverflowCapsuleListCount()===0&&t.length>0&&this._log({T:"CI.SearchOverflowCounter",feature:i._featureName,action:"CI.SearchOverflowCounterShown",data:null}),u.getOverflowCapsuleListCount()===1&&t.length===0&&this._showOrHidePopout(!1),u.setOverflowCapsuleListCount(t.length),t.length>i._scrollCount?(n(".bm_popoutTop1").add_class("scroll"),n(".bm_overflowPopout").add_class("scroll")):(n(".bm_popoutTop1").remove_class("scroll"),n(".bm_overflowPopout").remove_class("scroll")),this._updateQueryTerm(),r=s,o=f.length;r<o;r++)f[r].insertIcon();this._cardsAnimationSearchInsideManager.animationCompleted.addOne(function(){t.length>0&&h._showOrHidePreviousSearchTipOnOverflowShown(!0)});this._cardsAnimationSearchInsideManager.startAnimation(t,t.length);u._adjustSearchBoxWidth()},i.prototype._updateQueryTerm=function(){var n,i,r,t;if(this._taskbarConfigs.updateSearchTerm){n=this._cardsList.convertToArray();i=n&&n.length>0?n[0].getTitle():"";this._taskbarConfigs.updateSearchTermWithTaskTitle&&n&&n.length>0&&(r=this._taskManager.getStackById(n[0].getId()),r&&(t=r.getFirstTask(),t&&t._taskState&&(t._taskState.originalQuery||t._taskState.taskTitle)&&(i=t._taskState.originalQuery||t._taskState.taskTitle)));this._taskBarViewModel.setSearchTerm(i);return}},i.prototype._showOrHidePopout=function(t){var s=this._map.getRootElement(),u=s&&s.getParent(),h=u&&u.length>0&&u[0],f,r;if(h&&(f=n(".bm_overflowPopout",h).get_style("display"),(t&&f==="none"||!t&&f==="block")&&(r=this._taskBarViewModel.getControl(),this._overflowPopoutShown=t,r.length>0))){this._log({T:"CI.SearchOverflowPopout",feature:i._featureName,action:"CI.SearchOverflowPopout",data:{isShown:t}});var e=n(".bm_overflowPopout",r[0]),o=n(".bm_overflowBox",r[0]),c=n(".bm_outsideBeak",r[0]);e.length>0&&o.length>0&&(e.set_style({display:t?"block":"none"}),c.length>0&&c.set_style({display:t?"block":"none"}),t&&(this._showOrHidePreviousSearchTip(!1),o.add_class("active"),Microsoft.Maps.setTimeout(function(){var t=n(".bm_overflowCardText",e[0]);t.length>0&&(t[0].focus(),t.getParent().fireEvent("hover"))},20)),t||(o.remove_class("active"),this._taskBarViewModel.setOverflowExpanded(!1)))}},i.prototype._showOrHideReactivateTip=function(t){var r=this;this._reactivateTooltipShown||(this._log({T:"CI.SearchReactivateTip",feature:i._featureName,action:"CI.SearchReactivateTip",data:{isShown:t}}),t?n("#ReactivateSearchTip").add_class("opened"):n("#ReactivateSearchTip").remove_class("opened"),t&&Microsoft.Maps.setTimeout(function(){r._showOrHideReactivateTip(!1);r._reactivateTooltipShown=!0},i._timeoutForTooltipHiding))},i.prototype._showOrHidePreviousSearchTipOnOverflowShown=function(n){var t=this;this._previousSearchTooltipShown||(this._log({T:"CI.PreviousSearchTip",feature:i._featureName,action:"CI.PreviousSearchTip",data:{isShown:n}}),this._showOrHidePreviousSearchTip(n),n&&Microsoft.Maps.setTimeout(function(){t._showOrHidePreviousSearchTipOnOverflowShown(!1);t._previousSearchTooltipShown=!0},i._timeoutForTooltipHiding))},i.prototype._showOrHidePreviousSearchTip=function(t){t?n("#PreviousSearchTip").add_class("opened"):n("#PreviousSearchTip").remove_class("opened")},i.prototype._log=function(n){var t=Microsoft.Maps.logger;t&&t.logObject(n)},i.prototype.onSearchInvokedFromTaskbar=function(n){if(this._newSearchInitiatedFromTaskbar=!0,this._searchTermFromSearchBox=n,this._searchTermInsertedIntoSearchBoxFromCapsule){var t=this._cardsList.convertToArray();t&&t.length>0&&(this._stackIdToBeRemovedDueToSearchFromSearchBox=t[0].getId())}},i.prototype.overflowClick=function(n){window.clearTimeout(i._popoutHideHandler);this._overflowPopoutShown?this._showOrHidePopout(!1):this._showOrHidePopout(!0);n&&(n.preventDefault&&n.preventDefault(),n.stopImmediatePropagation())},i.prototype.overflowKeyDown=function(n){var t=n;t.keyCode===13&&this.overflowClick(n)},i.prototype.overflowMouseOver=function(n){this._overflowPopoutShown||this._showOrHidePreviousSearchTip(!0);n&&n.preventDefault()},i.prototype.overflowMouseOut=function(n){this._showOrHidePreviousSearchTip(!1);n&&n.preventDefault()},i.prototype.popoutMouseoverHandler=function(n){window.clearTimeout(i._popoutHideHandler);n&&n.preventDefault&&n.preventDefault()},i.prototype.clearAllClickHandler=function(n){var r,i,t,u,f;for(n&&n.preventDefault&&n.preventDefault(),r=this._taskBarViewModel,i=r.getOverflowCapsuleList(),t=0,u=i.length;t<u;t++)f=i[t],this._taskManager.removeTaskStack(f.getId())},i.prototype.clearAllKeyDownHandler=function(t){var i,r;if(t&&t.preventDefault&&t.preventDefault(),i=t,i)if(i.keyCode===13)this.clearAllClickHandler(t);else if(i.keyCode===9)if(i.shiftKey){this._showOrHidePopout(!0);var f=this._cardsList.convertToArray(),e=n(".bm_overflowItem")[f.length-1],u=n(".bm_overflowCardClose",e);u.set_attr("tabindex","0");u[0].focus()}else this._showOrHidePopout(!1),r=this._taskBarViewModel,r&&r.setSearchBoxFocus()},i.prototype.sbCloseTaskHandler=function(n){var u,f,t,r,i,e,h;if((n.preventDefault(),n.stopImmediatePropagation(),!this._searchBoxViewModel.getCloseDisable())&&(u=this._cardsList.convertToArray()[0],f=u&&this._taskManager.getStackById(u.getId()),f))for(t=f.getAllTasks(),r=0;r<t.length;r++)if(i=t[r],!i.displayState||i.displayState.stackOrder===1||i.displayState.prominence===1&&t.length===1){e=i.id;h={logData:{feature:"SB",action:"C",data:{BN:n.target.classList,TID:e}}};s.invokeHandler(o.instrumentationDataHandlerKey,h);(this._taskManager.getStacks().length>1||t.length>1)&&this._searchBoxViewModel.setCloseDisable(!0);this._taskManager.removeTaskAndReseatChild(e);break}},i.prototype.popoutMouseoutHandler=function(n){var t=this;i._popoutHideHandler=Microsoft.Maps.setTimeout(function(){t._showOrHidePopout(!1)},i._timeoutForHidePopout);n&&n.preventDefault&&n.preventDefault()},i.prototype._setImageClass=function(n,t){var r,u;n&&(r="",n.indexOf(i._categoryIdForDefaultSearchTask)>-1?r="maps_searchsvg":n.indexOf(i._categoryIdForMyPlacesTask)>-1?r="maps_myplacessvg":n.indexOf(i._categoryIdForPlaceTask)>-1||n.indexOf(i._categoryIdForAddressTask)>-1?r="maps_addresssvg":n.indexOf(i._categoryIdForDirectionsTask)>-1?r="maps_carsvg":n.indexOf(i._categoryIdForTrafficTask)>-1?r="maps_trafficsvg":n.indexOf(i._categoryIdForFeedbackTask)>-1?r="maps_feedbacksvg":n.indexOf(i._categoryIdForTransitTask)>-1?r="maps_transitsvg":n.indexOf(i._categoryIdForItineraryTask)>-1?r="maps_itinerarysvg":n.indexOf(i._categoryIdForMeasureTask)>-1?r="maps_measuresvg":n.length>0&&(r=n),u="bm_cardImage",r.length>0&&(u+=" "+r),t.setImageClass(u))},i.prototype._setCardIcon=function(n,t){n&&this._nonXSRCategories.indexOf(n)===-1&&!t.getCanvas()&&this._selectorReady().then(function(i){i.getCategoryIconTemplate(function(n){var r=n&&n.icon,i;r&&(i=r.renderIcon(),i&&(t.setCanvas(i),t.insertIcon()))},n,"#FFF",20,20)})},i.prototype._selectorReady=function(){var n=this;return this._baseMapTemplateSelector?this._baseMapTemplateSelector.selectorReady():this._map.getTemplateSelector().then(function(t){return n._baseMapTemplateSelector=t,n._baseMapTemplateSelector.selectorReady()})},i.prototype._getCategory=function(n){if(n){var t=n.type;return t===f.directionsTask||t===f.directionsFlipTask?"directions":t===f.trafficTask||t===f.trafficFlipTask?"traffic":t===f.collectionsTask?"myplaces":t===f.feedbackTask?"feedback":t===f.transitLineTask||t===f.transitStopTask||t===f.nearbyTransitTask?"transit":t===f.itineraryListingsTask||t===f.itineraryDetailsTask?"itinerary":t===f.venueMapDirectoryTask?"90892":t===f.measureMap?"measure":t===f.myContributions?"myContributions":this._getSearchCategory(n)}return"search"},i.prototype._getSearchCategory=function(n){var s=["Place","City","Events"],i,r,u,f,o,t,e;if(n){if(i=n.viewModel,i){if(i.categoryFound)return n.viewModel.getCardCategoryId();if(r=i&&i.getEntities(),r&&r.length>-1&&(u=r[0],u)){if(f=u.getPrimaryCategoryPath(),f)return(o=di.extractCategoryId(f,!1),!o)?f in s?"place":"search":o;if(t=u.getSegmentTypes(),t&&t.length>0)return(e=t[0],s.indexOf(e)>-1)?"place":e.indexOf("Local")>-1?t.length>1?t[1]:"place":e}}return"place"}},i._timeoutForHidePopout=500,i._timeoutForTooltipHiding=4e3,i._featureName="SearchPrototype",i._categoryIdForDefaultSearchTask="search",i._categoryIdForPlaceTask="place",i._categoryIdForAddressTask="address",i._categoryIdForDirectionsTask="directions",i._categoryIdForTrafficTask="traffic",i._categoryIdForMyPlacesTask="myplaces",i._categoryIdForFeedbackTask="feedback",i._categoryIdForTransitTask="transit",i._categoryIdForMeasureTask="measure",i._categoryIdForItineraryTask="itinerary",i._scrollCount=7,i}(),cu=function(n){function i(i,r,u,f){var e=this,o={};return e=n.call(this,o,f,u)||this,o.defineProperty("ariaLabel",null,null,{defaultValue:t.CloseMapView}),e.setAriaLabel(t.CloseMapView),e}return y(i,n),i}(et),gt=function(n){function t(){var i=this,t={};return i=n.call(this,t)||this,t.defineProperty("isActive"),t.defineProperty("cssClass"),t.defineProperty("dataTag"),t.defineProperty("showLabel"),t.defineProperty("popoutClass"),t.defineProperty("ariaExpanded"),t.defineProperty("ariaControls"),t.defineProperty("ariaHasPopout"),i.url="#",i.isNew=!1,i.banner="",i}return y(t,n),t}(vt),ee=function(i){function r(r,f,o,s,l,a){var v=this,y={},p;return v=i.call(this,y,s,o)||this,y.defineProperty("searchTerm"),y.defineProperty("capsuleList"),y.defineProperty("overflowCapsuleList"),y.defineProperty("overflowCapsuleListCount"),y.defineProperty("searchboxContainerClassName"),y.defineProperty("stackExists"),y.defineProperty("closeDisable"),y.defineProperty("displayInPrivate"),y.defineProperty("closeTitle"),y.defineProperty("displayClearSearch"),v.resources=t,v._map=f,v._taskManager=l,p=l.getFocusedStack(),v._currentStack=p&&p.id,v._cardsController=new vi(a,l,v._map,v),v.searchInstData=v.stringify(v._getInstData()),v._stacks=l.getStacks(),v._taskManager=l,v.setCloseDisable(!1),v._isFlipped=!1,v._isFlipMode=!1,v.setDisplayInPrivate(c.isInPrivateMode?"":"none"),v.setCloseTitle(v.resources.ShareClose),v.setAsExpanded(!1),v.clearSearchEvent=new u,v.disposables.push(l.stackRemoved.add(function(n){var i,t;if(l.getStacks().length===0)v.setSearchTerm(""),v._searchBox&&v._searchBox.focus(),v.setStackExists(!1),v._setTaskType(null);else for(i=l.getStacks(),t=0;t<i.length;t++)p=i[t],p.displayState&&p.displayState.activationState===1&&v._setTaskType(p.getForegroundTask());n.stack.id===v._currentStack&&v._determineWidthOverride(l);l.getStacks().length===0&&v._setSearchControlsWidth(v._searchBox,e.searchBoxWidth)})),v.disposables.push(l.stackFocused.add(function(n){n&&n.stack&&(v._currentStack=n.stack.id,v._isFlipMode&&v._flipSetSearchTerm(),v._setTaskType(n.stack.getForegroundTask()))})),v.disposables.push(l.stackAdded.add(function(n){v._isFlipped=!1;v._determineWidthOverride(l);n&&n.stack&&(v._currentStack=n.stack.id);var t=v._getTaskFromArgs(n);v.setStackExists(t&&t!==undefined);v._setTaskType(t);v.disposables.push(n.stack.flipAnimationCompleted.add(function(){return v._flipSetSearchTerm()}))})),v.disposables.push(l.stacksReset.add(function(){var n=l.getFocusedStack();v._currentStack=n.id;v._determineWidthOverride(l);v.setStackExists(l.getStacks().length>0);v._setTaskType(n&&n.getForegroundTask())})),v.disposables.push(l.secondaryTaskAdded.add(function(n){var t=v._getTaskFromArgs(n);t&&t.id&&(t.id.toLowerCase().indexOf("itinerarydetails")>-1||!h._getIsSlideCardEnabled()&&t.id.toLowerCase().indexOf("transitline")>-1)&&v._flipSetSearchTerm()})),sj_evt.bind("CardResize",function(t){var e=v.getControl(),i,u,l,f;if(e&&e.length>0&&t&&t.length>1){var o=t[1],a=c&&c.features&&c.features.taskFramework,k=t.length>2&&t[2],y=a&&a.showLoadingSkeleton&&h._isPercievedLoadSkeletonShown();if(o){if(i=!0,!h._isSlideCardEnabled){i=!1;var p=v._taskManager.getFocusedStack(),s=p&&p.getForegroundTask(),r=s&&s.displayState,w=r&&r.prominence,b=r&&r.activationState;w&&w===1&&b&&b===1&&(u=s,l=u&&u.getCurrentWidth&&u.getCurrentWidth(),i=l&&l===o)}(!y&&i||y&&k)&&(f=n(".inputbox",e[0]),f&&f.length>0&&v._setSearchControlsWidth(f[0],o))}}}),v.setSearchboxContainerClassName("bm_searchBoxNavLeft bm_l2Search"),v}return y(r,i),r.prototype.boolToDisplay=function(n){return n?"":"none"},r.prototype.nullToDisplayNone=function(n){return n?"":"none"},r.prototype.setDisabledClass=function(n){return n?"disabled":""},r.prototype.onSearchInvokedFromTaskbar=function(n){if(this._cardsController!==null)this._cardsController.onSearchInvokedFromTaskbar(n)},r.prototype.overflowCapsuleListToDisplay=function(){var n=this.getOverflowCapsuleList();return n&&n.length>0?"":"none"},r.prototype.overflowCapsuleListToCount=function(){var n=this.getOverflowCapsuleList();return n&&n.length>0?n.length.toLocaleString():"none"},r.prototype.overflowClick=function(n){this._cardsController.overflowClick(n)},r.prototype.overflowKeyDown=function(n){var t=n;t.keyCode===13&&this._cardsController.overflowClick(n)},r.prototype.overflowMouseOver=function(n){this._cardsController.overflowMouseOver(n)},r.prototype.overflowMouseOut=function(n){this._cardsController.overflowMouseOut(n)},r.prototype.mouseEnterSearchBox=function(){},r.prototype.mouseLeaveSearchBox=function(){},r.prototype.clearSearchText=function(n){this.setSearchTerm("");this._searchBox&&(this._searchBox.value="");this.setSearchBoxFocus();this.setDisplayClearSearch(!1);this.clearSearchEvent.invoke();n.preventDefault();n.stopImmediatePropagation()},r.prototype.showClearTextTip=function(){var n,t,i;this.getAsExpanded()||(n=this._showTip(this.resources.ClearText),t=this.getControl().select(".clearSearchText"),t.append(n),i=n.get_absolute_pos(),n.set_style({top:52,left:18-i.width/2}))},r.prototype.showClearSearchTip=function(){},r.prototype.hideTip=function(){this._tooltip&&this._tooltip.removeTip()},r.prototype.stringify=function(t){return n.Internals.stringify(t)},r.prototype.clearAllClickHandler=function(n){this._cardsController.clearAllClickHandler(n)},r.prototype.sbCloseHandler=function(t){var i,u=this._taskManager.getStackById(this._currentStack),r,f;u&&(i=u.getForegroundTask());i&&i.id.toLowerCase().indexOf("collection")>-1&&(r=n(".collectionsCard.refresh"),r.length>0&&(f=r.select(".placesMessage"),f.get_style("display")==="none"&&(this._isFlipped=!0)));this._isFlipped?this._isFlipped=h.flipClickReturnToList(i):this._cardsController.sbCloseTaskHandler(t);t.preventDefault();t.stopPropagation()},r.prototype.setSearchBoxFocus=function(){if(this._searchBox)if(this._searchBox.focus(),nt.enableDirectionsSearch=!0,typeof this._searchBox.selectionStart=="number")this._searchBox.selectionStart=this._searchBox.selectionEnd=this._searchBox.value.length;else if(typeof this._searchBox.createTextRange!="undefined"){var n=this._searchBox.createTextRange();n.collapse(!1);n.select()}},r.prototype.setSearchBox=function(t){var i=this;this._searchBox=t;n(this._searchBox).add_event("keydown",function(n){i._onSearchBoxEnter(n)})},r.prototype._setTaskType=function(t){var i=n(".MicrosoftMap .bm_searchBoxNavLeft"),u=i&&i.length>0&&i[0].firstElementChild,r;u&&(r=n(u),t&&t.type===f.directionsTask?r.add_class(f.directionsTask):r.remove_class(f.directionsTask))},r.prototype._determineWidthOverride=function(t){var i=n(".MicrosoftMap .bm_searchBoxNavLeft ul li.inputbox"),r=t.getStacks();r.length>0?i.has_class("inlineCard")||i.add_class("inlineCard"):i.remove_class("inlineCard")},r.prototype._onSearchBoxEnter=function(t){var r=t,f=r.keyCode||r.which,u,i;f===13&&(u=this._getInstData(),s.invokeHandler(o.instrumentationDataHandlerKey,u),i=n(".searchButton")[0],i.setAttribute("tabindex","-1"),i.focus(),i.removeAttribute("tabindex"))},r.prototype._mapTypeChanged=function(n){n&&(n.newMapTypeId===a.streetside||n.newMapTypeId===a.birdseyeV2)?this.getControl().add_class("b_hide"):this.getControl().remove_class("b_hide")},r.prototype._adjustSearchBoxLeftMargin=function(t){n(".MicrosoftMap .bm_searchBoxNavLeft").set_style({left:t+r.CardContentLeftPadding+"px"})},r.prototype._adjustSearchBoxWidth=function(){var e=this.getControl()[0],i=n(".inputbox",e)[0],r=n("#taskbarPrimer"),u=r.length>0&&r[0],t,f;u&&u.clientWidth>0&&(t=this._getCardContainerWidth(),t?this._setSearchControlsWidth(i,t,!0):(f=n(".bm_tcfPrimer .inputbox")[0],this._setSearchControlsWidth(i,f.getBoundingClientRect().width,!0)))},r.prototype._getCardContainerWidth=function(){var n=0,t=document.getElementsByClassName("overlay-container"),i;return t&&t.length>0&&(i=t[0].getAttribute("data-mapcardwidth"),n=i&&parseInt(i),n=isNaN(n)?0:n),n},r.prototype._setSearchControlsWidth=function(t,i,u){var o,s,f,e;t&&this._currentWidth!==i&&(this._currentWidth=i,o=0,s=u?0:r.searchBoxBorderWidth*2,t.setAttribute("style","width: "+(i===-1?"":i-o-s+"px")),f=n(".as_container_search",t),f&&f.get_style("visibility")==="visible"&&this._searchBox.value.length>-1&&f.set_style({width:i+"px"}),e=n("#taskbarPrimer"),e&&e.length>0&&i!==-1&&e.select(".inputbox").set_style({width:i+"px"}))},r.prototype._getTaskFromArgs=function(n){var t=n.task;return!t&&n.stack&&(t=n.stack.getForegroundTask()),t},r.prototype._getInstData=function(){return{logData:{feature:"SB",action:"C",data:{FN:v.Search}}}},r.prototype._flipSetSearchTerm=function(){var t=this._taskManager.getStackById(this._currentStack),n;t?(n=t.getForegroundTask(),e.updateSearchTermWithTaskTitle&&this.setSearchTerm(n.getTitle()),this._isFlipMode=!0,this._isFlipped=n.displayState.stackOrder>1?!0:!1):this._isFlipMode=!1},r.prototype._showTip=function(n){var t,i;return this._tooltip&&this._tooltip.removeTip(),t=new ht(this._map,"",[n],!0,!1,!0,!1,null,null,"searchBoxTip"),t.setShowClose(!1),t.setShowBeak(!0),i=t.getRootElement(),this._tooltip=t,i},r._searchFeatureName="Search",r.CardContentLeftPadding=16,r.searchBoxBorderWidth=2,r}(et),nt=function(i){function r(f,o,s,l,v){var y=this,p={},b,w;return y=i.call(this,p,l,s)||this,p.defineProperty("searchTermInternal"),p.defineProperty("className"),p.defineProperty("asExpanded"),p.defineProperty("selectedSuggestionId"),p.defineProperty("isOnVertical"),p.defineProperty("overflowCapsuleList"),p.defineProperty("overflowCapsuleListCount"),p.defineProperty("searchboxPlaceHolderText"),p.defineProperty("overflowExpanded"),y._isMapsAnswer=Microsoft&&Microsoft.Maps&&Microsoft.Maps.GlobalConfig&&Microsoft.Maps.GlobalConfig.isMapsAnswer,e.fullScreen=y._isMapsAnswer?!1:e.fullScreen,y._minimumActionButtonsWidth=e.minimumActionButtonsWidth,y._maxIdControlsWidth=e.maxIdControlsWidth,y._minIdControlsWidth=e.minIdControlWidth,y._searchBoxWidth=e.searchBoxWidth,y._navButtonWidth=e.navButtonWidth,y._minSearchBoxWidth=e.minSearchBoxWidth,y._searchButtonWidth=e.searchButtonWidth,y._noTextBuffer=e.taskbarTextBuffer,y._resizeBuffer=e.taskBarResizeBuffer,y._maxActionButtonsWidth=e.maximumActionButtonsWidth,y._searchBoxLeftBuffer=e.taskbarLeftBuffer,y._rightTaskbarBuffer=e.taskbarRightBuffer,y._smallSearchControlsWidth=y._minSearchBoxWidth,y._fullSearchControlsWidth=y._searchBoxWidth,y.setClassName("taskBar"),y.setSearchboxPlaceHolderText(""),y.setSearchTerm(""),y._taskManager=v,y.taskBarItems=[],y.taskBarExtraItems=[],r._taskItems=[],y.createTaskItems(),y._map=o,y._controlTemplateFactory=l,r._staticMap=o,y.setUpAlwaysOnPoi(),y._container=f,y.launchFeedbackMenu=new u,y.hideFeedbackMenu=new u,y.focusFeedback=new u,y.exitFullScreen=new u,y.exitFullScreen.add(function(){return r.exitFullScreen()}),y.clearAutosuggest=new u,y.setAsExpanded(!1),y._mouseOutPrevent=!1,y.displayInPrivate=c.isInPrivateMode?"":"none",y._overlayCloseViewModel=new cu(f,o,ar,l),y._map&&(y.disposables.push(y._map.viewChanged.add(function(){y._map.isPanning()||y.mapInteractedEvent()})),y.disposables.push(y._map.mapTapped.add(function(){return y.mapInteractedEvent()})),y.disposables.push(y._map.mapZoomStarted.add(function(){return y.mapInteractedEvent()})),y.disposables.push(y._map.primitiveTapped.add(function(){return y.mapInteractedEvent()}))),y.disposables.push(y._taskManager.stackFocused.add(function(){r.enableDirectionsSearch=!1})),sj_evt&&sj_evt.bind("identityHeaderShown",function(){Microsoft.Maps.setTimeout(function(){y._setHiddenElementFocusHandler();y._adjustSearchBoxWidth();y._showIdControls()},500)}),y._menuList=[],y._touchByPassMouseout=!1,(y._trafficItem||y.isFeatureEnabled("traffic"))&&y._container.instanceAsync("TrafficLayerV2",function(n){y._trafficLayer=n;n&&(y._showTrafficLayerAfterInstantiation&&n.show(1),y._setTrafficButtonSelected(n.getIsShowing()),y.disposables.push(y._trafficLayer.changed.add(function(n){n.name==="isShowing"&&y._setTrafficButtonSelected(n.newValue)})))}),y.resources=t,y.searchInstData=y.createInstrumentationData(r._searchFeatureName),o&&(y.disposables.push(v.stackRemoved.add(function(){v.getStacks().length===0&&(y.setSearchTerm(""),y._searchBox&&y._searchBox.focus())})),y.disposables.push(o.mapTypeChanged.add(function(n){n.newMapTypeId===a.birdseye?(y._trafficItem&&y._trafficItem.setCssClass("trafficIcon realign disabled"),y._trafficIsDisabled=!0):n.oldMapTypeId===a.birdseye&&(y._trafficIsDisabled=!1,y._trafficLayer&&y._setTrafficButtonSelected(y._trafficLayer.getIsShowing()));y._setTextAlignment(y.taskBarItems)}))),y._isMapsAnswer?sj_evt&&sj_evt.bind("LargeMapHidden",function(){y._clearHeaderLastElementKeyDownHandler()}):y._setTextAlignment(y.taskBarItems),e.showTaskBarLabels&&(n(window).add_event("resize",function(n){y._onResizeHandler(n)}),e.fullScreen&&n(window).add_event("fullscreenChange,webkitfullscreenChange,mozfullscreenChange,msfullscreenchange,msfullscreenChange,MSFullscreenChange",function(n){y._onResizeHandler(n)})),b=e.isEnabled&&!h._isSmallMapShownOnSerp()?"block":"none",y.getControl().set_style({display:b}),y.setIsOnVertical(c.isMapsVertical),y._isMapsAnswer&&(y.disposables.push(o.actualSizeChanged.addOne(function(){var i=n(".actions")[0],t;if(i&&(y.actionBarSize=i.getBoundingClientRect().width),t=n(".b_searchboxForm")[0],t){var r=n(".searchButton")[0],u=r?r.getBoundingClientRect().width:40,f=t.getBoundingClientRect().width-u;y._setSearchControlsWidth(n(".inputbox",y.getControl()[0])[0],f)}y._setTextAlignment(y.taskBarItems)})),y.disposables.push(o.actualSizeChanged.add(function(){y._setTextAlignment(y.taskBarItems)}))),y._cardsController=new vi(y,v,y._map),w=c.features.taskFramework,w&&w.isTouchDevice&&y.getControl().add_class("bm_touch"),y}return y(r,i),r.prototype.setAutoSuggestExpanded=function(n){this._searchBoxViewModel?this._searchBoxViewModel.setAsExpanded(n):this.setAsExpanded(n);this._showOrHidePanelShading(n)},r.prototype._showOrHidePanelShading=function(t){if(e.autoSuggestDimmingEnabled){var r=n(".MicrosoftMap .bm_waitlayer"),i=n(".MicrosoftMap .inner-container"),u=n(".taskLayoutContainer.bm_l2NavLeft"),f=r.length>0?n(r[0]):null,o=i.length>0?n(i[0]):null;if(!f||!o||u.length===0)return;r.set_style({display:""});i.length>0&&this._showOrHideWaitLayer(t,i[0],u)}},r.prototype._showOrHideWaitLayer=function(t,i,r,u){var s=n(i),f=s.select(".bm_waitlayer"),e,o,h;f.length>0&&(t?(s.set_style({position:""}),r.has_class("bm_asDroppedDown")||r.add_class("bm_asDroppedDown"),f.has_class("bm_highlightPane")||f.add_class("bm_highlightPane"),e=f.getParent().length>0&&f.getParent().get_size(),e&&(o=u&&u.leftOffset?e.width-1:e.width+1,h=u?u.leftOffset:0,f.set_style({width:o+"px",left:h+"px"}),u&&(u.leftOffset+=o))):(r.remove_class("bm_asDroppedDown"),f.remove_class("bm_highlightPane"),f.set_style({width:"",left:""})))},r.prototype.setSearchTerm=function(n){this._searchBoxViewModel?this._searchBoxViewModel.setSearchTerm(n):this.setSearchTermInternal(n)},r.prototype.getSearchTerm=function(){return this._searchBoxViewModel?this._searchBoxViewModel.getSearchTerm():this.getSearchTermInternal()},r.prototype.setSearchBox=function(t){var i=this;this._searchBoxViewModel?this._searchBoxViewModel.setSearchBox(t):(this._searchBox=t,n(this._searchBox).add_event("keydown",function(n){i._onSearchBoxEnter(n)}))},r.prototype.onSearchInvokedFromTaskbar=function(n){if(this._cardsController!=null)this._cardsController.onSearchInvokedFromTaskbar(n)},r.prototype.overflowClick=function(n){this.setOverflowExpanded(!0);this._cardsController.overflowClick(n)},r.prototype.overflowKeyDown=function(n){var t=n;t.keyCode===13&&this._cardsController.overflowClick(n)},r.prototype.overflowMouseOver=function(n){this._cardsController.overflowMouseOver(n)},r.prototype.overflowMouseOut=function(n){this._cardsController.overflowMouseOut(n)},r.prototype.dispose=function(){n(window).remove_event("keyup",this._windowEventHandler);n(window).remove_event("keyup",this.onEscapeEvent);n(window).remove_event("keydown",this._firefoxEscapeEventHandler);n(window).remove_event("fullscreenChange,webkitfullscreenChange,mozfullscreenchange,msfullscreenChange,MSFullscreenChange,msfullscreenchange",this._onResizeHandler);this._clearHeaderLastElementKeyDownHandler()},r.prototype.setActionsOptions=function(i){for(var e,o,s,f=this.taskBarItems,u=0;u<f.length;u++)i===2047&&(f[u].action===8||f[u].action===256)?f[u].setIsActive(!1):(f[u].setIsActive((i&f[u].action)!=0),r.isFullScreen&&f[u].name===t.L_TaskBar_Label_Fullscreen&&(e=r._getTaskbarFullScreenButton(null),e.add_class("selected"),o=r.getMenuItem(t.L_TaskBar_Label_Fullscreen),s=n(".fullscreenIcon",o),s.add_class("selected")))},r.prototype.setActionsState=function(n,t){for(var i,o,u,e=this.taskBarItems,s=this.getControl(),f=0;f<e.length;f++)i=e[f],(n&i.action)!=0&&(o=i.getDataTag(),u=s.select('*[data-tag="'+o+'"]'),t==1?u.remove_class(r._pressedButtonClass):t==2&&u.add_class(r._pressedButtonClass),i.setCssClass(u.get_attr("class")))},r.prototype.stringify=function(t){return n.Internals.stringify(t)},r.prototype.clearAllClickHandler=function(n){this._cardsController.clearAllClickHandler(n)},r.prototype.clearAllKeyDownHandler=function(n){this._cardsController.clearAllKeyDownHandler(n)},r.prototype.setSearchBoxFocus=function(){if(this._searchBoxViewModel)this._searchBoxViewModel.setSearchBoxFocus();else if(this._searchBox)if(this._searchBox.focus(),r.enableDirectionsSearch=!0,typeof this._searchBox.selectionStart=="number")this._searchBox.selectionStart=this._searchBox.selectionEnd=this._searchBox.value.length;else if(typeof this._searchBox.createTextRange!="undefined"){var n=this._searchBox.createTextRange();n.collapse(!1);n.select()}},r.prototype.mapInteractedEvent=function(){r.enableDirectionsSearch=!1;this.hideMenu();var n=this.getControl().select(".taskBar");n&&n.length>0&&n[0].classList.contains("bm_slideout")&&n.remove_class("bm_slideout")},r.prototype.hideMenu=function(){var t=this;window.clearTimeout(r._mouseOverDelayHandle);this._taskBarPopOutElement&&(r._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){var i=n(".bm_dropdownEntry",t._taskBarPopOutElement[0]),f,u,r;if(i&&i.length>0&&i[0].blur(),f=!1,u=n(".popOutTemplate",t._taskBarPopOutElement[0]),u&&u.length>0){if(u[0].querySelector(":focus")||u[0].querySelector(":hover")||u[0].querySelector(":active"))f=!0;else for(r=0;r<i.length;r++)if(i[r].parentElement.querySelector(":hover")||i[r].parentElement.querySelector(":active")||i[r].parentElement.querySelector(":focus")||i[r].querySelector(":focus")||i[r].querySelector(":hover")||i[r].querySelector(":active")){f=!0;break}f&&u.get_style("display")!=="none"||t.clearMenuElements()}},r._mouseTimeout*2));this._mouseOutPrevent=!1},r.prototype.mouseoverMenuHandler=function(t){var i=this;window.clearTimeout(r._mouseOverDelayHandle);r._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){i._setMoreTaskItemState(!0);n(".taskBarPopout",i._map.getRootElement().getParent()[0]).set_style({display:"block"});i._initializeMenu(t)},r._mouseTimeout-100);t&&t.preventDefault&&t.preventDefault()},r.prototype.popoutMouseoverHandler=function(n){this._cardsController.popoutMouseoverHandler(n)},r.prototype.popoutMouseoutHandler=function(n){this._cardsController.popoutMouseoutHandler(n)},r.prototype.onFullScreenClick=function(i){var o=this;this._windowEventHandler||(this._windowEventHandler=function(n){return o.onEscapeEvent(n)},document.addEventListener("mozfullscreenchange",this.onEscapeEvent),document.addEventListener("webkitfullscreenchange",this.onEscapeEvent),document.addEventListener("msfullscreenChange",this.onEscapeEvent),document.addEventListener("MSFullscreenChange",this.onEscapeEvent),document.addEventListener("msfullscreenchange",this.onEscapeEvent),document.addEventListener("fullscreenchange",this.onEscapeEvent),n(window).add_event("keyup",this.onEscapeEvent));r.enableDirectionsSearch=!1;var u=r._getTaskbarFullScreenButton(i),f=r.getMenuItem(t.L_TaskBar_Label_Fullscreen),e=n(".fullscreenIcon",f),s=n("#container");u&&(u.has_class("selected")?(n(u).exit_full_screen(),u.remove_class("selected"),u[0].setAttribute("aria-label",t.L_TaskBar_Label_Fullscreen),e.remove_class("selected"),f&&f.setAttribute("aria-label",t.L_TaskBar_Label_Fullscreen),r.isFullScreen=!1):(n(u).set_full_screen(s[0]),u.add_class("selected"),u.set_attr("aria-label",t.Taskbar_Label_ExitFullScreen),e.add_class("selected"),f&&f.setAttribute("aria-label",t.Taskbar_Label_ExitFullScreen),r.isFullScreen=!0,r._logFullScreen(!0)),r._adjustContainerTop());i&&i.preventDefault()},r.getMenuItem=function(t){var e=n(".taskBarPopout",r._staticMap.getRootElement().getParent()[0])[0],f=n(".popOutInner",e)[0],u,i;if(f&&f.childElementCount>0)for(u=f.children,i=0;i<u.length;i++)if(u[i].innerHTML.indexOf(t)>-1)return u[i];return null},r.prototype.clearMenuElements=function(){this.hideFeedbackMenu.invoke();this._taskbarPopOutButtonViewModel&&this._taskbarPopOutButtonViewModel.setIsDisplayed(!1);n(".taskBarPopout",this._map.getRootElement().getParent()[0]).set_style({display:"none"});this._setMoreTaskItemState(!1)},r.prototype._setMoreTaskItemState=function(n){for(var i,t=r._taskItems.length-1;t>0;t--)if(r._taskItems[t].getCssClass().indexOf("moreIcon")>-1){i=r._taskItems[t];break}r._handleSelectedClass(i,n);i.setAriaExpanded(n)},r._handleSelectedClass=function(t,i){if(t)if(i)t.getCssClass().indexOf("selected")===-1&&t.setCssClass(t.getCssClass()+" selected");else while(t.getCssClass().indexOf("selected")>-1)t.setCssClass(t.getCssClass().replace(" selected","")),n(".moreIcon").fireEvent("blur")},r.prototype.mouseoutMenuHandler=function(n){var t=this;this._touchByPassMouseout||(window.clearTimeout(r._mouseOverDelayHandle),r._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){t.hideFeedbackMenu.invoke()},r._mouseTimeout));this._touchByPassMouseout=!1;n&&n.preventDefault&&n.preventDefault()},r.prototype.hoverFeedbackButton=function(){var t=n(".fullscreenMenuLink",this._taskBarPopOutElement[0]);t&&t.length>0&&t[0].parentElement.parentElement.focus()},r.prototype.boolToDisplay=function(n){return n?"":"none"},r.prototype.nullToDisplayNone=function(n){return n?"":"none"},r.prototype.overflowCapsuleListToDisplay=function(){var n=this.getOverflowCapsuleList();return n&&n.length>0?"":"none"},r.prototype.overflowCapsuleListToCount=function(){var n=this.getOverflowCapsuleList();return n&&n.length>0?n.length.toLocaleString():"none"},r.prototype.boolToHide=function(n){return n?"none":""},r.prototype.onEscapeEvent=function(n){var t=n,i=document.mozFullScreenElement||document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement;(t&&t.key&&(t.key==="Escape"||t.key==="Esc")||t.keyCode&&t.keyCode===27||(n.type==="mozfullscreenchange"||n.type==="webkitfullscreenchange"||n.type==="fullscreenchange"||n.type==="msfullscreenchange"||n.type==="MSFullscreenChange"||n.type==="msfullscreenChange")&&!i)&&(r.exitFullScreen(),r._logFullScreen(!1));n.preventDefault()},r.prototype.onOverlayCloseButtonClicked=function(){var n={logData:{feature:"TB",action:"C",data:{FN:r._featureNameToAction.Overlay,CN:"Close"}}};c.dynamicProperties.serpIG&&(n.impressionGuid=c.dynamicProperties.serpIG);s.invokeHandler(o.instrumentationDataHandlerKey,n)},r.prototype.onOverlayCloseKeydown=function(t){var i=t,r;i.keyCode&&(i.keyCode===13?this.onOverlayCloseButtonClicked():i.keyCode!==9||i.shiftKey||(t.preventDefault(),t.stopImmediatePropagation(),r=n("mapFocus"),r.length>0&&r[0].focus()))},r.exitFullScreen=function(){var i=this._getTaskbarFullScreenButton(null),u=r.getMenuItem(t.L_TaskBar_Label_Fullscreen),f=n(".fullscreenIcon",u);i.has_class("selected")&&(n("#container").exit_full_screen(),i.remove_class("selected"),f.remove_class("selected"));r.isFullScreen=!1;r._adjustContainerTop()},r.prototype._adjustSearchBoxLeftMargin=function(n){this._searchBoxViewModel&&this._searchBoxViewModel._adjustSearchBoxLeftMargin(n)},r.prototype.setIconClass=function(){var f=this._getShowTaskBarItemLabel(),u=n(".actions",this.getControl()[0])[0],t,i,r;if(u&&u.style&&u.style.display!="none")if(t=n(".action"),!f&&t&&t.length>0)for(i=0;i<t.length;i++)r=t[i].firstElementChild,r&&r.classList.contains("realign")&&r.classList.remove("realign");else if(t&&t.length>0)for(i=0;i<t.length;i++)r=t[i].firstElementChild,r&&!r.classList.contains("realign")&&r.classList.add("realign")},r._getTaskbarFullScreenButton=function(t){var i=t&&t.target;return i?i.className.indexOf("actionLabel")>-1?n(i.parentElement):i.className.indexOf("action")>-1?n(i.firstChild):n(i):n(".taskBar .fullScreenIcon")},r.prototype._onSearchBoxEnter=function(t){var u=t,e=u.keyCode||u.which,f,i;e===13&&(f=this._getInstData(r._searchFeatureName),s.invokeHandler(o.instrumentationDataHandlerKey,f),i=n(".searchButton")[0],i.setAttribute("tabindex","-1"),i.focus(),i.removeAttribute("tabindex"))},r.prototype._createTaskItemWithTaskOption=function(n,t,i,r,u){var f=new gt;return f.setCssClass(n),f.taskOption=t,f.action=i,f.setIsActive(!0),f.setDataTag(u?u:""),f.setShowLabel(r),f},r.prototype.createTaskItemWithClickHandler=function(t,i,r,u,f,o){var h=this,s;return o===void 0&&(o=!0),s=new gt,s.setCssClass(t),s.action=r,s.setIsActive(!0),s.setDataTag(f?f:""),s.setShowLabel(u),s.clickHandler=function(n){i(n);n.preventDefault()},s.keydownHandler=function(i){var r=h._map.getMode(),u,o,f;r&&(r.mapModeType===2||r.getDisplayName().indexOf("Birds")>-1)&&(e.fullScreen&&t.indexOf("full")>-1||!e.fullScreen&&t.indexOf("share")>-1)&&(u=i,o=u.keyCode||u.which,o===9&&(f=n("#id_h"),f.length>0&&h._setFocusToId(i,f)))},s.action=r,s},r.prototype.createTaskItemWithMouseHandlers=function(t,i,u,f,e){var s=this,o=new gt;return o.setCssClass(t),o.mouseoverHandler=function(n){window.clearTimeout(r._mouseOverDelayHandle);r._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){i(n)},r._mouseTimeout);n&&n.preventDefault&&n.preventDefault()},o.mouseoutHandler=function(n){s._touchByPassMouseout||(window.clearTimeout(r._mouseOverDelayHandle),r._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){n.target.tagName==="A"&&(n&&n.preventDefault&&n.preventDefault(),s.hideMenu())},r._mouseTimeout));s._touchByPassMouseout=!1},o.clickHandler=function(n){(n.type==="touchend"||n.type==="pointerup")&&(s._touchByPassMouseout=!0);n&&n.preventDefault&&n.preventDefault();i(n);n.cancelBubble=!0;n.stopPropagation()},o.keydownHandler=function(t){var u=t,e=u.keyCode||u.which,f;e===40&&o.getCssClass().indexOf("selected")===-1?(window.clearTimeout(r._mouseOverDelayHandle),r._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){i(t)},r._mouseTimeout),t&&t.preventDefault&&t.preventDefault()):e===9&&!u.shiftKey&&t.target.className.indexOf("more")>-1&&(f=n("#id_h"),f.length>0&&s._setFocusToId(t,f))},o.action=u,o.setIsActive(!0),o.setDataTag(e?e:""),o.setShowLabel(f),o.setPopoutClass("taskBarPopout"),o},r.prototype.createTaskItems=function(){var t=c.features.localGuide,n=this._getShowTaskBarItemLabel();this.addDirectionsItem(n);this.addTrafficItem(n);t&&t.isEnabled&&!oi.enableNewSidebar&&this.addLocalGuideItem(n);oi.enableMyContributions&&this.addMyContributionsItem(n);this.addCollectionItem(n);this.addSharingItem(n);this.addMoreMenuItem(n);this.addfullScreenItem(n)},r.prototype.addCollectionItem=function(n){if(this.isFeatureEnabled("collections")&&!c.isInPrivateMode){var i=this.createTaskItemWithClickHandler("placesIcon realign",function(n){if(n.type!=="pointerup"){r.enableDirectionsSearch=!1;var t={entryPoint:1,action:ni.GetAllCollections},i={type:f.collectionsTask,state:t};s.invokeHandler(o.taskDataHandlerKey,i);n.preventDefault()}},2,n,"TaskBar.CollectionsButton",!1);i.altName=i.name=t.L_TaskBar_Label_Favorites;i.url="/maps/myplaces";i.instrumentationData=this.createInstrumentationData(f.collectionsTask);this.taskBarItems.push(i);r._taskItems.push(i)}},r.prototype.makeHomeWorkRequest=function(){var t={entryPoint:1,action:ni.ProcessCardlessPrimitives},i={type:f.collectionsTask,requestorType:"TaskBar",requestState:t,hiddenTask:!0},n=this._map.getFrameManager();n&&n.frameRendered&&n.frameRendered.addOne(function(){s.invokeHandler(o.taskProcessDataHandlerKey,i)})},r.prototype.setUpAlwaysOnPoi=function(){var t=this,n;h._isSmallMapShownOnSerp()?(n=function(){t.makeHomeWorkRequest();sj_evt.unbind("LargeMapShown",n)},sj_evt.bind("LargeMapShown",n)):this.makeHomeWorkRequest()},r.prototype.addSharingItem=function(n){var u=c.features.sharing,i;u&&u.isEnabled&&!u.disableOutboardSharing&&(i=this.createTaskItemWithClickHandler("shareIcon realign",function(n){n.type!=="pointerup"&&(r.enableDirectionsSearch=!1,s.invokeHandler(o.shareDataHandlerKey,{entryPoint:l.TaskBar}))},8,n,"TaskBar.ShareButton",!1),i.altName=i.name=t.L_TaskBar_Label_Share,i.instrumentationData=this.createInstrumentationData(r._shareFeatureName),i.setIsActive(!1),i.setAriaExpanded(undefined),this.taskBarItems.push(i),r._taskItems.push(i))},r.prototype.addMoreMenuItem=function(n){var u=this,i=this.createTaskItemWithMouseHandlers("moreIcon realign",function(n){u.mouseoverMenuHandler(n)},128,n,"Taskbar.MoreButton");i.altName=i.name=t.L_TaskBar_Label_More;i.setAriaExpanded(!1);i.setAriaHasPopout(!0);i.setAriaControls("taskbarPopout");this.taskBarItems.push(i);r._taskItems.push(i)},r.prototype.addfullScreenItem=function(n,i){var f=this,u;e.fullScreen&&(u=this.createTaskItemWithClickHandler("fullScreenIcon",function(n){if(n.type!=="pointerup")f.onFullScreenClick(n)},256,n,"Taskbar.FullscreenButton"),u.altName=u.name=t.L_TaskBar_Label_Fullscreen,u.setIsActive(!1),u.setAriaExpanded(undefined),i?this.taskBarExtraItems.push(u):this.taskBarItems.push(u),r._taskItems.push(u))},r.prototype.addTrafficItem=function(n){var u=this,i;this.isFeatureEnabled("traffic")&&(i=void 0,this._trafficItem=i=this.createTaskItemWithClickHandler("trafficIcon",function(n){n.type!=="pointerup"&&(r.enableDirectionsSearch=!1,u._map.getMapType().id!==a.birdseye&&(u._trafficLayer?u._trafficLayer.toggle(1):u._showTrafficLayerAfterInstantiation=!0))},32,n,"TaskBar.TrafficButton",!1),i.altName=i.name=t.L_TaskBar_Label_Traffic,i.url="/maps/traffic",i.setAriaExpanded(undefined),i.instrumentationData=this.createInstrumentationData(r._trafficFeatureName),this.taskBarItems.push(i),r._taskItems.push(i))},r.prototype.addLocalGuideItem=function(n){var i=this.createTaskItemWithClickHandler("localGuideIcon",function(n){if(n.type!=="pointerup"){r.enableDirectionsSearch=!1;var t={type:f.localGuideTask,state:{entryPoint:l.LocalGuide}};s.invokeHandler(o.taskDataHandlerKey,t)}},1024,n,"TaskBar.LocalGuideButton",!1);i.name=t.L_TaskBar_Label_LocalGuide;i.altName=t.LocalGuide_Title;i.url="/maps/localnearby";i.setAriaExpanded(undefined);i.isNew=!0;i.banner=t.TaskBar_Banner_New;i.instrumentationData=this.createInstrumentationData(r._localGuideFeatureName);this.taskBarItems.push(i);r._taskItems.push(i)},r.prototype.addMyContributionsItem=function(n){var i=this.createTaskItemWithClickHandler("localGuideIcon",function(n){if(n.type!=="pointerup"){var t={type:f.myContributions,state:{}};s.invokeHandler(o.taskDataHandlerKey,t)}},1024,n,"TaskBar.MyContributionsButton",!1);i.name=t.L_TaskBar_Label_MyContributions;i.altName=t.L_TaskBar_Label_MyContributions;i.url="/maps/mycontributions";i.setAriaExpanded(undefined);i.isNew=!0;i.banner=t.TaskBar_Banner_New;i.instrumentationData=this.createInstrumentationData(r._localGuideFeatureName);this.taskBarItems.push(i);r._taskItems.push(i)},r.prototype.addDirectionsItem=function(n,i){var u=this,r;this.isFeatureEnabled("directions")&&(i?r=this._createTaskItemWithTaskOption("directionsIcon realign",{type:f.directionsTask,state:i},1,n,"TaskBar.DirectionsButton"):(r=this.createTaskItemWithClickHandler("directionsIcon realign",function(n){if(n.type!=="pointerup")u.onDirectionsClick(n)},1,n,"TaskBar.DirectionsButton",!1),r.altName=r.name=t.L_TaskBar_Label_Directions,r.url="/maps/directions",r.setAriaExpanded(undefined),r.instrumentationData=this.createInstrumentationData(f.directionsTask)),this.taskBarItems.push(r))},r.prototype.isFeatureEnabled=function(n){return c&&c.features[n]&&c.features[n].isEnabled},r.prototype.createInstrumentationData=function(n){var t=this._getInstData(n);return this.stringify(t)},r.prototype.onDirectionsClick=function(n){var t=this._taskManager.getFocusedStack()?this._taskManager.getFocusedStack().getForegroundTask():null,i,u;t&&(t.type===f.localDetailsTask||t.type===f.polygonEntityDetailsTask)&&!r.enableDirectionsSearch?(this._logDirectionsSearch(),this._getCardDetailsForDirections(t.type)):r.enableDirectionsSearch&&this._searchBox&&this._searchBox.value&&this._searchBox.value.length>0?(this._logDirectionsSearch(),this._getDetailsForDirections()):(i={entryPoint:1},u={type:f.directionsTask,state:i},s.invokeHandler(o.taskDataHandlerKey,u));r.enableDirectionsSearch=!1;n.preventDefault()},r.prototype._getCardDetailsForDirections=function(n){var t={searchEntitiesRequested:!0,entryPoint:l.TaskBar},i={requestorType:"TaskBar",type:n,requestState:t,useActiveTasks:!0};s.invokeHandler(o.taskProcessDataHandlerKey,i)},r.prototype._getDetailsForDirections=function(){var n={disableTaskActivate:!0,query:this._searchBox.value,noAds:!0,entryPoint:l.TaskBar},t={requestorType:"TaskBar",type:f.localDetailsTask,requestState:n,useActiveTasks:!1};s.invokeHandler(o.taskProcessDataHandlerKey,t)},r.prototype._logDirectionsSearch=function(){s.invokeHandler(o.instrumentationDataHandlerKey,{logData:{feature:"TB",action:"SE",data:{C:"DS"}}})},r._logFullScreen=function(n){var t=n?"FSO":"FSE",i={logData:{feature:"TB",action:"C",data:{FN:t}}};s.invokeHandler(o.instrumentationDataHandlerKey,i)},r.prototype._getInstData=function(n){return{logData:{feature:"TB",action:"C",data:{FN:r._featureNameToAction[n]}}}},r.prototype._getMenuInstData=function(n){return{logData:{feature:"TB",action:"C",data:{FN:n}}}},r.prototype._initializeMenu=function(t){var r=this,u,f,i,o;t&&t.preventDefault();u=n(".taskBarPopout",this._map.getRootElement().getParent()[0]);u&&u.length>0&&(f=n(".feedbackPopOut")[0],f&&this._map.getRootElement().getParent().insertBefore(f,this._map.getRootElement()));this._menuList.length===0&&(i=c.features.sharing,i&&i.isEnabled&&!i.disableOutboardSharing&&this._menuList.push(this._createShareMenuItem()),this.isFeatureEnabled("print")&&this._menuList.push(this._createPrintMenuItem()),this.isFeatureEnabled("feedback")&&this._menuList.push(this._createFeedbackMenuItem()),e.fullScreen&&this._menuList.push(this._createFullscreenMenuItem()),this._menuList.push(this._createEmbedMenuItem()));this._showDropdown(t);o=n("feedbackMenuLink");o.set_attr("aria-expanded","false");o.add_event("touchend",function(t){var i=n(".feedbackMenuLink").parent(),u;r.launchFeedbackMenu.invoke(i);u=r._map.getMode();t&&(t.preventDefault(),t.stopPropagation());r._touchByPassMouseout=!0});h._setFocusOnFirstMenuItem(this._taskBarPopOutElement)},r.prototype._createShareMenuItem=function(){var n=this;return{name:t.L_TaskBar_Label_Share,handler:function(){s.invokeHandler(o.shareDataHandlerKey,{entryPoint:l.TaskBar});n._setMoreTaskItemState(!1)},mouseouthandler:function(t){n.hideMenu();t&&(t.preventDefault(),t.stopPropagation())},cssClass:"shareMenuLink",iconClass:"shareIcon menuLinkIcon",instData:this._getMenuInstData(v.Share)}},r.getCurrentActiveTask=function(n){var i="",t;return n&&(t=n.getFocusedStack(),t?t.getForegroundTask()&&(i=t.getForegroundTask().type):i="BaseMap"),i},r.prototype._createPrintMenuItem=function(){var i=this,u=this._taskManager;return{name:t.L_TaskBar_Label_Print,handler:function(){var t=r.getCurrentActiveTask(u);s.invokeHandler(o.printDataHandlerKey,{source:1,fullScreen:r.isFullScreen,taskType:t});i._setMoreTaskItemState(!1);dt.onPrintDialogClose.addOne(function(){window.clearTimeout(r._mouseOverDelayHandle);r._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){i._setMoreTaskItemState(!0);n(".taskBarPopout",i._map.getRootElement().getParent()[0]).set_style({display:"block"});i._taskbarPopOutButtonViewModel.setIsDisplayed(!0);i._mouseOutPrevent=!0;Microsoft.Maps.setTimeout(function(){var t=n(".printMenuLink"),i=t&&t.length>0?t[0].parentElement:null;i&&i.focus()},150)},r._mouseTimeout)})},mouseouthandler:function(n){i._mouseOutPrevent||i.hideMenu();i._mouseOutPrevent=!1;n&&(n.preventDefault(),n.stopPropagation())},cssClass:"printMenuLink",iconClass:"printIcon menuLinkIcon",instData:this._getMenuInstData(v.Print)}},r.prototype._createFeedbackMenuItem=function(){var i=this;return{name:t.L_Menu_Feedback_Text,mouseoverhandler:function(){window.clearTimeout(r._submenuMouseOverDelayHandle);r._submenuMouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){var t=n(".feedbackMenuLink").parent();i.launchFeedbackMenu.invoke(t)},r._mouseTimeout)},handler:function(){var t=n(".feedbackMenuLink").parent();i.launchFeedbackMenu.invoke(t)},mouseouthandler:function(n){i._touchByPassMouseout||(window.clearTimeout(r._submenuMouseOverDelayHandle),r._submenuMouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){i.hideFeedbackMenu.invoke()},r._mouseTimeout*2));i._touchByPassMouseout=!1;n&&(n.preventDefault(),n.stopPropagation())},cssClass:"feedbackMenuLink",iconClass:"feedbackIcon menuLinkIcon",subMenu:!0,instData:this._getMenuInstData(v.Feedback)}},r.prototype._createFullscreenMenuItem=function(){var i=this,u=n(".fullScreenIcon.realign"),r="fullscreenIcon menuLinkIcon";return u.has_class("selected")&&(r+=" selected"),{name:t.L_TaskBar_Label_Fullscreen,handler:function(n){i.onFullScreenClick(n);i._setMoreTaskItemState(!1)},mouseouthandler:function(n){i.hideMenu();n&&(n.preventDefault(),n.stopPropagation())},cssClass:"fullscreenMenuLink",iconClass:r,instData:this._getMenuInstData(v.Fullscreen)}},r.prototype._createEmbedMenuItem=function(){var n=this,i=this._taskManager;return{name:t.L_TaskBar_Label_Embed,handler:function(t){n._openEmbedPage(t)},mouseouthandler:function(t){n.hideMenu();t&&(t.preventDefault(),t.stopPropagation())},cssClass:"embedMenuLink",iconClass:"embedIcon menuLinkIcon",instData:this._getMenuInstData(v.Embed)}},r.prototype._openEmbedPage=function(){if(this._map){var n=h._formatString(k.embedPageUrl,this._map.getBounds().center.latitude,this._map.getBounds().center.longitude,this._map.getMercatorZoomLevel());window.open(n,"EmbeddedMap");this._logEmbed(n)}},r.prototype._showDropdown=function(t){var o=this,i=t&&t.target,u;i.className.indexOf("actionLabel")>-1?i=t.target.parentElement.parentElement:i.className.indexOf("Icon")>-1&&(i=i.parentElement);this._taskbarDropdownViewModel?this._taskbarPopOutButtonViewModel&&this._taskbarPopOutButtonViewModel.getIsDisplayed()===!0&&(this._taskbarPopOutButtonViewModel.setIsDisplayed(!1),this._taskbarDropdownViewModel.setDropdown(this._menuList),this._taskbarDropdownViewModel.setButtonElement(n(i)),this._taskbarPopOutButtonViewModel.setDropdown(this._taskbarDropdownViewModel)):(this._taskbarDropdownViewModel=new sr(this._menuList,n(i)),this._taskbarPopOutButtonViewModel=new rr(this._taskbarDropdownViewModel,null,this._taskbarDropdownViewModel.taskBarListDropDownTemplate),u=this._taskbarPopOutButtonViewModel.buildPopOut(),this._taskBarPopOutElement=n(".taskBarPopout",this._map.getRootElement().getParent()[0]),this._taskBarPopOutElement.append(u));var r=i.getBoundingClientRect(),s=r.height+10,f=n(window).get_scroll_pos().x,h=window.innerHeight/window.document.documentElement.offsetHeight*100<80,c=!(f===0||h),e=_G.RTL?r.right-this._taskBarPopOutElement[0].clientWidth:r.left;c&&(e+=f);this._taskBarPopOutElement.set_style({left:e+"px",right:"",top:s+"px"});n(".taskBarPopout").add_event("keydown",function(n){o._onMenuKeyDown(n)});this._taskbarPopOutButtonViewModel.setIsDisplayed(!0)},r.prototype._showIdControls=function(){var s=n("#b_header")[0],i;if(s&&(i=n("#id_h",s),i.length>0)){var t=n(".id_nc",i[0]),o=t&&t.length>0&&!t.has_class("bnc-hide"),r=n("#id_sc");if(!c.isMapsAnswer){var u=n("#id_l",i[0]),f=n("#id_rh",i[0]),h=o?this._maxIdControlsWidth:100;window.innerWidth<e.taskbarIdShowWidth+h?(u.length>0&&!u.has_class("hide")&&u.add_class("hide"),f.length>0&&!f.has_class("hide")&&f.add_class("hide"),o&&t.length>0&&!t.has_class("hide")&&t.add_class("hide")):(u.length>0&&u.has_class("hide")&&u.remove_class("hide"),f.length>0&&f.has_class("hide")&&f.remove_class("hide"),o&&t.length>0&&t.has_class("hide")&&t.remove_class("hide"))}window.innerWidth<e.taskbarButtonsShowTextWidth+this._maxIdControlsWidth?(t.length>0&&!t.has_class("hide")&&t.add_class("hide"),!e.enableTCFTablet&&r.length>0&&!r.has_class("hide")&&r.add_class("hide")):(t.length>0&&t.has_class("hide")&&t.remove_class("hide"),!e.enableTCFTablet&&r.length>0&&r.has_class("hide")&&r.remove_class("hide"));this._removeIDFocusHandler(i);this._setLastIdKeyDownListener(i)}},r.prototype._setFocusToId=function(t,i){for(var r,e=this,f=i[0].children,u=0;u<f.length;u++)if(r=f[u].tagName.toLowerCase()==="a"?n(f[u]):null,r&&r.length>0&&r.get_style("display")!=="none"||!r.has_class("hide")){t&&t.preventDefault&&t.preventDefault();r.add_event("keydown",function(t){if(t.keyCode===9&&t.shiftKey){var i=n(".moreIcon",e.getControl()[0]);i.length>0&&(t.preventDefault(),t.stopImmediatePropagation(),i[0].focus())}});r[0].focus();break}},r.prototype._clearHeaderLastElementKeyDownHandler=function(){var i=n("#b_header"),t=n("#id_h",i[0]);t.length>0&&this._removeIDFocusHandler(t)},r.prototype._setLastIdKeyDownListener=function(t){for(var i,f=this,u=t&&t.length>0&&t[0].children,r=u.length-1;r>=0;r--)if(i=u[r].tagName.toLowerCase()==="a"?n(u[r]):null,i&&i.length>0&&i.get_style("display")!=="none"&&(!i.get_attr("keydownListen")||i.get_attr("keydownListen").indexOf("false")>-1)){i[0].addEventListener("keydown",function(n){return f.idButtonKeydownHandler(n)});i.set_attr("keydownListen","true");break}},r.prototype._removeIDFocusHandler=function(t){for(var i,u=t&&t.length>0&&t[0].children,r=u.length-1;r>=0;r--)i=u[r].tagName.toLowerCase()==="a"?n(u[r]):null,i&&i.length>0&&(i[0].removeEventListener("keydown",this.idButtonKeydownHandler),i.set_attr("keydownListen","false"))},r.prototype.idButtonKeydownHandler=function(t){if(t&&t.keyCode&&t.keyCode===9&&!t.shiftKey){var i=n("#mapFocus");h._isLargeMapShownOnSerp()&&(i=n(".overlayCloseLink"));i.length>0&&i[0].focus();t.preventDefault();t.stopImmediatePropagation()}},r.prototype._setTextAlignment=function(n){for(var i=n,r=this._getShowTaskBarItemLabel(),t=0;t<i.length;t++)i[t].setShowLabel(r);this._adjustSearchBoxWidth();this._showIdControls()},r.prototype._adjustSearchBoxWidth=function(){var o=this.getControl()[0],s=h._isSmallMapShownOnSerp()?0:this._map.getActualSize().width,t,i,f,u;if(s>0)if(t=n(".inputbox",o)[0],i=n("#taskbarPrimer")[0],i&&i.clientWidth>0)f=n(".inputbox",i)[0],this._setSearchControlsWidth(t,f.getBoundingClientRect().width);else if(this._isMapsAnswer&&this.actionBarSize<this._minimumActionButtonsWidth&&(this.actionBarSize=this._maxActionButtonsWidth),t){var c=n("#b_header")[0],l=n("#id_h",c),r=n(".id_nc",l[0]),a=r&&r.length>0&&!r.has_class("bnc-hide"),v=a?47:0,y=this._rightTaskbarBuffer+this._searchBoxLeftBuffer+this._navButtonWidth+this._maxActionButtonsWidth+v,p=this._fullSearchControlsWidth-this._minSearchBoxWidth,e=window.innerWidth-(this._fullSearchControlsWidth+y);e>0?this._setSearchControlsWidth(t,this._searchBoxWidth):(u=p-Math.abs(e),u<0?this._setSearchControlsWidth(t,this._minSearchBoxWidth):this._setSearchControlsWidth(t,this._minSearchBoxWidth+u))}},r.prototype._setSearchControlsWidth=function(t,i){var u,f,r;t&&(u=38,f=n("#maps_sb",t)[0],t.setAttribute("style","width: "+i+"px"),r=n(".as_container_search",t),r&&r.get_style("visibility")==="visible"&&this._searchBox.value.length>-1&&r.set_style({width:i+"px"}))},r.prototype.insertPopoutInMap=function(){var t=n(".taskBarPopout",this._map.getRootElement().getParent()[0]);t&&t.length!==0||(this._taskBarPopOutElement=h._createElement("div"),this._taskBarPopOutElement.set_attr("class","taskBarPopout"),this._taskBarPopOutElement.set_attr("id","taskBarPopoput"),this._map.getRootElement().getParent().insertBefore(this._taskBarPopOutElement[0],this._map.getRootElement()))},r.prototype.getSearchBox=function(){return this._searchBoxViewModel&&this._searchBoxViewModel.getControl()},r.prototype.getOverlayCloseButton=function(){return this._overlayCloseViewModel&&this._overlayCloseViewModel.getControl()},r.prototype._onResizeHandler=function(){var l=this._getShowTaskBarItemLabel(),f,u,o,s,i,t,c,r;for(this._showIdControls(),this._setTextAlignment(this.taskBarItems),f=this.taskBarItems,u=0;u<f.length;u++)f[u].setShowLabel(l);if(this.setIconClass(),h._isLargeMapShownOnSerp()||h._isTravelOverlayShownOnSerp()){if(o=document.getElementById("b_header"),s=window.innerWidth,o)if(i=n(".id_button",o),s<=e.taskBarMapTypeTextMinWidth)for(t=0;t<i.length;t++)i[t].style.padding="0";else for(t=0;t<i.length;t++)i[t].removeAttribute("style");c=document.getElementsByTagName("html")[0];r=n(".b_footer.b_slimFoot.bm_oneMap")[0];s<=e.windowMinWidth?(c.style.overflowX="auto",r&&(r.style.zIndex="1001")):(c.style.overflowX="hidden",r&&r.removeAttribute("style"))}},r._adjustContainerTop=function(){var t=n("#container")[0];r.isFullScreen&&(t.style.top="0",t.style.bottom="0")},r.prototype._onMenuKeyDown=function(t){var s=this,o=t,u=o.keyCode||o.which,i,f,e;u===9?this.hideMenu():u===37?this.clearMenuElements():u===13||u===39?(i=t.target,i.className.indexOf("bm_dropdownEntry")>-1&&(i=i.children[0],i&&(i=i.children[0])),i.className.indexOf("feedback")>-1&&this.launchFeedbackMenu.invoke(n(".feedbackMenuLink").parent()),window.clearTimeout(r._mouseOverDelayHandle),r._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){s.focusFeedback.invoke()},r._mouseTimeout*2)):u===40?(f=t.target.nextElementSibling,f&&n(f)[0].focus()):u===38&&(e=t.target.previousElementSibling,e?n(e)[0].focus():this.clearMenuElements())},r.prototype._setTrafficButtonSelected=function(t){var i=n(".trafficIcon")[0];i&&(t&&!i.classList.contains("selected")?i.classList.add("selected"):!t&&i.classList.contains("selected")&&i.classList.remove("selected"));this._trafficIsSelected=t},r.prototype._getShowTaskBarItemLabel=function(){return this._searchBoxWidth==null?!1:e.showTaskBarLabels&&window.innerWidth>e.taskbarButtonsShowTextWidth+(h._isLargeMapShownOnSerp()?50:0)},r.prototype._logEmbed=function(n){var t={PL:n};b.instLog(it.EMC,t)},r.prototype._searchBoxFocusHandler=function(){var t=n("#maps_sb_container #maps_sb");t.length>0&&t[0].focus()},r.prototype._setHiddenElementFocusHandler=function(){var r=this,i=n("#b_header"),t;i.length>0&&(t=i.select("a"),t.length>0&&t[0].addEventListener("keydown",function(n){n&&n.keyCode&&n.keyCode===9&&!n.shiftKey&&(n.preventDefault(),n.stopPropagation(),r._searchBoxFocusHandler())}))},r._shareFeatureName="Share",r._searchFeatureName="Search",r._trafficFeatureName="Traffic",r._fullscreenFeatureName="Fullscreen",r._embedFeatureName="Embed",r._overlayFeatureName="Overlay",r._localGuideFeatureName="LocalGuide",r._taskbarStyleSet="",r._taskbarStyle="",r._mouseTimeout=150,r._featureNameToAction=function(){var n={};return n[f.collectionsTask]=v.Collections,n[f.directionsTask]=v.Directions,n[r._shareFeatureName]=v.Share,n[r._searchFeatureName]=v.Search,n[r._trafficFeatureName]=v.Traffic,n[r._fullscreenFeatureName]=v.Fullscreen,n[r._embedFeatureName]=v.Embed,n[r._overlayFeatureName]=v.Overlay,n[r._localGuideFeatureName]=v.LocalGuide,n}(),r.hiddenStyle={visibility:"hidden"},r.visibleStyle={visibility:"visible"},r._pressedButtonClass="pressed",r._fullScreenModalDialogContentTemplate='<div class="fullscreenEscape"><p>{escText}<\/p><\/div>',r.isFullScreen=!1,r}(et),lu=function(n){function t(t,i,r,u,f){var e=n.call(this,t,i,r,u,f)||this;return e._slideOutMenuItem&&t.instanceAsync("SlideOutMenu",function(n){e._slideOutMenu=n}),e}return y(t,n),t.prototype.createTaskItems=function(){var i=this,n;this.addDirectionsItem(!1,{entryPoint:1});this.isFeatureEnabled("slideOutMenu")&&(this._slideOutMenuItem=n=this.createTaskItemWithClickHandler("slideOutIcon",function(){i._slideOutMenu&&i._slideOutMenu.showMenu()},64,!1,"TaskBar.SlideOutMenu"),n.instrumentationData=this.createInstrumentationData(t._slideOutMenuFeatureName),this.taskBarItems.push(n))},t._slideOutMenuFeatureName="SlideOutMenu",t}(nt),au=function(){function r(t,i,r,f){var o=this,b=this._getTemplate(),l,a,s,v,y,p,w;if(b)this._taskManager=f,this._viewModel=this._CreateTaskBarViewModel(t,i,b,r,this._taskManager),l=this._viewModel.getControl(),this._map=i,this._controlTemplateFactory=r,a=i.getRootElement(),this.feedbackInitialize=new u,this._viewModel.launchFeedbackMenu.add(function(n){o.feedbackInitialize.invoke(n)}),this.dismissMenu=new u,this.dismissMenu.add(function(){o._viewModel.hideMenu()}),this.dismissFeedbackMenu=new u,this.focusFeedbackMenu=new u,this._viewModel.focusFeedback.add(function(){o.focusFeedbackMenu.invoke()}),this._viewModel.hideFeedbackMenu.add(function(){o.dismissFeedbackMenu.invoke()}),this.hoverFeedbackButton=new u,this.hoverFeedbackButton.add(function(){o._viewModel.hoverFeedbackButton()}),this.exitFullScreen=new u,this.exitFullScreen.add(function(){o._viewModel.exitFullScreen.invoke()}),this._visibilityChangedEvent=new u,this._visibilityChangedEvent.add(function(n){o._viewModel.setAutoSuggestExpanded(n)}),this._selectionChangedEvent=new u,this._selectionChangedEvent.add(function(n){o._viewModel.setSelectedSuggestionId(n)}),this._currentSearchBoxQuery=null,this._map.mapTapped.add(function(){o._searchBox&&o._searchBox.blur()}),this._autosuggestResultsFromNearby=!1,a.getParent().insertBefore(l,a),s=c.features.taskFramework,s&&(s.isOSx||s.isSafari)&&l.add_class("bm_safari"),v=n("#maps_sb"),this._viewModel.setIconClass(),this._viewModel._adjustSearchBoxWidth(),v.length>0&&(this._searchBox=v[0],this._viewModel.setSearchBox(this._searchBox)),n(".searchIcon").add_event("click",function(n){o.handleSearchButtonEvents(n)}),y=c.features.autosuggest,y.isEnabled&&(this._suggestionItemSelected=new u,this._suggestionItemSelected.add(function(n){o._onSuggestionItemSelected(n)}),this._suggestionItemClicked=new u,this._suggestionItemClicked.add(function(n){o._onSuggestionItemClicked(n)}),this._onAutosuggestKeydown=new u,this._onAutosuggestKeydown.add(function(n){o.onAutosuggestKeydownFunction(n)}),this._clickHandler=new u,this._clickHandler.add(function(){o.handleClick()}),tt.customSATREnabled&&!tt.isSDK&&(this._onAutosuggestBlur=new u,this._onAutosuggestBlur.add(function(n){o.onAutosuggestBlurHandler(n)})),s.nearbyButtonEnabled&&(this._onAutosuggestNearbyBlur=new u,this._onAutosuggestNearbyBlur.add(function(){return o._setNearbyExpansion()}))),typeof Feedback!="undefined"&&(Feedback.Bootstrap.InitializeFeedback({structured:!0},"tdd_feedback",!1,!0,!1),Feedback.Bootstrap.InitializeFeedback({structured:!0},"tdd_exit",!1,!0,!1)),this._viewModel.insertPopoutInMap(),this.fullScreenEnabled=e.fullScreen,y.enableSmartCompose&&(p=h.createElementWithClassName("input","bm_completionBox bm_completionBoxHidden"),p.disabled=!0,this._searchBox&&this._searchBox.insertAdjacentElement("afterend",p));else throw new Error("Template is not defined!");this._clearSuggestions=!1;w=n("#b_TriviaOverlay");c.isMapsVertical&&w&&w.length>0&&kt.initialize(this._map,this._taskManager)}return r.prototype.initializeAutosuggest=function(){var r=n("#maps_sb_container"),u=n("#maps_sb"),t=new er,i;this._searchBoxAutosuggestDataModel=t;this._autosuggestViewModel=new bi(t,this._controlTemplateFactory,!0,"TaskBarSearch",this._visibilityChangedEvent,this._selectionChangedEvent);i="as_container_search";this._autosuggest=new ki(r,u,i,this._autosuggestViewModel,this._map);this._autosuggest.setAutosuggestKeydownHandler(this._onAutosuggestKeydown);this._autosuggest.setItemSelectionEventHandler(this._suggestionItemSelected);this._autosuggest.setItemClickEventHandler(this._suggestionItemClicked);this._autosuggest.setClickEventHandler(this._clickHandler);tt.customSATREnabled&&!tt.isSDK&&this._autosuggest.setAutosuggestBlurHandler(this._onAutosuggestBlur)},r.prototype.handleSearchButtonEvents=function(n){nt.enableDirectionsSearch=!1;this._autosuggest&&this._autosuggest.instrumentSearchButtonClickEvent();var t=this._autosuggestViewModel&&this._autosuggestViewModel.getSelectedSuggestion(),i=t?l.Autosuggest:l.SearchButton;this._performSearch(i,t);n&&n.preventDefault&&n.preventDefault()},r.prototype.handleClick=function(){nt.enableDirectionsSearch=!0;this._autosuggest&&this._autosuggest.refreshAutosuggest();this._clearSuggestions&&(nt.enableDirectionsSearch=!1,this._clearSuggestions=!1,this._searchBox&&this._searchBox.removeAttribute("placeholder"),this._searchBoxAutosuggestDataModel.clearDefaultSuggestions());this._autosuggestResultsFromNearby=!1},r.prototype.onAutosuggestKeydownFunction=function(n){var u=n,f=u.keyCode||u.which,t,i,r;f==13&&(nt.enableDirectionsSearch=!1,i=l.SearchBox,this._autosuggestViewModel&&(t=this._autosuggestViewModel.getSelectedSuggestion()),wi.enableSmartCompose&&!t&&(r=this._autosuggestViewModel.getCurrentSuggestion(),r&&(t=r.suggestion)),t&&(i=l.Autosuggest),i=this._autosuggestResultsFromNearby?l.Nearby:i,this._performSearch(i,t),this._autosuggestResultsFromNearby=!1)},r.prototype.processCallback=function(n){var t,i,r,u,e,h;n&&n.inData&&n.processorType&&n.outData&&(n.processorType===f.localDetailsTask||n.processorType===f.polygonEntityDetailsTask)&&(t={entryPoint:1},i=n.inData.requestState,i&&(i.searchEntitiesRequested||i.disableTaskActivate)&&n.outData&&n.outData.length>0&&(r=this._getEventTime(n.outData),r&&(u={dateTime:r,timeType:or.arrival}),e=this._getWaypoint(n.outData),e&&(t.waypoints=[e],u&&(t.options=u))),h={type:f.directionsTask,state:t},s.invokeHandler(o.taskDataHandlerKey,h))},r.prototype._getTemplate=function(){return wr},r.prototype._getWaypoint=function(n){var u=null,i,r,f,t;if(n.length>1||n[0]&&n[0].processorId){for(i=0;i<n.length;i++)if(n[i]&&n[i].data&&(r=n[i],f=r.processorId,this._taskManager.getFocusedStack()&&this._taskManager.getFocusedStack().getForegroundTask().id===f&&(t=r.data&&r.data.length>0?r.data[0]:null,t&&!t.isApproximateLocation))){u=new si(t.getAddress(),t.getLocation(),t.getTitle(),!1,null,t.id,null,null,null,2,5);break}}else n[0]&&n[0]&&n[0].data.entities&&n[0].data.entities.length>0&&(t=n[0].data.entities[0],t&&!t.isApproximateLocation&&(u=new si(t.getAddress(),t.getLocation(),t.getTitle(),!1,null,t.id,null,null,null,2,5)));return u},r.prototype._getEventTime=function(n){var f,r,u,e,t,o,s;if(n[0]&&n[0]&&n[0].data&&n[0].data.length==1)for(r=0;r<n.length;r++)n[r]&&n[r].data&&(u=n[r],e=u.processorId,this._taskManager.getFocusedStack()&&this._taskManager.getFocusedStack().getForegroundTask().id===e&&(t=u.data&&u.data.length>0?u.data[0]:null,t&&t.id&&t.id.indexOf("event")>-1&&(o=i.GlobalConfig.features.localSearch.eventPreArrivalTime,t.getDateTime&&t.getDateTime()&&(s=new Date(t.getDateTime()),f=t.getDateTime()+t.getUtcOffset()*6e4-o*6e4))));return f},r.prototype._onSuggestionItemSelected=function(n){this.getSearchTerm()===n.searchText&&this._searchBox&&(this._searchBox.value=n.searchText);this.setSearchTerm(n.searchText)},r.prototype._onSuggestionItemClicked=function(n){this._performSearch(this._autosuggestResultsFromNearby?l.Nearby:l.Autosuggest,n);this._autosuggestResultsFromNearby=!1},r.prototype.onAutosuggestBlurHandler=function(){var n=this;this.getSearchTerm()||(this._currentSearchBoxQuery&&this.setSearchTerm(this._currentSearchBoxQuery),this._searchBox.setAttribute("placeholder",t.SearchGhostText));this._currentSearchBoxQuery=null;this._routePoints&&Microsoft.Maps.setTimeout(function(){n._routePoints=null;n._searchBoxAutosuggestDataModel.clearDefaultSuggestions();n._autosuggest&&n._autosuggest.setIsSearchAlongRoute(!1)},2e3)},r.prototype._performSearch=function(i,r){var nt=this,p,u,w,d,g,v,b,y,it,rt,k,ft;ir.setStartTime("SearchRequest");p=this._searchBox?this._searchBox.value.trim():this._viewModel.getSearchTerm().trim();this._viewModel.onSearchInvokedFromTaskbar(null);if(this._autosuggest&&this._autosuggest.stopAutosuggest(),u={},u.query=p,i!==l.Autosuggest&&(u.originalQuery=p),u.entryPoint=i,i===l.Nearby&&(w=n("div.overlay-taskpane"),d=null,w&&w.length>0&&(g=w[w.length-1].getAttribute("data-entity"),g&&(v=JSON.parse(g),v&&v.routablePoint&&(d={location:v.routablePoint,title:v.entity&&(v.entity.name||v.entity.title||v.entity.adress)}))),u.nearbyPivotEntity=d),u.asConversationId=this._autosuggest&&this._autosuggest.getConversationId(),r&&(this.setSearchTerm(r.searchText),u.query=r.searchText,u.fullQuery=r.searchText,e.updateSearchTermOfAutosuggestWithTaskTitle&&(u.originalQuery=r.searchText),u.filterUrlParam=r.entityId,u.mapBounds=r.mapBounds,r.type==="Favorite"?(!r.entityId&&r.location&&(u.query=r.location.latitude+","+r.location.longitude,u.fullQuery=u.query),u.taskTitle=r.alternateName||r.name,u.asName=r.name,u.asFormattedAddress=r.formatedAddress):(u.asName=r.formatedLine1,u.asFormattedAddress=r.formatedLine2),b=r.primaryCategoryPath,b&&(h._isRestaurantCategory(b)||h._isHotelsCategory(b))&&(u.noAds=!0)),y=this._map.getMode(),y&&(y.mapModeType===2||y.mapModeType===3)&&p?(it=y.getPreviousMapType(),this._map.setMapType(it),rt=y.getPreviousMode(),this._map.setMode(rt),this.setActionsOptions(2047)):this._map.getMapType().id===a.birdseyeV2&&p&&this._map.getBirdseyeV2Manager().then(function(n){var t=nt._map.getMapTypes()[n.previousMapState.mapTypeId||a.road];t&&nt._map.setBaseLayers(t)}),k=c.features,r&&r.title===t.L_SearchNearbyTransit&&k&&k.transit&&k.transit.isEnabled){ft={location:ut.getMapCenter(this._map),title:this._nearbyLocationTitle,entryPoint:1};s.invokeHandler(o.taskDataHandlerKey,{state:ft,type:f.nearbyTransitTask});return}tt.customSATREnabled&&!tt.isSDK&&this._routePoints&&this._routePoints.length>0&&(u.keyRoutePoints=this._routePoints,u.entryPoint=l.CategoriesBar,u.isCustomSatrSearch=!0,u.directionsTraceId=this._directionsTraceId,u.disableComputingMapViewForLoadingOnly=!0,u.forceDisableMicroPoi=!0,u.directionsTaskId=this._directionsTaskId,this.logSatrSearchRequest(this.getSearchTerm()),this._currentSearchBoxQuery=null);s.invokeHandler(o.taskProcessDataHandlerKey,{requestState:u,type:f.localSearchTask})},r.prototype.setActionsOptions=function(n){this._viewModel.setActionsOptions(n)},r.prototype.setActionsState=function(n,t){this._viewModel.setActionsState(n,t)},r.prototype.setSearchTerm=function(n,t){this._viewModel.setSearchTerm(n);t&&s.invokeHandler(o.taskProcessDataHandlerKey,{type:f.localSearchTask,requestState:{query:n}})},r.prototype.getSearchTerm=function(){return this._viewModel.getSearchTerm()},r.prototype.setSearchBoxFocus=function(){this._viewModel.setSearchBoxFocus()},r.prototype.getSearchBox=function(){return n(this._searchBox)},r.prototype.setSearchBoxGhostText=function(n){this._searchBox&&(this._currentSearchBoxQuery=this.getSearchTerm(),this.setSearchTerm(""),this._searchBox.setAttribute("placeholder",n),this.setSearchBoxFocus(),this._clearSuggestions=!0)},r.prototype.updateSearchBoxAutosuggestDefault=function(n,t,i,r,u,f){var e=c.features.taskFramework;this._autosuggestResultsFromNearby=e.nearbyButtonEnabled&&!!f;tt.customSATREnabled&&!tt.isSDK&&i&&(this._routePoints=i,this._directionsTaskId=r,this._directionsTraceId=u,this._autosuggest&&this._autosuggest.setIsSearchAlongRoute(i&&i.length>0));this._searchBoxAutosuggestDataModel.updateDefaultSuggestions(n,t);this._autosuggest&&this._autosuggest.refreshAutosuggest();this._autosuggest&&this._onAutosuggestNearbyBlur&&this._autosuggest.setAutosuggestBlurHandler(this._onAutosuggestNearbyBlur)},r.prototype.setNearbyLocationTitle=function(n){this._nearbyLocationTitle=n},r.prototype._CreateTaskBarViewModel=function(n,t,i,r,u){return c.isMobile?new lu(n,t,lr,r,u):new nt(n,t,this._getTemplate(),r,u)},r.prototype.logSatrSearchRequest=function(n){var t={logData:{feature:"TB",action:"S",data:{Q:n,TYP:"SATR"}}};s.invokeHandler(o.instrumentationDataHandlerKey,t)},r.prototype._setNearbyExpansion=function(){var i,r,u,t;if(this._autosuggestResultsFromNearby)for(i=n(".ibs_2btns"),i||(i=n(".ibs_3btns")),r=0;r<i.length;r++)u=n(i[r]),t=u.has_class("nearbyBtn")?u:null,t&&t.length>0&&(t.get_attr("aria-expanded")!==undefined||t.get_attr("aria-expanded")!=="")&&t.set_attr("aria-expanded","false")},r.SlideOutAnimDuration=250,r.MinimumTaskBarWidth=62,r.MaximumTaskBarWidth=76,r}(),ht=function(n){function i(i,r,f,e,o,s,h,c,l,a){var v=this,y={},w,p;return v=n.call(this,y)||this,y.defineProperty("title"),y.defineProperty("signInTitle"),y.defineProperty("messageLines"),y.defineProperty("isFaded"),y.defineProperty("isHidden"),y.defineProperty("showClose"),y.defineProperty("showBeak"),y.defineProperty("isDark"),y.defineProperty("preLink"),y.defineProperty("link"),y.defineProperty("postLink"),y.defineProperty("linkUrl"),y.defineProperty("customCssOverride"),h?f&&f.length&&(v._linkMessage=f[0],v._parseLinkMessage(),v.setLinkUrl("#")):v.setMessageLines(f),v.setTitle(r),v.setShowClose(!0),v.setShowBeak(!1),v.setIsDark(s),v.setCustomCssOverride(a),v.resources=t,v.tipRemoved=new u,v.signedIn=new u,v.messageLinkClicked=new u,v.tipHovered=new u,v._map=i,v._autoFadeHandlers=[],w=v._createTemplate(c),v.setTemplate(w),v._tipElement=v.getRootElement(),p=function(){v._fadeTimeout&&window.clearTimeout(v._fadeTimeout);v._tipElement&&v.removeTip()},e||(v._map&&(v._autoFadeHandlers.push(v._map.mapPanStarted.addOne(p)),v._autoFadeHandlers.push(v._map.mapTapped.addOne(p)),v._autoFadeHandlers.push(v._map.mapZoomStarted.addOne(p))),v._fadeTimeout=Microsoft.Maps.setTimeout(function(){v._tipElement&&v.fadeTip()},l?l:4e3)),o&&(v._windowClickEventHandler=function(n){if(v&&v.rendered){var i=n.target,t=v.getRootElement();t&&t.has(i)||Microsoft.Maps.setTimeout(function(){v.removeTip()},1)}},Microsoft.Maps.setTimeout(function(){window.addEventListener("click",v._windowClickEventHandler)},1)),v}return y(i,n),i.prototype.fadeTip=function(){var n=this;this.setIsFaded(!0);Microsoft.Maps.setTimeout(function(){n.removeTip()},1e3)},i.prototype.removeTip=function(){this._tipElement&&this._tipElement.removeFromParent();this._tipElement=null;this.tipRemoved&&this.tipRemoved.invoke();this.dispose()},i.prototype.dispose=function(){window.removeEventListener("click",this._windowClickEventHandler);h._clearDisposables(this._autoFadeHandlers);n.prototype.dispose.call(this)},i.prototype._createTemplate=function(n){var t=this;return new rt(n||dr,{boolToDisplay:function(n){return t._boolToDisplay(n)},boolToNotDisplay:function(n){return t._boolToDisplay(!n)},boolToFadedClass:function(n){return t._boolToFadedClass(n)},nullToDisplayNone:function(n){return t._nullToDisplayNone(n)},closeClicked:function(n){n.preventDefault();t.removeTip()},onSignedIn:function(){t.signedIn&&t.signedIn.invoke();t.removeTip()},onTipHoverOver:function(n){n&&n.stopPropagation();n&&n.preventDefault();t.tipHovered&&t.tipHovered.invoke()},onTipHoverOut:function(n){n&&n.stopPropagation();n&&n.preventDefault()},onLinkClicked:function(n){n&&n.stopPropagation();t.getLinkUrl()==="#"&&n&&n.preventDefault();t.messageLinkClicked&&t.messageLinkClicked.invoke();t.removeTip()}})},i.prototype._boolToDisplay=function(n){return n?"":"none"},i.prototype._boolToFadedClass=function(n){var t=this.getCustomCssOverride();return"bm_tooltips"+(this.getIsDark()?" dark":"")+(n?" reminderHiddenFade":"")+(t?" "+t:"")},i.prototype._nullToDisplayNone=function(n){return n?"":"none"},i.prototype._parseLinkMessage=function(){var n=this._linkMessage,t,i,r;n&&(t=n.indexOf("<link>"),t!==-1?(i=n.slice(0,t),i&&this.setPreLink(i),n=n.substr(t).replace("<link>",""),t=n.indexOf("<\/link>"),r=n.slice(0,t),r&&this.setLink(r),n=n.substr(t).replace("<\/link>",""),n&&this.setPostLink(n)):this.setLink(n))},i}(ot),vu=function(n){function t(t,i){var r=n.call(this,null,null,[i],!0,!0,!1,!0,br)||this;return r._privates.defineProperty("iconText",null,null,{defaultValue:t}),r.setShowClose(!1),r.setShowBeak(!0),r}return y(t,n),t}(ht),yu=function(n){function i(i,r,u){var f=this,e=[t.L_Tooltip_Itinerary_Saved_Text];return f=n.call(this,i,"",e,!1,!0,!0)||this,f.separator=" "+String.fromCharCode(183)+" ",f._privates.defineProperty("name",null,null,{defaultValue:u}),f._privates.defineProperty("showEditName",null,null,{defaultValue:!1}),f._relatedTaskId=r,f.setShowClose(!1),f.setShowBeak(!0),f}return y(i,n),i.prototype._createTemplate=function(){var n=this;return new rt(kr,{boolToDisplay:function(t){return n._boolToDisplay(t)},boolToNotDisplay:function(t){return n._boolToDisplay(!t)},boolToFadedClass:function(t){return n._boolToFadedClass(t)},nullToDisplayNone:function(t){return n._nullToDisplayNone(t)},closeClicked:function(t){t.preventDefault();n.removeTip()},renameClicked:function(t){t.preventDefault();n._onRenameClick()},onKeyPressed:function(t){t.keyCode===13&&n._onSaveLinkClick()},onSaveLinkClick:function(t){t.preventDefault();n._onSaveLinkClick()}})},i.prototype._onRenameClick=function(){window.clearTimeout(this._fadeTimeout);h._clearDisposables(this._autoFadeHandlers);var n=this.getRootElement().select(".nameEditBox");n&&n.length&&(n[0].value=this.getName());this.setIsDark(!1);this.setShowEditName(!0);this.setShowClose(!0);window.removeEventListener("click",this._windowClickEventHandler)},i.prototype._onSaveLinkClick=function(){var n=this.getRootElement().select(".nameEditBox"),t=n&&n.length&&n[0].value,i,r;t&&(i={action:6,title:t},r={type:f.itineraryDetailsTask,requestState:i,taskId:this._relatedTaskId},s.invokeHandler(o.taskProcessDataHandlerKey,r));this.fadeTip()},i}(ht);i.TaskBar=au;r.SharingDialogViewModel=eu;r.PrintManager=dt;r.SlideOutMenu=typeof ai!="undefined"?ai:undefined;r.BirdsEyeV2DialogViewModel=typeof ci!="undefined"?ci:undefined;r.CommutabilityControl=gr;r.CommutabilityControlV2=tu;r.CommutabilityControlOverlay=nu;r.CommutabilityControlV2Overlay=iu;r.UserTipControl=ht;r.SaveSuccessTipControl=yu;r.SaveOnSerpConfirmationTip=vu}catch(yi){if(i.logger)i.logger.logCriticalError(yi);else throw yi;}}).call(window)