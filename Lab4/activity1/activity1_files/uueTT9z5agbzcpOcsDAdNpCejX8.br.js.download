(function(){var p;try{(function(){var n={L_Collections_NotFound_Text:"The original result is no longer available:",L_Collections_TryAgain_Text:"Try searching and saving again.",L_FilterName_AlongARoute:"Along a route",L_FilterName_QueryRep_FilterBy_AllPrices:"All Prices",L_FilterName_QueryRep_FilterBy_AllRatings:"All Ratings",L_FiltersBar_Rating_OptionSuffix:"& up",L_LocalSearch_BackToCollections:"Favorites group",L_LocalSearch_BackToSearchResults:"Search results",L_LocalSearch_ReturnToList:"return to list",L_SearchAlongRouteNoneOptionText:"None",L_SearchNearbyGhostTextFormat:"Search near {query}",L_SearchNearbyTerm_1:"Parking",L_SearchNearbyTerm_2:"Hotels",L_SearchNearbyTerm_3:"Restaurants",L_SearchNearbyTerm_4:"Coffee",L_NearbyMinute:"min",L_Menu_ReportProblem_Link_Text:"Report a Problem",L_LocalSearch_SearchAlongYourRouteTitle:"{0} along your route",L_SearchNearbyCategoryId_1:"90925",L_SearchNearbyCategoryId_2:"91572",L_SearchNearbyCategoryId_3:"90287",L_SearchNearbyCategoryId_4:"91649",L_SearchNearbyCategoryId_5:"90089",L_SearchNearbyCategoryId_6:"90738",L_SearchNearbyCategoryId_7:"250",L_SearchNearbyTerm_5:"Gas stations",L_SearchNearbyTerm_6:"Grocery stores",L_SearchNearbyTerm_7:"Nearby Transit",L_NearbyFloatingContainerNearbyTitle:"Nearby",L_NearbyFloatingContainerDrivingTitle:"Driving",L_NearbyFloatingContainerTransitTitle:"Transit",L_NearbyFloatingContainerWalkingTitle:"Walking",Nearby_Search_Area:"Search this area",L_FiltersBar_UserRating_SelectionLabel:"Rating: {0} stars & up",L_Menu_SuggestAnEdit_Link_Text:"Suggest an edit",L_FiltersBar_UserRating_SelectionLabel_HighestRating:"Rating: {0} stars",L_FilterName_QueryRep_FilterBy_AllCuisines:"All Cuisines",L_PrintEntityAddress_Text:"Address:",L_PrintEntityPhone_Text:"Phone:",L_PrintEntityTitle_Text:"Title:",L_PrintNotes_Watermark:"Type your notes here.",L_PrintEntityWebsite_Text:"Website:",L_PrintCurrency_Text:"$",L_PrintExtendedArea_Text:"Area:",L_PrintExtendedAt_Text:"Located At:",L_PrintExtendedAvgRate_Text:"Average Rate:",L_PrintExtendedCapitol_Text:"Capital:",L_PrintExtendedCC_Text:"Calling Code:",L_PrintExtendedCounty_Text:"County Seat:",L_PrintExtendedCuisine_Text:"Cuisine:",L_PrintExtendedFounded_Text:"Founded:",L_PrintExtendedGDP_Text:"GDP:",L_PrintExtendedHotelClass_Text:"Hotel Class:",L_PrintExtendedLatLong_Text:"Location:",L_PrintExtendedPopulation_Text:"Population:",L_PrintExtendedPrice_Text:"Price:",L_PrintExtendedTravelTip_Text:"Travel Tip:",L_WikipediaTitle_Text:"Wikipedia",L_HoursLabel_Text:"Hours",L_ReportMissingBusiness_Text:"Add a Missing Business",Overlay_NewErrorLink_Separator:"{0} or {1}",L_AddMissingBusinessCardTitle:"Add missing business",L_AddMissingBusinessMessage:"Did not find what you are looking for?",L_PrintClinicTitle_Text:"Clinic:",L_PrintHomeFactsTitle_Text:"Home Facts",L_PrintLastSoldTitle_Text:"Last Sold:",L_PrintMoreInfoTitle_Text:"More Info",L_PrintSpecialtyTitle_Text:"Specialty:",L_PrintZestimateTitle_Text:"ZEstimate ",L_PrintExperienceTitle_Text:"Years of experience:",L_FilterName_QueryRep_FilterBy_Price:"Price",L_FilterName_QueryRep_FilterBy_Rating:"Rating",L_FilterName_QueryRep_FilterBy_Cuisine:"Cuisine",L_FilterName_QueryRep_FilterBy_OpenTime:"Open time",L_FilterName_QueryRep_FilterBy_Amenities:"Amenities",L_FilterName_QueryRep_SortBy:"Sort by",L_AddNickNameOption:"Add a nickname",L_AddNoteOption:"Add a description",L_EditNickNameOption:"Edit nickname",L_EditNoteOption:"Edit description",L_DeleteNickNameOption:"Delete nickname",L_DeleteNoteOption:"Delete description",L_AddButton:"Add",L_EditButton:"Save",L_AnnotateToolTip:"Add a nickname or description",L_ReservationTitle:"Your Reservation",L_FlightTitle:"Your Flight",L_EventInfoMessage:"This event was inferred from your Outlook email account or calendar.",L_CheckInText:"Check-in",L_CheckOutText:"Check-out",L_SeeEmailLinkText:"See email for this reservation",L_SeeEmailFlightLinkText:"See email for this flight",L_DepartureText:"Departs ",L_ArrivalText:"Arrives at ",L_AirportFormat:"{0} ({1})",L_AirlineFormat:"{0} Confirmation #{1}",L_SeeMoreFlightsText:"See your other flights",L_VenueMapTaskTitle_Suffix:"Directory - ",L_VenueMapTask_NoEntity_Message:"Detailed directory of this level coming soon",L_VenueMapTask_NoCategory_Message:"No business of selected category on this level",L_RichAttributeFeedbackTitle:"Tell Bing about this business",L_PrintTrailInfo_Text:"Trail Data:",L_PrintSeason_Text:"Season:",L_PrintDifficulty_Text:"Difficulty:",L_PrintActivities_Text:"Activities:",L_PrintSeparator_Text:" · ",L_PrintAnnualVisitors_Text:"Annual Visitors:",L_PrintArchitects_Text:"Architect(s):",L_PrintArchitectureFirm_Text:"Architecture Firm:",L_PrintArtists_Text:"Artists:",L_PrintAverageStay_Text:"Average Stay:",L_PrintCapacity_Text:"Capacity:",L_PrintDateCompleted_Text:"Date Completed:",L_PrintEstablished_Text:"Established:",L_PrintFloors_Text:"Floors:",L_PrintHeight_Text:"Height:",L_PrintInterests_Text:"Interests:",L_PrintMainSites_Text:"Main Sites: ",L_PrintMedia_Text:"Media:",L_PrintOpened_Text:"Opened:",L_PrintOpen_Text:"Open:",L_PrintRates_Text:"Rates:",L_PrintServiceAreas_Text:"Service Areas:",L_PrintSites_Text:"Sites:",L_PrintSubjects_Text:"Subjects:",L_PrintTeams_Text:"Team(s):",L_PrintElevation_Text:"Elevation:",L_PrintFirstAscender_Text:"First ascender:",L_PrintFirstAscent_Text:"First ascent:",L_PrintLastEruption_Text:"Last eruption:",L_PrintMountainRange_Text:"Mountain range:",L_PrintProminence_Text:"Prominence:",L_PrintCollegesUniversities_Text:"Colleges and universities:",L_PrintNearbyAirport_Text:"Nearby Airport(s):",L_AddToItinerary:"Add to Itinerary",L_SaveTooltip:"Save",L_ShareTooltip:"Share",L_EllipsisTooltip:"More",L_TimeDriveHome_Text:"{0} drive from home",L_TimeDriveWork_Text:"{0} drive from work",L_TimeWalkHome_Text:"{0} walk from home",L_TimeWalkWork_Text:"{0} walk from work",L_TimeDurationLessThan_Text:"< {0} min",AnnotationCloseText:"Close",PaginationNextLabelText:"Next Page",PaginationPreviousLabelText:"Previous Page",PaginationMoreLabelText:"See more",InfoboxListAriaLabel:"Click for more details",L_Deal_Text:"DEAL",HotelsFound:"Found ",HotelsNear:" hotels near ",HotelPricesHere:"Hotel prices here are ",HotelCityAverage:" than city average",HotelPricesCheaper:" cheaper ",HotelPricesExpensive:" more expensive ",HotelPricesWithin:"within",HotelWithinCityAverage:" city average",HotelDistanceFromCityCenter:" miles away from city center",HotelThisLocation:"This location is ",HotelNear:"near",HotelCityCenter:" city center",HotelAreaSafety:"Area safety here is ",HotelSafetyExcellent:"Excellent",HotelSafetyGood:"Good",HotelSafetyNeutral:"Neutral",MetadataLine:"{0} · {1}",CoffeeMetadataLine:"Coffee · {0}",L_Menu_Print_Link_Text:"Print"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("LocalSearch",n):window.$MicrosoftMaps8.ResourcesObject=n})();var o=window.$MicrosoftMaps8,a=o.Local=o.Local||{},v=o.Internal=o.Internal||{},kt=v.TaskData=v.TaskData||{},vi=o.Directions=o.Directions||{},nt=v.AdsScenario,ce=o.ButtonGroupViewModel,yi=v._BaseMapTemplateSelector,h=v.BaseTask,yt=v.BaseTaskViewModel,le=o.BirdseyeV2Metadata,ae=o.BitmapImageTemplate,wu=o.GlobalConfig.features.calendar,bu=o.CalendarSync,ve=v.CanvasDrawingContext,pt=kt.CollectionActions,ye=o.GlobalConfig.features.collections,pe=o.CommonControls.CollectionsListDropdownViewModel,dt=v.ControlTemplate,f=o.DataHandlerKeys,nr=v._Debug,ku=vi.DefaultDirectionsFormattedTextProvider,we=o.DetailsTaskPoiManager,tr=o.GlobalConfig.features.directions,ir=o.Directions.DirectionsInputData,be=o.CommonControls.DirectionsListDropdownViewModel,d=kt.DirectionsMode,rr=kt.DistanceUnit,u=v._EntryPoints,st=v._FeatureNames,it=o.GlobalConfig.features.feedback,du=o.FiltersBarModuleViewModel,ke=o.FiltersBarViewModel,de=o.FiltersStatusBarViewModel,gu=o.FiltersBar,gt=o.FiltersBarItem,ct=o.FiltersBarItemData,t=v._Gimme,c=o.GlobalConfig,e=o.GlobalDataEventHandler,lt=o.Heading,i=v._Helper,ur=o.HomeOrWorkEnabledLocalSearchEntity,ge=typeof o.Infobox!="undefined"?o.Infobox:undefined,g=v._JSEvent,no=v._LatLonCrs,fr=c.features.layerManager,nf=o.CommonControls.ListDropdownViewModel,n=c.features.localSearch,ii=o.LocalSearchEntity,to=v._LocalStorageCache,er=o.LocationRect,ft=v.MapHelper,io=v.MapInteractionBehavior,b=o.Location,or=o.MapMath,sr=o.MapTypeId,hr=o.MapView,tf=o.MapViewAnimator,ro=o.MicroPoiManager,rf=o.CommonControls.ModalDialogViewModel,et=v._Network,ni=v._ObservableObject,uo=v._ObservableObjectChangedArgs,ri=v._ObservableCollection,fo=v._OverlayEntity,uf=o.CommonControls.PopOutButtonViewModel,eo=o.CommonControls.PopOutMessageViewModel,oo=o.CommonControls.CollectionPopOutMessageViewModel,so=c.features.parking,cr=o.GlobalConfig.features.print,lr=v.PrintContent,ar=v.PrintManager,w=v._PerfV2Logger,vr=kt.RecommendationEntity,r=o.ResourceManager.LocalSearch,ff=o.ResultsTaskPoiManager,ef=vi.RouteErrorType,of=vi.RouteResultsDataModel,ui=o.SignInState,pi=o.SimplePointPrimitive,sf=v._StreetsidePerfConstants,wt=o.CommonControls.SyndicatedAds,at=o.CommonControls.ServerSideAds,fi=o.CommonControls.TnAAds,ho=o.TaskBar,co=o.TaskMapInteractionBehavior,ei=v._TaskDataHandlerHelper,ot=c.features.taskFramework,s=o.TaskTypes,lo=o.VectorImageTemplate,ao=o.VectorMapLayer,vo=v.TipComponents,bt=kt.Waypoint,yo=o.CommonControls.SelectionListDropdownViewModel,yr=o.GlobalConfig.features.streetside,ti=o.GlobalConfig.features.travel,oi=o.ZoomLevel,po=v.TransientLensActions,wo=o.PolygonListingTaskPoiManager,hf='<div class="bm_annotationRoot" data-tag="annotationRoot">    <div class="auxillaryButtons">        <a class="annotateButton" data-tag="annotateButton" role="button" aria-expanded="false" event:click="onAnnotateClick" href="#" title="{Binding resources.L_AnnotateToolTip}" aria-expanded="false"><\/a>    <\/div>    <div class="nameContainer">        <TextBlock Text="{Binding CurrentName}" />    <\/div>    <div class="annotateDropdown popOutTop" style:display="{Binding ShowDropdown Converter=boolToDisplay}">        <a class="annotateEntry bm_dropdownEntry" data-tag="annotateEntry" role="button" aria-label="{Binding CurrentName Converter=displayNameChangeMessage}" event:click="onAddNicknameClick" style:display="{Binding IsHomeWork Converter=boolToNotDisplay}" href="#">            <span class="annotateButton annotateIcon"><\/span>            <TextBlock Text="{Binding CurrentName Converter=displayNameChangeMessage}" />        <\/a>        <a class="annotateEntry bm_dropdownEntry" data-tag="annotateEntry" role="button" aria-label="{Binding Description Converter=displayNoteChangeMessage}" event:click="onAddDescriptionClick" href="#">            <span class="annotateButton annotateIcon"><\/span>            <TextBlock Text="{Binding Description Converter=displayNoteChangeMessage}" />        <\/a>        <a class="annotateEntry bm_dropdownEntry" data-tag="annotateEntry" role="button" aria-label="{Binding resources.L_DeleteNickNameOption}" event:click="onDeleteNicknameClick" style:display="{Binding CurrentName Converter=displayDeleteNickName}" href="#">            <span class="deleteButton annotateIcon"><\/span>            <TextBlock Text="{Binding resources.L_DeleteNickNameOption}" />        <\/a>        <a class="annotateEntry bm_dropdownEntry" data-tag="annotateEntry" role="button" aria-label="{Binding resources.L_DeleteNoteOption}" event:click="onDeleteDescriptionClick" style:display="{Binding Description Converter=boolToDisplay}" href="#">            <span class="deleteButton annotateIcon"><\/span>            <TextBlock Text="{Binding resources.L_DeleteNoteOption}" />        <\/a>    <\/div>    <div class="annotatePopOut popOutTop nickNamePopOut" style:display="{Binding ShowNickNameEdit Converter=boolToDisplay}">        <a class="deleteButton annotateClose" data-tag="annotateClose" event:click="onCloseClick" href="#" role="button" aria-label="{Binding resources.AnnotationCloseText}" title="{Binding resources.AnnotationCloseText}"><\/a>        <div id="addNameLabel">            <TextBlock text="{Binding CurrentName Converter=displayNameChangeMessage}" />        <\/div>        <div class="nameInputContainer">            <input type="text" class="nameEditBox" data-tag="nameEditBox" maxlength="100" value="{Binding TempAnnotation Mode=TwoWay}" event:keydown="onKeyPressName" aria-labelledby="addNameLabel"/>            <a href="#" class="annotationAddButton" role="button" data-tag="annotationAddButton" event:click="onSaveNickNameClick">                <TextBlock Text="{Binding CurrentName Converter=showAddEditNameButton}" />            <\/a>        <\/div>    <\/div>    <div class="annotatePopOut popOutTop descriptionPopOut" style:display="{Binding ShowDescriptionEdit Converter=boolToDisplay}">        <a class="deleteButton annotateClose" role="button" data-tag="annotateClose" event:click="onCloseClick" href="#" aria-label="{Binding resources.AnnotationCloseText}" title="{Binding resources.AnnotationCloseText}"><\/a>        <div id="addDescriptionLabel">            <TextBlock text="{Binding Description Converter=displayNoteChangeMessage}" />        <\/div>        <div class="descriptionInputContainer">            <textarea class="descriptionEditBox" data-tag="descriptionEditBox" contenteditable="true" rows="4" maxlength="1000" value="{Binding TempAnnotation Mode=TwoWay}" event:keydown="onKeyPressNote" aria-labelledby="addDescriptionLabel"><\/textarea>            <a href="#" class="annotationAddButton" role="button" data-tag="annotationAddButton" event:click="onSaveDescriptionClick">                <TextBlock Text="{Binding Description Converter=showAddEditNoteButton}" />            <\/a>        <\/div>    <\/div>    <div class="descriptionContainer" style:display="{Binding Description Converter=boolToDisplay}">        <TextBlock Text="{Binding Description}" />    <\/div>    <div class="originalNameContainer" style:display="{Binding CurrentName Converter=displayIfDifferentName}">        <TextBlock Text="{Binding OriginalName}" />    <\/div><\/div>',cf='<ul>    <ItemsControl ItemsSource="{Binding geochainSegments}">        <ItemsControl.ItemTemplate>            <DataTemplate>                <li><TextBlock Text="{Binding displayName}" /><\/li>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl><\/ul>',wi='<div class="localEntitiesPrintText" data-tag="localEntitiesPrintText">    <div class="localEnititiesList" data-tag="localEntitiesList">        <ItemsControl ItemsSource="{Binding printEntities}" panelTagName="ul">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <li>                        <div class="printEntity" data-tag="detailPrintEntity">                            <div class="printEntityTitle" style:display="{Binding Title Converter=nullToDisplayNone}">                                <div class="localSearchPrintTitle" data-tag="localDetailsPrintTitle">                                    <TextBlock Text="{Binding Title}" />                                <\/div>                            <\/div>                            <div class="printEntityTitle" style:display="{Binding originalName Converter=nullToDisplayNone}">                                <div class="localSearchPrintHeader" data-tag="localDetailsPrintOriginalName">                                    <TextBlock Text="{Binding originalName}" />                                <\/div>                            <\/div>                            <div class="isText showText printEntityAddress" style:display="{Binding Address Converter=hideIfMatchedData}">                                <div class="localPrintLabel">                                    <TextBlock Text="{Binding resources.L_PrintEntityAddress_Text}" />                                <\/div>                                <div class="localSearchPrintHeader" data-tag="localDetailsPrintAddress">                                    <TextBlock Text="{Binding Address}" />                                <\/div>                            <\/div>                            <div class="isText showText printEntityPhone" style:display="{Binding Phone Converter=nullToDisplayNone}">                                <div class="localPrintLabel">                                    <TextBlock Text="{Binding resources.L_PrintEntityPhone_Text}" />                                <\/div>                                <div class="localSearchPrintHeader" data-tag="localDetailsPrintPhone">                                    <TextBlock Text="{Binding Phone}" />                                <\/div>                            <\/div>                            <div class="isText showText printEntityWebsite" style:display="{Binding Website Converter=nullToDisplayNone}">                                <div class="localPrintLabel">                                    <TextBlock Text="{Binding resources.L_PrintEntityWebsite_Text}" />                                <\/div>                                <div class="localSearchPrintHeader" data-tag="localDetailsPrintWebsite">                                    <TextBlock Text="{Binding Website}" />                                <\/div>                            <\/div>                        <\/div>                    <\/li>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>    <\/div>    <div class="isText showText dataPrintFacts">        <div class="localPrintFactsList" data-tag="localPrintFactsList">            <ItemsControl ItemsSource="{Binding printFacts}" panelTagName="ul">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <li>                            <div class="printFact">                                                                <div style:display="{Binding factLabel Converter=nullToDisplayNone}">                                    <div class="localPrintFactLabel">                                        <TextBlock Text="{Binding factLabel}" />                                    <\/div>                                    <div class="localSearchPrintHeader" data-tag="localDetailsPrintDataFact">                                        <div style:display="{Binding factData Converter=nullToDisplayNone}">                                            <TextBlock Text="{Binding factData}" />                                        <\/div>                                        <div style:display="{Binding extendedFacts.type Converter=displayOnTrails}">                                            <div style:display="{Binding extendedFacts.type Converter=nullToDisplayNone}">                                                <span style:display="{Binding extendedFacts.lengthIcon Converter=nullToDisplayNone}">                                                    <img src="{Binding extendedFacts.lengthIcon}" class="richPrintIcons" />                                                    <TextBlock Text="{Binding extendedFacts.length}" />                                                <\/span>                                                <span style:display="{Binding extendedFacts.elevationIcon Converter=nullToDisplayNone}">                                                    <span class="separator" style:display="{Binding extendedFacts.lengthIcon Converter=nullToDisplayNone}">                                                        <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                    <\/span>                                                    <img src="{Binding extendedFacts.elevationIcon}" class="richPrintIcons" />                                                    <TextBlock Text="{Binding extendedFacts.elevation}" />                                                <\/span>                                                <span style:display="{Binding extendedFacts.durationIcon Converter=nullToDisplayNone}">                                                    <span class="separator" style:display="{Binding extendedFacts.elevationIcon Converter=nullToDisplayNone}">                                                        <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                    <\/span>                                                    <img src="{Binding extendedFacts.durationIcon}" class="richPrintIcons" />                                                    <TextBlock Text="{Binding extendedFacts.duration}" />                                                <\/span>                                            <\/div>                                        <\/div>                                        <div style:display="{Binding extendedFacts.type Converter=displayOnCampgrounds}">                                            <span style:display="{Binding extendedFacts.rvIcon Converter=nullToDisplayNone}">                                                <img src="{Binding extendedFacts.rvIcon}" class="richPrintIcons" />                                                <TextBlock Text="{Binding extendedFacts.rvSites}" />                                            <\/span>                                            <span style:display="{Binding extendedFacts.tentIcon Converter=nullToDisplayNone}">                                                <span class="separator" style:display="{Binding extendedFacts.rvIcon Converter=nullToDisplayNone}">                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                <\/span>                                                <img src="{Binding extendedFacts.tentIcon}" class="richPrintIcons" />                                                <TextBlock Text="{Binding extendedFacts.tentSites}" />                                            <\/span>                                        <\/div>                                    <\/div>                                <\/div>                                                                <div style:display="{Binding extendedFacts.type Converter=displayOnTrails}">                                    <div style:display="{Binding extendedFacts.type Converter=nullToDisplayNone}">                                        <div class="localPrintFactLabel trailDifficulty">                                            <TextBlock Text="{Binding resources.L_PrintDifficulty_Text}" />                                        <\/div>                                        <span class="{Binding extendedFacts.difficulty}">                                            <TextBlock Text="{Binding extendedFacts.difficulty}" />                                        <\/span>                                    <\/div>                                <\/div>                            <\/div>                        <\/li>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>    <\/div>    <div class="isText showText">        <div class="printHours" data-tag="detailPrintHours" style:display="{Binding listHours Converter=emptyToDisplayNone}">            <div class="localPrintLabel">                <TextBlock Text="{Binding resources.L_HoursLabel_Text}" />            <\/div>            <table>                <ItemsControl ItemsSource="{Binding listHours}" panelTagName="tbody">                    <ItemsControl.ItemTemplate>                        <DataTemplate>                            <tr data-tag="hourListing">                                <td class="dayOfTheWeek" data-tag="dayOfTheWeek"><TextBlock Text="{Binding day}" /><\/td>                                <td class="hoursOfTheDay" data-tag="hoursOfTheDay">                                    <ItemsControl ItemsSource="{Binding hourRanges}">                                        <ItemsControl.ItemTemplate>                                            <DataTemplate>                                                <div class="todaysHours" data-tag="todaysHours">                                                    <TextBlock Text="{Binding start}" />                                                    <TextBlock Text=" - " />                                                    <TextBlock Text="{Binding end}" />                                                <\/div>                                            <\/DataTemplate>                                        <\/ItemsControl.ItemTemplate>                                    <\/ItemsControl>                                <\/td>                            <\/tr>                        <\/DataTemplate>                    <\/ItemsControl.ItemTemplate>                <\/ItemsControl>            <\/table>        <\/div>    <\/div><\/div>',lf='<div class="isText showText localListingListPrintText" data-tag="localListingListPrintText">    <div class="entitiesCol1" data-tag="entitiesCol1">        <div class="localEnititiesList" data-tag="localEntitiesList">            <ItemsControl ItemsSource="{Binding printEntities}" panelTagName="ul">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <li>                            <div class="printEntity" data-tag="listingPrintEntity">                                                                <div class="titleHead">                                    <div class="entityIcon">                                        <img class="printIcon" src="{Binding colorIndex Converter=chooseIconSource}" alt="{Binding iconText}"/>                                        <span class="entityIndex" data-tag="entityIndex">                                            <TextBlock Text="{Binding iconText}" />                                        <\/span>                                    <\/div>                                    <div class="localEntityPrintTitle" data-tag="localEntityPrintTitle" style:display="{Binding Title Converter=nullToDisplayNone}">                                        <TextBlock Text="{Binding Title}" />                                    <\/div>                                <\/div>                                <div class="supplementalData">                                    <div class="schoolFact" style:display="{Binding schoolInfo Converter=nullToDisplayNone">                                        <TextBlock Text="{Binding schoolInfo}" />                                    <\/div>                                    <div class="printEntityAddress" style:display="{Binding printEntity Converter=hideMatchedData}">                                        <div class="localPrintLabel">                                            <TextBlock Text="{Binding resources.L_PrintEntityAddress_Text}" />                                        <\/div>                                        <div class="localSearchPrintHeader" data-tag="localDetailsPrintAddress">                                            <TextBlock Text="{Binding Address}" />                                        <\/div>                                    <\/div>                                    <div class="printEntityPhone" style:display="{Binding Phone Converter=nullToDisplayNone}">                                        <div class="localPrintLabel">                                            <TextBlock Text="{Binding resources.L_PrintEntityPhone_Text}" />                                        <\/div>                                        <div class="localSearchPrintHeader" data-tag="localDetailsPrintPhone">                                            <TextBlock Text="{Binding Phone}" />                                        <\/div>                                    <\/div>                                    <div class="printEntityWebsite" style:display="{Binding Website Converter=nullToDisplayNone}">                                        <div class="localPrintLabel">                                            <TextBlock Text="{Binding resources.L_PrintEntityWebsite_Text}" />                                        <\/div>                                        <div class="localSearchPrintHeader listingWebsite" data-tag="localDetailsPrintWebsite">                                            <TextBlock Text="{Binding Website}" />                                        <\/div>                                    <\/div>                                    <div class="isText showText dataPrintFacts">                                        <div class="localPrintFactsList" data-tag="localPrintFactsList">                                            <ItemsControl ItemsSource="{Binding printFacts}" panelTagName="ul">                                                <ItemsControl.ItemTemplate>                                                    <DataTemplate>                                                        <li>                                                            <div class="printFact">                                                                <div style:display="{Binding factLabel Converter=nullToDisplayNone}">                                                                    <div class="localPrintFactLabel">                                                                        <TextBlock Text="{Binding factLabel}" />                                                                    <\/div>                                                                    <div class="localSearchPrintHeader" data-tag="localDetailsPrintDataFact">                                                                        <div style:display="{Binding extendedFacts.type Converter=notNullToDisplayNone}">                                                                            <TextBlock Text="{Binding factData}" />                                                                        <\/div>                                                                        <div style:display="{Binding extendedFacts.type Converter=displayOnTrails}">                                                                            <span style:display="{Binding extendedFacts.lengthIcon Converter=nullToDisplayNone}">                                                                                <img src="{Binding extendedFacts.lengthIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.length}" />                                                                            <\/span>                                                                            <span style:display="{Binding extendedFacts.elevationIcon Converter=nullToDisplayNone}">                                                                                <span class="separator" style:display="{Binding extendedFacts.lengthIcon Converter=nullToDisplayNone}">                                                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                                                <\/span>                                                                                <img src="{Binding extendedFacts.elevationIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.elevation}" />                                                                            <\/span>                                                                            <span style:display="{Binding extendedFacts.durationIcon Converter=nullToDisplayNone}">                                                                                <span class="separator" style:display="{Binding extendedFacts.elevationIcon Converter=nullToDisplayNone}">                                                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                                                <\/span>                                                                                <img src="{Binding extendedFacts.durationIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.duration}" />                                                                            <\/span>                                                                        <\/div>                                                                        <div style:display="{Binding extendedFacts.type Converter=displayOnCampgrounds}">                                                                            <span style:display="{Binding extendedFacts.rvIcon Converter=nullToDisplayNone}">                                                                                <img src="{Binding extendedFacts.rvIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.rvSites}" />                                                                            <\/span>                                                                            <span style:display="{Binding extendedFacts.tentIcon Converter=nullToDisplayNone}">                                                                                <span class="separator" style:display="{Binding extendedFacts.rvIcon Converter=nullToDisplayNone}">                                                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                                                <\/span>                                                                                <img src="{Binding extendedFacts.tentIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.tentSites}" />                                                                            <\/span>                                                                                                                                                    <\/div>                                                                    <\/div>                                                                <\/div>                                                                <div style:display="{Binding extendedFacts.type Converter=displayOnTrails}">                                                                    <div style:display="{Binding extendedFacts.type Converter=nullToDisplayNone}">                                                                        <div class="localPrintFactLabel trailDifficulty">                                                                            <TextBlock Text="{Binding resources.L_PrintDifficulty_Text}" />                                                                        <\/div>                                                                        <span class="{Binding extendedFacts.difficulty}">                                                                            <TextBlock Text="{Binding extendedFacts.difficulty}" />                                                                        <\/span>                                                                    <\/div>                                                                <\/div>                                                            <\/div>                                                        <\/li>                                                    <\/DataTemplate>                                                <\/ItemsControl.ItemTemplate>                                            <\/ItemsControl>                                        <\/div>                                    <\/div>                                <\/div>                             <\/div>                        <\/li>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>           <\/div>    <div class="entitiesCol2" style:display="{Binding printEntitiesList2 Converter=nullToDisplayNone}" data-tag="entitiesCol2">        <div class="localEnititiesList" data-tag="localEntitiesList">            <ItemsControl ItemsSource="{Binding printEntitiesList2}" panelTagName="ul">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <li>                            <div class="printEntity" data-tag="listingPrintEntity">                                <div class="titleHead">                                    <div class="entityIcon">                                        <img class="printIcon" src="{Binding colorIndex Converter=chooseIconSource}" alt="{Binding iconText}"/>                                        <span class="entityIndex" data-tag="entityIndex">                                            <TextBlock Text="{Binding iconText}" />                                        <\/span>                                    <\/div>                                    <div class="localEntityPrintTitle" data-tag="localEntityPrintTitle" style:display="{Binding Title Converter=nullToDisplayNone}">                                        <TextBlock Text="{Binding Title}" />                                    <\/div>                                <\/div>                                <div class="supplementalData">                                    <div class="printEntityAddress" style:display="{Binding printEntity Converter=hideMatchedData}">                                        <div class="localPrintLabel">                                            <TextBlock Text="{Binding resources.L_PrintEntityAddress_Text}" />                                        <\/div>                                        <div class="localSearchPrintHeader" data-tag="localDetailsPrintAddress">                                            <TextBlock Text="{Binding Address}" />                                        <\/div>                                    <\/div>                                    <div class="printEntityPhone" style:display="{Binding Phone Converter=nullToDisplayNone}">                                        <div class="localPrintLabel">                                            <TextBlock Text="{Binding resources.L_PrintEntityPhone_Text}" />                                        <\/div>                                        <div class="localSearchPrintHeader" data-tag="localDetailsPrintPhone">                                            <TextBlock Text="{Binding Phone}" />                                        <\/div>                                    <\/div>                                    <div class="printEntityWebsite" style:display="{Binding Website Converter=nullToDisplayNone}">                                        <div class="localPrintLabel">                                            <TextBlock Text="{Binding resources.L_PrintEntityWebsite_Text}" />                                        <\/div>                                        <div class="localSearchPrintHeader listingWebsite" data-tag="localDetailsPrintWebsite">                                            <TextBlock Text="{Binding Website}" />                                        <\/div>                                    <\/div>                                    <div class="isText showText dataPrintFacts">                                        <div class="localPrintFactsList" data-tag="localPrintFactsList">                                            <ItemsControl ItemsSource="{Binding printFacts}" panelTagName="ul">                                                <ItemsControl.ItemTemplate>                                                    <DataTemplate>                                                        <li>                                                            <div class="printFact">                                                                <div style:display="{Binding factLabel Converter=nullToDisplayNone}">                                                                    <div class="localPrintFactLabel">                                                                        <TextBlock Text="{Binding factLabel}" />                                                                    <\/div>                                                                    <div class="localSearchPrintHeader" data-tag="localDetailsPrintDataFact">                                                                        <div style:display="{Binding extendedFacts.type Converter=notNullToDisplayNone}">                                                                            <TextBlock Text="{Binding factData}" />                                                                        <\/div>                                                                        <div style:display="{Binding extendedFacts.type Converter=displayOnTrails}">                                                                            <span style:display="{Binding extendedFacts.lengthIcon Converter=nullToDisplayNone}">                                                                                <img src="{Binding extendedFacts.lengthIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.length}" />                                                                            <\/span>                                                                            <span style:display="{Binding extendedFacts.elevationIcon Converter=nullToDisplayNone}">                                                                                <span class="separator" style:display="{Binding extendedFacts.lengthIcon Converter=nullToDisplayNone}">                                                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                                                <\/span>                                                                                <img src="{Binding extendedFacts.elevationIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.elevation}" />                                                                            <\/span>                                                                            <span style:display="{Binding extendedFacts.durationIcon Converter=nullToDisplayNone}">                                                                                <span class="separator" style:display="{Binding extendedFacts.elevationIcon Converter=nullToDisplayNone}">                                                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                                                <\/span>                                                                                <img src="{Binding extendedFacts.durationIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.duration}" />                                                                            <\/span>                                                                        <\/div>                                                                        <div style:display="{Binding extendedFacts.type Converter=displayOnCampgrounds}">                                                                            <span style:display="{Binding extendedFacts.rvIcon Converter=nullToDisplayNone}">                                                                                <img src="{Binding extendedFacts.rvIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.rvSites}" />                                                                            <\/span>                                                                            <span style:display="{Binding extendedFacts.tentIcon Converter=nullToDisplayNone}">                                                                                <span class="separator" style:display="{Binding extendedFacts.rvIcon Converter=nullToDisplayNone}">                                                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                                                <\/span>                                                                                <img src="{Binding extendedFacts.tentIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.tentSites}" />                                                                            <\/span>                                                                        <\/div>                                                                    <\/div>                                                                <\/div>                                                                <div style:display="{Binding extendedFacts.type Converter=displayOnTrails}">                                                                    <div style:display="{Binding extendedFacts.type Converter=nullToDisplayNone}">                                                                        <div class="localPrintFactLabel trailDifficulty">                                                                            <TextBlock Text="{Binding resources.L_PrintDifficulty_Text}" />                                                                        <\/div>                                                                        <span class="{Binding extendedFacts.difficulty}">                                                                            <TextBlock Text="{Binding extendedFacts.difficulty}" />                                                                        <\/span>                                                                    <\/div>                                                                <\/div>                                                            <\/div>                                                        <\/li>                                                    <\/DataTemplate>                                                <\/ItemsControl.ItemTemplate>                                            <\/ItemsControl>                                        <\/div>                                    <\/div>                                <\/div>                            <\/div>                        <\/li>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>                    <\/div><\/div>',af='<div class="LocalListingTitlePrint" data-tag="LocalListingTitlePrint">    <div class="printQuery">        <div class="localSearchPrintTitle" data-tag="localSearchPrintTitle">            <TextBlock Text="{Binding query}" />        <\/div>    <\/div><\/div>',pr='<div class="localSearchPrintPanel" data-tag="localSearchPrintPanel">    <div class="localSearchPrintText">        <div>            <table>                <tr>                    <td class="textColumn">                        <Tab TabContent="{Binding printTitleViewModel}" TabTemplate="{Binding titlePrintTemplate}" IsDisplayed="true"><\/Tab>                    <\/td>                    <td class="noteColumn">                        <div class="printNotes localPrintNotes" style:display="{Binding isDetails Converter=boolToDisplay}">                            <div class="searchNotesTableData screenNotes">                                <textarea class="searchNotes" contenteditable="true" aria-label="{Binding resources.L_PrintNotes_Watermark}" placeholder="{Binding resources.L_PrintNotes_Watermark}" maxlength="{Binding notesMaxCharSize}" data-tag="printNotes">                                    <TextBlock Text="{Binding PrintNotes}" />                                <\/textarea>                            <\/div>                            <div class="printedNotes">                            <\/div>                        <\/div>                    <\/td>                                    <\/tr>            <\/table>        <\/div>        <div>            <Tab TabContent="{Binding printListingsViewModel}" TabTemplate="{Binding listingsPrintTemplate}" IsDisplayed="true"><\/Tab>        <\/div>    <\/div>    <div class="localSearchMapPrint isMap showMap taskMapPrintPageBreak" data-tag="localSearchMapPrint">        <div class="printArea" data-tag="printArea">            <div class="printMap" data-tag="printMap">            <\/div>        <\/div>    <\/div>    <div class="detailsAttribution" style:display="{Binding isDetails Converter=boolToDisplay}">        <TextBlock Text="{Binding attributionText}"/>    <\/div><\/div>',vf='<div class="bm_report-missing-business-link-content">    <div class="feedbackCardLabel">        <TextBlock Text="{Binding resources.L_AddMissingBusinessMessage}" />    <\/div>    <div class="feedbackCardText">        <a href="#" class="reportProblemLink" role="button" event:click="addMissingEntityLinkClicked">            <TextBlock Text="{Binding resources.L_ReportMissingBusiness_Text}" />        <\/a>    <\/div><\/div>',yf='<div class="bm_svrpagination" style:display="{Binding showSeeMore Converter=boolToDisplay}">        <div class="om_wfr_sm">        <span class="om_wfr_smw">            <a href="#" class="om_wfr_smlk" aria-label="{Binding resources.PaginationMoreLabelText}" role="button" event:click="seeMoreClicked">                <span class="om_wfr_smtxt"><TextBlock Text="{Binding resources.PaginationMoreLabelText}" /><\/span>                <span class="om_wfr_arrow"><\/span>            <\/a>        <\/span>    <\/div><\/div>',pf='<div class="bm_svrpagination">        <div>        <a href="#" role="button" class="bm_leftChevron" aria-label="{Binding resources.PaginationPreviousLabelText}" event:click="leftChevronClicked" style:display="{Binding showLeftChevron Converter=boolToDisplay}"><\/a>    <\/div>    <div>        <a href="#" role="button" class="bm_rightChevron" aria-label="{Binding resources.PaginationNextLabelText}" event:click="rightChevronClicked" style:display="{Binding showRightChevron Converter=boolToDisplay}"><\/a>    <\/div>    <\/div>',wr='<div class="bm_sk_regularDetails">    <div class="skrd_mainImage"><\/div>    <div class="skrd_buttonWrapper">        <div class="skrd_buttons left"><\/div>        <div class="skrd_buttons right"><\/div>    <\/div>    <div class="skrd_line"><\/div>    <div class="skrd_line"><\/div>    <div class="skrd_shortLine"><\/div>    <div class="skrd_gap"><\/div>    <div class="bm_sk_SingleList">        <ul>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>        <\/ul>    <\/div><\/div>',wf='<div class="bm_sk_largeDetails">    <div class="skld_mainImage"><\/div>    <div class="skld_buttonWrapper">        <div class="skld_buttons"><\/div>        <div class="skld_buttons"><\/div>        <div class="skld_buttons"><\/div>    <\/div>    <div class="skld_line"><\/div>    <div class="skld_line"><\/div>    <div class="skld_shortLine"><\/div>    <div class="skrd_gap"><\/div>    <div class="bm_sk_SingleList">        <ul>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>            <li class="sk_singleListItem">                <div class="sk_itemSingleImage">                <\/div>                <div class="sk_itemLines">                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleLine"><\/div>                    <div class="sk_itemSingleShortLine"><\/div>                <\/div>            <\/li>        <\/ul>    <\/div><\/div>',si='<div class="bm_sk_SingleList">    <ul>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_singleListItem">            <div class="sk_itemSingleImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>                <div class="sk_itemSingleLine"><\/div>                <div class="sk_itemSingleShortLine"><\/div>            <\/div>        <\/li>    <\/ul>    <li class="sk_singleListItem">        <div class="sk_itemSingleImage">        <\/div>        <div class="sk_itemLines">            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>        <\/div>    <\/li>    <li class="sk_singleListItem">        <div class="sk_itemSingleImage">        <\/div>        <div class="sk_itemLines">            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>        <\/div>    <\/li>    <li class="sk_singleListItem">        <div class="sk_itemSingleImage">        <\/div>        <div class="sk_itemLines">            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>        <\/div>    <\/li>    <li class="sk_singleListItem">        <div class="sk_itemSingleImage">        <\/div>        <div class="sk_itemLines">            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>        <\/div>    <\/li>    <li class="sk_singleListItem">        <div class="sk_itemSingleImage">        <\/div>        <div class="sk_itemLines">            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>        <\/div>    <\/li>    <li class="sk_singleListItem">        <div class="sk_itemSingleImage">        <\/div>        <div class="sk_itemLines">            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>        <\/div>    <\/li>    <li class="sk_singleListItem">        <div class="sk_itemSingleImage">        <\/div>        <div class="sk_itemLines">            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>        <\/div>    <\/li>    <li class="sk_singleListItem">        <div class="sk_itemSingleImage">        <\/div>        <div class="sk_itemLines">            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>            <div class="sk_itemSingleLine"><\/div>            <div class="sk_itemSingleShortLine"><\/div>        <\/div>    <\/li><\/div>',bf='<div class="bm_nearbyMapContainer">    <div class="bm_nearbyMapSearchButton" aria-role="alert" aria-live="polite">        <div id="map-manual-refresh" class="ol_refreshpanel bm_nearbySearchArea" >            <span><TextBlock Text="{Binding resources.Nearby_Search_Area}" /><\/span>        <\/div>    <\/div>    <div class="b_nearbyFloatingContainer">        <span class="nearbyIcon"><\/span>        <div class="nearbyText" aria-label="{Binding titleText}">            <TextBlock Text="{Binding titleText}" />        <\/div>        <span class="nearbyModePic"><\/span>        <div class="nearbyDropdown" tabindex="-1" aria-label="{Binding drivingText}">            <TextBlock Text="{Binding drivingText}" />            <span class="nearbyDropdownIcon"><\/span>        <\/div>        <div class="nearbyDropdownList" >            <a class="nearbyDrivingOption" role="button" href="#">                <span class="b_nearbyFloatingContainerDrivingImg"><\/span>                <TextBlock Text="{Binding drivingText mode=TwoWay}" />            <\/a>            <a class="nearbyWalkingOption" role="button" href="#">                <span class="b_nearbyFloatingContainerWalkingImg"><\/span>                <TextBlock Text="{Binding walkingText mode=TwoWay}" />            <\/a>            <a class="nearbyTransitOption" role="button" href="#">                <span class="b_nearbyFloatingContainerTransitImg"><\/span>                <TextBlock Text="{Binding transitText mode=TwoWay}" />            <\/a>        <\/div>        <div class="nearbyClose">            <span class="nearbyCloseIcon"><\/span>        <\/div>    <\/div><\/div>',br='<div class="bm_sk_MultiList">    <ul>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>        <li class="sk_listItem">            <div class="sk_itemMultiImage">            <\/div>            <div class="sk_itemLines">                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>                <div class="sk_itemMultiLine"><\/div>                <div class="sk_itemMultiShortLine"><\/div>            <\/div>        <\/li>    <\/ul><\/div>',kf='<div class="bm_upcomingEventsRoot" data-tag="upcomingEvents">    <div class="infoIcon" event:mouseover="onInfoHovered" event:mouseout="onInfoExited"><\/div>    <div class="upcomingEventPopUp popOutTop" style:display="{Binding ShowPopUp Converter=boolToDisplay}">        <TextBlock Text="{Binding resources.L_EventInfoMessage}" />    <\/div>    <ItemsControl ItemsSource="{Binding Events}">        <ItemsControl.ItemTemplate>            <DataTemplate>                <div style:display="{Binding eventIndex Converter=initiallyHideOtherFlights}">                    <hr class="collectionSeparator flightSeparator" style:display="{Binding eventIndex Converter=displayAfterFirst}" />                    <div class="hotelEventDetails" style:display="{Binding type Converter=hotelToDisplay}">                        <h2>                            <TextBlock Text="{StaticBinding resources.L_ReservationTitle}" />                        <\/h2>                        <div class="checkInDetails">                            <div class="checkInTitle">                                <TextBlock Text="{StaticBinding resources.L_CheckInText}" />                            <\/div>                            <div class="checkInTime">                                <TextBlock Text="{Binding startDate Converter=getTimeString}" />                            <\/div>                        <\/div>                        <div class="checkOutDetails">                            <div class="checkOutTitle">                                <TextBlock Text="{StaticBinding resources.L_CheckOutText}" />                            <\/div>                            <div class="checkOutTime">                                <TextBlock Text="{Binding endDate Converter=getTimeString}" />                            <\/div>                        <\/div>                        <div class="seeEmailContainer" style:display="{Binding emailLink Converter=nullToDisplayNone}">                            <a class="seeEmailLink" href="{Binding emailLink}" target="_blank">                                <TextBlock Text="{StaticBinding resources.L_SeeEmailLinkText}" />                            <\/a>                        <\/div>                    <\/div>                    <div class="flightEventDetails" style:display="{Binding type Converter=flightToDisplay}">                        <h2 style:display="{Binding eventIndex Converter=hideAfterFirst}">                            <TextBlock Text="{StaticBinding resources.L_FlightTitle}" />                        <\/h2>                        <div class="airlineDetails">                            <TextBlock Text="{Binding $self$ Converter=getAirlineDetails}" />                        <\/div>                        <div class="departureDetails">                            <div class="departureAirport">                                <TextBlock Text="{StaticBinding resources.L_DepartureText}" />                                <a class="airportLink" data-task="{Binding departureAirport.entity Converter=buildEventDataTaskAttribute}" style:display="{Binding departureAirport.entity.businesslistingid Converter=hideIfEntity}" href="#">                                    <TextBlock Text="{Binding departureAirport.entity Converter=getAirportText}" />                                <\/a>                                <div class="airportText" style:display="{Binding departureAirport.entity.businesslistingid Converter=displayIfEntity}">                                    <TextBlock Text="{Binding departureAirport.entity Converter=getAirportText}" />                                <\/div>                            <\/div>                            <div class="departureTime">                                <TextBlock Text="{Binding startDate Converter=getTimeString}" />                            <\/div>                        <\/div>                        <div class="arrivalDetails">                            <div class="arrivalAirport">                                <TextBlock Text="{StaticBinding resources.L_ArrivalText}" />                                <a class="airportLink" data-task="{Binding arrivalAirport.entity Converter=buildEventDataTaskAttribute}" style:display="{Binding arrivalAirport.entity.businesslistingid  Converter=hideIfEntity}" href="#">                                    <TextBlock Text="{Binding arrivalAirport.entity Converter=getAirportText}" />                                <\/a>                                <div class="airportText" style:display="{Binding arrivalAirport.entity.businesslistingid Converter=displayIfEntity}">                                    <TextBlock Text="{Binding arrivalAirport.entity Converter=getAirportText}" />                                <\/div>                            <\/div>                            <div class="arrivalTime">                                <TextBlock Text="{Binding endDate Converter=getTimeString}" />                            <\/div>                        <\/div>                        <div class="seeEmailContainer" style:display="{Binding emailLink Converter=nullToDisplayNone}">                            <a class="seeEmailLink" href="{Binding emailLink}" target="_blank">                                <TextBlock Text="{StaticBinding resources.L_SeeEmailFlightLinkText}" />                            <\/a>                        <\/div>                    <\/div>                <\/div>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>    <div class="showMoreFlights" style:display="{Binding ShowOtherFlights Converter=showMoreFlightButton}">        <hr class="collectionSeparator flightSeparator" />        <a class="showMoreLink" event:click="onExpandClick" href="#">            <TextBlock Text="{StaticBinding resources.L_SeeMoreFlightsText}" />        <\/a>    <\/div><\/div>',kr='<div>    <div class="bm_filtersBarModule"><\/div>    <ItemsControl ItemsSource="{Binding entities}" PanelTagName="div" class="bm_venueDirectory">        <ItemsControl.ItemTemplate>            <DataTemplate>                <div class="bm_venueEntity" data-task="{Binding taskInfo}" event:click="onBusinessClick" event:mouseover="onBusinessMouseOver" event:mouseout="onBusinessMouseOut">                    <div class="bm_venueEntityWrapper">                        <div class="bm_entityDetails">                            <div class="bm_localName">                                <TextBlock Text="{Binding name}"><\/TextBlock>                            <\/div>                            <div class="bm_phoneNumber">                                <TextBlock Text="{Binding phoneNumber}"><\/TextBlock>                            <\/div>                            <div class="bm_floorName">                                <TextBlock Text="{Binding floorName}"><\/TextBlock>                            <\/div>                        <\/div>                    <\/div>                    <div class="bm_entityDivider"><\/div>                <\/div>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>    <div class="bm_noEntityMessage">    <\/div><\/div>',dr='<div>    <ItemsControl ItemsSource="{Binding entities}" PanelTagName="div" id="bm_venueDirectory">        <ItemsControl.ItemTemplate>            <DataTemplate>                <div class="card bm_venueEntity" data-task="{Binding taskInfo}" event:click="onBusinessClick" event:mouseover="onBusinessMouseOver" event:mouseout="onBusinessMouseOut">                    <div id="bm_venueEntityWrapper">                        <div class="textContainer" id="bm_entityDetails">                            <div class="title bm_localName">                                <TextBlock Text="{Binding name}"><\/TextBlock>                            <\/div>                            <div class="subtitle" id="bm_phoneNumber">                                <TextBlock Text="{Binding phoneNumber}"><\/TextBlock>                            <\/div>                            <div class="notes" id="bm_floorName">                                <TextBlock Text="{Binding floorName}"><\/TextBlock>                            <\/div>                        <\/div>                    <\/div>                    <div id="bm_entityDivider"><\/div>                <\/div>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>    <div class="bm_noEntityMessage">    <\/div><\/div>',y=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),gr=function(n){function o(t,i,u,f,e,o,s){s===void 0&&(s=null);var h=this,c={};return h=n.call(this,c)||this,c.defineProperty("currentName"),c.defineProperty("originalName"),c.defineProperty("description"),c.defineProperty("tempAnnotation"),c.defineProperty("isHomeWork"),c.defineProperty("showDropdown",function(n,t){return h._onShowPopOutChanged(n,t)}),c.defineProperty("showNickNameEdit",function(n,t){return h._onShowPopOutChanged(n,t)}),c.defineProperty("showDescriptionEdit",function(n,t){return h._onShowPopOutChanged(n,t)}),h.controlTemplateFactory=t,h._templateName=hf,h.disposables=[],h.annotationChanged=new g,h.setCurrentName(f),h.setIsHomeWork((f==="Home"||f==="Work")&&f!==e),h.setOriginalName(e?e:f),h.setDescription(o),h.setShowDropdown(!1),h.setShowNickNameEdit(!1),h.setTempAnnotation(""),h.resources=r,h._map=i,h._isAddress=u,h._impressionGuid=s,h._windowClickEventHandler=function(n){var t=h._control,i=t.select(".nickNamePopOut"),r=t.select(".descriptionPopOut");i&&i.has(n.target)||r&&r.has(n.target)||(h._hideDropdown(n),h._hideDescriptionPopOut(n),h._hideNickNamePopOut(n))},h._windowKeyupEventHandler=function(n){var r=n,i,t;if(r.keyCode===9){if(i=document.activeElement,t=i&&i.classList,i&&(t.contains("annotateEntry")||t.contains("nickNamePopOut")||t.contains("descriptionPopOut")||t.contains("nameEditBox")||t.contains("descriptionEditBox")||t.contains("annotationAddButton")||t.contains("annotateClose")))return;h._hideDropdown(n);h._hideDescriptionPopOut(n);h._hideNickNamePopOut(n)}},h}return y(o,n),o.prototype.boolToDisplay=function(n){return n?"":"none"},o.prototype.boolToNotDisplay=function(n){return n?"none":""},o.prototype.displayIfDifferentName=function(n){return n===this.getOriginalName()?"none":""},o.prototype.displayDeleteNickName=function(n){return n===this.getOriginalName()||this.getIsHomeWork()?"none":""},o.prototype.displayNameChangeMessage=function(n){return n===this.getOriginalName()?this.resources.L_AddNickNameOption:this.resources.L_EditNickNameOption},o.prototype.displayNoteChangeMessage=function(n){return n?this.resources.L_EditNoteOption:this.resources.L_AddNoteOption},o.prototype.showAddEditNameButton=function(n){return n===this.getOriginalName()?this.resources.L_AddButton:this.resources.L_EditButton},o.prototype.showAddEditNoteButton=function(n){return n?this.resources.L_EditButton:this.resources.L_AddButton},o.prototype.getControl=function(){if(!this._control){if(!this.controlTemplateFactory)throw new Error("control template factory must be defined.");var n=this.controlTemplateFactory({templateText:this._templateName,staticResources:this});this._control=n.applyDataTemplate(this);this.disposables.push(n)}return this._control},o.prototype.dispose=function(){for(var n=0;n<this.disposables.length;n++)this.disposables[n].dispose();this.disposables=[]},o.prototype.onAnnotateClick=function(n){this.setShowDropdown(!0);Microsoft.Maps.setTimeout(function(){var n=t(".bm_annotationRoot"),r=t(".annotateDropdown ",n[0]);i._setFocusOnFirstMenuItem(r)},100);this._logInstrumentation("Annotate");n.stopPropagation();n.preventDefault()},o.prototype.onAddNicknameClick=function(n){this.setShowDropdown(!1);this.getCurrentName()!==this.getOriginalName()&&this.setTempAnnotation(this.getCurrentName());this.setShowNickNameEdit(!0);var i=t(".nameEditBox",this._control[0]);i&&i.length&&i[0].focus();this._logInstrumentation("EditNickName");n&&(n.stopPropagation(),n.preventDefault())},o.prototype.onAddDescriptionClick=function(n){var r,i;this.setShowDropdown(!1);r=this.getDescription();r&&this.setTempAnnotation(r);this.setShowDescriptionEdit(!0);i=t(".descriptionEditBox",this._control[0]);i&&i.length&&(i[0].value=this.getTempAnnotation());i&&i.length&&i[0].focus();this._logInstrumentation("EditNotes");n&&(n.stopPropagation(),n.preventDefault())},o.prototype.onDeleteNicknameClick=function(n){this.setShowDropdown(!1);this.setCurrentName(this.getOriginalName());this.setTempAnnotation("");this.annotationChanged.invoke();this._logInstrumentation("DeleteNickName");n&&(n.stopPropagation(),n.preventDefault())},o.prototype.onDeleteDescriptionClick=function(n){this.setShowDropdown(!1);this.setDescription(null);this.setTempAnnotation("");var i=t(".descriptionEditBox",this._control[0]);i&&i.length&&(i[0].value="");this.annotationChanged.invoke();this._logInstrumentation("DeleteNotes");n&&(n.stopPropagation(),n.preventDefault())},o.prototype.onSaveNickNameClick=function(n){this.setShowNickNameEdit(!1);var t=this.getTempAnnotation().trim();t&&(this.setCurrentName(t),this.setTempAnnotation(""),this.annotationChanged.invoke());this._logInstrumentation("SaveNickName");n&&n.stopPropagation();n&&n.preventDefault()},o.prototype.onSaveDescriptionClick=function(n){this.setShowDescriptionEdit(!1);this.setDescription(this.getTempAnnotation());this.setTempAnnotation("");this.annotationChanged.invoke();this._logInstrumentation("SaveNotes");n&&n.stopPropagation();n&&n.preventDefault()},o.prototype.onCloseClick=function(n){this.setShowDescriptionEdit(!1);this.setShowNickNameEdit(!1);this.setTempAnnotation("");var i=t(".descriptionEditBox",this._control[0]);i&&i.length&&(i[0].value="");n.stopPropagation();n.preventDefault()},o.prototype.onKeyPressName=function(n){if(n.keyCode===13)this.onSaveNickNameClick(null)},o.prototype.onKeyPressNote=function(n){if(n.keyCode===13&&!n.shiftKey){var i=t(".descriptionEditBox",this._control[0]);i&&i.length&&i[0].blur();this.onSaveDescriptionClick(null)}},o.prototype.addAuxillaryButton=function(n){var t=this.getControl().select(".auxillaryButtons"),i;t&&t.length>0&&(i=t.select("a"),i&&i.length>0&&t.insertBefore(n,i))},o.prototype._onShowPopOutChanged=function(n,i){var u=this,r=t(window);i?Microsoft.Maps.setTimeout(function(){r.add_event("click,contextmenu",u._windowClickEventHandler);r.add_event("keyup",u._windowKeyupEventHandler)},1):n&&(r.remove_event("click,contextmenu",this._windowClickEventHandler),r.remove_event("keyup",this._windowKeyupEventHandler),this._focusAnnotateButton())},o.prototype._hideDropdown=function(){this.getShowDropdown()?this.setShowDropdown(!1):(t(window).remove_event("click,contextmenu",this._windowClickEventHandler),t(window).remove_event("keyup",this._windowKeyupEventHandler))},o.prototype._hideNickNamePopOut=function(){this.getShowNickNameEdit()?this.setShowNickNameEdit(!1):(t(window).remove_event("click,contextmenu",this._windowClickEventHandler),t(window).remove_event("keyup",this._windowKeyupEventHandler))},o.prototype._hideDescriptionPopOut=function(){this.getShowDescriptionEdit()?this.setShowDescriptionEdit(!1):(t(window).remove_event("click,contextmenu",this._windowClickEventHandler),t(window).remove_event("keyup",this._windowKeyupEventHandler))},o.prototype._logInstrumentation=function(n){var t={AN:n,EP:u.LocalDetails},i={logData:{feature:"DC",action:"C",data:t},impressionGuid:this._impressionGuid};e.invokeHandler(f.instrumentationDataHandlerKey,i)},o.prototype._focusAnnotateButton=function(){var n=this.getControl().select(".annotateButton");n&&n.length&&n[0].focus()},o}(ni),nu=function(){function n(){}return n}(),df=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return y(t,n),t}(nu),bo=[new gt("RestaurantPrice","bm_Price",r.L_FilterName_Price,2,1).addAllOptions([1,2,3,4].map(function(n){for(var t="",i=0;i<n;i++)t=t.concat(r.L_FiltersBar_Price_Unit);return new ct(n.toString(),t,"RestaurantPrice_RPrice"+(n+1))})),new gt("HotelStarRating","bm_Rating",r.L_FilterName_Rating,1,2,function(n){return i._formatString(r.L_FiltersBar_HotelRating_SelectionLabel,n.getSelectedOptions().map(function(n){return n.value}).join(", "))}).addAllOptions([2,3,4].map(function(n){return new ct(n.toString(),r.L_FiltersBar_HotelRating_OptionSuffix,"UserRating_URating"+(2*n-1)+"Up")})).addOption(new ct("5","","UserRating_URating9Up")),new gt("CuisineCategory","bm_Cuisine",r.L_FilterName_Cuisine,2,0).addAllOptions(["91210","91216","91221","91223","91225","91229","91238"].map(function(n){return new ct(n,r["L_FiltersBar_Cuisine_"+n],"CuisineCategory_"+n)}))],tu=function(n){function t(t,i){var r=this,u={};return r=n.call(this,u,i,cf)||this,u.defineProperty("geochainSegments"),r.setGeochainSegments(t),r}return y(t,n),t}(yt),bi=function(n){function t(t){var i=n.call(this,t.getTitle(),t.getAddress(),t.id,t.getLocation(),t.getRoutableLocation(),t.getMenuUrl(),t.getImageUrl(),t.entitySource,t.getPrimaryCategoryPath(),t.getPrimaryCategoryName(),t.getVdpId(),t.getLocationType(),t.getDateTime())||this;return t.getPhone()&&n.prototype.setPhone.call(i,t.getPhone()),t.getWebsite()&&n.prototype.setWebsite.call(i,t.getWebsite()),i.factData=null,i.factLabel=null,i.colorIndex=null,i.resources=r,i}return y(t,n),t.prototype.hideIfMatchedData=function(n){var t=n;return t===null||this.getTitle()===t?"none":""},t.prototype.nullToDisplayNone=function(n){return n?"":"none"},t}(ii),ko=function(n){function s(t,i,u,f){var e=this,o={};return e=n.call(this,o)||this,o.defineProperty("events"),o.defineProperty("showPopUp"),o.defineProperty("showOtherFlights"),e.controlTemplateFactory=t,e._templateName=kf,e.disposables=[],e.resources=r,e._map=i,e._id=f,e.setEvents(u),e._logEventShownInstrumentation(),e}return y(s,n),s.prototype.boolToDisplay=function(n){return n?"":"none"},s.prototype.boolToNotDisplay=function(n){return n?"none":""},s.prototype.nullToDisplayNone=function(n){return n?"":"none"},s.prototype.hotelToDisplay=function(n){return n==="Events.HotelEvent"?"":"none"},s.prototype.flightToDisplay=function(n){return n==="Events.FlightEvent"?"":"none"},s.prototype.getTimeString=function(n){if(n){var t=i._formatLongDateString(n),r=i._formatTimeString(n);return"{0}, {1}".replace("{0}",t).replace("{1}",r)}return""},s.prototype.getAirportText=function(n){return n?this.resources.L_AirportFormat.replace("{0}",n.city).replace("{1}",n.airportCode):""},s.prototype.getAirlineDetails=function(n){return n?this.resources.L_AirlineFormat.replace("{0}",n.airline).replace("{1}",n.reservationId):""},s.prototype.initiallyHideOtherFlights=function(n){return!this.getShowOtherFlights()&&n>0?"none":""},s.prototype.displayAfterFirst=function(n){return n>0?"":"none"},s.prototype.hideAfterFirst=function(n){return n>0?"none":""},s.prototype.hideIfEntity=function(n){return n===this._id?"none":""},s.prototype.displayIfEntity=function(n){return n===this._id?"":"none"},s.prototype.showMoreFlightButton=function(n){var t=this.getEvents();return!n&&t&&t[0]&&t[0].type==="Events.FlightEvent"&&t.length>1?"":"none"},s.prototype.onExpandClick=function(n){this.setShowOtherFlights(!0);var t=this.getEvents();this.setEvents([]);this.setEvents(t);n.preventDefault();n.stopPropagation()},s.prototype.onInfoHovered=function(){this.setShowPopUp(!0)},s.prototype.onInfoExited=function(){this.setShowPopUp(!1)},s.prototype.buildEventDataTaskAttribute=function(n){var i=o.CloudGraphDataManager.CollectionEntity.buildEntityDataTaskOptions(n);return i.state.taskTitle="",i.activateOptions={},t.Internals.stringify(i)},s.prototype.getControl=function(){if(!this._control){if(!this.controlTemplateFactory)throw new Error("control template factory must be defined.");var n=this.controlTemplateFactory({templateText:this._templateName,staticResources:this});this._control=n.applyDataTemplate(this);this.disposables.push(n)}return this._control},s.prototype.dispose=function(){for(var n=0;n<this.disposables.length;n++)this.disposables[n].dispose();this.disposables=[]},s.prototype._logEventShownInstrumentation=function(){var n={AN:"UE",EP:u.LocalDetails},t={logData:{feature:"DC",action:"A",data:n}};e.invokeHandler(f.instrumentationDataHandlerKey,t)},s}(ni),tt;(function(n){n[n.ID=0]="ID";n[n.SB=1]="SB"})(tt||(tt={})),function(n){n[n.STP=0]="STP";n[n.LLT=1]="LLT";n[n.LDT=2]="LDT";n[n.LDA=3]="LDA";n[n.LLR=4]="LLR";n[n.LSR=5]="LSR";n[n.RAP=6]="RAP";n[n.MBR=7]="MBR";n[n.FLBK=8]="FLBK";n[n.SPR=9]="SPR"}(p||(p={}));var iu=function(){function n(n){this._perfLogger=n}return n.prototype.perfStart=function(n){if(tt[n]){var t=st.Search+"_"+tt[n];return this._perfLogger.start(t)}return null},n.prototype.log=function(n,t,i){var r={impressionGuid:i,logData:{feature:st.Search,action:p[n],data:t}};e.invokeHandler(f.instrumentationDataHandlerKey,r)},n.prototype.getMarketFromBingPlacesUrl=function(n){var r=n&&n.select("div.wpc_sfl")[0],u=r&&r.lastElementChild,f=u&&u.href,t=f&&f.split("market="),i=t&&t.length>1?t[1].split("&"):null;return i&&i.length>0?i[0]:""},n}(),ru=function(){function u(n,t,i,r,u,f,e){var o=this,s;this.map=n;this.panelRoot=t;this._logHelper=i;this._selector=r;this._attributeName=u;this._pushpins=[];this._entities=[];this._eventHandlers=[];this._disposables=[];this._transientLensViewModel=f;this._transientLensViewModel&&this._transientLensViewModel.initializeCollections();this.landMarkFilterRule=null;this._signInSate=new ui;this._isSignedIn=this._signInSate.getIsSignedIn();this._disposables.push(this._signInSate.notifySignedIn.add(function(n){return o._isSignedIn=n}));this.changed=new g;this.titleChanged=new g;this.catIdPopulated=new g;this.catIdPopulated.add(function(){return o._assignEntitySearchCategory()});this.launchOverflowTask=new g;e&&e.selectedCategoryId&&(s=e.selectedCategoryId);this.populateCardCategoryId(s)}return u.getSuggestionIconColor=function(){return i._isHighContrastMode()?u._highContrastSuggestionIconColor:u._suggestionIconColor},u.prototype.selectorReady=function(){var n=this;return this._baseMapTemplateSelector?this._baseMapTemplateSelector.selectorReady():this.map.getTemplateSelector().then(function(t){return n._baseMapTemplateSelector=t,n._baseMapTemplateSelector.selectorReady()})},u.prototype.dispose=function(){this.clear();i._clearDisposables(this._disposables);this._transientLensViewModel.dispose()},u.prototype.setResponseContent=function(r,u,f){var o,s,e,h,c,v,a;r&&(this.clear(f),this.panelRoot&&(f&&f.isInfiniteScroll||this.panelRoot.clear(),this.parseEntitiesFromResponse(r,u,f),this._parseLandMarkMetaData(r),this._parseCategoryData(r),o=!0,!n.showContentFirstForPermalinks||i._getUrlParam(window.location,"disablecf")==="1"||(s=t(".cardPrimer"),e=t(".cardPrimer .contentRoot"),e&&e.length>0&&e[0].children.length>0&&r.select(".nonajaxCardPrimer").length>0&&(h=e.select(".bm_filterBar"),h.length>0&&h.removeFromParent(),f&&f.isInfiniteScroll||this.panelRoot.append(t(e[0].children[0])),o=!1),s&&s.removeFromParent()),!o||f&&f.isInfiniteScroll||(c=r.length>0&&r[0].innerHTML,c?this.panelRoot.appendHTML(c):this.panelRoot.append(r)),f&&f.isInfiniteScroll||this._forceImageRedrawForEdge()),u&&(v=u.localFilters&&u.localFilters.indexOf('tsource:"OutdoorAttraction"')>-1&&u.localFilters.indexOf("gsfilter:")>-1,u.originIG=u.originIG||l.getImpressionGuid(this.panelRoot),a=i._decodeHTML(t(".stickyFiltersRoot .bm_filterBar").get_attr("fp")),(!v||a)&&(u.localFilters=a)))},u.prototype.getResponseContainer=function(){return this.panelRoot},u.prototype.getCardCategoryId=function(){return this._cardCategoryId},u.prototype.getPushpinPrimitives=function(){return this._pushpins},u.prototype.clearPushpinPrimitives=function(){this._pushpins=[]},u.prototype.UpdatePrimitiveState=function(n,t){for(var u,r=!1,i=0,f=this._pushpins.length;i<f;i++)if(this._pushpins[i].entity.id===n){if(u=this._pushpins[i].entity,u&&u.isApproximateLocation)return r;this._pushpins[i].viewState=t;this._pushpins[i].revision=(this._pushpins[i].revision||0)+1;r=!0;break}return r},u.prototype.getEntities=function(){return this._entities},u.prototype.parseEntitiesFromResponse=function(n,i,r){var u=this,f;return r&&r.infiniteScrollData&&r.infiniteScrollData.entities.length>0?(this._entities=this._entities.concat(r.infiniteScrollData.entities),this._pushpins=this._pushpins.concat(r.infiniteScrollData.pushpins),{entities:this._entities,pushpins:this._pushpins}):(f=n.select(this._selector),f.for_each(function(r){var f=r.getAttribute(u._attributeName),e=r.getAttribute("data-facts"),s=e&&t.Internals.parseJSON(e),o;f&&(o=t.Internals.parseJSON(f),u.processEntity(o,n,i,!1,s))}),{entities:this._entities,pushpins:this._pushpins})},u.prototype.processEntity=function(n,t,i,r,u){var f,y,c,h,l;if(!n)return null;if(f=n.entity,!f&&i&&(f={title:i.query}),f&&!f.title&&i&&(f.title=i.query),f&&f.title){var a=n.geometry,v=n.routablePoint,o=null,s=null;if(a&&(o=new b(a.y,a.x)),v&&(s=new b(v.latitude,v.longitude)),o||(o=s),s||(s=o),o&&s){var w=i&&i.directionsTaskId!=null,p=w?1:0,k=this._isSignedIn,e=k?new ur(f.title,f.address,f.id,o,s,f.menuUrl,f.imageUrl,p,f.primaryCategoryPath,f.primaryCategoryName,f.vdpId,f.locationType,f.startDateTime,f.endDateTime,f.utcOffset,f.isAllDayEvent,f.segmentTypes):new ii(f.title,f.address,f.id,o,s,f.menuUrl,f.imageUrl,p,f.primaryCategoryPath,f.primaryCategoryName,f.vdpId,f.locationType,f.startDateTime,f.endDateTime,f.utcOffset,f.isAllDayEvent,f.segmentTypes);return(f.phone&&e.setPhone(f.phone),f.website&&e.setWebsite(f.website),f.subtitle&&(e.subtitle=f.subtitle),f.iconText&&(e.iconText=f.iconText),f.isUpHierarchy&&(e.isUpHierarchy=!0),f.isApproximateLocation&&(e.isApproximateLocation=!0),f.usePricePoi&&(e.usePricePoi=!0),f.badgeType&&(e.badgeType=f.badgeType),f.infoboxHtml&&(e.infoboxHtml=f.infoboxHtml),f.disablePoiLabel&&(e.disablePoiLabel=!0),f.city&&e.setCity(f.city),f.localFilters&&e.setLocalFilters(f.localFilters),y=f.chainId,y&&e.setChainId(y),f.adProviderId&&(e.adBusinessLocationId=f.adBusinessLocationId,e.adImpressionGuid=f.adImpressionGuid,e.adProviderId=f.adProviderId,e.adQuery=f.adQuery,e.adRetailEntitySource=f.adRetailEntitySource,e.adStoreId=f.adStoreId,e.adTriggerType=f.adTriggerType,e.adYpid=f.adYpid),t&&this._updateEntityState(t,e),c=null,e.subtitle&&e.subtitle.indexOf("useastitle:")>-1&&(e.subtitle=e.subtitle.replace("useastitle:",""),e.subtitle&&e.subtitle.length>0&&(c=e.clone(),c.setTitle(e.subtitle),c.subtitle=null)),h=new pi(o,c!==null?c:e),h.entity.poiType=1,e.isApproximateLocation&&(h.viewState=3),f.isPermanentlyClosed&&(e.isPermanentlyClosed=!0),u&&this._updateEntityWithDataFacts(e,u),r&&(l=this._findPushpin(e.id),l>0))?(this._pushpins[l]=h,this._entities[l]=e,h):(this._pushpins.push(h),this._entities.push(e),h)}}return null},u.prototype._updateEntityWithDataFacts=function(n,t){var s,h,f;n.interests=t.Interests;n.stayDuration=t["Average stay"];n.addressFields=t.addressFields;var i=n.getPrimaryCategoryName(),e=n.getPrimaryCategoryPath(),u=n.getSegmentTypes();if(t.campgrounds)s=t.campgrounds,n.metadataString=r.MetadataLine.replace("{0}",s.RVSites).replace("{1}",s.tentSites);else if(t.trails)h=t.trails,n.metadataString=r.MetadataLine.replace("{0}",h.length).replace("{1}",h.elevation);else if(i&&i==="Hotel"&&t["Hotel class"])n.metadataString=t["Hotel class"];else if(i&&i==="Restaurant"||e.indexOf("90232")>-1||e.indexOf("90287")>-1){var c=t.cuisine&&t.cuisine.split(","),o=c&&c.length&&c[0],f=t.price&&this._escapePriceString(t.price);o&&f?n.metadataString=r.MetadataLine.replace("{0}",o).replace("{1}",f):f?n.metadataString=t.price:o&&(n.metadataString=o);i||(i="Restaurant")}else e&&e.indexOf("91649")>-1&&t.price?(f=this._escapePriceString(t.price),n.metadataString=r.CoffeeMetadataLine.replace("{0}",f)):u&&u.length&&u[0]==="Events"&&(n.metadataString=t.Venue);n.mainSegmentType=i?i:u&&u.length&&u[0]},u.prototype._escapePriceString=function(n){return n.indexOf("$")===0?"$"+n:n},u.prototype._findPushpin=function(n){for(var t=0;t<this._pushpins.length;t++)if(this._pushpins[t].entity&&this._pushpins[t].entity.id===n)return t;return-1},u.prototype.getHouseListingCounts=function(){return null},u.prototype.updateAdvertising=function(n){this.updateTextAds(n);this.updateTnAAds();this.updateLocalSearchAds()},u.prototype.updateTextAds=function(){},u.prototype.updateTnAAds=function(){},u.prototype.updateLocalSearchAds=function(){},u.prototype.processDirectionsData=function(){},u.prototype.processCollectionsData=function(){},u.prototype.processTravelData=function(){},u.prototype.boolToDisplay=function(n){return n?"":"none"},u.prototype.nullToDisplayNone=function(n){return n?"":"none"},u.prototype.hideIfMatchedData=function(n){return n===null||this.getEntities()[0].getTitle()===n?"none":""},u.prototype.emptyToDisplayNone=function(n){return n&&n.length?"":"none"},u.prototype._updateEntityState=function(){},u.prototype._addEventsToEventList=function(n,t,i){this._eventHandlers.push({item:n,eventName:t,handler:i})},u.prototype.clear=function(){this._pushpins=[];this._entities=[];this._eventHandlers.forEach(function(n){n.item.remove_event(n.eventName,n.handler)});this._eventHandlers=[]},u.prototype._parseLandMarkMetaData=function(n){var r=n.select("div[data-landmark]"),u,i;if(r.length==1&&(u=r[0],i=u.getAttribute("data-landmark"),i)){var f=t.Internals.parseJSON(i),s=f.type,e=[],o=[];f.value.forEach(function(n){e.push(n.CategoryID);o.push(n.Percentage)});this.landMarkFilterRule={field:s,value:e,distribution:o}}},u.prototype.parseSuggestionMetaData=function(){var r=this.panelRoot.select("div[data-suggestions]"),u,n,f,i;return r.length!=1?null:(u=r[0],n=u.getAttribute("data-suggestions"),!n)?null:(f=t.Internals.parseJSON(n),i=[],f.forEach(function(n){var t=[];n.viewport&&n.viewport.length>1&&!isNaN(n.viewport[0].latitude)&&!isNaN(n.viewport[0].longitude)&&!isNaN(n.viewport[1].latitude)&&!isNaN(n.viewport[1].longitude)&&(t.push(new b(n.viewport[0].latitude,n.viewport[0].longitude)),t.push(new b(n.viewport[1].latitude,n.viewport[1].longitude)));i.push({Name:n.name,Id:n.categoryId,viewport:t})}),i)},u.prototype._drawCategoryItem=function(n,t,r,u){var o=t.Name,c=t.Id,h=i._createElement("li"),f=i._createElement("a"),e,s;return f.set_attr("class","searchNearbySuggestionLinkIcon"),e=i._createElement("div"),e.set_attr("class","suggestionIconBound"),f.add_event("click",u),this._addEventsToEventList(f,"click",u),f.set_attr("data-tag",r+"."+o),f.set_attr("aria-label",o),f.set_attr("href","#"),f.set_attr("role","button"),f.append(e),h.append(f),s=null,window.matchMedia("screen and (-ms-high-contrast: black-on-white)").matches?s="black":window.matchMedia("screen and (-ms-high-contrast: white-on-black)").matches&&(s="white"),n.getCategoryIconTemplate(function(n){var r=n&&n.icon,i;r&&(i=r.renderIcon(),i.set_attr("title",o),i.set_attr("alt",o),e.append(i),e.appendText(t.Name))},c,s,25,25),h},u.prototype._parseCategoryData=function(){},u.prototype.populateCardCategoryId=function(n){var t=this;n===""?(this.categoryFound=!1,this.catIdPopulated.invoke()):n?this.map.getTemplateSelector().then(function(){var i=yi.extractCategoryId(n,!1);i&&(t._cardCategoryId=i,t.changed.invoke());t.categoryFound=typeof t._cardCategoryId!="undefined";t.catIdPopulated.invoke()}):this.catIdPopulated.invoke()},u.prototype.addReportLinkToNoResultCard=function(t,u,f){var b=this,c,h,e,l,y,o,p,w,s,a,k,v,d;t.select("div[data-answerinfo]").length>0&&(c=t.select("div[data-answerinfo]"),c.get_attr("data-answerinfo")==="0"&&(n.useNewErrorCard?this._createNewReportLinkForNoResultCard(u,c,f):(h=i._createElement("p"),e=i._createElement("a"),e.set_text(r.L_Menu_ReportProblem_Link_Text),e.set_attr("href","#"),e.set_attr("data-tag","reportProblemLink"),e.set_attr("class","reportProblemLink"),l=i._createElement("div"),l.set_attr("class","reportProblemLinkWrapper"),l.append(e),h.append(l),y=c.select(".query"),o=y.length>0?y[0].textContent:"",o=o||f&&f.query,p=this.getUserFacts(),it&&it.showAddMissingBusinessLink&&!this._houseIntentFound(f)&&(w=i._createElement("span"),w.set_attr("class","reportProblemLinkSeparator"),h.append(w),s=i._createElement("a"),s.set_text(r.L_ReportMissingBusiness_Text),s.set_attr("href","#"),s.set_attr("class","reportProblemLink"),a=i._createElement("div"),a.set_attr("class","reportProblemLinkWrapper"),a.append(s),h.append(a),k=function(n){return b.onAddMissingBusinessLinkClicked(n,u,o,o,p,1)},s.add_event("click",k)),v=this.panelRoot.select(".errmsg"),v.append(i._createElement("br")),v.append(h),v.append(i._createElement("br")),d=function(n){return b._onReportProblemLinkClick(n,u,o,o,p)},e.add_event("click",d))))},u.prototype.onAddMissingBusinessLinkClicked=function(n,t,i,u,o,h){if(n.preventDefault(),it&&it.showAddMissingBusinessLink){var c={AN:"RapEntryPoints#"+h.toString()};this._logHelper&&this._logHelper.log(p.MBR,c);e.invokeHandler(f.taskDataHandlerKey,{type:s.feedbackTask,state:{entryPoint:3,feedbackTaskType:6,title:r.L_AddMissingBusinessCardTitle,activeTaskId:t,options:{dataFacts:{parentId:t},reportType:1,noFoundType:2,userFacts:o,rapEntryPoint:h}}})}},u.prototype._createNewReportLinkForNoResultCard=function(t,u,f){var b=this,h=i._createElement("div"),e,l,p,o,w,a,v,s,y,k,c,d;h.add_class("linkContainer");e=i._createElement("a");e.set_text(r.L_Menu_ReportProblem_Link_Text);e.set_attr("href","#");e.set_attr("data-tag","reportProblemLink");e.set_attr("class","reportProblemLink");l=i._createElement("div");l.set_attr("class","reportProblemLinkWrapper");l.append(e);h.append(l);p=u.select(".query");o=p.length>0?p[0].textContent:"";o=o||f&&f.query;w=this.getUserFacts();it&&it.showAddMissingBusinessLink&&!this._houseIntentFound(f)&&(a=i._createElement("span"),a.set_attr("class","reportProblemLinkSeparator"),n.useNewErrorCard&&(v=r.Overlay_NewErrorLink_Separator,v=v.replace("{0}","").replace("{1}",""),a.set_text(v)),h.append(a),s=i._createElement("a"),s.set_text(r.L_ReportMissingBusiness_Text),s.set_attr("href","#"),s.set_attr("class","reportProblemLink"),y=i._createElement("div"),y.set_attr("class","reportProblemLinkWrapper"),y.append(s),h.append(y),k=function(n){return b.onAddMissingBusinessLinkClicked(n,t,o,o,w,1)},s.add_event("click",k));c=this.panelRoot.select(".mapErrLinksContainer");c.length===0&&(c=this.panelRoot.select(".mapErrLinksContainerFilter"));c.length>0&&(c.append(h),d=function(n){return b._onReportProblemLinkClick(n,t,o,o,w)},e.add_event("click",d))},u.prototype._houseIntentFound=function(n){if(n){if(n.searchQueryCategory&&i._isHouseCategory(n.searchQueryCategory))return!0;if(n.categoryLayers&&n.categoryLayers.length)for(var t=0;t<n.categoryLayers.length;t++)if(n.categoryLayers[t]&&i._isHouseCategory(n.categoryLayers[t]))return!0}return!1},u.prototype._onReportProblemLinkClick=function(n,t,i,r,u){n.preventDefault();this._logHelper&&this._logHelper.log(p.RAP,{AN:"RapEntryPoints#2"});e.invokeHandler(f.taskDataHandlerKey,{type:s.feedbackTask,activateOptions:{parentId:t},state:{entryPoint:3,feedbackTaskType:3,title:i,activeTaskId:t,options:{query:r,reportType:1,userFacts:u,rapEntryPoint:2}}})},u.prototype._forceImageRedrawForEdge=function(){var n=this;t.Browser.is_edge&&Microsoft.Maps.setTimeout(function(){for(var u=n.panelRoot.select(".irpserp img, .cico img"),i=0,o=u.length;i<o;i++){var r=u[i],f=r,e=function(n){t([n.srcElement]).set_style({outline:"0px solid white"});n.srcElement.removeEventListener("load",e)};f&&!f.complete?r.addEventListener("load",e):t([r]).set_style({outline:"0px solid white"})}},0)},u.prototype._assignEntitySearchCategory=function(){var t=this.getCardCategoryId(),n=this.getEntities();t&&n&&n.length&&n.forEach(function(n){return n.setSearchCategory(t)})},u.prototype.getUserFacts=function(){var n=null,t=this.panelRoot.select("div[data-ufacts]").get_attr("data-ufacts");if(t)try{n=JSON.parse(t)}catch(i){}return n},u._suggestionIconColor="rgb(96,96,96)",u._highContrastSuggestionIconColor="rgb(255,255,0)",u}(),hi=function(a){function v(i,u,f,e,o,s,h,l,y,p){var w=a.call(this,i,u,e,"div.overlay-taskpane","data-entity",o,l)||this,b,k,d,g;if(w._adsVisibleLogged=!1,w._annotationControlAdded=!1,w._nearbyButton=null,w._preProcessLinks=function(n){var t,i,r;try{if(sj_evt.unbind("accordionAjaxResponse",w._preProcessLinks),n&&n.length>1)for(t=n[1],i=0;i<t.length;i++)r=t[i],r&&r.tagName==="DIV"&&w._handleExternalLinks(r)}finally{sj_evt.fire("accordionProcessed",t)}},w._handleExternalLinks=function(n){for(var i,r,u=n.getElementsByTagName("a"),t=0;t<u.length;t++)i=u[t],r=i.href,r.indexOf(v._externalLinkAttrNameWithHash)>-1&&w._processExternalLink(r,i)},w._processHotelsAndRestaurantsSeoLinks=function(n,i){var u,f,r;return n&&(f=n.indexOf("#data-process="),n=n.substring(f+14),n=n.replace(/\?form=[a-zA-Z]*[0-9]*/i,""),i.setAttribute("data-process",n),i.setAttribute("href","#")),u=t.Internals.parseJSON(n),r=u&&u.requestState,r&&r.query&&r.seoHotelsAndRestaurantsUrl&&i.setAttribute("href",r.seoHotelsAndRestaurantsUrl),u},w._buttonGroupViewModel=s,w._moduleClickEventInitialized=!1,w._controlTemplateFactory=y,w._taskId=f,w._state=l,l&&l.savedEntityId&&(w.savedEntityId=l.savedEntityId),l&&l.collectionId&&(w.collectionId=l.collectionId),l&&l.itineraryTaskId&&(w.itineraryTaskId=l.itineraryTaskId),l&&l.id&&(w.itineraryEntityId=l.id),w.printNotes="",w._taskBar=h,w.iconClass="srcTsk",w.resources=r,w.printTitleViewModel=null,w._primitivesInteracted=p,b=n.searchNearbyDefaultSuggestions,w._searchNearbyDefaultCategories=[],b){for(k=0;k<b.length;k++)if(d=b[k].split(":"),d.length==2){var it=d[0],rt=d[1],nt=r[it],tt=r[rt];nt&&tt&&w._searchNearbyDefaultCategories.push({Name:nt,Id:tt})}g=c.features;g&&g.transit&&g.transit.isEnabled&&(w._searchNearbyDefaultCategories[w._searchNearbyDefaultCategories.length-1]={Name:r.L_SearchNearbyTerm_7,Id:r.L_SearchNearbyCategoryId_7})}return w}return y(v,a),v.prototype.dispose=function(){a.prototype.dispose.call(this);this._buttonGroupViewModel.dispose();this.annotationControl&&this.annotationControl.dispose();this.upcomingEventsControl&&this.upcomingEventsControl.dispose()},v.prototype.getIsDetails=function(){return!0},v.prototype.getPrintNotes=function(){return this.printNotes},v.prototype.getAttributionText=function(){return this._getAttribution()},v.prototype.updatePoiTitle=function(n){this._pushpins&&this._pushpins.length>0&&this._pushpins[0].entity.setTitle(n)},v.prototype.resetPrimitives=function(n){n.setPrimitives(this._pushpins)},v.prototype.registerLocatedAtSearchEvents=function(){sj_evt.unbind("SearchLocatedAt",this._searchLocatedAtHandler);sj_evt.bind("SearchLocatedAt",this._searchLocatedAtHandler,0)},v.prototype.registerModuleClickEvents=function(){sj_evt.unbind("TPModHdrClick",this._moduleHeaderClickHander);sj_evt.bind("TPModHdrClick",this._moduleHeaderClickHander,0)},v.prototype.registerVenueMapEvents=function(){var t=this,n=this.panelRoot.select("div[class=bm_venueMapButton]");n&&n[0]&&n.is_element_inView()&&n.add_event("click",function(){t.handleVenueMapClick()})},v.prototype.registerGeochainEvents=function(){for(var n,i,o,e=this.panelRoot.select(".geochainModule a"),r=0;r<e.length;r++)n=e[r],i={},n.hasAttribute("data-sid")?i.id="sid:"+n.getAttribute("data-sid"):n.hasAttribute("data-vdpid")?i.id="vdpid:"+n.getAttribute("data-vdpid"):i.query=n.innerText,i.entryPoint=u.Geochain,o={type:s.localSearchTask,requestState:i},n.setAttribute(f.taskProcessDataHandlerKey,t.Internals.stringify(o))},v.prototype.registerCalendarEvents=function(){var h=this,n=this.panelRoot.select("#cal_tm1"),i=this.panelRoot.select("#cal_tm2"),c,r,o,s,l;if(n&&n.length&&i&&i.length){c=this.panelRoot.select("*[data-cal-loc]");r=null;try{r=t.Internals.parseJSON(c.get_attr("data-cal-loc"))}catch(a){}o=this.map.getContainer();o&&(o.instanceAsync("Calendar",function(t){t.init(h.panelRoot,n,i,r)}),s=this._getReservertionForm(n),s&&(l=s.select("input[type='submit']"),l.add_event("click",function(){var n=h._buildLogData("C",{AN:"Reservation",EP:u.LocalDetails});e.invokeHandler(f.instrumentationDataHandlerKey,n)})))}},v.prototype._initializeNearbyButton=function(n,t){var e=this,f=this.panelRoot.select("div.ibsb_nearby"),i,r,u;f!==null&&(this._nearbyButton=f.get_ancestor(2));this._nearbyButton&&(i=a.prototype.parseSuggestionMetaData.call(this),i||(i=this._searchNearbyDefaultCategories),r=[],i!=null&&i.forEach(function(n){r.push(n.Name)}),this._nearbyButton.length===1&&(this._nearbyButton.add_class("nearbyBtn"),this._nearbyButton.set_attr("role","button"),this._nearbyButton.set_attr("aria-expanded","false"),u=function(n){return e._nearbySearchLinkClickHandler(n,t,r,i&&i.length?i[0].viewport:null)},this._nearbyButton.add_event("click",u),this._addEventsToEventList(this._nearbyButton,"click",u)))},v.prototype.registerActionButtonEvents=function(n,i){var l=this,nt=this.panelRoot.select("div[data-entity]"),o=nt&&t(nt[0]),r,c,f,a,tt,y,e,v,p,it,w,b,s,k,d,h,rt,g;o&&this._taskId&&(r=o.select("a[class=directionsAction]"),r&&r.length!==0||(r=this._initializeAlternateDirectionsButton(o)),c=this.getEntities()[0],f=c&&c.getLocation(),ot.nearbyButtonEnabled&&this._initializeNearbyButton(o,f),a=c&&c.getRoutableLocation(),a=a?a:f,r&&r.length===1&&(r.set_attr("role","button"),r.set_attr("aria-expanded","false"),tt=this._buildLogData("C",{AN:"Directions",CP:f,EP:u.LocalDetails}),y=function(n){return l._buttonGroupViewModel.directionButtonClicked(n,a,tt,u.LocalDetails)},r.add_event("click",y),this._addEventsToEventList(r,"click",y)),e=o.select("a[class=scheduleContactBtn], a#scheduleContactBtn"),e&&e.length===1&&(v=e.get_attr("href"),p=v&&v!="#"?t.Internals.parseJSON(v):null,e.set_attr("href","#"),p&&e.length&&(e.set_attr("role","button"),e.set_attr("aria-expanded","false"),it=this._buildLogData("C",{AN:"ScheduleTourOrContactAgent",CP:f,EP:u.LocalDetails}),w=function(n){return l._buttonGroupViewModel.scheduleContactTourButtonClicked(n,p,it,u.LocalDetails)},e.add_event("click",w),this._addEventsToEventList(e,"click",w))),b=new ui,s=o.select("a[class=saveAction], a#newCollectAction"),s&&s.length===1&&(s.set_attr("role","button"),s.set_attr("aria-expanded","false"),k=this._buildLogData("C",{AN:"CollectionsMenu",CP:f,EP:u.LocalDetails}),d=function(n){!b.getIsSignedIn()&&ti.isEditable?l._buttonGroupViewModel.saveWithTravelButtonClicked(n,f,k,u.LocalDetails):l._collectionClick(n,f,k,u.LocalDetails,b.getIsSignedIn())},s.add_event("click",d),this._addEventsToEventList(s,"click",d)),h=o.select("a[class=shareAction], a#shareAction"),h&&h.length===1&&(h.set_attr("role","button"),h.set_attr("aria-expanded","false"),rt=this._buildLogData("C",{AN:"ShareActionButton",CP:f,EP:u.LocalDetails}),g=function(t){return l._shareButtonClicked(t,rt,n)},h.add_event("click",g),this._addEventsToEventList(h,"click",g)),this._buttonGroupViewModel.setEntityData(c,{requestorType:"LocalDetailsTask",requestorId:this._taskId},this.panelRoot),this._addSuggestionsToNearbyModule(f),this._registerBrowseProductsClick(o,i))},v.prototype.registerActionsModuleEvents=function(){var s=this,n=this.panelRoot.select("div[class=actionAnswer]"),t,o,i,r;if(n&&n.length)for(t=0;t<n.length;t++)if(o=n[t].getAttribute("data-actiontype"),i=n[t].getElementsByTagName("a"),i&&i.length&&o)for(r=0;r<i.length;r++)i[r].addEventListener("click",function(){var n=s._buildLogData("C",{AN:"ActionModule",EP:u.LocalDetails,DT:o});e.invokeHandler(f.instrumentationDataHandlerKey,n)})},v.prototype.processDirectionsData=function(t){var r=this.getEntities(),i=r&&r[0],h=i.getAddress(),f,e,o,s;i&&i.id&&i.id.indexOf("event")>-1&&(e=n.eventPreArrivalTime,f=i.getDateTime&&i.getDateTime()?i.getDateTime()+i.getUtcOffset()*6e4-e*6e4:null);o=i.entitySource===1;s=ei.getDirectionTaskOptions(h,i.getRoutableLocation(),u.LocalDetails,i.getTitle(),i.id,null,o,f);t&&t.inData&&t.inData.requestorState&&(t.inData.requestorState.entryPoint===u.LocalDetails?this._buttonGroupViewModel.processDirectionsData(t,s):this._transientLensViewModel.processDirectionsData(t))},v.prototype.processTravelData=function(n){if(n&&n.inData&&n.inData.requestorState)n.inData.requestorState.entryPoint===u.LocalDetails?this._buttonGroupViewModel.processSaveWithTravelData(n):this._transientLensViewModel.processTravelData(n);else if(n&&n.outData&&n.outData.length){var t=n.outData[n.outData.length-1];this.itineraryTaskInfo=t;this._populateAddToContainer()}},v.prototype._populateAddToContainer=function(){var v=this,l=this.panelRoot.select("div[data-entity]"),f=l&&t(l[0]),n,e,o,u,s,a,h;f&&f.length!==0&&(n=f.select("div[class=bm_addToContainer]"),this.itineraryTaskInfo&&!n.length&&(e=f.select("div[class=b_subModule]"),o=e.length&&e[0],o&&(n=i._createElement("div"),n.add_class("bm_addToContainer bm_addToFirstModule"),o.appendChild(n[0]))),this.itineraryTaskInfo&&!c.isInPrivateMode&&n.length?(n.clear(),n.add_class("bm_addToItineraryContainer"),u=i._createElement("a"),u.set_attr("href","#"),u.set_attr("class","addToAction addToItinerary"),s=i._createElement("span"),s.set_attr("class","addToItineraryIcon"),u.append(s),u.appendText(r.L_AddToItinerary),a=this.itineraryTaskInfo.processorId,h=function(n){return v._addAttractionButtonClicked(n,a)},u.add_event("click",h),this._addEventsToEventList(u,"click",h),n.append(u),n.set_style({display:"block"})):n.length&&(n.set_style({display:"none"}),n.remove_class("bm_addToItineraryContainer")))},v.prototype.processCollectionsData=function(n){var r=this.getEntities(),i=r&&r.length===1&&r[0],f=ei.getMyPlacesTaskOptions(i.getTitle(),i.getLocation(),i.getDescription()),t,e;f.activateOptions={parentId:this._taskId};f.state.data.id=i.id;t=n.inData.requestState;(t.action===pt.AddEntity||t.action===pt.AddFavorite||t.action===pt.AddToTemporaryCollection)&&(e=n.outData.length&&n.outData[0].data&&n.outData[0].data.entityId,e&&(this.savedEntityId=e),t.collectionId&&(this.collectionId=t.collectionId),t.action===pt.AddToTemporaryCollection&&(this.collectionId="TEMP"));n&&n.inData&&n.inData.requestorState&&(n.inData.requestorState.entryPoint===u.LocalDetails?this._buttonGroupViewModel.processCollectionsData(n,f):this._transientLensViewModel.processCollectionsData(n))},v.prototype.setResponseContent=function(i,r){var f=this,s,y,o,h,c,l;if(i){this._delayLoadRecommendationModuleImages(i);this._hideEmptyModules(i);a.prototype.setResponseContent.call(this,i,r);window.AccordionControl&&AccordionControl&&AccordionControl.accordion&&(s=AccordionControl.accordion.length,s>0&&(y=AccordionControl.accordion[s-1],y.isResponsePreprocessingRequired=!0,sj_evt.bind("accordionAjaxResponse",this._preProcessLinks)));o=r===null||r===void 0?void 0:r.category;n.oneSizeDetail&&o&&(o==="Restaurant"||o.indexOf("90232")>-1||o.indexOf("90287")>-1)&&(h=t(".b_ot_dtp_pickers"),h.length>0&&h.add_class("bm_onesize"));n.enableJavaScriptLoadingInResponse&&Microsoft.Maps.setTimeout(function(){f._loadJavaScriptInResponse(i)},10);c=this.panelRoot.select(".overlay-container");c.length>0&&(l=c[0].getAttribute("data-answerinfo"),l!=null&&n.pushpinIconScenarios!=null&&n.pushpinIconScenarios.indexOf(l)!==-1&&(this.iconClass="addrTsk"));var e={},p={},w=this.panelRoot.select("a[href]");w.for_each(function(n){var o=n.getAttribute("href"),i,r,h,w,c,a,k,y,d,g;if(o)if(i=o.toLowerCase(),i.indexOf("http")===0||i.indexOf("/search")===0||i.indexOf("/images/search")===0)n.setAttribute("target","_blank");else if(i.indexOf("/local/reportproblem")===0)it.shouldIgnoreSAE&&f.panelRoot.select(".infoModule .b_feedbackComponent")||!f._shouldEnableSuggestAnEdit()||f._setLocalFeedbackTaskOptions(n);else if(i.indexOf(v._externalLinkAttrNameWithHash)>-1)f._processExternalLink(o,n);else if(i.indexOf("data-process")===0||i.indexOf("/maps")===0&&i.indexOf("#data-process")!==-1){r=null;try{i.indexOf("data-process")===0?(o=o.replace(/data-process=/i,""),o=o.replace(/\?form=[a-zA-Z]*[0-9]*/i,""),n.setAttribute("data-process",o),n.setAttribute("href","#"),r=t.Internals.parseJSON(o)):r=f._processHotelsAndRestaurantsSeoLinks(o,n)}catch(tt){w=f._buildLogData("C",{AN:"SEARCHERROR",EP:u.LocalDetails,DT:"BadDataProcess"});n.setAttribute("data-instrumentation",t.Internals.stringify(w));n.setAttribute("data-process","")}if(r&&r.moduleName&&(h=r.moduleName,h in e?e[h]+=1:e[h]=1,w=f._buildLogData("C",{AN:h,EP:u.LocalDetails}),n.setAttribute("data-instrumentation",t.Internals.stringify(w))),r&&r.requestState&&r.requestState.passThruParam&&r.requestState.passThruParam.indexOf("lemodule=")!==-1&&(c=r.requestState.passThruParam.split("="),c&&c.length>1)){var s="lemoduleSeeAll."+c[1],nt="MapsModule."+c[1],b,l=f.panelRoot.select("div[data-entitymetadata]");if(l&&l.length)for(a=0;a<l.length;a++)if(l[a].getAttribute("data-moduletag")===nt){b=l[a];break}k=f._buildLogData("C",{AN:s,EP:u.LocalDetails});b&&(y=b.getAttribute("data-entitymetadata"),y&&y.length&&(p[s]=y,k=f._buildLogData("C",{AN:s,EP:u.LocalDetails,DAT:y})));n.setAttribute("data-instrumentation",t.Internals.stringify(k));s in e?e[s]+=1:e[s]=1}}else i.indexOf("javascript:void(0)")===0&&(d=n.getAttribute("id"),d!=null&&(g=d.toLowerCase(),g=="raflink"&&f._shouldEnableSuggestAnEdit()&&f._setLocalCrowdSourcingTaskOptions(n)))});this._addOutingsEventHandlers();this._addModulesInstrumentation(e,p);this.addProductAdsClientInstrumentation();a.prototype.addReportLinkToNoResultCard.call(this,i,this._taskId,r)}},v.prototype.addProductAdsClientInstrumentation=function(){var i=this,n=this.panelRoot.select(".ProductAdsContainer");n&&n.length&&n.for_each(function(n){var s=n.getAttribute("data-mapimp"),r,h,o;s&&(r=t.Internals.parseJSON(s),r&&r.module&&r.count&&(h=i._buildLogData("I",{AN:r.module,EP:u.LocalDetails,CNT:r.count}),e.invokeHandler(f.instrumentationDataHandlerKey,h)),n.setAttribute("data-mapimp",""));o=t(n).select("a[data-maplog]");o&&o.length&&o.for_each(function(n){var u=n.getAttribute("data-maplog"),r,o;u&&(r=t.Internals.parseJSON(u),r&&(o=i._buildLogData("C",r),n.addEventListener("click",function(){e.invokeHandler(f.instrumentationDataHandlerKey,o)})),n.setAttribute("data-maplog",""))})})},v.prototype.loadDelayedRecommendationModuleImages=function(){var n=this.panelRoot.select("div.EntityCollectionModuleContainer");!n||n.length<1||n.for_each(function(n){var f=n.getElementsByClassName("b_slideexp"),t,r,e,u,i,o;if(f&&f.length&&(t=f[0].getElementsByClassName("slide"),t&&t.length))for(r=0;r<t.length;r++)for(e=t[r].getElementsByTagName("img"),u=0;u<e.length;u++)i=e[u],i&&(o=i.getAttribute("data-delayedsrc"),o&&(i.setAttribute("src",o),i.setAttribute("data-delayedsrc","")))})},v.prototype._delayLoadRecommendationModuleImages=function(n){var t=0,r=n.select("div[data-mapcardwidth]"),f=r&&r.length&&r[0].getAttribute("data-mapcardwidth"),u,i;if(f)if(u=parseInt(f),u===384)t=2;else if(u===650)t=4;else return;(i=n.select("div.EntityCollectionModuleContainer"),!i||i.length<1)||i.for_each(function(n){var e=n.getElementsByClassName("b_slideexp"),i,u,o,f,r,s;if(e&&e.length&&(i=e[0].getElementsByClassName("slide"),i&&i.length>t))for(u=t;u<i.length;u++)for(o=i[u].getElementsByTagName("img"),f=0;f<o.length;f++)r=o[f],r&&(s=r.getAttribute("src"),s&&(r.setAttribute("data-delayedsrc",s),r.setAttribute("src","")))})},v.prototype._hideEmptyModules=function(n){var t=n.select("div.wpc_module.sb_meta");t.for_each(function(n){n.childElementCount==0&&n.setAttribute("style","display: none;")})},v.prototype._processExternalLink=function(n,t){var r,i;try{r=n.indexOf(v._externalLinkAttrNameWithHash);n=n.substr(r+v._externalLinkAttrNameWithHash.length+1);n=n.replace(/\?form=[a-zA-Z]*[0-9]*/i,"");i=v._externalLinkAttrNameWithHash.substr(1);t[i]=n;t.setAttribute(i,n);t.setAttribute("href","#");t.setAttribute("target","_blank");t.addEventListener("click",function(){t.setAttribute("href",t.getAttribute(i))});t.addEventListener("mouseover",function(){t.setAttribute("href",t.getAttribute(i))});t.addEventListener("focus",function(){t.setAttribute("href",t.getAttribute(i))})}catch(f){this._buildLogData("C",{AN:"SEARCHERROR",EP:u.LocalDetails,DT:"BadDataProcess"})}},v.prototype._initializeAlternateDirectionsButton=function(n){var u=n.select("a#DirBtn"),s,e,h,r,t,c,l,f;if(u&&u.length!==0||(s=n.select(".ibsb_dir"),u=s?s.get_ancestor(2):null),e=!1,u&&u.length>0)if(h=this.panelRoot.select(".directionsPopOut"),h&&h.length!==0)e=!0;else if(r=u.get_ancestor(3),r&&r.length>0)if(r.has_class("b_subModule"))try{t=null;this._state&&(i._isHouseCategory(this._state.listingCategoryPath)||i._isHouseCategory(this._state.selectedCategoryId)||i._isHouseCategory(this._state.category)||i._isHouseCategory(this._state.searchQueryCategory))&&(t=r.select(">.b_mort"),t&&t.length!==0||(t=r.select(">.b_subscomp")),t&&t.length!==0||(t=r.select(">.b_lBottom.b_snippet")));t&&t.length!==0||(t=r.select(".infoCardIcons"));t&&t.length!==0||(t=r.select(".b_vList"));t&&t.length>0&&(f=document.createElement("div"),f.className="bm_popout directionsPopOut",r.insertBefore(f,t),e=!0)}catch(a){c=o.logger;c&&(l={feature:"MC",action:"WRN",data:{errorMessage:"_initializeAlternateDirectionsButton exception: "+a.toString()}},c.logObject(l))}else r.has_class("b_icbtns")&&(f=document.createElement("div"),f.className="bm_popout directionsPopOut",r.append(f),e=!0);return e||(this._processDirectionsButtonClick(),u=null),u},v.prototype._processDirectionsButtonClick=function(){if(this.panelRoot){var n=this.getEntities()[0],t=this.panelRoot.select("#DirBtn")[0];n&&t&&t.addEventListener("click",function(t){t.preventDefault();var i=new bt(n.getAddress(),n.getRoutableLocation(),n.getTitle(),!1,null,n.id,null,null,null,2,1,null),r={entryPoint:3,waypoints:[i]};e.invokeHandler(f.taskDataHandlerKey,{type:s.directionsTask,state:r})})}},v.prototype.parseEntitiesFromResponse=function(n,i){var f=this,e=a.prototype.parseEntitiesFromResponse.call(this,n,i),r=e.entities,o,s,u;return this.boundingBox=this._parseBoundingBox(n),this.boundingBox&&(r=this.getEntities(),r&&r.length===1&&r[0].setBoundingBox(this.boundingBox)),o=n.select("div.EntityCollectionModuleContainer"),o.for_each(function(n){var l=n.getAttribute("data-entitylist"),r,e,c,o,s,i,h,u;if(l&&(r=t.Internals.parseJSON(l),r&&r.length>0))for(c=n.getAttribute("data-moduletag"),c&&(o=c.split("."),o&&o.length===2&&(e=o[1])),s=0;s<r.length;++s)i=r[s],f._pushpins&&i&&i.location&&i.location.length===2&&i.title&&i.id&&(h=new vr(i.id,i.title),e&&(h.setSearchCategory(e),h.setSelectedCategoryForIcon(e)),u=new pi(new b(i.location[0],i.location[1]),h),u.alwaysShowOnMap=!1,u.viewState=3,u.entity.poiType=1,f._pushpins.push(u))}),s=n.select("div.overlay-taskpane").get_attr("data-facts"),u=l.parseDataFact(s),u&&r&&r.length===1&&(r[0].addressFields=u.addressFields),i&&i.dateTime&&r[0]&&r[0].setDateTime(i.dateTime),i&&i.imgUrls&&i.imgUrls.length&&r[0]&&!r[0].getImageUrl()&&r[0].setImageUrl(i.imgUrls[0]),e},v.prototype.processPhotostripData=function(){var n,i=this.panelRoot.select("div[data-photostripconfig]").get_attr("data-photostripconfig");i&&(n=t.Internals.parseJSON(i));n&&(this._setPhotoStripWidth(n),this._registerPhotostripEvents())},v.prototype.createCalendarSync=function(){var t=this,u=this.getEntities()&&this.getEntities()[0],i,f,r;u?(this.calendarSync=[],this.panelRoot.select(".calendarSyncControlContainer").for_each(function(i){var f=i.getAttributeNode("id"),r=f?f.nodeValue.split("_")[0]:"";t.calendarSync.push(new bu(t.map,t.panelRoot.select(r?"#"+r+"_calendarSyncControlContainer":".calendarSyncControlContainer"),t.panelRoot.select(r?"#"+r+"calendarSyncLabel":".calendarSyncLabel"),t.panelRoot.select(".calendarSyncMessage"),t._taskId,u,n))})):(i=this.panelRoot.select(".calendarSyncModule"),i&&i.length&&(f=i[0],r=f.parentElement,r&&r.classList.contains("b_subModule")&&(r.style.display="none")))},v.prototype.addCollectionsDescription=function(n){var e,t,r,u,f;if(n&&n.descriptionList&&n.descriptionList.length>0&&(e=n.descriptionList,t=this.panelRoot.select("ul[id=userDescriptionList]"),t&&t.length===1)){for(r=0;r<e.length;r++)u=i._createElement("li"),u.set_attr("data-tag","MapActionModule.UserDescription.Item"),u.set_text(e[r]),t.append(u);f=this.panelRoot.select("div[id=userDescription]");f&&f.length==1&&f.set_style({display:"block"})}},v.prototype.addAnnotationControl=function(u){var nt=this,k,d,tt,p,f,s,at,y,o,ot,st,ht,ct,a,g,it,rt,lt,ut,l,w,b,ft;if(!this._annotationControlAdded){var et=this.getEntities(),e=et&&et.length&&et[0],v=this.panelRoot.select(".local-variant");if((!v||v.length===0)&&(this._state.selectedCategoryId==="House"||(e?e.getPrimaryCategoryPath()==="House"||n.enableNewActionBarButtons:!1))&&(v=this.panelRoot.select(".overlay-taskpane")),v&&v.length&&(k=v.select(".b_entityTitle"),d=k.parent(),d&&d.length&&k&&k.length?(y=document.createElement("div"),y.className="b_annotate annotate",d.insertBefore(y,k),o=document.createElement("div"),o.className="collectionsPopOut",n.enableNewActionBarButtons?(s=this.panelRoot.select(".b_actionBtns"),s&&s.length&&s.append(o)):d.insertBefore(o,k)):this._state&&(i._isHouseCategory(this._state.listingCategoryPath)||i._isHouseCategory(this._state.selectedCategoryId)||i._isHouseCategory(this._state.category)||i._isHouseCategory(this._state.searchQueryCategory))&&(tt=v.select(".b_subModule"),p=tt.select(">.b_subscomp"),p&&p.length!==0||(p=tt.select(">.b_lBottom.b_snippet")),o=document.createElement("div"),o.className="collectionsPopOut",p&&p.length>0&&tt.insertBefore(o,p))),f=this.panelRoot.select(".annotate"),n.enableNewActionBarButtons&&(!f||f.length===0)&&(s=this.panelRoot.select(".b_actionBtns"),s&&s.length&&(at=s.parent(),y=document.createElement("div"),y.className="b_annotate annotate",at.insertBefore(y,s),o=document.createElement("div"),o.className="collectionsPopOut",s.append(o),f=t(y))),ot=this.panelRoot.select(".geocoderInfoModule"),st=this.panelRoot.select(".mapsCustomInfoCard .b_entityTitle"),f&&f.length){var vt=u.originalName?u.originalName:e?e.getTitle():"",pt=u.taskTitle||vt,yt=null;u.descriptionList&&(yt=u.descriptionList[u.descriptionList.length-1]);ht=e&&e.getLocationType();ct=ht==="StreetAddress"||ht==="Other"&&(!e.id||e.id===e.getTitle());this._state.selectedCategoryId==="House"||(e?e.getPrimaryCategoryPath()==="House":!1)?f.removeFromParent():(a=new gr(this._controlTemplateFactory,this.map,ct,pt,vt,yt,h.getImpressionGuid(this.panelRoot)),this.annotationControl=a,a.annotationChanged.add(function(){var t=a.getDescription(),n=a.getCurrentName();nt._sendUpdateEntityProcessCall(n,t);nt._state.descriptionList=[t];nt._state.taskTitle=n;nt.titleChanged.invoke(n)}),g=this.panelRoot.select(".b_tp_bann"),g&&g.length&&(g.removeFromParent(),f.getParent().insertBefore(g,f)),f.append(a.getControl()),f.set_style({display:"block"}),ct&&f.add_class("address"),ot&&ot.set_style({display:"none"}),st&&st.set_style({display:"none"}),it=this.panelRoot.select("div[data-sponad]").get_attr("data-sponad")==="true",(n.enableNewActionBarButtons||it)&&(rt=this.panelRoot.select("div.b_actionBtns"),(rt&&rt.length||it)&&(lt=rt.select("#moreBtn"),(lt&&lt.length||it)&&(ut=this.panelRoot.select("[data-tag=annotateButton]"),ut&&ut.length&&ut.set_style({display:"none"})))),this._annotationControlAdded=!0);l=this.panelRoot.select(".mapActionsModule li");l&&l.length!==0||(l=this.panelRoot.select(".local-variant .b_entityTitle ~ .b_hList li"));l&&l.length>3&&(w=this.panelRoot.select(".shareAction, #shareAction"),w&&w.length>0&&(ft=w.parent(),a.addAuxillaryButton(w),ft.removeFromParent(),w.add_class("show"),w.set_attr("title",r.L_ShareTooltip)),l.length>4&&(b=this.panelRoot.select(".newCollectAction, #newCollectAction"),b&&b.length>0?(ft=b.parent(),a.addAuxillaryButton(b),ft.removeFromParent(),b.add_class("show"),b.set_attr("title",r.L_SaveTooltip)):c.isInPrivateMode&&l[l.length-1].remove()));this.panelRoot.select("#shareAction").add_class("show");this.panelRoot.select("#newCollectAction").add_class("show")}}},v.prototype.removeUpcomingEventContainer=function(){var t=this.panelRoot.select(".upcomingEvents"),n;t&&t.length&&(n=t.getParent(),n&&n.has_class("wpc_module")&&n.removeFromParent())},v.prototype.expandDetailsCard=function(){var r=this,n,i;c.isMobile&&(n=this.panelRoot.select("a[id*='expitem_']"),n&&n.length&&(n.get_attr("data-exp").length>0?n.for_each(function(n){var i=t(n);i.get_attr("data-exp").indexOf("tp_mobileexp")>=0&&r._toggleExpansion(i,!0)}):n.for_each(function(n){n.click()}),i=this.panelRoot.select("div[id='tp_mobileexp']"),i.removeFromParent()))},v.prototype._updateEntityState=function(n,t){this._isHomeOrWorkScenario(n)&&t&&this._processHomeAndWork(t)},v.prototype._parseCategoryData=function(){var t,n=this.getEntities();n&&n.length===1&&(t=n[0].getPrimaryCategoryPath(!0));this.populateCardCategoryId(t)},v.prototype.processTnAAds=function(){var n=this.panelRoot.select("[data-tag=TnA.AdsModule.Container]"),t;n&&n.length>0&&(t=h.getImpressionGuid(this.panelRoot),fi.setShownAds("AT",".maps_tna_ad_item",n,t),fi.setShownAds("DE",".maps_tna_ad_card",n,t))},v.prototype.enableAdsShownLogging=function(t){var i=this;n.adsShownLogging&&this._adsContainer&&this._adsContainer.length&&(this._logIfAdsVisible(this._adsContainer,"NotScrolled"),this._adsVisibleLogged||(t&&t.add(function(){i._logIfAdsVisible(i._adsContainer,"Scrolled")}),sj_evt.bind("customScrolled",function(n){n&&i._logIfAdsVisible(i._adsContainer,"Scrolled")})))},v.prototype.processAdvertising=function(t,i){var e,u,r,o;try{if(e=this.getEntities(),i&&wt.isEnabled()&&e&&e.length)if(u=e[0],n.newAdsClientSideCode)r=(n.adsFromBfprWorkflow||n.adsFromBmfpWorkflow)&&this.panelRoot.select("div.mapsTextAds"),r&&r.length?(o=r[0].getAttribute("data-tracingTag")==="PD"?nt.PD:this.GetDetailsScenario(t,u),at.setShownAds(o,r,h.getImpressionGuid(this.panelRoot)),this._adsContainer=r):t.useBfpr||this.requestSyndicatedAds(t,i,u);else if(n.adsFromWorkflow){var f=this.panelRoot.select("div.mapsTextAds"),s=f&&f.length&&f[0].getAttribute("data-tracingTag"),o=s==="PD"?nt.PD:this.GetDetailsScenario(t,u);at.setShownAds(o,f,h.getImpressionGuid(this.panelRoot));this._adsContainer=f}else this.requestSyndicatedAds(t,i,u)}catch(c){wt.logError(c)}},v.prototype.logInstrumentationForShoppingDataGroup=function(){var i=this.panelRoot.select("div[data-hasshoppingdatagroup]").get_attr("data-hasshoppingdatagroup")==="true",n,t;i&&(n=o.logger,n&&(t={feature:"LocalDetails",action:"local:datagroupid.shopping",data:null},n.logObject(t,h.getImpressionGuid(this.panelRoot))))},v.prototype.requestSyndicatedAds=function(t,i,r){var e,l=this.panelRoot&&this.panelRoot.select("div.adsContainer"),s=l&&l.length&&l.getParent(),f,u,p,o,a,v,h,c,y;if(s&&s.length)t&&(t.query?f=t.query:t.entryPoint==="BasemapPrimitive"&&t.scenarioKey==="MA_PNTY"&&t.id.indexOf("vdpid:")===0&&t.taskTitle&&(f=t.taskTitle),f&&(e=n.detailsMaxAdCount,e&&(i.setScenario(nt.PD),i.requestAds(this._placeAdsQuery(f),r.getLocation().clone(),e,this._taskId),s.getParent().insertBefore(i.getControl(),s)))),s.removeFromParent();else{if(p=r.getPrimaryCategoryName(),e=n.detailsMaxAdCount,(t.scenarioKey==="HS"||p==="Hotel")&&e&&(u=nt.HO),!u&&e){if(o=r.getPrimaryCategoryPath(),a=r.getLocationType(),(a==="City"||a==="Country")&&(f=this._placeAdsQuery(r.getTitle()),u=nt.PL),!u&&o&&o.length&&(v=o.split("."),v&&(h=n.catsForAdsTest,h)))for(c=0;c<h.length;c++)if(v.indexOf(h[c])>=0){u=nt.LS;break}u||t.scenarioKey!=="LS"&&t.scenarioKey!=="LLS"||o&&o.length||(u=nt.LS)}u&&(f||(f=r.getTitle()))&&(y=this.panelRoot&&this.panelRoot.select("div.tp_tasks"),y.length&&(i.setScenario(u),i.requestAds(f,r.getLocation().clone(),e,this._taskId),y.append(i.getControl())))}},v.prototype.registerNewMoreMenuEvents=function(n){var e=this,r,f,o,u;this._moreMenuListDropdownModel=new nf;this._moreMenuPopOutButtonViewModel=new uf(this._moreMenuListDropdownModel);this._moreMenuTask=n;r=this.panelRoot.select("#moreBtn");f=this.panelRoot.select(".b_icbtns");r&&r.length&&(r.set_attr("role","button"),r.set_attr("aria-expanded","false"),f&&f.length?f.append(this._moreMenuPopOutButtonViewModel.buildPopOut()):(o=this.panelRoot.select(".b_actionBtns"),o&&o.length?o.append(this._moreMenuPopOutButtonViewModel.buildPopOut()):r.append(this._moreMenuPopOutButtonViewModel.buildPopOut())),u=this,r.add_event("click",function(n){var s;if(n.preventDefault(),n.stopImmediatePropagation(),r.set_attr("aria-expanded","true"),u._moreMenuListDropdownModel.setDropdown(u._moreMenuTask.getMenuList()),u._moreMenuPopOutButtonViewModel.setDropdown(u._moreMenuListDropdownModel),u._moreMenuListDropdownModel.setButtonElement(r),u._moreMenuPopOutButtonViewModel.setIsDisplayed(!0),it.shouldIgnoreSAE){var h=u.panelRoot.select(".menuLocalFeedback"),o=h?h.parent():null,e=u.panelRoot.select(".b_feedbackComponent a");e||(e=u.panelRoot.select("#epf_infb"));o&&e&&(o.remove_attr("data-dropdown"),o.add_event("click",function(n){n.stopImmediatePropagation();e.fireEvent("click")}))}s=t(".bm_popOutContainer",f[0]);s.length>0&&i._setFocusOnFirstMenuItem(s)}),r.add_event("keydown",function(n){var f=n,o,u,r;if(f.keyCode&&f.keyCode===9&&!i._isAttractionCategory(e.getCardCategoryId())&&!f.shiftKey)for(o=t(".csrc.sc_rc1",e.panelRoot[0]),u=0;u<o.length;u++)if(r=t(o[u]).get_sibling(1,0),r.length>0&&(r[0].tagName==="a"||r[0].tagName==="A")){n.preventDefault();n.stopImmediatePropagation();r[0].removeEventListener("keydown",function(){return e._ratingKeyDownEventHandler});r[0].addEventListener("keydown",function(n){return e._ratingKeyDownEventHandler(n)});r[0].setAttribute("tabindex","0");r[0].focus();break}}))},v.prototype.registerShowAllImageEvents=function(){var n=this,i=t(".iasmtab.leftsmtab",this.panelRoot[0]);i&&i.length>0&&i.add_event("keydown",function(i){var u=i,r;u.keyCode&&u.keyCode===9&&!u.shiftKey&&(r=t(".b_mapbtns",n.panelRoot[0]).select("a"),r&&r.length>0&&(i.preventDefault(),i.stopImmediatePropagation(),r[0].removeEventListener("keydown",function(){return n._firstMapBtnKeyDownEventHandler}),r[0].addEventListener("keydown",function(t){return n._firstMapBtnKeyDownEventHandler(t)}),r[0].focus()))})},v.prototype._firstMapBtnKeyDownEventHandler=function(n){var r=n,i;r&&r.keyCode&&r.keyCode===9&&r.shiftKey&&(i=t(".iasmtab.leftsmtab",this.panelRoot[0]),i&&i.length>0&&(n.preventDefault(),n.stopImmediatePropagation(),i.set_attr("tabindex","0"),i[0].focus()))},v.prototype._ratingKeyDownEventHandler=function(n){var o=this,f=n,r,i,e,u;f.keyCode&&f.keyCode===9&&(f.shiftKey?(r=t(".b_mapbtns",this.panelRoot[0]),r&&r.length>0&&(i=r.select("a"),i.length>0&&(n.preventDefault(),n.stopImmediatePropagation(),i.set_attr("tabindex","0"),i[i.length-1].focus()))):(e=t(".b_icbtns",this.panelRoot[0]),e.length>0&&(u=e.select("a"),u.length>0&&(n.preventDefault(),n.stopImmediatePropagation(),u[0].addEventListener("keydown",function(n){var r=n,f,u,i;if(r&&r.keyCode&&r.keyCode===9&&r.shiftKey)for(f=t(".csrc.sc_rc1",o.panelRoot[0]),u=0;u<f.length;u++)if(i=t(f[u]).get_sibling(1,0),i.length>0&&(i[0].tagName==="a"||i[0].tagName==="A")){n.preventDefault();n.stopImmediatePropagation();i[0].setAttribute("tabindex","0");i[0].focus();break}}),u[0].focus()))))},v._getLocationForEntity=function(n){var t=n&&n.entity&&n.entity.getGeometry();return t?new b(t.y,t.x):null},v._getWorkHomeResourceString=function(n){var i=n.isHome,t=n.requestOptions.mode;return i?t===d.walking?r.L_TimeWalkHome_Text:r.L_TimeDriveHome_Text:t===d.walking?r.L_TimeWalkWork_Text:r.L_TimeDriveWork_Text},v.prototype._logIfAdsVisible=function(n,t){if(!this._adsVisibleLogged&&n&&n.length){var i=n[0].getBoundingClientRect();if(i){if(i.top===0&&i.bottom===0||i.height===0)return;i.top>=0&&i.bottom<=window.innerHeight&&(this._adsVisibleLogged=!0,at.logAdsShown(t))}}},v.prototype._isHomeOrWorkScenario=function(t){var i=t.select(".overlay-container").get_attr("data-answerInfo"),r=i&&parseInt(i);return r&&n.homeWorkAnswerScenarios&&n.homeWorkAnswerScenarios.indexOf(r)!==-1},v.prototype._processHomeAndWork=function(n){var r=new ui,i,t;r.getIsSignedIn()&&(i=this.map,t=this.map&&this.map.getContainer(),t&&t.instanceAsync("ItineraryDataManager",function(t){t&&t.syncFavorites(function(r){if(r===0){var u=v._getLocationForEntity(t.home),f=v._getLocationForEntity(t.work);(u||f)&&v._updateEntityWithHomeOrWorkDistance(t,n,i,h.getImpressionGuid(this.panelRoot))}})}))},v._getWaypoints=function(n,t,i,r){var u=[],e=i?n.home:n.work,f=e.entity;return u.push(new bt(f.getAddress(),t,f.getName(),!1,null,f.id,null,null,null,1,6,null)),u.push(new bt(r.getAddress(),r.getRoutableLocation()?r.getRoutableLocation():r.getLocation(),r.getTitle(),!1,null,r.id,null,null,null,2,1,null)),u},v._updateEntityWithHomeOrWorkDistance=function(t,u,o,s){s===void 0&&(s=null);var l=v._getLocationForEntity(t.home),a=v._getLocationForEntity(t.work),b=u.getRoutableLocation(),k=b?b:u.getLocation(),y=l&&or.greatCircleDistance(k,l),p=a&&or.greatCircleDistance(k,a),h,c,w;if(y&&p?(h=y<=p,c=h?y:p,w=h?l:a):y?(h=!0,c=y,w=l):p&&(h=!1,c=p,w=a),c&&c<n.maxHomeOrWorkDistanceMeters&&c>n.minHomeOrWorkDistanceMeters){var g=v._getWaypoints(t,h?l:a,h,u),nt={waypoints:g,options:{unit:tr.unit===1?rr.miles:rr.km,maxRoutes:1},mode:c<n.maxWalkingDistance?d.walking:d.driving},tt={isSummaryOnly:!0,requestOptions:nt,isHome:h,entity:u};of.downloadRoutes(tt,function(t,h,c){var l,a,y;if(c.errorCode===ef.Success&&h&&(l=h.resourceSets.length>0&&h.resourceSets[0]&&h.resourceSets[0].resources&&h.resourceSets[0].resources[0],l)){var p=new ku,w=v._getWorkHomeResourceString(t),b=l.travelDurationTraffic<=n.minTimeThreshold*60?i._formatString(r.L_TimeDurationLessThan_Text,n.minTimeThreshold):p.getDurationString(l.travelDurationTraffic);u.subtitle=w.replace("{0}",b);u instanceof ur&&u.setRouteRequestState(t);a=o&&o.getFrameManager();a&&a.hackHackSetFrame();y={logData:{feature:"DC",action:"HWSHOW",data:{HW:t.isHome?"H":"W"}},impressionGuid:s};e.invokeHandler(f.instrumentationDataHandlerKey,y)}})}},v.prototype.GetDetailsScenario=function(n,t){if(n.scenarioKey==="HS"||t.getPrimaryCategoryName()==="Hotel")return nt.HO;var i=t.getLocationType();return i==="City"||i==="Country"?nt.PL:n.scenarioKey==="LS"||n.scenarioKey==="LLS"?nt.LS:n.scenarioKey==="EAIA"||t.mainSegmentType==="Events"?nt.EV:nt.DE},v.prototype.getDetailsHtmlContentForPrint=function(n){var t=this,f=this.annotationControl&&this.annotationControl.getOriginalName(),e=this.annotationControl&&this.annotationControl.getDescription(),i,u,r;return this.printTitleViewModel=new lu(this.map,this._controlTemplateFactory,this.getEntities(),n,f),this.notesMaxCharSize=cr.notesMaxChars,i={boolToDisplay:function(n){return t.boolToDisplay(n)},nullToDisplayNone:function(n){return t.nullToDisplayNone(n)},hideIfMatchedData:function(n){return t.hideIfMatchedData(n)},emptyToDisplayNone:function(n){return t.emptyToDisplayNone(n)}},this.titlePrintTemplate=new dt(wi,i),u=this._controlTemplateFactory({templateText:pr,staticResources:i}),this.printNotes=e||"",r=u.applyDataTemplate(this),r.length>0?r[0].outerHTML:""},v.prototype.hideIfMatchedData=function(n){var t=this.getEntities()&&this.getEntities()[0]&&this.getEntities()[0].getSegmentTypes()?this.getEntities()[0].getSegmentTypes()[0].toLowerCase():"";return n===null||this.getEntities()[0].getTitle()===n||t==="house"?"none":""},v.prototype.prepareMenuModule=function(){var t=this.panelRoot.select("div[data-tabcontrolid]").get_attr("data-tabcontrolid"),n;t&&(n=this.panelRoot.select("#"+t+"_menu"),n&&n.length&&(this._prepareTabs(n[0],t),Microsoft.Maps.setTimeout(function(){sj_evt.fire("tab_init",tabcontrol)},10)))},v.prototype.prepareReviewsAccordionModule=function(n){var i=this.panelRoot.select("div[class=revacc]"),t,r;i&&i.length&&(t=i.select("div[class=acc-header]"),t&&t.length&&t[0].children&&t[0].children.length&&sj_evt.bind("accordion_item_click",n,1),r=i.select("a[id*='expitem_']"),r&&r.length&&r.for_each(function(t){t.addEventListener("click",function(){n&&n()})}),Microsoft.Maps.setTimeout(function(){sj_evt.fire("accordion_init",AccordionControl)},10))},v.prototype.addRecommendationModuleHover=function(n){var i=this,u=this.panelRoot.select("div.EntityCollectionModuleContainer"),r=1;u.for_each(function(u){var l=u.getAttribute("data-entitylist"),e,o;if(l&&(e=t.Internals.parseJSON(l),e&&e.length>0)){for(var s=r,h=r+e.length-1,f=u.parentElement,a=0,c=!1;f&&a<5;){if(c=f&&f.className&&f.className.indexOf("wpc_module")>-1?!0:!1,c)break;++a;f=f.parentElement}c?(f.addEventListener("mouseenter",function(){i._onRecommendationModuleHover(n,s,h,!0)}),f.addEventListener("mouseleave",function(){i._onRecommendationModuleHover(n,s,h,!1)})):(u.addEventListener("mouseenter",function(){i._onRecommendationModuleHover(n,s,h,!0)}),u.addEventListener("mouseleave",function(){i._onRecommendationModuleHover(n,s,h,!1)}));o=t(u).select("li");o&&o.length&&o.length==e.length?o.for_each(function(t){var u=r++;t.addEventListener("mouseenter",function(){i._onRecommendationModuleItemHover(n,u,!0)});t.addEventListener("mouseleave",function(){i._onRecommendationModuleItemHover(n,u,!1)})}):r+=e.length}})},v.prototype.edgeRecoModuleFix=function(){var n=this.panelRoot.select("div.wpc_module.sb_meta");n&&n.length&&n.for_each(function(n){n.setAttribute("style","outline: 1px solid transparent")})},v.prototype.handleVenueMapClick=function(){var n={};n.type=s.venueMapDirectoryTask;n.action="activate";n.activateOptions={};n.activateOptions.activationState=1;var i={},r=this.panelRoot.select("div.overlay-taskpane.local-taskpane"),u=r.get_attr("data-venues"),t=JSON.parse(u);t.venueMapInfo&&t.venueMapInfo[0]&&t.venueMapInfo[0].id&&(i.venueMapId=t.venueMapInfo[0].id,i.venueMapType=t.venueMapInfo[0].mapType,i.title=this._state.taskTitle||"",n.state=i,e.invokeHandler(f.taskDataHandlerKey,n))},v.prototype._onRecommendationModuleItemHover=function(n,t,i){if(n&&this._pushpins&&this._pushpins.length&&t<this._pushpins.length){var r=this._pushpins[t];r.viewState=i?1:0;r.zIndex=i?2:0;n.setPrimitives(this._pushpins,!0)}},v.prototype._onRecommendationModuleHover=function(n,t,i,r){if(n&&this._pushpins&&this._pushpins.length&&t<this._pushpins.length&&i<this._pushpins.length){for(var u=t;u<=i;++u)this._pushpins[u].viewState=r?0:3,!r&&n._primitives&&n._primitives.length&&u<n._primitives.length&&n._primitives[u].bucket&&delete n._primitives[u].bucket;n.disableComputingMapViewForFirstTimeLoad=!0;r?n.setPrimitives(this._pushpins,!0):n.setPrimitives([this._pushpins[0]],!0)}},v.prototype._addOutingsEventHandlers=function(){var n=this.panelRoot.select(".articleList a.articleCard"),s,i,o,r;n&&n.length!==0||(n=this.panelRoot.select(".bm_outingsModule a"));n&&n.length>0&&(s=this._buildLogData("C",{AN:"MapsModule.OutingsLink",EP:u.LocalDetails}),n.for_each(function(n){n.addEventListener("click",function(){e.invokeHandler(f.instrumentationDataHandlerKey,s)})}));i=this.panelRoot.select(".articleList .b_module_expansion .b_expand");i&&i.length>0&&(o=this._buildLogData("C",{AN:"MapsModule.OutingsExpansion",EP:u.LocalDetails}),i[0].addEventListener("click",function(){e.invokeHandler(f.instrumentationDataHandlerKey,o)}),i[0].addEventListener("keydown",function(n){if(n.keyCode&&n.keyCode===13){var i=n.currentTarget;i&&i.nextElementSibling&&Microsoft.Maps.setTimeout(function(){var n=t(".articleList .b_module_expansion .b_collapse");n.length>0&&(n[0].setAttribute("tabindex","1"),n[0].focus(),n[0].setAttribute("tabindex","0"))},500);e.invokeHandler(f.instrumentationDataHandlerKey,o)}}));r=this.panelRoot.select(".articleList .b_module_expansion .b_collapse");r&&r.length>0&&r[0].addEventListener("keydown",function(n){if(n.keyCode&&n.keyCode===13){var i=n.currentTarget;i&&i.previousElementSibling&&Microsoft.Maps.setTimeout(function(){var n=t(".articleList .b_module_expansion .b_expand");n.length>0&&(n[0].setAttribute("tabindex","1"),n[0].focus(),n[0].setAttribute("tabindex","0"))},500)}})},v.prototype._addModulesInstrumentation=function(n,i){var nt=this,b=this.panelRoot.select("div[data-suppressed]"),v,y,p,w,a,c,s,l,o,h,tt,k,it,r,d,rt,g;if(b&&b.length&&(v=b[0].getAttribute("data-suppressed"),v&&v.length&&(c=this._buildLogData("R",{AN:"Suppressed",EP:u.LocalDetails,DAT:v}),c.impressionGuid=this._state.impressionGuid,e.invokeHandler(f.instrumentationDataHandlerKey,c))),y=this.panelRoot.select("div[data-umodules]"),y&&y.length&&(p=y[0].getAttribute("data-umodules"),p&&p.length&&this._state&&(w={moduleKeys:p,query:this._state.query,id:"",title:""},a=this.getEntities&&this.getEntities(),a&&a.length&&(w.id=a[0].id,w.title=a[0].getTitle()),c=this._buildLogData("UM",{AN:"UnrecognizedModules",EP:u.LocalDetails,DAT:t.Internals.stringify(w)}),c.impressionGuid=this._state.impressionGuid,e.invokeHandler(f.instrumentationDataHandlerKey,c))),s=this.panelRoot.select("div[data-moduletag]"),s&&s.length)for(l=0;l<s.length;l++)o=s[l].getAttribute("data-moduletag"),o&&(h=s[l].getAttribute("data-entitymetadata"),h&&h.length&&(i[o]=h),tt=t(s[l]),k=tt.select("a[href]"),k&&k.for_each(function(i){var e="",s="",c,f,r,l;try{c=i.getAttribute("data-process");c&&(f=JSON.parse(c),f&&f.requestState&&(r=f.requestState,r.title&&(s=r.title),r.entityId&&(e=r.entityId)))}catch(a){}l=h&&h.length?nt._buildLogData("C",{AN:o,EP:u.LocalDetails,ID:e,Name:s,DAT:h}):nt._buildLogData("C",{AN:o,EP:u.LocalDetails,ID:e,Name:s});i.setAttribute("data-instrumentation",t.Internals.stringify(l));o in n?n[o]+=1:n[o]=1}));it=["MapsModule.PointsOfInterest","MapsModule.PeopleAlsoSearchedFor","MapsModule.FoundAtThisAddress","MapsModule.FoundNearThisAddress","MapsModule.EatAndDrink","MapsModule.ThingsToDo","MapsModule.WhereToStay","MapsModule.PlaceNearby","MapsModule.PlaceToGo","MapsModule.Events","MapsModule.EventsAtVenue"];for(r in n)n.hasOwnProperty(r)&&n[r]&&(d=it.indexOf(r)>-1?Math.floor(n[r]/2):n[r],g=i[r],rt=g?this._buildLogData("I",{AN:r,EP:u.LocalDetails,CNT:d,DAT:g}):this._buildLogData("I",{AN:r,EP:u.LocalDetails,CNT:d}),e.invokeHandler(f.instrumentationDataHandlerKey,rt))},v.prototype._prepareTabs=function(n,t){for(var r,i,u,f,h,e,o=this,s=0;s<n.children.length;s++)r=n.children[s],i=r.getAttribute("data-content"),i&&(u=this.panelRoot.select("#"+i),u&&u.length&&(r.setAttribute("data-content",i+"_"+t),u[0].id=i+"_"+t)),r.addEventListener("click",function(){o._menuModuleClicked("TabClick")});f=this.panelRoot.select("div[data-tabcontrolid]");f&&(h=["_navl","_navr"],h.forEach(function(n){var i=f.select("#"+t+n);i&&i.length&&i[0].addEventListener("click",function(){o._menuModuleClicked("NavClick")})}),e=f.select("a[class=b_moreLink]"),e&&e.length&&e[0].addEventListener("click",function(){o._menuModuleClicked("MenuLinkClick")}))},v.prototype._menuModuleClicked=function(n){var t=this._buildLogData("C",{AN:"RestaurantMenu",EP:u.LocalDetails,DT:n});e.invokeHandler(f.instrumentationDataHandlerKey,t)},v.prototype._shareButtonClicked=function(n,t,i){n&&n.preventDefault();e.invokeHandler(f.shareDataHandlerKey,{action:"shareTasks",taskIds:[i],entryPoint:u.LocalDetails});e.invokeHandler(f.instrumentationDataHandlerKey,t)},v.prototype._addAttractionButtonClicked=function(n,t){n&&n.preventDefault();var i=this.getEntities()[0],r=ei.getItineraryAddItemOptions(i.getTitle(),i.getLocation(),i.id,i.getImageUrl(),t,i.getSelectedCategoryForIcon(),i.interests,i.stayDuration);e.invokeHandler(f.taskProcessDataHandlerKey,r)},v.prototype._setPhotoStripWidth=function(n){var i,t,r,u;if(n.PhotostripItems&&n.PhotostripItems.length){for(this._photostripTotalWidth=0,i=n.PhotostripItems.length,t=0;t<i;t++)r=n.PhotostripItems[t],this._photostripTotalWidth+=r.IsPano?v._photoWidth*2:v._photoWidth;u=this.panelRoot.select("ul.photostrip");u.set_style({width:this._photostripTotalWidth+"px"})}},v.prototype._slidePhotstripLeft=function(n,t,i){if(t<0){var r=i*++t;n.set_style({left:r+"px"})}return t},v.prototype._slidePhotstripRight=function(n,t,i){var r,u,f;return t<=0&&(r=i*(t-1),this._photostripTotalWidth>Math.abs(r)&&(u=Math.floor(v._photostripVisibleWidth/v._photoWidth),f=(this._photostripTotalWidth-Math.abs(r))/v._photoWidth,f>u?n.set_style({left:r+"px"}):(r=r+(v._photostripVisibleWidth-(this._photostripTotalWidth-Math.abs(r))),n.set_style({left:r+"px"})),--t)),t},v.prototype._showImageInModalDialog=function(n){if(n){var t=v._imgModalDialogContentTemplate.replace("{imgSrc}",n.imgsrc).replace("{imgAttrb}",n.imgattrb).replace("{providerLink}",n.providerlink).replace("{providerLinkText}",n.providerlinktext),i=new rf(t,"bigImgDialog");i.OpenDialog()}},v.prototype._registerPhotostripEvents=function(){var n=this,r=this.panelRoot.select("ul.photostrip"),e=v._photoWidth*3,i=0,o=this.panelRoot.select("div.mapsPhotostrip .psnav.prev"),s=function(t){i=n._slidePhotstripLeft(r,i,e);t.preventDefault()},u,f,h;o.add_event("click",s);this._addEventsToEventList(o,"click",s);u=this.panelRoot.select("div.mapsPhotostrip .psnav.next");f=function(t){i=n._slidePhotstripRight(r,i,e);t.preventDefault()};u.add_event("click",f);this._addEventsToEventList(u,"click",f);h=r.select("a.thumb[data-imgsrc]");h.for_each(function(i){var r=t(i),f=t.Internals.parseJSON(r.get_attr("data-imgsrc")),u=function(t){n._showImageInModalDialog(f);t.preventDefault()};r.add_event("click",u);n._addEventsToEventList(r,"click",u)})},v.prototype._parseBoundingBox=function(n){var f=n.select("div[data-boundingbox]").get_attr("data-boundingbox"),r=f&&t.Internals.parseJSON(f),u,i;return r&&r.boundingBox&&r.boundingBox.length>1?(u=[],i=r.boundingBox[0],u.push(new b(i.latitude,i.longitude)),i=r.boundingBox[1],u.push(new b(i.latitude,i.longitude)),u):null},v.prototype._buildLogData=function(n,t){return{logData:{feature:"DC",action:n,data:t},impressionGuid:h.getImpressionGuid(this.panelRoot)}},v.prototype._logAction=function(n){var t={AN:n};this._logHelper&&this._logHelper.log(p.LDA,t)},v.prototype._loadJavaScriptInResponse=function(n){n.select("div[data-answerinfo]").length>0&&n.select("script").for_each(function(n){var i=n.textContent,t;v._detailsPageScripts[i]||(t=document.createElement("script"),t.type="text/javascript",t.textContent=i,document.head.appendChild(t),v._detailsPageScripts[i]=t)})},v.prototype._moduleHeaderClickHander=function(n){var t,i;n&&n[1]&&n[2]&&(t=n[1].nextElementSibling,t&&(i=_w.getComputedStyle(t,null).display==="none",t.style.display=i?"block":"none",Log.Log(i?"Show":"Hide","TaskPane",n[2],!1)))},v.prototype._searchLocatedAtHandler=function(n){if(n&&n[1]){var t={query:n[1],fullQuery:n[1],entryPoint:u.LocalDetails};n[2]&&(t.filterUrlParam='local_ypid:"'+n[2]+'"');e.invokeHandler(f.taskProcessDataHandlerKey,{requestState:t,type:s.localSearchTask})}},v.prototype._toggleExpansion=function(n,t){var o=t?"id":"data-expe",i=n.get_attr(o),u,f,e,r;if(i.indexOf("txt")==0)i=i.substr(3);else if(i.lastIndexOf("_hit")==i.length-4)i=i.substr(0,i.length-4);else return;u=this.panelRoot.select("[data-exp=H;"+i+";;;;]");u&&(t?u.remove_class("b_hide"):u.add_class("b_hide"));f=this.panelRoot.select("[id=txt"+i+"]");f&&(t?f.add_class("b_hide"):f.remove_class("b_hide"));e=this.panelRoot.select("[id="+i+"_hit]");e&&(t?e.add_class("b_hide"):e.remove_class("b_hide"));r=this.panelRoot.select("[data-expid="+i+"]");r&&r.has_class("tp_collapsed")&&(t?r.remove_class("tp_collapsed"):r.add_class("tp_collapsed"))},v.prototype._getReservertionForm=function(n){for(var t=n.parent(),i=null,r=0;r<5;r++){if(t&&t[0]&&t[0].tagName=="FORM"){i=t;break}t=t.parent()}return i},v.prototype._addSuggestionsToNearbyModule=function(n){var u=this,v=this.getEntities(),y=v&&v[0],s=!0,t=a.prototype.parseSuggestionMetaData.call(this),o,p,i,l,r;t||(s=!1,t=this._searchNearbyDefaultCategories);o=[];t.forEach(function(n){o.push(n.Name)});p=c.features;i=this.panelRoot.select("a[class=searchNearbySearchLink]");i&&i.length===1&&(l=function(i){return u._nearbySearchLinkClickHandler(i,n,o,t&&t.length?t[0].viewport:null)},i.add_event("click",l),this._addEventsToEventList(i,"click",l),i.add_class("xsrIcon"));r=this.panelRoot.select("ul[class=searchNearbyModule]");this.selectorReady().then(function(i){var l,c,a;r&&r.length===1&&(l="searchNearbyModuleIcon searchNearbyWithLabels",r.set_attr("class",l),t.forEach(function(t){var f=u._drawCategoryItem(i,t,"SearchNearbySuggestionLink",function(i){return u._nearbySuggestionClickHandler(i,n,s,y,t.viewport)});f&&r.append(f)}),c=u.panelRoot.select("li.searchNearbySearchButton"),c&&c.length===1&&(c.removeFromParent(),r.append(c)),a={logData:{feature:"NBS",action:"A",data:{CAT:o.join(","),DY:s}},impressionGuid:h.getImpressionGuid(u.panelRoot)},e&&e.invokeHandler(f.instrumentationDataHandlerKey,a))})},v.prototype._nearbySearchLinkClickHandler=function(t,i,o,s){var h,l;this._nearbyButton.set_attr("aria-expanded","true");h=this._getMapBounds(s);l=this._buildLogData("C",{AN:"SearchNearby",CP:i,EP:u.LocalDetails,DT:"SearchLink"});t&&t.preventDefault();e.invokeHandler(f.instrumentationDataHandlerKey,l);h||ft.setMapCenter(this.map,i,n.searchNearbyDefaultZoomLevel);var c=this.getEntities()[0],a=c&&c.getTitle()||"",v=r.L_SearchNearbyGhostTextFormat.replace("{query}",a);this._taskBar&&this._taskBar.setSearchBoxGhostText(v);this._taskBar&&this._taskBar.setNearbyLocationTitle(c.getTitle());o&&this._taskBar.updateSearchBoxAutosuggestDefault(o,h,null,null,null,ot.nearbyButtonEnabled)},v.prototype._nearbySuggestionClickHandler=function(t,i,o,h,l){var d=h&&h.getAddress(),g=h&&h.getTitle()||d,a,v,w,b,y,p,k;if(t&&t.target){for(a=t.target;a.parentNode;){if(a.nodeName.toLowerCase()==="a")break;a=a.parentNode}if((t.stopPropagation(),t.preventDefault(),a)&&(v=a.getAttribute("aria-label"),v)){if(w=o?"SuggestionLinkDynamic.":"SuggestionLink.",b=this._buildLogData("C",{AN:"SearchNearby",CP:i,EP:u.LocalDetails,DT:w+v}),e.invokeHandler(f.instrumentationDataHandlerKey,b),(!l||l.length<2)&&ft.setMapCenter(this.map,i,n.searchNearbyDefaultZoomLevel),y={},y.entryPoint=u.LocalDetails,y.query=v,y.mapBounds=this._getMapBounds(l),p=c.features,v===r.L_SearchNearbyTerm_7&&p&&p.transit&&p.transit.isEnabled){k={location:i,title:g,entryPoint:1};e.invokeHandler(f.taskDataHandlerKey,{state:k,type:s.nearbyTransitTask});return}e.invokeHandler(f.taskProcessDataHandlerKey,{requestState:y,type:s.localSearchTask})}}},v.prototype._getMapBounds=function(n){if(n&&n.length>1&&!isNaN(n[0].latitude)&&!isNaN(n[0].longitude)&&!isNaN(n[1].latitude)&&!isNaN(n[1].longitude)){var t=[];return t.push(Math.max(n[0].latitude,n[1].latitude)),t.push(Math.min(n[0].longitude,n[1].longitude)),t.push(Math.min(n[0].latitude,n[1].latitude)),t.push(Math.max(n[0].longitude,n[1].longitude)),t}return null},v.prototype._setLocalCrowdSourcingTaskOptions=function(n){var f=this,e=this.getEntities(),i=e&&e[0],t={},h;t.entityName=i.getTitle();t.entityYpid=i.id;var r=null,u=null,o=this.panelRoot.select("div.overlay-taskpane").get_attr("data-facts"),s=this.panelRoot.select("div.overlay-taskpane").get_attr("data-ufacts");if(o){try{r=JSON.parse(o)}catch(c){}r&&(t.dataFacts=r)}if(s){try{u=JSON.parse(s)}catch(c){}u&&(t.userFacts=u)}t.query=i.getTitle();t.reportType=4;h=function(n){f._onLocalCrowdSourcingLinkClick(n,f._taskId,i.getTitle(),t)};n.href="#";n.onclick=h},v.prototype._onLocalCrowdSourcingLinkClick=function(n,t,i,u){n.preventDefault();e.invokeHandler(f.taskDataHandlerKey,{type:s.feedbackTask,activateOptions:{parentId:t},state:{entryPoint:3,feedbackTaskType:7,title:r.L_RichAttributeFeedbackTitle,activeTaskId:t,options:u}})},v.prototype._setLocalFeedbackTaskOptions=function(n){var e=this,o=this.getEntities(),u=o&&o[0],t,c;if(u){t={};t.entityName=u.getTitle();t.entityYpid=u.id;var i=null,f=null,s=this.panelRoot.select("div.overlay-taskpane").get_attr("data-facts"),h=this.panelRoot.select("div.overlay-taskpane").get_attr("data-ufacts");if(s){try{i=JSON.parse(s)}catch(l){}i&&(t.dataFacts=i)}if(h){try{f=JSON.parse(h)}catch(l){}f&&(t.userFacts=f,i&&i.feedbackMetaData&&i.feedbackMetaData.isTestingLocation==="true"&&(t.userFacts.isTestingLocation="true"))}t.query=u.getTitle();t.reportType=4;c=function(n){e._onSuggestAnEditLinkClick(n,e._taskId,u.getTitle(),t)};n.text=r.L_Menu_SuggestAnEdit_Link_Text;n.href="#";n.onclick=c}},v.prototype._onSuggestAnEditLinkClick=function(n,t,i,u){n.preventDefault();e.invokeHandler(f.taskDataHandlerKey,{type:s.feedbackTask,activateOptions:{parentId:t},state:{entryPoint:3,feedbackTaskType:4,title:r.L_Menu_SuggestAnEdit_Link_Text+" - "+i,activeTaskId:t,options:u}})},v.prototype._shouldEnableSuggestAnEdit=function(){var n=null,t=null,i=this.panelRoot.select("div.overlay-taskpane").get_attr("data-facts"),r,u;if(i)try{n=JSON.parse(i)}catch(f){}return(n&&n.languageCultureName&&(t=n.languageCultureName),r=it.ftwMarkets,u=new RegExp(t,"i"),r.search(u)>=0)?!0:!1},v.prototype._placeAdsQuery=function(n){var i=2,t=-1;do t=n.indexOf(",",t+1);while(t>=0&&--i);return!i&&t>0&&(n=n.substring(0,t)),n},v.prototype._getAttribution=function(){var n=this.panelRoot.select("div[class*='b_footnote']");return n&&n.length>0?n[0].innerText:""},v.prototype._sendUpdateEntityProcessCall=function(n,t){var r,u,i;(this.savedEntityId||this.collectionId)&&(r={action:pt.UpdateEntity,data:{description:t,title:n},entityId:this.savedEntityId,collectionId:this.collectionId},i={type:s.collectionsTask,requestorType:"LocalDetailsTask",requestorId:this._taskId,requestState:r},e.invokeHandler(f.taskProcessDataHandlerKey,i));this.itineraryTaskId&&(u={action:4,itineraryItemChanged:{Description:t,Name:n,Id:this.itineraryEntityId}},i={type:s.itineraryDetailsTask,requestorType:"LocalDetailsTask",requestorId:this._taskId,requestState:u,taskId:this.itineraryTaskId},e.invokeHandler(f.taskProcessDataHandlerKey,i))},v.prototype._collectionClick=function(n,t,i,r,u){this.annotationControl&&(this._buttonGroupViewModel.entityDescription=this.annotationControl.getDescription(),this.annotationControl.getCurrentName()!==this.annotationControl.getOriginalName()&&(this._buttonGroupViewModel.entityNickName=this.annotationControl.getCurrentName(),this._buttonGroupViewModel.entityOriginalName=this.annotationControl.getOriginalName()));u?ti.isEditable?this._buttonGroupViewModel.saveWithTravelButtonClicked(n,t,i,r,!0):this._buttonGroupViewModel.collectionMenuButtonClicked(n,t,i,r):this._buttonGroupViewModel.collectionButtonClicked(n,t,i,r)},v.prototype._registerBrowseProductsClick=function(n,t){var s=this,f=n.select(".shoppingButton"),r=n.select(".shoppingButton a"),u,o;if(f&&f.length===1&&r&&r.length===1){var i=f[0],l=i.getAttribute("data-browseProductUrl"),a=i.getAttribute("data-productSearchUrl"),v=i.getAttribute("data-autosuggestEndPoint"),y=i.getAttribute("data-retailer"),e=this.getEntities(),c="";e&&e.length>0&&(c=e[0].getTitle());u=t&&t.productRootKeyword;u||(u=i.getAttribute("data-productRootKeyword"));o=function(n){n.stopImmediatePropagation();n.preventDefault();s.launchOverflowTask.invoke({title:y||c,loadingUrl:l,productSearchUrl:a,autosuggestEndpoint:v,entryPoint:1,productRootKeyword:u,impressionGuid:h.getImpressionGuid(s.panelRoot)})};r.add_event("click",o);this._addEventsToEventList(r,"click",o)}},v._detailsPageScripts={},v._photostripVisibleWidth=310,v._photoWidth=82,v._imgModalDialogContentTemplate='<div class="bigImg"><p>{imgAttrb}<\/p><div><img src="{imgSrc}" /><\/div><p><a href="{providerLink}">{providerLinkText}<\/a><\/p><\/div>',v._externalLinkAttrNameWithHash="#data-extlink",v}(ru),gf=function(){function n(){this._skeletonCardBuffer=32;this._rightLaneSkeletonBufferAdjustment=4}return n.getInstance=function(){return n._instance||(n._instance=new n),n._instance},n.prototype.initialize=function(n){var t=this;this._initialized||(n&&n.getContainer().instanceAsync("TaskManager",function(n){t._taskManager=n},null,!0),this._activeTasksList=[],this._initialized=!0)},n.prototype.showOrHideSearchCardPrimer=function(r,u,f,e){var st=t(".taskLayoutContainer.bm_l2NavLeft"),b=t(".taskLayoutContainer.bm_l2NavLeft .bm_scrollbarMask .cardWrapper.expand"),g=t(".taskLayoutContainer.bm_l2NavLeft .bm_scrollbarMask .taskCard"),o=t(".bm_loadSkeleton.taskLayoutSkeletonContainer.bm_l2NavLeft"),h=o.select(".bm_skCombinedWrapper"),y=h&&h.length>0&&h.has_class("bm_skSlideCard"),p=h.select(".bm_cardWrapper.bm_skeletonResults"),nt=h.select(".bm_cardWrapper.bm_skeletonDetails"),it=h.select(".bm_cardWrapper.bm_skeletonResults .contentRoot"),ri=h.select(".bm_cardWrapper.bm_skeletonDetails .contentRoot"),w=!i._getIsSlideCardEnabled(),s=this._taskManager&&this._taskManager.getFocusedStack(),k=i.getVerticalTaskBarWidth(),ht=!(s&&s.getAllTasks().length>0),ct=this._getClickSourceInfo(f,s),lt=ct.isListingClick,at=ct.newParent,vt=ot.suppressSkeleton&&o.has_class("bm_suppressSkeleton"),yt=0,pt,d,wt,v,bt,ut,ti,kt,tt,l,ft,dt,gt,a,ii,ni,c,et;if(o.remove_class("bm_hideSkeleton"),pt=o.length>0&&o.select(".contentRoot"),pt&&pt.length!==0)if(r){if(vt){this._activeTasksList.push(u);return}if(!this._isEligibleForSkeleton(u,f,e))return;d=this._getSkeletonTemplate(u,f);d&&d.template===si&&this._updateSkeletonTemplateForLazyLoad(d);wt=d.template;v=d.width;yt=v;bt=!0;w&&!h.has_class("bm_skFlipCard")&&h.add_class("bm_skFlipCard");u instanceof rt?(l=h.select(".bm_cardWrapper.bm_skeletonDetails .contentRoot"),this._clearDivContents(l),l.appendHTML(wt),ut=v+this._skeletonCardBuffer,l.set_style({width:ut+"px"}),nt.set_style({display:""}),(y||at)&&!w?nt.add_class("bm_rightLaneSkeleton"):p.set_style({display:"none"}),o.set_style({left:k+"px"}),lt?i._getIsSlideCardEnabled()?(ht?o.set_style({left:k+"px"}):(ft=s&&this._getCardForTask(s.getFirstTask().id,g),c=this._getPanelWrapperParentForCard(ft),c&&(ti=c.get_size().width+k-2,i.isSlideOutCard(s)&&s.getFirstTask()!==s.getForegroundTask()&&(a=this._getCardForTask(s.getForegroundTask().id,g),a&&a.getParent().set_style({display:"none"})),at?(kt=this._taskManager.getTaskById(ct.parentId),tt=this._getSkeletonTemplate(kt,{requestState:kt._getTaskState()}),this._clearDivContents(it),it.appendHTML(tt.template),it.set_style({width:tt.width+this._skeletonCardBuffer-this._rightLaneSkeletonBufferAdjustment+"px"}),o.set_style({width:tt.width+v+this._skeletonCardBuffer*2-this._rightLaneSkeletonBufferAdjustment+"px"}),p.set_style({display:""}),yt=tt.width):(o.set_style({left:ti+"px"}),l.set_style({width:ut-this._rightLaneSkeletonBufferAdjustment+"px"}),nt.add_class("bm_rightLaneSkeleton")))),bt=!1):o.set_style({left:k+"px"}):y&&!w&&l.set_style({width:ut-this._rightLaneSkeletonBufferAdjustment+"px"})):y&&w||(l=h.select(".bm_cardWrapper.bm_skeletonResults .contentRoot"),this._clearDivContents(l),l.appendHTML(wt),l.set_style({width:v+this._skeletonCardBuffer+"px"}),p.set_style({display:""}),v>n.RegularListingCardLaneWidth&&p.add_class("bm_wideSearchCard"),y||nt.set_style({display:"none"}),o.set_style({left:k+"px"}));this._activeTasksList.push(u);lt||ht||(ft=s&&this._getCardForTask(s.getFirstTask().id,g),c=this._getPanelWrapperParentForCard(ft),c&&c.set_style({width:v+"px"}),i.isSlideOutCard(s)&&(a=this._getCardForTask(s.getForegroundTask().id,g),a&&a.getParent().set_style({display:"none"})));o.set_style({display:"block"});i._setPercievedLoadSkeletonShown(!0);bt&&st.set_style({width:v+"px"});dt=u instanceof rt;dt&&(!dt||y||lt)?(at||w)&&sj_evt.fire("CardResize",yt,!0):sj_evt.fire("CardResize",v,!0)}else{if(this._activeTasksList.indexOf(u)<0)return;vt||(gt=w&&y&&!(u instanceof rt),gt||st.set_style({width:""}),b&&b.length>0&&(c=this._getPanelWrapperParentForCard(b),!gt&&c&&c.set_style({width:""}),i.isSlideOutCard(s)&&(st.set_style({width:""}),a=!ht&&this._getCardForTask(s.getForegroundTask().id,g),a&&(a.getParent().set_style({display:""}),a.remove_class("hidden")))),!y||u instanceof rt||w||(ii=p.get_size().width,p.set_style({display:"none"}),o.set_style({left:ii+k-4+"px"})),u instanceof rt||p.remove_class("bm_wideSearchCard"));ni=this._activeTasksList.indexOf(u);ni>-1&&this._activeTasksList.splice(ni,1);this._activeTasksList.length===0&&(vt?o.remove_class("bm_suppressSkeleton"):(c=this._getPanelWrapperParentForCard(b),b&&b.length>0&&c&&c.set_style({width:""}),o.set_style({display:"none",left:""}),nt.remove_class("bm_rightLaneSkeleton"),h.remove_class("bm_skFlipCard"),i._setPercievedLoadSkeletonShown(!1),et={width:""},it.set_style(et),ri.set_style(et),o.set_style(et),o.select(".bm_skCombinedWrapper").remove_class("bm_skSlideCard").remove_class("bm_skFlipCard")))}},n.prototype._getPanelWrapperParentForCard=function(n){for(var t=n;t!==null&&!t.has_class("panelWrapper")&&t.length!==0&&t.getParent()!==t;)t=t.getParent();return t},n.prototype._isEligibleForSkeleton=function(n,i,r){var u,e,f;if(!this._needsCardPrimer(i,n))return!1;if(u=r||n.displayState,u){if(u.prominence!==1||u.isHidden)return!1;(u.activationState===1&&u.stackOrder===2||u.activationState===2&&u.stackOrder===1)&&(e=t(".bm_loadSkeleton.taskLayoutSkeletonContainer.bm_l2NavLeft"),f=e.select(".bm_skCombinedWrapper"),f.has_class("bm_skSlideCard")||f.has_class("bm_skSlideCard"))}return!0},n.prototype._getEntryPoint=function(n){return n&&n.requestState?n.requestState.entryPoint:null},n.prototype._needsCardPrimer=function(n,t){var i=!0,r=this._getEntryPoint(n);if(r){switch(r){case u.Collections:case u.DirectionsRouteList:case u.Feedback:case u.ItineraryDetails:case u.ItineraryListings:case u.MapsTour:case u.MobileListMap:case u.MyPlacesNew:case u.TransitLine:case u.TransitStop:case u.TravelL2:case u.VenueMap:case u.DirectionsWaypointSearch:i=!1}r===u.LocalDetails&&t instanceof uu&&(i=!1);r===u.LocalGuide&&n.requestState&&n.requestState.parentTaskId&&(i=!1)}return i},n.prototype._getClickSourceInfo=function(n,t){var f=!1,e=!1,o=n&&n.requestState&&n.requestState,r=o&&o.parentTaskId,i=this._getEntryPoint(n);if(i===u.LocalListing||i===u.LocalListingAlongRoute)f=!0,e=!1;else if((i===u.Infobox||i===u.LayerManager)&&t){var s=t.getFirstTask(),h=t.getForegroundTask(),c=s&&s.id===r,l=h&&h.id===r;e=!(c||l);(i===u.Infobox&&r||i===u.LayerManager&&o.listingTaskId)&&(f=!0)}return{isListingClick:f,newParent:e,parentId:r}},n.prototype._getSkeletonTemplate=function(t,i){if(!t)return null;var u=i&&i.requestState,f=t.getRecommendedWidth(),r={template:si,width:f?f:ot.defaultSkeletonWidth};if(t instanceof rt||!(t instanceof ut)&&this._isIdBasedLookup(u)?(r.template=wr,r.width=n.RegularDetailsCardLaneWidth):t instanceof ut&&(t instanceof ki||t instanceof di||this._isRestaurantCategoryQuery(t,u)?(r.template=br,r.width=this._getWiderListingCardWidth(u,t)):(r.template=si,r.width=ot.defaultSkeletonWidth)),u&&!(t instanceof rt))switch(u.searchQueryCategory){case"Attraction":r.template=br;r.width=this._getWiderListingCardWidth(u,t)}return r},n.prototype._updateSkeletonTemplateForLazyLoad=function(t){var u,r,e,f;t&&t.template===si&&(u=this._taskManager&&this._taskManager.getFocusedStack(),u&&(r=i.isSlideOutCard(u)?u.getFirstTask():u.getForegroundTask(),r&&r._getTaskState&&(e={requestState:r._getTaskState()},f=this._getSkeletonTemplate(r,e),f.template===wr&&r.getRecommendedWidth&&r.getRecommendedWidth()>n.RegularDetailsCardLaneWidth?(t.template=wf,t.width=n.WiderDetailsCardLaneWidth):(t.template=f.template,t.width=f.width))))},n.prototype._isRestaurantCategoryQuery=function(n,t){return n instanceof ai&&t.isCategoryQuery},n.prototype._isIdBasedLookup=function(n){return n&&(n.id&&n.id.indexOf("id:")>-1||n.filterUrlParam&&n.filterUrlParam.indexOf("id:")>-1)},n.prototype._getWiderListingCardWidth=function(t,i){return t&&t.isThreeColumnResponseExpected&&!(i instanceof di)?n.WiderListingCardLaneWidth:n.WiderListingCardTwoColumnWidth},n.prototype._getCardForTask=function(n,r){var o=!i._getIsSlideCardEnabled(),u,f,e;if(r&&r.length>0&&n)for(u=0;u<r.length;u++)if(f=t(r[u]),e=o?f.select(".cardFace").get_attr("data-subtaskid"):f.get_attr("data-subtaskid"),e===n)return f;return null},n.prototype._clearDivContents=function(n){if(n.length>0)while(n[0].firstChild)n[0].removeChild(n[0].firstChild)},n.WiderListingCardLaneWidth=732,n.WiderListingCardTwoColumnWidth=484,n.WiderDetailsCardLaneWidth=650,n.RegularDetailsCardLaneWidth=464,n.RegularListingCardLaneWidth=384,n}(),ci=function(o){function c(t,i,u,f,e,s,h){var l=this;return i&&i.add_class("bm_listings-container"),l=o.call(this,t,i,f,"a.listings-item","data-entity",s)||this,l._poiManager=e,l._taskId=u,l._controlTemplateFactory=h,l.resources=r,l.printTitleViewModel=null,l.printListingsViewModel=null,l._paginationImageDelayLoaded=!1,l.loadInfobox=new g,l._paginationItemsPerPage=n.useNewListingSearchCount?n.listingSearchCount:c._evenColumnListItemsPerPage,l._paginationCurrentPage=0,c._entityCardHoverTimeout=n.hoverThreshold,l}return y(c,o),c.prototype.getIsDetails=function(){return!1},c.prototype.getQuery=function(){return this._query},c.prototype.setQuery=function(n){this._query=n},c.prototype.clear=function(n){n&&n.isInfiniteScroll||o.prototype.clear.call(this)},c.prototype.setResponseContent=function(t,i,r){if(t){var u=t.select(".bm_3col"),f=t.select("a.listing-ads");u&&u.length?(this._paginationItemsPerPage=n.useNewListingSearchCount?n.listingSearchCount:c._threeColumnListItemsPerPage,i&&(i.isThreeColumns=!0)):this._paginationItemsPerPage=f&&f.length?n.useNewListingSearchCount?n.listingSearchCount+2:c._listItemsPerPageWithAds:n.useNewListingSearchCount?n.listingSearchCount:c._evenColumnListItemsPerPage;this.isWaterfallListingsEnabled()||this._delayLoadListingImagesInPagination(t);o.prototype.setResponseContent.call(this,t,i,r);this.isWaterfallListingsEnabled()&&(this._paginationItemsPerPage=c._waterfallListItemsPerPage);this.setQuery(i.query);o.prototype.addReportLinkToNoResultCard.call(this,t,this._taskId,i);this._dataCategory!="House"&&this._addReportMissingEntityLinkToLocalListing(t,this._taskId,i);this._logModulesImpressions()}},c.prototype._addReportMissingEntityLinkToLocalListing=function(n,t,i){var f=this,u,s;if(it&&it.showAddMissingBusinessLink){var e=this.panelRoot.select(".report-missing-business-link-container"),h=n.select("div[data-answerinfo]"),o=h.select(".query"),r=o.length>0?o[0].textContent:"";if(r=r||i&&i.query,u=this.getUserFacts(),s=this._dataCategory||this._getDataCategory(),s==="TestingLocation"&&u&&(u.isTestingLocation="true"),e){var c={addMissingEntityLinkClicked:function(n){f.onAddMissingBusinessLinkClicked(n,f._taskId,r,r,u,4)}},l=this._controlTemplateFactory({templateText:vf,staticResources:c}),a=l.applyDataTemplate(this);e.append(a)}}},c.prototype.dispose=function(){o.prototype.dispose.call(this);this._hoverPoi=null;var n=this._taskId.replace(/\$/g,"");t("."+n).removeFromParent()},c.prototype.registerListItemEvents=function(){var i=this,r=this.panelRoot.select("a[data-entity]"),n=this.getPushpinPrimitives();r.for_each(function(r){var h=r.getAttribute("data-entity"),f=t.Internals.parseJSON(h),e=f.entity,o,s,u;if(e){for(s=n.length,u=0;u<s;u++)if(n[u].entity.id===e.id){o=n[u];break}i.registerListItemEvent(f,o,r)}})},c.prototype.registerListItemEvent=function(n,i,r){var f=this,u=t(r),e=function(t){return f._processMouseOver(n.id,i,t)},o=function(){return f._processMouseOut(i)};u.add_event("mouseenter",e).add_event("mouseleave",o);this._addEventsToEventList(u,"mouseenter",e);this._addEventsToEventList(u,"mouseleave",o)},c.prototype.InsertListItemCarousel=function(n,t){var i=this.processEntity(n,null,null,!0);i&&n.entity&&this.registerListItemEvent(n.entity,i,t)},c.prototype.processDirectionsData=function(n){n&&n.inData&&n.inData.requestorState&&this._transientLensViewModel.processDirectionsData(n)},c.prototype.processCollectionsData=function(n){this._transientLensViewModel.processCollectionsData(n)},c.prototype.processTravelData=function(n){n&&n.inData&&n.inData.requestorState&&n.inData.requestorState.entryPoint===u.LocalListing?this._transientLensViewModel.getButtonGroupViewModel().processSaveWithTravelData(n):this._transientLensViewModel.processTravelData(n)},c.prototype.getListingsHtmlContentForPrint=function(n){var t=this,i,u,r;return this.printTitleViewModel=this,this.printListingsViewModel=new au(this.map,this._controlTemplateFactory,this.getPushpinPrimitives(),n,this.panelRoot),i={boolToDisplay:function(n){return t.boolToDisplay(n)},nullToDisplayNone:function(n){return t.nullToDisplayNone(n)},hideMatchedData:function(n){return t.hideIfMatchedData(n)},chooseIconSource:function(n){return t.chooseIconSource(n)}},this.titlePrintTemplate=new dt(af,i),this.listingsPrintTemplate=new dt(lf,i),u=this._controlTemplateFactory({templateText:pr,staticResources:i}),r=u.applyDataTemplate(this),r.length>0?r[0].outerHTML:""},c.prototype.chooseIconSource=function(n){var t="";return n&&(n===1&&(t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAXCAMAAAAm/38fAAAAQlBMVEVHcEyqKY+qKY+qKY+qKY+qKY+qKY+qKY+qKY+qKY+qKY////+qKY+wOJfKebncptHBZK7v1+r68vj05PHoxeHVlMftKC+aAAAAC3RSTlMAeN9JrzDvxRRgj9SxIBcAAAC1SURBVCjPfZHtEoUQFEV9lWQfJN7/Va+kJszc9XOvHNqHscbCldaKL6xHCjSE/MSbAsj5lLwjQG1vroEcbSVmQD9Ggw77chD0nfMur4bXQSu87fBYr2EGZAcIpgg1HriOqCIEjlEkiCIAOwH8F3HMzyo00nzH9Ys73Cgc9qtv4JwmLXdVoRehlVU6cf2gtdVrgPC+LAbUQh5DuV50Zvrk5QFlVaAQSgrdr92oe+XKsIlFys/HP2FZEe+D6e0PAAAAAElFTkSuQmCC"),n===2&&(t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAMAAADX9CSSAAAARVBMVEVHcEwAqrAAqrAAqrAAqrAAqrAAqrAAqrAAqrAAqrAAqrAAqrD///8UsbZiy88wur+/6uuA1dhDwMXX8vOv5Obv+vqf3+G0rBkKAAAAC3RSTlMAz6cnXOSPEIBAvytHJ6oAAAC3SURBVCjPdZHZDoQgDEVRdi+7Ov//qVPFUZDMeSE5N2lpy1hFC7UsixKategZP+YmERKIOaWUIyDFrckmV0mUXIEFgnsIgD1ry04fgTx6GPi987uHIS/xcT0fSMY4vHvjwekzZfCFvmSQB5+pwX8fBh/IW8TBR5pMA+tLrwANNg+FAua6ntTpdC1IwbeVVg9VjzLBb7fePKbrNBSg1GQruPW5UyKWeDymPTBX8ryuVJy90Nbap8IXq9AS1imhErwAAAAASUVORK5CYII="),n===3&&(t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAXCAMAAAAm/38fAAAAS1BMVEVHcEwAggAAggAAggAAggAAggAAggAAggAAggAAggAAggAAggD///8AggASixJgsWDP6M/v9+/f79+PyI+AwYCn1KdAoUC/4L9QqVBjJUhMAAAADHRSTlMAz4dJMK8QYL/oIHAyg2hSAAAAuUlEQVQoz32RWxKEIAwEFYyAMkEU1PufdBEfJVi1/TktESZNc9EJ0ppE15RIgwsjX3FPALu4bdExQP2Tt0DwNuMD0N5Ggyf7MDH0mY9Fns2YBxkstmCBOYYpsK1gqCSoPnAcoSQMplpsMEkA9gPwX/g6n7PQiLWI+YkCrhYO4ugbmD+TurOqtRTrVdZgymEOZjhbVMD+3MzvyIXchkP+0Rz4lacLpFWB1zWlaMu1KzpXTqr50En5+vgHNJ4TbfTHZhoAAAAASUVORK5CYII=")),t},c.prototype._parseCategoryData=function(n){var i,t=n.select("div[data-category]");t&&t.length===1&&(i=t.get_attr("data-category"));this.populateCardCategoryId(i)},c.prototype._logEntityCardHoverIfNecessary=function(n){if(n&&this._entityCardHoverStartTime&&Date.now()-this._entityCardHoverStartTime>=c._entityCardHoverTimeout){var t=this.getQuery()||"",i={logData:{feature:"LC",action:"H",data:{ID:n.id,Q:t,EP:u.LocalListing}},impressionGuid:h.getImpressionGuid(this.panelRoot)};e.invokeHandler(f.instrumentationDataHandlerKey,i);this._entityCardHoverStartTime=null}},c.prototype._logModulesImpressions=function(){var r,o,s,n,i;if(this.panelRoot&&(r=this.panelRoot.select("div[data-implog]"),r&&r.length))for(o=0;o<r.length;o++)if(s=r[o].getAttribute("data-implog"),s)try{if(n=t.Internals.parseJSON(s),n&&n.length)for(i=0;i<n.length;i++)n[i].AN&&n[i].CNT&&e.invokeHandler(f.instrumentationDataHandlerKey,{logData:{feature:st.Search,action:"I",data:{AN:n[i].AN,CNT:n[i].CNT,EP:u.LocalListing}},impressionGuid:h.getImpressionGuid(this.panelRoot)})}catch(c){}},c.prototype._processMouseOver=function(t,i){var r,u;n.enableInfoBox&&(r=i,r&&(r.viewState!==1&&r.viewState!==3&&(this.loadDelayedListingImagesInPagination(),r.viewState=1,r.zIndex=2,this._hoverPoi=r,r.entity.changed&&r.entity.changed.invoke({sender:r.entity}),sj_evt&&sj_evt.fire("pushpinhoverstarted",i),this._entityCardHoverStartTime=Date.now()),u=ut.mapsInfobox,u&&u.getOptions()&&u.getOptions().visible!==!1||r.viewState!==1||this.loadInfobox.invoke(i)))},c.prototype._processMouseOut=function(n){var i=n?n.viewState:null,t=this._hoverPoi;n&&t&&(n===t&&sj_evt&&sj_evt.fire("pushpinhoverstopped",n),i!==3&&(t.viewState=0,t.zIndex=this._paginationCurrentPage>0?1:0,t.entity.changed&&t.entity.changed.invoke({sender:t.entity}),this._hoverPoi=null,this._logEntityCardHoverIfNecessary(n.entity)));ut.mapsInfobox&&ut.mapsInfobox.setOptions({visible:!1})},c.prototype._buildLogData=function(n,t){return{logData:{feature:"LC",action:n,data:t}}},c.prototype._mapviewSuggestionClickHandler=function(n){var t,i,o,r;if(n&&n.target){for(t=n.target;t.parentNode;){if(t.nodeName.toLowerCase()==="a")break;t=t.parentNode}(n&&n.preventDefault(),t)&&(i=t.getAttribute("aria-label"),i)&&(o=this._buildLogData("C",{AN:"SearchSuggestion",EP:u.LocalListing,DT:"SuggestionLinkDynamic."+i}),e.invokeHandler(f.instrumentationDataHandlerKey,o),r={},r.entryPoint=u.LocalListing,r.query=i,e.invokeHandler(f.taskProcessDataHandlerKey,{requestState:r,type:s.localSearchTask}))}},c.prototype.updateTnAAds=function(){var n=this.panelRoot.select("[data-tag=TnA.AdsModule.Container]"),t,i;n&&n.length>0&&(t=h.getImpressionGuid(this.panelRoot),i=this._getDataCategory(),fi.setShownAds("MC",".maps_tna_ad_card",n,t,i),fi.setShownAds("SC",".maps_tna_ad_item",n,t,i))},c.prototype.updateLocalSearchAds=function(){var n=this.panelRoot.select("a.listing-ads"),r=h.getImpressionGuid(this.panelRoot),t,i;if(n&&n.length)for(t=0;t<n.length;t++)i=n[t],i&&at.updateAdLink(i,r)},c.prototype.getHouseListingCounts=function(n){var t,i;if((n===null||n===void 0?void 0:n.length)&&(t=n.get_attr("data-houselistmetadata"),(t===null||t===void 0?void 0:t.length)&&(i=JSON.parse(t),i))){var u=parseInt(i.CurrentListCount),f=parseInt(i.BlockedCount),r=u+f;return isNaN(r)?null:r}return null},c.prototype.updateTextAds=function(t){var r,i;if(wt.isEnabled())try{n.newAdsClientSideCode?(i=(n.adsFromBfprWorkflow||n.adsFromBmfpWorkflow)&&this.panelRoot.select("div.mapsTextAds"),i&&i.length?at.setShownAds(nt.LI,i,h.getImpressionGuid(this.panelRoot)):this.requestSyndicatedAds(t)):n.adsFromWorkflow?(r=this.panelRoot.select("div.mapsTextAds"),at.setShownAds(nt.LI,r,h.getImpressionGuid(this.panelRoot))):this.requestSyndicatedAds(t)}catch(u){wt.logError(u)}},c.prototype.requestSyndicatedAds=function(t){var o=n.listingMaxAdCount,i,r,f,e,u;o&&(i=this.panelRoot&&this.panelRoot.select("div.adsContainer"),i&&i.length&&this.map&&(r=this.getEntities(),r&&r.length&&(this._ads||(this._ads=new wt(this._controlTemplateFactory,nt.LI),f=this._ads,this._ads.requestAds(t.query,r[0].getLocation().clone(),o,this._taskId,function(){if(i.length>1&&f.getPosition()==="B"){var n=i[1],t=n.parentElement;t&&t.insertBefore(f.getControl()[0],n)}})),this._ads&&(e=i[i.length>1&&this._ads.getPosition()==="B"?1:0],u=e.parentElement,u&&(u.insertBefore(this._ads.getControl()[0],e),u.removeChild(i[0])),i.length>1&&i[1].removeAttribute("class")))))},c.prototype.processPoiPagination=function(n,t){var y=this,e=this._getResultItemRoot(),f,r,u,s;if(e&&e.length===1&&(f=this._getResultItems(e),this._shouldPaginate(f))){var h=this._isPricePoiPagination(),o=Math.floor(f.length/this._paginationItemsPerPage)+(f.length%this._paginationItemsPerPage>0?1:0),l=i._createElement("div"),a=i._createElement("ul"),v=[];for(this._paginationCurrentPage=1,l.set_attr("class","bm_paginationModule"),r=0;r<=o+1;r++)u=i._createElement("a"),v.push(u),u.set_attr("href","#"),u.set_attr("data-pageNumber",r.toString()),r===0?u.set_attr("class",c._noDisplayClassName):r===o+1?u.set_attr("class","bm_rightArrow"):u.set_text(r.toString()),r===1&&u.set_attr("class","bm_active"),u.add_event("click",function(n){y._paginationHandler(n,v,o,f,t,h)}),s=i._createElement("li"),s.append(u),r>c._paginationVisiblePageButtons&&r<o+1&&s.set_attr("class",c._noDisplayClassName),a.append(s);l.append(a);e.getParent().append(l);this._paginationSetDisplayForItems(f,1,!0,t,h);n.disableListingRefresh=h?!1:!0;this._paginationListingItems=f}},c.prototype.setIconOnlyLimitBySegmentTypeOrCategoryId=function(){var e,t,r,i,u,f;if(n&&n.iconOnlyLimitBySegmentTypeOrCategoryId){if(e=this._getDataCategory(),!e)return;if(t=e.split("."),r=Object.keys(n.iconOnlyLimitBySegmentTypeOrCategoryId),r&&r.length&&t&&t.length)for(i=0;i<t.length;i++)if(u=t[i]&&t[i].toLowerCase(),u&&r.indexOf(u)>-1&&(f=n.iconOnlyLimitBySegmentTypeOrCategoryId[u],f&&!isNaN(parseFloat(f)))){this._poiManager.iconOnlyLimit=parseFloat(f);break}}},c.prototype._enableServerPaginationForRestaurants=function(){var n=!1,t,r;return this.panelRoot&&(t=this._getDataCategory(),i._isRestaurantCategory(t)&&(r=this.panelRoot.select("div[data-cacheid]").get_attr("data-cacheid"),n=!!r)),n},c.prototype._enableServerPaginationForLocal=function(){var t,i,r;return n.serverPaginationForLocalEntities&&(t=this._getDataCategory(),t&&t.startsWith("90000")&&(i=this.panelRoot.select("div[data-hasmoreresults]"),i.length))?(r=i.get_attr("data-hasmoreresults"),r&&r.length>0):!1},c.prototype._getResultItems=function(n){return this.isWaterfallListingsEnabled()?this.panelRoot.select("a.listings-item"):!n||n.length!==1?null:n.select("li")},c.prototype._getResultItemRoot=function(){return this.isWaterfallListingsEnabled()?this.panelRoot.select("div.wfr_cells"):this.panelRoot.select("div.entity-listing-container ul")},c.prototype.isWaterfallListingsEnabled=function(){var t=this._getDataCategory();return n.waterfallEnabledCategories&&n.waterfallEnabledCategories.length!=0&&t?n.waterfallEnabledCategories.indexOf(t.toLowerCase())>=0:!1},c.prototype.enableServerPagination=function(t,i,r){var f,w,o,l,u,v,s,h;if(!this._enableServerPaginationForRestaurants()&&!this._enableServerPaginationForLocal()){if(f=n.categoriesWithServerPagination,!f||f.length<1)return!1;var y=!1,p=this._getDataCategory(),e=p&&p.split(".");if(e&&e.length)for(w=e.length,o=0;o<w;++o)if(l=e[o].toLowerCase(),l&&f.indexOf(l)>-1){y=!0;break}if(!y)return!1}if(u=this._getResultItemRoot(),!u||u.length!==1)return!1;if(this._paginationControl&&!(i&&i.mapPannedOrZooomed))return u.getParent().append(this._paginationControl),!0;var a=this._getResultItems(u),b=this.getHouseListingCounts(this.panelRoot.select("div[data-houselistmetadata]")),k=b?b:a.length;return!a||!this._pushpins||k<this._paginationItemsPerPage&&!this.isWaterfallListingsEnabled()||this._getNoMoreResults()||a.length!==this._pushpins.length?!1:(v=this._getWaterfallGridComponentId(t),v?(this._paginationItemsPerPage=c._waterfallListItemsPerPage,s=new vu(this._controlTemplateFactory,this._paginationItemsPerPage,k,t,r,v)):s=new yu(this._controlTemplateFactory,this._paginationItemsPerPage,t,r),h=s&&s.getControl(),!h)?!1:(this._paginationControl=h,u.getParent().append(h),!0)},c.prototype.resetServerPagination=function(){this._paginationControl=null},c.prototype.getCategory=function(){return this._getDataCategory()},c.prototype.getDomEntities=function(){return this._getResultItems(this._getResultItemRoot())},c.prototype._getWaterfallGridComponentId=function(n){var t,i;if(!n||!n.panelRoot||!this.isWaterfallListingsEnabled())return null;if(t=n.panelRoot.select("div.overlay-listings").get_attr("data-listingMetadata"),t)try{if(i=JSON.parse(t),i)return i.WfrGridId}catch(r){}return null},c.prototype._getDataCategory=function(){if(!this._dataCategory&&this.panelRoot){var n=this.panelRoot.select("div[data-category]");n&&n.length&&(this._dataCategory=n.get_attr("data-category"))}return this._dataCategory},c.prototype._getNoMoreResults=function(){var n=this.panelRoot&&this.panelRoot.select("div[data-hasmoreresults]");return n&&n.length&&n.get_attr("data-hasmoreresults")==="false"},c.prototype._isPricePoiPagination=function(){var r,e,s,t,f;if(n.poiCountOverrideByCategoryId){for(r=!1,e=this._pushpins.length,t=0;t<e;++t)if(this._pushpins[t]&&this._pushpins[t].entity&&this._pushpins[t].entity.usePricePoi){r=!0;break}if(r){var o=this._getDataCategory(),i=o&&o.split("."),u=Object.keys(n.poiCountOverrideByCategoryId);if(u&&u.length&&i&&i.length)for(s=i.length,t=0;t<s;++t)if(f=i[t]&&i[t].toLowerCase(),f&&u.indexOf(f)>-1)return!0}}return!1},c.prototype._delayLoadListingImagesInPagination=function(){var f=this._getResultItemRoot(),n,i,t,r,u,e;if(f&&f.length===1&&(n=this._getResultItems(f),n&&!(n.length<=this._paginationItemsPerPage))){for(i=this._paginationItemsPerPage;i<n.length;i++)if(t=n[i].getElementsByTagName("img"),t&&t.length)for(r=0;r<t.length;r++)u=t[r],e=u.getAttribute("src"),e&&(u.setAttribute("data-delayedsrc",e),u.setAttribute("src",""));this._paginationImageDelayLoaded=!0}},c.prototype.loadDelayedListingImagesInPagination=function(){var n=this._paginationListingItems,i,t,r,u,f;if(this._paginationImageDelayLoaded&&n&&n.length&&n.length>this._paginationItemsPerPage)for(this._paginationImageDelayLoaded=!1,i=this._paginationItemsPerPage;i<n.length;i++)if(t=n[i].getElementsByTagName("img"),t&&t.length)for(r=0;r<t.length;r++)u=t[r],f=u.getAttribute("data-delayedsrc"),f&&(u.setAttribute("src",f),u.setAttribute("data-delayedsrc",""))},c.prototype._paginationSetDisplayForItems=function(n,t,i,r,u){var f,e;if(n&&this._pushpins&&!(n.length<=this._paginationItemsPerPage)&&n.length===this._pushpins.length){if(i&&t===1)for(f=0;f<n.length;f++)f>=this._paginationItemsPerPage&&(n[f].style.display="none"),u?this._pushpins[f].zIndex=f<this._paginationItemsPerPage?1:0:f>=this._paginationItemsPerPage?(this._pushpins[f].entity.isPaginationReducedPoi=!0,this._pushpins[f].zIndex=0):this._pushpins[f].zIndex=1;else for(this.loadDelayedListingImagesInPagination(),f=0;f<n.length;f++)e=Math.floor(f/this._paginationItemsPerPage)+1===t,e?n[f].removeAttribute("style"):n[f].style.display="none",u||(this._pushpins[f].entity.isPaginationReducedPoi=!e),this._pushpins[f].zIndex=e?1:0;this._poiManager.setPrimitives(this._pushpins,!1);r&&r()}},c.prototype._paginationHandler=function(n,t,i,r,u,f){var s,e,o;if(n&&n.preventDefault(),!(t.length<i+2)){if(n&&n.target&&(s=n.target.getAttribute("data-pageNumber"),s)){if(e=parseFloat(s),isNaN(e))return;if(e<1){if(this._paginationCurrentPage<=1)return;this._paginationCurrentPage-=1}else if(e>i){if(this._paginationCurrentPage>=i)return;this._paginationCurrentPage+=1}else{if(this._paginationCurrentPage===e)return;this._paginationCurrentPage=e}for(this._paginationSetDisplayForItems(r,this._paginationCurrentPage,!1,u,f),o=1;o<=i;o++)o<t.length&&t[o].set_attr("class",o===this._paginationCurrentPage?"bm_active":"");this._paginationCurrentPage<=1?t[0].set_attr("class",c._noDisplayClassName):t[0].set_attr("class","bm_leftArrow");this._paginationCurrentPage>=i?t[t.length-1].set_attr("class",c._noDisplayClassName):t[t.length-1].set_attr("class","bm_rightArrow");i>c._paginationVisiblePageButtons&&(this._paginationCurrentPage-1>0&&t[this._paginationCurrentPage-1].getParent().get_attr("class").indexOf(c._noDisplayClassName)>-1?(t[this._paginationCurrentPage-1].getParent().set_attr("class",""),this._paginationCurrentPage+c._paginationVisiblePageButtons-2<t.length&&t[this._paginationCurrentPage+c._paginationVisiblePageButtons-1].getParent().set_attr("class",c._noDisplayClassName)):this._paginationCurrentPage+2<t.length&&t[this._paginationCurrentPage+1].getParent().get_attr("class").indexOf(c._noDisplayClassName)>-1&&(t[this._paginationCurrentPage+1].getParent().set_attr("class",""),this._paginationCurrentPage-c._paginationVisiblePageButtons+1>0&&t[this._paginationCurrentPage-c._paginationVisiblePageButtons+1].getParent().set_attr("class",c._noDisplayClassName)))}u&&u()}},c.prototype._shouldPaginate=function(n){return!n||!this._pushpins||n.length<=this._paginationItemsPerPage||n.length!==this._pushpins.length?!1:!0},c._evenColumnListItemsPerPage=20,c._threeColumnListItemsPerPage=21,c._listItemsPerPageWithAds=22,c._waterfallListItemsPerPage=50,c._paginationVisiblePageButtons=9,c._noDisplayClassName="bm_noDisplay",c}(ru),l=function(o){function l(t,i,r,u,f){var e=o.call(this,i)||this,s;return e.map=t,e._trafficLayer=f,e._count=n.useNewListingSearchCount?n.listingSearchCount:20,e._offset=0,e.pageProcessor=r,e.type="LocalSearch",e._taskUrlParams.push({param:"q",paramGetter:function(){return e._getQueryParam()}}),e._taskUrlParams.push({param:"segment",paramGetter:function(){return e._getSegmentParam()}}),e._taskUrlParams.push({param:"lf",paramGetter:function(){return e._getFiltersParam()}}),e.scrollLane=new g,e.laneScrolled=new g,e.mapsInfoboxOptions={showCloseButton:!1,zIndex:1006,showPointer:!1,visible:!0,htmlContent:null,location:null,autoAlignment:!0},l._poiHoverLoggingThresholdForEventLogging=n.hoverThreshold,e._logHelper=new iu(e.perfLog),e.setPercentLoaded(0),u&&(e._transientLensViewModel=u,e.disposables.push(e._transientLensViewModel.invalidateLayer.add(function(){return e.concatOverlayPrimitive()}))),l._overlayCloseBtnListenerAdded||(s=Microsoft.Maps.Internal._Gimme&&Microsoft.Maps.Internal._Gimme(".overlayCloseBtn")[0],s&&s.addEventListener&&(l._overlayCloseBtnListenerAdded=!0,s.addEventListener("click",function(){l._useBfpr=!1}))),e.setCurrentWidth(null),e.setRecommendedWidth(null),ot.showLoadingSkeleton&&(e._searchPrimer=gf.getInstance(),e._searchPrimer.initialize(t)),e._overrideGlinkPing(),e}return y(l,o),l.prototype.activate=function(n,t){o.prototype.activate.call(this,n,t);this.poiManager&&(this.poiManager.disableComputingMapViewForFirstTimeLoad=t.disableComputingMapViewForLoadingOnly);this._taskState=t;this._transientLensViewModel.setOptions({requestorId:this.id,requestorType:this.type});this._taskState&&this._taskState.content&&this.processResponse(this._taskState.content);this.getTitle()&&(this._initialTitle=this.getTitle(),t.directionsTaskId&&this._updateTitle())},l.prototype.deactivate=function(){if(l.mapsInfobox&&(l.mapsInfobox.setOptions({visible:!1}),l.mapsInfobox.preventAutoClose=!1),this.isSearchAlongRouteEnabled())this.disableSearchAlongRoute(!0,!1);this.viewModel&&this.viewModel.landMarkFilterRule&&this.map.getLandmarksManager().then(function(n){n.resetDataSource()});o.prototype.deactivate.call(this);this.viewModel.dispose()},l.prototype.setDisplayState=function(n){var t=this;o.prototype.setDisplayState.call(this,n);n.activationState&1&&this.viewModel&&this.viewModel.landMarkFilterRule&&this.map.getLandmarksManager().then(function(n){n.applyFilterOnDataSource(t.viewModel.landMarkFilterRule)});n.activationState&1&&n.prominence&1&&l._removeCardPrimer(this.map)},l.prototype.process=function(t,r,u){var f=t&&t.requestState,s,h,v;if(f){if(l._useBfpr&&(f.useBfpr=!0,this._taskState&&!this._taskState.useBfpr&&(this._taskState.useBfpr=!0)),f.action==0){this._taskState&&(this._taskState.keyRoutePoints=f.keyRoutePoints,this._taskState.keyRoutePoints&&this._taskState.keyRoutePoints.length>=2&&this._updateRoutePoints(this._getPointsString(this._taskState.keyRoutePoints)),(this.displayState&&this.displayState.activationState!==3||f&&f.cause!==1)&&this.poiManager.suppressViewChangeOnRefreshOnce(),this._refreshWithDelay({appliedFilterOption:new ct(f.directionsTaskId,"",null,!0)}));return}if(f.action==1){s=!1;this._updateRoutePoints(null);this.disableSearchAlongRoute(s);this._refreshWithDelay();return}if(f.searchEntitiesRequested)this.viewModel&&r&&r({processorId:this.id,data:this.viewModel.getEntities()});else if(f.trackingDataRequested)this.viewModel&&r&&r({processorId:this.id,data:{ImpressionGuid:this._getImpressionGuid(),TraceId:this._getTraceId()}});else if(this._taskState=f,this._taskState.query&&(this._taskState.query=this._taskState.query.trim()),!this._taskState.query&&this._taskState.category&&(this._taskState.query=""),this._taskState.query||this._taskState.id||this._taskState.category){h=this._taskState.id?tt.ID:tt.SB;this._searchPerfState=this._logHelper.perfStart(h);var o=this._createUrl(),e=this._taskState.passThruParam,a=n.formCodeMonitr,y=e&&(e.indexOf("sponover")>-1||e.indexOf("sponad")>-1);((y||!i._isLocalOrRealEstateScenarioOverlayShownOnSerp())&&a&&e&&e.toUpperCase().indexOf(a)===-1||e&&e.toLowerCase().indexOf("lemodule")>-1)&&(o+=e.indexOf("&")!==0?"&"+e:e);w.getStartTime(this.id)||w.getStartTime("SearchRequest")||w.setStartTime("SearchRequest");this._sendSearchRequest(o,t,r,u,!0);v={Q:this._taskState.query?this._taskState.query:"",URL:o};this._logHelper&&this._logHelper.log(p.LSR,v,c.dynamicProperties.mapsIG)}}},l.prototype.processCallback=function(n){var i,u,f,t,r;n&&n.inData&&n.processorType&&n.outData&&(n.processorType===s.directionsTask?this.viewModel.processDirectionsData(n):n.processorType===s.collectionsTask?(i=n.inData.requestState,i&&i.action===pt.UpdateEntity&&i.data&&i.data.title&&this.type!==s.localListingTask&&(u=i.data.title,this.setTitle(u),f=this.viewModel,f.updatePoiTitle(u),f.resetPrimitives(this.poiManager),f.annotationControl.setCurrentName(u)),this.viewModel.processCollectionsData(n)):n.processorType===s.itineraryDetailsTask?this.viewModel.processTravelData(n):(n.processorType===s.localSearchTask||n.processorType===s.hotelsDetailsTask)&&n.outData.length&&n.outData[0].data&&n.outData[0].data.content&&(t=n.outData[0].data.content,r=k.parseCategory(t),this._taskState=n.inData.requestState||this._taskState,this._resetMicropois(),this._taskState&&r&&!this._taskState.isFallbackRequery&&(this._isOutingsFallback(r,t)||this._isHotelsFallback(r,t)||this._isRestaurantsFallback(r,t)||this._fallbackIfNoResultsFoundInResponse(t))?(this._taskState.disableTaskActivate=!1,this._requestFallback(t)):(this.processResponse(t),this.scrollLane&&this.scrollLane.invoke&&this.scrollLane.invoke(this.panelRoot),this._logInstrumentationForLocalTopicsClick())))},l.prototype.serialize=function(n){var i,r,t;if(this._taskState&&(this._taskState.content=null,this._taskState.activatingElement=null,this._taskState.taskTitle||(this._taskState.taskTitle=this.getTitle()),this._taskState.primerPois=null,this._taskState.primerRequestUrl=null,this._taskState.primerParseSelector=null,n&&(this._reduceLatLonPrecisions(),this._taskState.shareDescription=this.getShareDescription(),this._taskState.fromSharing=!0,this._taskState.ads&&(this._taskState.ads=null),this.displayState.prominence===1)))return i=this._buildTaskStateWithPrimerPois(),i.disableComputingMapViewForLoadingOnly=!0,i;if(this._taskState&&this._taskState.originalResponse){r={};for(t in this._taskState)t&&t.indexOf("originalResponse")<0&&this._taskState.hasOwnProperty(t)&&(r[t]=this._taskState[t]);return r}return this._taskState},l.prototype.getShareDescription=function(){return""},l.prototype.getCardIconInfo=function(){return{iconClass:"srcTsk",iconElements:this.getCardIcons(this.viewModel.getCardCategoryId())}},l.prototype._refreshWithDelay=function(n){var t=this;(!i._getIsSlideCardEnabled()||this.displayState.prominence!==1)&&this.displayState.activationState===2&&this instanceof ki||(et.abortRequest(this._outstandingRefreshReqId),window.clearTimeout(this._resultsReqTimeoutHandler),w.getStartTime(this.id)||w.setStartTime(this.id),this._resultsReqTimeoutHandler=Microsoft.Maps.setTimeout(function(){t._refresh(n)},ff.refreshTimeout))},l.prototype._refresh=function(n){var t=this,r,u,f,e;this._taskState.mapBounds=this._getLocalMapViewBounds();this._taskState.primerPois=null;this._taskState.cacheId=null;r=this._createUrl(n);r&&(this.setPercentLoaded(0),u=this._taskState&&this._taskState.id?tt.ID:tt.SB,n||(n={}),n.perfState=this._logHelper.perfStart(u),f=function(r){var u,o;t._showOrHideWaitLayer(!1);u=!0;try{n.perfState.end("NT");var f=t._convertToResponseObject(r),e=k.getEntitiesFromResponse(f,t._taskState),s=e&&e.entities;u=t._shouldProcessResponseOnRefresh(s,n);u&&(t.processResponse(f,n),o=n.forceLogAsLocalListingTask?p.LLT:p.LLR,t._logActivated(o,n.forceLoggingEntryPoint),t.displayState&&t.displayState.prominence===1&&i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&sj_evt&&sj_evt.fire("SearchResponseReceived",{IG:h.getImpressionGuid(t.viewModel.panelRoot),primitives:t.viewModel.getPushpinPrimitives()}))}finally{u&&t._postRefresh()}},this._showOrHideWaitLayer(!0),e=function(){t._showOrHideWaitLayer(!1)},this._outstandingRefreshReqId=et.downloadGeneric(r,"srchrefresh",f,null,e,null,0,null,w.getLogKeyFromUrl(r)))},l.prototype.getIconColorAndClassName=function(n){var t=this,r,i;if(this._taskState.cardBackgroundData){n(this._taskState.cardBackgroundData.cardBackgroundColor,this._taskState.cardBackgroundData.cardClassName);return}r=this._taskState&&this._taskState.listingCategoryPath?!0:this.viewModel.categoryFound;typeof r=="undefined"?n(null,null):(i=function(i){i=i||yi.FallbackLocalCat;t._buildCardIcon(null,i,function(r){t._taskState.cardBackgroundData={cardBackgroundColor:r,cardClassName:"catid_"+i};n(t._taskState.cardBackgroundData.cardBackgroundColor,t._taskState.cardBackgroundData.cardClassName)})},this._taskState.listingCategoryPath?this.map.getTemplateSelector().then(function(){var n=yi.extractCategoryId(t._taskState.listingCategoryPath,!1);i(n)}):i(this.viewModel.getCardCategoryId()))},l.prototype.activateInfobox=function(i,r,u,f){var e=this,o=i.entity;u&&t.Browser.is_ie&&t.Browser.ie_version<12||f?l.mouseoverTimeout=0:u||l.mouseoverTimeout!==0||(l.mouseoverTimeout=500);window.clearTimeout(l.mouseoverDelayHandle);l.mouseoverDelayHandle=window.setTimeout(function(){var s,h,c,f,t;if((!l.mapsInfobox||!l.mapsInfobox.preventAutoClose)&&o&&(o.infoboxHtml&&o.infoboxHtml.length>0||r&&r.length>0)){if(s=new Microsoft.Maps.Location(i.geometry.y,i.geometry.x),e.mapsInfoboxOptions.htmlContent=r?r:o.infoboxHtml,e.mapsInfoboxOptions.location=s,h=u?new Microsoft.Maps.Point(4,4):new Microsoft.Maps.Point(10,10),e._taskState.scenarioKey){for(f=Object.keys(n.scenarioKeys),t=0;t<f.length;t++)if(n.scenarioKeys[f[t]]===e._taskState.scenarioKey){c=f[t];break}c&&n.singleEntityScenarios.indexOf(c)>=0&&(h=new Microsoft.Maps.Point(10,14))}e.mapsInfoboxOptions.offset=h;l.mapsInfobox?l.mapsInfobox.setOptions(e.mapsInfoboxOptions):(l.mapsInfobox=new Microsoft.Maps.MapsInfobox(s,e.mapsInfoboxOptions),l.mapsInfobox.setMap(e.map))}},l.mouseoverTimeout)},l.prototype._showOrHideWaitLayer=function(n){var r=this,i=t(".MicrosoftMap .bm_waitlayer");n?this.displayState&&this.displayState.prominence===1&&this.displayState.activationState===1&&(this._waitlayerId=Microsoft.Maps.setTimeout(function(){r._showOrHideWaitLayer(!1)},3e3),i.set_style({display:"block"}),ot.dimOnAutoSuggest&&i.set_style({width:i.getParent().get_style("width")})):(clearTimeout(this._waitlayerId),i.set_style({display:"none"}),ot.dimOnAutoSuggest&&i.set_style({width:""}))},l.prototype._shouldProcessResponseOnRefresh=function(n){return n&&n.length>0},l.prototype._shouldSuppressMapViewChangeOnRefresh=function(n){return n?n.mapPannedOrZooomed||n.isPaginated:!1},l.prototype._onPrimitivesChanged=function(n){var t=this._currentRefreshContext?this._shouldSuppressMapViewChangeOnRefresh(this._currentRefreshContext):!1;this._currentRefreshContext=undefined;this.poiManager&&this.poiManager.setPrimitives(n,t)},l.prototype._postRefresh=function(){},l.prototype._getTaskState=function(){return this._taskState},l.prototype._resetMicropois=function(){},l.prototype._logInstrumentationEventForEntityClick=function(){var t=c.dynamicProperties.serpIG,n;t&&(n=Microsoft.Maps.logger,n&&n.logObject({T:"CI.OverlayEntClick",feature:"LocalOverlay",action:"CI.OverlayEntClick",data:{}},t,!1))},l.prototype._logPoiHoverIfNecessary=function(n,t,i){var r=n.primitive.entity;r&&(n.newValue===1?this._poiHoverStartTimeStamp=Date.now():(this._poiHoverStartTimeStamp&&Date.now()-this._poiHoverStartTimeStamp>=l._poiHoverLoggingThresholdForEventLogging&&this._logPoiHover(r,t,i),this._poiHoverStartTimeStamp=null))},l.prototype._logPoiHover=function(n,t,i){if(this._getTaskState()){var u=this._getTaskState().query||"",r={logData:{feature:"POI",action:"H",data:{ID:n.id,Q:u,EP:t,MP:!!i}},impressionGuid:h.getImpressionGuid(this.panelRoot)};this.isSearchAlongRouteEnabled()&&(r.logData.data.AL=!0);e.invokeHandler(f.instrumentationDataHandlerKey,r)}},l.prototype._logInstrumentationForLocalTopicsClick=function(){var n,t;this._taskState&&this._taskState.disableTaskActivate===!0&&this._taskState.entryPoint==="LocalListing"&&(n=this._taskState.originIG,n&&(t={EP:"LocalTopics",Q:this._taskState.query?this._taskState.query:"",SNRO:this._taskState.scenarioKey,SIG:n,MIG:this._getMasterImpressionGuid(),TRACE:this._getTraceId(),CT:this._getListingContentType()},this._logHelper&&this._logHelper.log(p.LLT,t,n)))},l.prototype.processResponse=function(t,r){var s=this._getImpressionGuid(),o,h,f,u,e,l;s&&(this._taskState&&(this._taskState.impressionGuid=s),this.poiManager&&(this.poiManager.impressionGuid=s));this.viewModel.setResponseContent(t,this._getTaskState());o=this.viewModel.panelRoot.select("div[data-mapcardwidth]");h=o&&o.length&&o[0].getAttribute("data-mapcardwidth");!h||r&&r.isInfiniteScroll||(f=parseInt(h),this.setRecommendedWidth(f),this.setCurrentWidth(f),n&&n.enablePoiCentering&&this.displayState&&i&&(u=void 0,e=32,this.map.getActualSize().width<=c.features.taskFramework.slideoutMinWidth?u=f+i.getVerticalTaskBarWidth()+e:this.displayState.stackOrder>1?(l=this.map.getViewportPadding(),u=i._isRtl()?l.right:l.left,u<n.placeCardWidth&&(e+=20,u+=f+i.getVerticalTaskBarWidth()+e)):u=f+i.getVerticalTaskBarWidth()+e,this._setViewportPaddingForCardSide(u)));this.setTaskComplete(r)},l.prototype.setTaskComplete=function(n){this.setPercentLoaded(1);this._taskState.mapBounds=this._getLocalMapViewBounds();this.serializableObjectChanged.invoke({magnitude:0});var t=this.viewModel.getPushpinPrimitives();t&&(this._currentRefreshContext=n,this.setMapPrimitives(t));l._removePoiPrimerLayer(this.map);this._taskState.activatingElement=null},l.prototype._logActivated=function(n,t){var y=this._taskState.fullQuery||this._taskState.query,o=y||this._taskState.id,f,e,r,s,h,c,l,u,a,v;o||(o="");f=n===p.LLR?"":this._taskState.entryPoint||"";t&&(f=t);var w=this._logCid(n,f)?this._taskState.asConversationId:"",b=this._taskState.scenarioKey||"",i={EP:f,Q:o,BB:this._tryGetBounds(),SNRO:b,SIG:this._getImpressionGuid(),MIG:this._getMasterImpressionGuid(),TRACE:this._getTraceId(),CID:w};this._taskState.isCustomSatrSearch&&(i.CSATR="C");this._taskState.directionsTraceId&&(i.DTID=this._taskState.directionsTraceId);i&&i.SNRO&&i.SNRO.indexOf("ERR")!==-1&&(i.AAP=this._getAnswerPicked());n===p.LDT&&(e=this.viewModel&&this.viewModel.getEntities&&this.viewModel.getEntities(),r=e&&e.length&&e[0],i.LT=r&&r.getLocationType?r.getLocationType():"",i.SGMT=r&&r.getSegmentTypes?r.getSegmentTypes():null,s=this.panelRoot.select(".iaplanner"),i.IC=s&&s.length?!0:!1,h=r.getPrimaryCategoryPath&&r.getPrimaryCategoryPath(),h&&(i.CAT=h),c=r.getTitle&&r.getTitle(),c&&(i.RE=c),this._logEntityIdType(i,r),l=r.getVdpId&&r.getVdpId(),l&&(i.VDPID=l));u=this._taskState.keyRoutePoints;u&&u.length>=2&&(a=u[0],v=u[u.length-1],i.AL=!0,i.ST=[a.latitude,a.longitude],i.EN=[v.latitude,v.longitude]);n===p.LLT&&(i.CT=this._getListingContentType());this._logHelper.log(n,i,i.SIG)},l.prototype._logCid=function(n,t){return(t===u.Autosuggest||t===u.SearchBox||t===u.SearchButton)&&n!=p.LLR?!0:!1},l.prototype._logEntityIdType=function(n,t){var i=t.id;i&&(i.indexOf("sid:")===0?n.SID=i.substr(i.indexOf(":")+1):i.indexOf("ypid:")===0?n.YPID=i.substr(i.indexOf(":")+1):i.indexOf("eventId:")===0?n.EID=i.substr(i.indexOf(":")+1):i.indexOf("geoId:")===0&&(n.GID=i.substr(i.indexOf(":")+1)))},l.prototype._getLocalMapViewBounds=function(){var t=ft.getMapBounds(this.map,!0),n=[];return n.push(t.getNorth()),n.push(t.getWest()),n.push(t.getSouth()),n.push(t.getEast()),n},l.prototype._getListingContentType=function(){var t=this.panelRoot.select("div.overlay-listings").get_attr("data-listingMetadata"),n;if(t)try{if(n=JSON.parse(t),n)return n.ContentType}catch(i){}return""},l.prototype._getTotalResultCount=function(n){var t,i,r;if(!n)return 0;if(t=n.select("div.overlay-listings").get_attr("data-listingMetadata"),t)try{if(i=JSON.parse(t),i)return r=i.TotalCount,parseInt(r)}catch(u){}return 0},l.prototype._getImpressionGuid=function(){return h.getImpressionGuid(this.panelRoot)},l.prototype._getMasterImpressionGuid=function(){return h.getMasterImpressionGuid()},l.prototype._getTraceId=function(){var n=this.panelRoot.select("div[data-traceid]"),t;return n&&n.length===1&&(t=n[0].getAttribute("data-traceid"),t)?t:""},l.prototype._contextMenuInvoked=function(n){n?(this._contextMenuPrimitive=n.primitive,this._contextMenuPrimitive&&(this._contextMenuPrimitive.viewState=0),this._contextMenuPrimitiveBucket=n.primitive.bucket,this._contextMenuPrimitiveViewState=this._contextMenuPrimitive.viewState,this.poiManager.suppressViewChangeOnRefreshOnce(),this._transientLensViewModel.show(n)):(this.poiManager.suppressViewChangeOnRefreshOnce(),this._transientLensViewModel.hide())},l.prototype._onPoiViewStateChanged=function(){},l.prototype.registerViewModelEvents=function(){var n=this;this.disposables.push(this.viewModel.changed.add(function(){var t=n.viewModel.getCardCategoryId();t&&(n.map.getTemplateSelector().then(function(i){i&&i.getCategoryIconTemplate(function(t){var i=t&&t.iconColor;i&&n.poiManager&&n.poiManager.setIconColorFromCard&&n.poiManager.setIconColorFromCard(i)},t)}),n.changed.invoke({name:"iconClass"}))}));this.disposables.push(this.viewModel.catIdPopulated.add(function(){n.changed.invoke({name:"catId"})}))},l.prototype.updateMapBounds=function(n){var t=this;this.disposables.push(this.map.getFrameManager().frameRendered.addOne(function(){hr.areEqual(t.map.getView(),n)&&(t._taskState.mapBounds=t._getLocalMapViewBounds(),t.serializableObjectChanged.invoke({magnitude:0}))}))},l.prototype.concatOverlayPrimitive=function(){var n=this._transientLensViewModel.getPrimitive();n?this.showOverlayPrimitive(n):this.hideOverlayPrimitive()},l.prototype.showOverlayPrimitive=function(n){this._contextMenuPrimitive.bucket&&delete this._contextMenuPrimitive.bucket;this._contextMenuPrimitive.viewState=3;this._contextMenuPrimitive.entity.changed&&this._contextMenuPrimitive.entity.changed.invoke();n.viewState=3;var t=this.viewModel.getPushpinPrimitives();this.setMapPrimitives(t.concat(n))},l.prototype.hideOverlayPrimitive=function(){this._contextMenuPrimitive&&(this._contextMenuPrimitiveBucket&&(this._contextMenuPrimitive.bucket=this._contextMenuPrimitiveBucket),this._contextMenuPrimitive.viewState=this._contextMenuPrimitiveViewState,this._contextMenuPrimitive.entity.changed&&this._contextMenuPrimitive.entity.changed.invoke(),this._onPoiViewStateChanged({primitive:this._contextMenuPrimitive,oldValue:3,newValue:this._contextMenuPrimitiveViewState}));var n=this.viewModel.getPushpinPrimitives();this.setMapPrimitives(n)},l.prototype._tryGetBounds=function(){try{return ft.getMapBounds(this.map).bounds}catch(n){return[]}},l.prototype._createUrl=function(t,r,f){var e,g,kt,y,s,a,o,nt,tt,b,it,ot,rt,k,st,ht,dt,ct,gt,ni,ti,ut,v,ri,d,ui,vt,h,et,yt,pt,w,bt;if(this._taskState){e=this._getRequestUrlFormat().replace("{mkt}",c.dynamicProperties.market).replace("{appid}",c.dynamicProperties.appId);g=e.indexOf("overlaybfpr")>-1;y=this._getLocationInfo();i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&(this._taskState.fullQuery=this._taskState.fullQuery||this._taskState.query);s=this._taskState.id;o="";this._taskState.localFilters&&(kt=!0);i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&this._taskState.localFilters&&this._taskState.localFilters.indexOf("realEstateMarket")!=0||(!this._taskState.filterUrlParam||this._taskState.localFilters&&this._taskState.localFilters.indexOf('tsource:"OutdoorAttraction"')>-1&&this._taskState.localFilters.indexOf("gsfilter:")>-1?s&&s.indexOf("ypid:")===0?(a=n.localFilterFormat,o=encodeURIComponent(a.replace("{ypid}",s.substring(5))+" ")):s&&s.indexOf("sid:")===0?(a=n.entityFilterFormat,o=encodeURIComponent(a.replace("{sid}",s.substring(4))+" "),nt=this._taskState.hasOwnProperty("localListingsState")?this._taskState.localListingsState:null,this._taskState.localFilters&&this._taskState.localFilters.indexOf("realEstateMarket")>-1?o+=encodeURIComponent(this._taskState.localFilters+" "):nt!=null&&nt.hasOwnProperty("filterUrlParam")&&(tt=nt.filterUrlParam,b=tt.indexOf("RealEstateMarket"),b>-1&&b+24<=tt.length&&(o+=encodeURIComponent(tt.substring(b,b+24)+" ")))):s&&s.indexOf("eventId:")===0?(a=n.eventFilterFormat,rt=s.indexOf("eventParentId:"),rt!==-1?(it=s.substring(8,rt-1),ot=s.substring(rt+14)):(it=s.substring(8),ot=it),o=encodeURIComponent(a.replace("{eventId}",it).replace("{eventParentId}",ot).replace("{latlong}",this._taskState.latLongForEventRequery).replace("{city}",this._taskState.locationForEventRequery)+" ")):s&&s.indexOf("vdpid:")===0&&(a=n.vdpIdFilterFormat,o=encodeURIComponent(a.replace("{vdpid}",s.substring(6))+" ")):o=this._taskState.filterUrlParam+"%20");this._overridePoiCount();k=r!==undefined?r.toString():this._offset.toString();o?(ht=f!==undefined?f.toString():this._taskState.poiCount&&!isNaN(parseFloat(this._taskState.poiCount))?this._taskState.poiCount:this._count.toString(),e+="&count="+ht+"&ecount="+ht+"&first="+k+"&efirst="+(parseInt(k)+1).toString(),e+=y):(st=f!==undefined?f.toString():this._taskState.entryPoint===u.DirectionsWaypointSearch?n.directionsSearchCount.toString():this._taskState.poiCount&&!isNaN(parseFloat(this._taskState.poiCount))?this._taskState.poiCount:this._count.toString(),e+="&count="+st+"&ecount="+st+"&first="+k+"&efirst="+(parseInt(k)+1).toString()+y,this._taskState.localFilters&&(o+=encodeURIComponent(this._taskState.localFilters+" ")),(kt||t&&t.mapPannedOrZooomed)&&(this._taskState.disableOSearchFromBackend||(this._taskState.disableOSearchFromBackend=this.panelRoot.select("div[data-disableosearch]").get_attr("data-disableosearch")),this._taskState.disableOSearchFromBackend==="1"&&(e+=l._disableOSearchParameter)));this._taskState.chainId&&(e+="&chain="+this._taskState.chainId,n.sendCarouselRead&&(o+=encodeURIComponent('carouselread:"true" ')));dt=this._taskState.taskTitle||"";ct=this._taskState.query||this._taskState.taskTitle||o||this._taskState.category;i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&!y&&(ct=this._taskState.fullQuery);gt=encodeURIComponent(ct.trim());typeof Base64Encoder!="undefined"&&(this._taskState.asName&&(ni=Base64Encoder.stringToBase64(this._taskState.asName),o+=encodeURIComponent('een:"'+ni+'" ')),this._taskState.asFormattedAddress&&(ti=Base64Encoder.stringToBase64(this._taskState.asFormattedAddress),o+=encodeURIComponent('eea:"'+ti+'" ')));this._taskState.extraFuiAugmentations&&(o+=encodeURIComponent(this._taskState.extraFuiAugmentations+" "));this._taskState.keyRoutePoints&&this._taskState.keyRoutePoints.length>=2&&(o+=encodeURIComponent('satr:"true" '));!t||!(t.isPaginated||t.mapPannedOrZooomed||t.appliedFilterOption)||!this.viewModel||!i._isAttractionCategory(this.viewModel.getCardCategoryId())||this._taskState.keyRoutePoints&&this._taskState.keyRoutePoints.length>0||this._taskState.localFilters&&this._taskState.localFilters.indexOf('tsource:"OutdoorAttraction"')>-1||(o+=encodeURIComponent('tsource:"attraction" '));n.sendDoNotBlockResultsForSID&&this._taskState.listingCategoryPath&&i._isAttractionCategory(this._taskState.listingCategoryPath)&&this._taskState.id&&this._taskState.id.indexOf("sid:")>-1&&(o+=encodeURIComponent('DoNotBlockResultsForSID:"false" '));o+=this._getCacheId();e=e.replace("{title}",encodeURIComponent(dt));e=e.replace(new RegExp("{query}","gi"),gt).replace("{filter}",o);e=e.replace("{tid}",l._tabID);ut=this._taskState.keyRoutePoints;ut&&ut.length>=2&&(e+="&routePoints={points}",e=e.replace("{points}",this._getPointsString(ut)),g&&e.indexOf(l._disableOSearchParameter)===-1&&(e+=l._disableOSearchParameter));v="";this._taskState.primerPois&&this._taskState.primerPois.length>0&&(this._taskState.primerPois.forEach(function(n){v+=n.entity.id+","}),v=v.substr(0,v.length-1),v&&(e+="&localypids="+v));this._taskState.startDate&&this._taskState.endDate&&(e+="&ckin="+this._taskState.startDate+"&ckout="+this._taskState.endDate);var p=this._taskState.filterUrlParam,lt=p&&p.indexOf("sid:")>-1,fi=lt&&p.indexOf("eventid:")>-1,ii=lt&&p.indexOf('disp:"itr"')>-1||p&&p.indexOf('disp:"itrlist"')>-1;g&&!fi&&!ii&&(this._taskState.id&&this._taskState.id.indexOf("sid:")===0||lt)&&(e=e.replace("[AplusAnswer",'[AplusAnswer RequeryPage="Default"'));ii&&(this._taskState.noAds=!0);ri=i._getUrlParam(window.location,"overrideBfprAnswerPicker");ri=="true"&&(e+="&overrideBfprAnswerPicker=true");y&&e.indexOf("localMapView")<0&&(e+=y)}return d=n.formCodeMonitr,d&&window.location.href.toUpperCase().indexOf(d)>-1&&e.toUpperCase().indexOf(d)===-1&&(e+="&FORM="+d),this._updateTitle(),ui=n.newAdsClientSideCode?g?n.adsFromBfprWorkflow:n.adsFromBmfpWorkflow:n.adsFromWorkflow,this._taskState.noAds&&(vt=this._getTextAdsCode(),(vt==="r"||vt==="h")&&(this._taskState.noAds=!1)),ui&&wt.isEnabled()&&this._taskState&&!this._taskState.noAds&&(h=this._getTextAdsCode(),h&&(t&&t.mapPannedOrZooomed?i._isAttractionCategory(this.viewModel.getCardCategoryId())&&(h=null):(this._taskState.id||this._taskState.filterUrlParam)&&h!=="h"&&h!=="r"&&(h="d")),h&&(this._taskState.ads&&(h+=this._taskState.ads),e+="&ads="+h,et=ft.getMapCenter(this.map),et&&(e+="&cp="+et.latitude+"~"+et.longitude),at.logQueryEvent(this._taskState.entryPoint))),e=e.replace("{originIG}",this._taskState.originIG?this._taskState.originIG:""),yt=Logger.getOverlayType(),yt&&(e+="&OVRLY="+yt),this._taskState&&this._taskState.isFallbackRequery&&this._taskState.fallbackScenario&&(e+="&isFallbackQuery=true"),i._getIsSlideCardEnabled()&&this._taskState.disableWideCard&&(e+="&widecard=false"),pt=this._isThreeColumnsOk(t),w=this._taskState,w&&(w.isThreeColumnResponseExpected=pt),pt&&(e+="&3colok=true"),w&&w.entryPoint===u.LocalListing&&w.noCoBan&&(e+="&noCoBan=true"),bt=c.dynamicProperties.mapsIG,bt&&(e+="&MCIG="+bt),e},l.prototype._getTextAdsCode=function(){return"1"},l.prototype._isThreeColumnsOk=function(t){return _w&&_w.innerWidth&&n&&n.threeColumnMinBrowserWidth&&_w.innerWidth>=n.threeColumnMinBrowserWidth&&(!t||!t.isPaginated&&!t.appliedFilterOption&&!t.filterValueChanged&&!t.mapPannedOrZooomed)||this._taskState&&this._taskState.isThreeColumns?!0:!1},l.prototype.enableSearchAlongRoute=function(n){this._taskState&&n&&(this._taskState.directionsTaskId=n,this._invokeListenersAction(2,n))},l.prototype.disableSearchAlongRoute=function(n,t){t===void 0&&(t=!0);this._taskState&&(this._taskState.directionsTaskId&&n&&this._invokeListenersAction(3,this._taskState.directionsTaskId),this._taskState.keyRoutePoints=[],this._taskState.directionsTaskId=null,t&&this._refreshWithDelay())},l.prototype.isSearchAlongRouteEnabled=function(){return this._taskState&&this._taskState.directionsTaskId!=null},l.prototype._getAnswerPicked=function(){var n=this.panelRoot.select("div[data-answerpicked]"),t;return n&&n.length===1&&(t=n[0].getAttribute("data-answerpicked"),t)?t:""},l.prototype.microPoiRequestForLocalOverlayIsAllowed=function(){return this._taskState&&this._taskState.entryPoint&&i._isLocalOverlayShownOnSerp()&&(this._taskState.isFallbackRequery||this._taskState.entryPoint.lastIndexOf(u.Permalink)>-1)&&this._peekForLocalOverlayCategoryId(this.panelRoot)?!0:!1},l.prototype.sendPaginationRequest=function(n,t,r,f){var e=this,o,s,c;this._taskState.mapBounds=this._getLocalMapViewBounds();this._taskState.primerPois=null;this._taskState.entryPoint=u.ServerPagination;o=this._createUrl({isPaginated:!0},n,t);o&&(this.setPercentLoaded(0),s=function(n){e._showOrHideWaitLayer(!1);var t=e._convertToResponseObject(n),o=k.getEntitiesFromResponse(t,e._taskState),s=o&&o.entities;if(s&&s.length){e._logActivated(p.LLR,f?u.InfiniteScrollPagination:u.ServerPagination);var c=e.viewModel.getHouseListingCounts(t.select("div[data-houselistmetadata]")),l=c?c:s.length,a=r.updateDisplayState(l,k.parseNoMoreResults(t),t);if(!a)return;e.processResponse(t,{isPaginated:!0,isInfiniteScroll:f,infiniteScrollData:o});e.displayState&&e.displayState.prominence===1&&i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&sj_evt&&sj_evt.fire("SearchResponseReceived",{IG:h.getImpressionGuid(e.viewModel.panelRoot),primitives:e.viewModel.getPushpinPrimitives()});f||e.scrollLane.invoke(e.panelRoot);sj_evt.fire("OnCardRefresh",e.panelRoot,e.stackId)}else r.updateDisplayState(0,!1,t)},this._showOrHideWaitLayer(!0),c=function(){e._showOrHideWaitLayer(!1);r.updateDisplayState(0,!1,null)},et.downloadGeneric(o,"pagination",s,null,c,null,0,null,w.getLogKeyFromUrl(o)))},l.prototype._getCacheId=function(){var n="";return this._taskState.cacheId&&(n=encodeURIComponent('cacheid:"'+this._taskState.cacheId+'" ')),n},l.prototype._invokeListenersAction=function(n,t){var i={action:n,listenerId:this.id};e.invokeHandler(f.taskProcessDataHandlerKey,{requestState:i,type:s.directionsTask,taskId:t})},l.prototype._updateTitle=function(){this._initialTitle&&(this._taskState&&this._taskState.directionsTaskId&&this._taskState.keyRoutePoints&&this._taskState.keyRoutePoints.length>0?this.setTitle(i._formatString(r.L_LocalSearch_SearchAlongYourRouteTitle,this._initialTitle)):this.setTitle(this._initialTitle))},l.prototype._getPointsString=function(n){var t=n.map(function(n){return n.latitude+","+n.longitude});return t.join(",")},l.prototype._sendSearchRequest=function(n,r,f,e,o){var h=this,a,s,y,p,v;if(this._taskState&&this._taskState.entryPoint===u.Permalink&&(this._taskState.originalQuery=this._taskState.query),a=t(".cardPrimer"),!l._cardPrimerConsumed&&!this._taskState.isFallbackRequery&&this.map.getConfig().enablePoiPrimer&&a&&a.length>0&&(s=a.select(".contentRoot"),s&&s.length>0&&s[0].children.length>0)){l._cardPrimerConsumed=!0;this._parseResponse(s[0].innerHTML,r,f);return}n&&(y=this._taskState&&this._taskState.id?tt.ID:tt.SB,p=this._logHelper.perfStart(y),sj_evt.fire("v8SearchRequestStarted"),v=!1,et.downloadGeneric(n,"search",function(n){if(v=!0,p.end("NT"),sj_evt.fire("v8SearchResponseReceived"),o)try{h._logSearchProcessRequest(n)}catch(t){}(!i._isSmallMapShownOnSerp()||c.dynamicProperties.prefetchingResultsOnSerp||c.dynamicProperties.prefetchingDetailsOnSerp)&&(h.showCardPrimer(!1,r,e),h._parseResponse(n,r,f),sj_evt.fire("v8SearchResponseParsed"))},null,function(){v=!0;h.showCardPrimer(!1,r,e)},null,0,null,w.getLogKeyFromUrl(n)),v||this.showCardPrimer(!0,r,e))},l.prototype.showCardPrimer=function(n,t,i){ot.showLoadingSkeleton&&this._searchPrimer&&this._searchPrimer.showOrHideSearchCardPrimer(n,this,t,i)},l.prototype._logSearchProcessRequest=function(t){var f,i;if(t&&this._taskState){f=this._taskState.fullQuery||this._taskState.query;i=f||this._taskState.id;i||(i="");var r=this._convertToResponseObject(t),u=r.select("[data-answerinfo]").get_attr("data-answerinfo"),o=r.select("[data-traceid]").get_attr("data-traceid"),s=r.select("[data-answerpicked]").get_attr("data-answerpicked"),c=u&&n.scenarioKeys[u]?n.scenarioKeys[u]:"",e={EP:this._taskState.entryPoint,Q:i,BB:this._tryGetBounds(),SNRO:c,SIG:h.getImpressionGuid(r),MIG:this._getMasterImpressionGuid(),TRACE:o||"",AAP:s||""};this._logHelper.log(p.SPR,e,e.SIG)}},l.prototype._addImgUrlsToTaskState=function(n){var f,i,e,r,u,o;for(this._taskState.imgUrls=[],f=n.select(".mapsCustomInfoCard, .iclc, .iaplanner, [data-ovl], .entity-listing-container"),i=0;i<f.length&&this._taskState.imgUrls.length<4;i++)for(e=t(f[i]).select("img"),r=0;r<e.length&&this._taskState.imgUrls.length<4;r++)u=e[r].getAttribute("src"),o=u&&u.match("/th/?"),o&&o.length>-1&&this._taskState.imgUrls.push(u)},l.prototype._isInLocalOverlayCategoryIdList=function(t){var i,r;if(t&&n&&n.localOverlayOnSerpCategoryIDs&&(i=t.split("."),i&&i.length))for(r=0;r<i.length;++r)if(i[r]&&n.localOverlayOnSerpCategoryIDs.indexOf(i[r])>-1)return!0;return!1},l.prototype._isHotelListingRequeryOnOverlay=function(){var t=this._taskState.selectedCategoryId||this._taskState.category;return i._isLocalOverlayShownOnSerp()&&this._taskState.isFallbackRequery&&this._taskState.fallbackScenario&&n.multiEntityScenarios.indexOf(this._taskState.fallbackScenario)>-1&&this._isInHotelCategoryIdList(t)?!0:!1},l.prototype._isInHotelCategoryIdList=function(t){var i,u,r;if(t&&n&&n.poiCountOverrideByCategoryId&&(i=t.split("."),u=Object.keys(n.poiCountOverrideByCategoryId),u&&u.length&&i&&i.length))for(r=0;r<i.length;++r)if(i[r]&&u.indexOf(i[r])>-1)return!0;return!1},l.prototype._getPoiCountOverrideIfAny=function(t){var i,f,r,u;if(t&&n&&n.poiCountOverrideByCategoryId&&(i=t.split("."),f=Object.keys(n.poiCountOverrideByCategoryId),f&&f.length&&i&&i.length))for(r=0;r<i.length;++r)if(u=i[r]&&i[r].toLowerCase(),u&&f.indexOf(u)>-1&&n.poiCountOverrideByCategoryId[u])return n.poiCountOverrideByCategoryId[u];return null},l.prototype._getRequestUrlFormat=function(){if(i._isTravelOverlayShownOnSerp()&&(!n.useBfprFallbackSegments||!n.useBfprFallbackSegments.length||!this._taskState||!this._taskState.entryPoint||this._taskState.entryPoint===u.Permalink))return n.fallbackRequestUrlFormatForTravelOverlayOnSerp&&n.fallbackRequestUrlFormatForTravelOverlayOnSerp.length>10&&this._taskState&&this._taskState.isFallbackRequery?n.fallbackRequestUrlFormatForTravelOverlayOnSerp:(l._useBfpr=!0,this._taskState&&(this._taskState.useBfpr=!0),n.requestUrlFormatForTravelOverlayOnSerp);var t=i._getCoreConfig();return this._taskState.isFallbackRequery&&this._taskState.fallbackCategory&&this._taskState.fallbackCategory.toLowerCase().indexOf("attraction")>-1?this._taskState&&this._taskState.useBfpr?n.useBfprRequestUrlFormat:n.requestUrlFormat:n.fallbackRequestUrlFormat&&n.fallbackRequestUrlFormat.length>10&&this._taskState&&this._taskState.entryPoint&&this._taskState.isFallbackRequery?n.fallbackRequestUrlFormat:n.requestUrlFormatForEventDetailCard&&n.requestUrlFormatForEventDetailCard.length>10&&this._taskState&&(this._taskState.filterUrlParam&&this._taskState.filterUrlParam.indexOf("eventId")!==-1||this._taskState.id&&this._taskState.id.indexOf("eventId")!==-1)?n.requestUrlFormatForEventDetailCard:(this._taskState&&this._taskState.useBfpr&&(l._useBfpr=!0),n.fallbackBySegmentRequestUrlFormat&&n.fallbackBySegmentRequestUrlFormat.length>10&&this._taskState&&this._taskState.isFallbackRequery&&this._taskState.useBfpr)?n.fallbackBySegmentRequestUrlFormat:l._useBfpr?n.useBfprRequestUrlFormat:this._taskState&&this._taskState.useBmfp?n.useBmfpRequestUrlFormat:n.requestUrlFormat},l.prototype._overridePoiCount=function(){var t=this._taskState&&this._taskState.searchQueryCategory;!t&&this._taskState&&this._taskState.filterUrlParam&&this._taskState.filterUrlParam.indexOf('entitysegment:"Attraction"')>-1&&(t="Attraction");t&&this._taskState.entryPoint&&this._taskState.entryPoint===u.Permalink&&n.categoriesWithServerPagination&&n.categoriesWithServerPagination.length&&n.categoriesWithServerPagination.indexOf(t.toLowerCase())>-1&&(this._taskState.poiCount=n.useNewListingSearchCount?n.listingSearchCount.toString():n.threeColumnListSegmentsEnabled&&n.threeColumnListSegmentsEnabled.length>0&&n.threeColumnListSegmentsEnabled.indexOf(t)>-1&&this._isThreeColumnsOk(null)?"21":"20",this._taskState.isFallbackRequery=!0);t&&n.waterfallEnabledCategories&&n.waterfallEnabledCategories.length>0&&n.waterfallEnabledCategories.indexOf(t.toLowerCase())>=0&&(this._taskState.poiCount="50")},l.prototype._peekForLocalOverlayCategoryId=function(t){if(t&&n&&n.localOverlayOnSerpCategoryIDs){var i=k.parseCategory(t);return i&&(this._taskState.category=i),this._isInLocalOverlayCategoryIdList(i)}return!1},l.prototype._peekForNoResult=function(n){var t,i;return n&&(t=n.select("div[data-answerinfo]"),t&&t.length)?(i=t.get_attr("data-answerinfo"),i==="0"):!1},l.prototype._useBfprFallbackBySegmentFound=function(i,r){var f=n.useBfprFallbackSegments,u,e,c,l,s,h,a,o;if(f&&f.length&&this._taskState&&this._taskState.useBfpr&&!this._taskState.useBmfp&&n.fallbackBySegmentRequestUrlFormat&&n.fallbackBySegmentRequestUrlFormat.length>10){if(i){if(u=i.split("."),u&&u.length)for(e=0;e<u.length;++e)if(u[e]&&f.indexOf(u[e])>-1)return!1}else if(r){if(c=r.select("[data-answerinfo]").get_attr("data-answerinfo"),c&&f.indexOf(c)>-1)return!1;for(l=r.select("div.overlay-taskpane"),s=0;s<l.length;s++)if(h=l[s].getAttribute("data-entity"),h&&h.length&&(a=t.Internals.parseJSON(h),o=a&&a.entity,o&&o.segmentTypes&&o.segmentTypes.length>0&&o.segmentTypes.filter(function(n){return f.indexOf(n)>-1}).length>0))return!1}return!0}return!1},l.prototype._isHotelsFallback=function(t,r){return i._isHotelsCategory(t)&&n.enableCustomHotelsExperience?(this._taskState.category=t,this._taskState.pivotEntity=r&&r.select("div[data-pivot]").get_attr("data-pivot"),!0):!1},l.prototype._isRestaurantsFallback=function(t,r){return i._isRestaurantCategory(t)&&n.enableCustomRestaurantsExperience?(this._taskState.category=t,this._taskState.pivotEntity=r&&r.select("div[data-pivot]").get_attr("data-pivot"),!0):!1},l.prototype._isRealEstateFallback=function(n,t){return i._isHouseCategory(t)&&k.parseAnswerInfo(n,this._taskState).intentKey==="multiEntity"?(this._taskState.originalResponse=n,!0):!1},l.prototype._isOutingsFallback=function(t){if(n.useNewListingSearchCount)return!1;var r="20",i=t&&t.toLowerCase(),f=i&&(i.indexOf("attraction")>-1||i.indexOf("protectedsite")>-1||i.indexOf("trail")>-1&&n.threeColumnListSegmentsEnabled&&n.threeColumnListSegmentsEnabled.indexOf("Trail")>-1),e=[u.SearchBox,u.SearchButton,u.Permalink,u.Autosuggest];if(this._taskState&&f&&e.indexOf(this._taskState.entryPoint)>-1){if(n.categoriesWithServerPagination&&n.categoriesWithServerPagination.length&&n.categoriesWithServerPagination.indexOf(i)>-1)return n.threeColumnListSegmentsEnabled&&n.threeColumnListSegmentsEnabled.length>0&&n.threeColumnListSegmentsEnabled.indexOf(t)>-1&&this._isThreeColumnsOk(null)?(this._taskState.poiCount="21",!0):this._taskState.poiCount&&this._taskState.poiCount.indexOf(r)<0?(this._taskState.poiCount=r,!0):!1;if(!this._taskState.poiCount)return this._taskState.poiCount="50",!0}return!1},l.prototype._fallbackIfNoResultsFoundInResponse=function(t){return!(this._taskState&&this._taskState.useBmfp)&&n.fallbackRequestUrlFormat&&n.fallbackRequestUrlFormat.length>10&&this._peekForNoResult(t)},l.prototype._parseResponse=function(t,r,o){var h=this._convertToResponseObject(t),v,a;this._taskState||(this._taskState=r.requestState);this._taskState.isFallbackRequery&&i._isHouseCategory(this._taskState.category||this._taskState.searchQueryCategory)&&this._taskState.originalResponse&&this._peekForNoResult(h)&&(h=this._taskState.originalResponse,this._taskState.originalResponse=null);this._addImgUrlsToTaskState(h);this._taskState.searchPerfState=this._searchPerfState;var p=this._taskState.entryPoint,w=p===u.TaskBar&&this._checkDirectionsIntent(h.select("[data-answerinfo]").get_attr("data-answerinfo")),c=k.parseCategory(h),l=this._useBfprFallbackBySegmentFound(c,h),y=this._isHotelsFallback(c,h)||this._isRestaurantsFallback(c,h);if(this._taskState.disableTaskActivate&&!w){if(v=this._peekForNoResult(h),!this._taskState.isFallbackRequery&&(v||l)&&(n.fallbackRequestUrlFormat&&n.fallbackRequestUrlFormat.length>10||l||n.fallbackRequestUrlFormatForTravelOverlayOnSerp&&n.fallbackRequestUrlFormatForTravelOverlayOnSerp.length>10&&i._isTravelOverlayShownOnSerp())){this._taskState.originalProcessInputData=r;r.requestorId||(this._taskState.originalProcessInputData.requestorId=this.id);this._requestFallback(h,l);v&&o&&(this._taskState.originalCallback=o);return}a=k.getEntitiesFromResponse(h,this._taskState);this._taskState.isFallbackRequery&&this._taskState.originalCallback?this._taskState.originalCallback({originalProcessInputData:this._taskState.originalProcessInputData,data:{content:h,entities:a&&a.entities}}):o&&o({originalProcessInputData:this._taskState.isFallbackRequery?this._taskState.originalProcessInputData:null,data:{content:h,entities:a&&a.entities}})}else!this._taskState.isFallbackRequery&&(this._isOutingsFallback(c,h)||y||this._fallbackIfNoResultsFoundInResponse(h)||l)?this._requestFallback(h,l&&!y):!this._taskState.isFallbackRequery&&n.fallbackRequestUrlFormatForTravelOverlayOnSerp&&n.fallbackRequestUrlFormatForTravelOverlayOnSerp.length>10&&i._isTravelOverlayShownOnSerp()&&this._peekForNoResult(h)?this._requestFallback(h):i._isZipCodeCategory(this._taskState.category||c)?(this._taskState.category||(this._taskState.category=c),this._shouldRequeryForZipCode(h,this._taskState)?(this._taskState.originalResponse=h,e.invokeHandler(f.taskProcessDataHandlerKey,{requestState:this._taskState,type:s.polygonListingTask})):(this._taskState.originalResponse&&(this._mergeResponses(h,this._taskState.originalResponse),delete this._taskState.originalResponse),k.parseResponse(h,this._taskState,this._trafficLayer,this.map))):k.parseResponse(h,this._taskState,this._trafficLayer,this.map)},l.prototype._requestFallback=function(t,i){var c,r,o,l,u,v,a,y;i===void 0&&(i=!1);c="";r="";t&&(o=t.select("div[data-answerinfo]"),o&&o.length&&(r=o.get_attr("data-answerinfo"),r&&(c=n.scenarioKeys[r])));this._taskState.isFallbackRequery=!0;this._taskState.fallbackScenario=r;this._taskState.fallbackCategory=k.parseCategory(t);l=t.select("div[data-iscategoryquery]").get_attr("data-iscategoryquery");l&&(this._taskState.isCategoryQuery=l.toLowerCase()==="true");u={Q:this._taskState.query?this._taskState.query:this._taskState.fullQuery?this._taskState.fullQuery:"",EP:this._taskState.entryPoint,SNRO:c};u.SIG=h.getImpressionGuid(t);u.MIG=h.getMasterImpressionGuid();this._logHelper&&this._logHelper.log(p.FLBK,u,u.SIG);v=this._peekForNoResult(t)?!1:!0;v&&!i?(a=k.parseAnswerInfo(t,this._taskState),y=a.intentKey==="multiEntity"?s.localListingTask:a.intentKey==="singleEntity"?s.localDetailsTask:s.localSearchTask,k.invokeTask(y,t,this._taskState,!1)):e.invokeHandler(f.taskProcessDataHandlerKey,{requestState:this._taskState,type:s.localSearchTask})},l.prototype._checkDirectionsIntent=function(t){return n.directionsIntentDrivingScenarios.indexOf(t)>=0?!0:n.directionsIntentTransitScenarios.indexOf(t)>=0||n.directionsIntentWalkingScenarios.indexOf(t)>=0?!0:void 0},l.prototype._shouldRequeryForZipCode=function(n,t){var e=!1,r,f,u;return i._isZipCodeCategory(t.category)&&(r=this._getItemCountsFromResponse(n),r&&(f=r[1]+r[2],u=t.originalResponse&&this._getItemCountsFromResponse(t.originalResponse),u&&(f+=u[1]+u[2]),e=f<r[0])),e},l.prototype._getItemCountsFromResponse=function(n){var t=n.select("div.overlay-listings").get_attr("data-listingMetadata");if(t.length>0){var i=JSON.parse(t),r=parseInt(i.TotalCount),u=parseInt(i.BlockedCount),f=n.select(".listings-item").length;return[r,u,f]}return null},l.prototype._mergeResponses=function(n,i){var u=this._getItemCountsFromResponse(n),f=this._getItemCountsFromResponse(i);if(u&&f){var e="data-listingMetadata",o=n.select("div.overlay-listings"),c=o.get_attr(e),s=JSON.parse(c);s.BlockedCount=(u[1]+f[1]).toString();o.set_attr(e,JSON.stringify(s));var h=".listings-item",r=n.select(h).getParent(),l=i.select(h),a=n.select(".b_vList");l.for_each(function(n){r&&r.length&&n&&a.insertBefore(t(n).getParent(),r)})}},l.prototype._tryParsingWithDOMParser=function(n){try{var i=new DOMParser;return t(i.parseFromString("<div>"+n+"<\/div>","text/html").firstChild.childNodes[1].firstChild)}catch(r){return nr.assert(!1,"Error parsing the response: "+r),null}},l.prototype._convertToResponseObject=function(n){var i=this._tryParsingWithDOMParser(n);return i||(i=t(document.createElement("div")),i.set_html(n)),i},l.prototype._getLocationInfo=function(){try{var t,n=this._taskState.point;return n&&n.length===2?l._circularViewFormat.replace("{0}",n[0].toString()).replace("{1}",n[1].toString()).replace("{2}",l._radiusInMeters):(t=this._taskState.mapBounds&&this._taskState.mapBounds.length===4?this._taskState.mapBounds:this._getLocalMapViewBounds(),l._mapViewFormat.replace("{0}",t.join(",")))}catch(i){return""}},l.prototype.isSharable=function(){return this.getMapPrimitives()&&this.getMapPrimitives().length>0},l.prototype.getMenuList=function(){for(var u,o,t=[],s=!1,i=0;i<t.length;i++)if(t[i].name.indexOf("print")||t[i].name.indexOf("Print")){s=!0;break}if(!s&&this.hasPrintContent()&&(u=this,t.push({name:r.L_Menu_Print_Link_Text,handler:function(){e.invokeHandler(f.printDataHandlerKey,{source:2,taskType:u.type,taskId:u.id,data:u.getPrintInstrumentationData()})},cssClass:"menuPrintItem",instData:this.getInstData("Print")})),o=this.viewModel,o&&o.annotationControl){var n=o.annotationControl,h=n.getCurrentName(),c=n.getDescription();t.push({name:n.displayNameChangeMessage(h),handler:function(){n.onAddNicknameClick.apply(n)}});t.push({name:n.displayNoteChangeMessage(c),handler:function(){n.onAddDescriptionClick.apply(n)}});n.displayDeleteNickName(h)===""&&t.push({name:r.L_DeleteNickNameOption,handler:function(){n.onDeleteNicknameClick.apply(n)}});n.getDescription()&&t.push({name:r.L_DeleteNoteOption,handler:function(){n.onDeleteDescriptionClick.apply(n)}})}return this.isReportable()&&(this.getReportType()===4?this.shoudEnableSuggestAnEdit()&&t.push(this._getLocalFeedbackListData()):t.push(this._getFeedbackListData())),t},l.prototype._updateRoutePoints=function(n){if(this._categories)for(var t=0,i=this._categories.length;t<i;t++)e.invokeHandler(f.layerManagerDataHandlerKey,{action:"updateRoutePoints",entryPoint:u.LocalListingAlongRoute,category:this._categories[t],taskId:this.id,routePoints:n})},l.prototype.openReportLocalProblemLink=function(){var n=this.viewModel.reportLocalProblemLinkURL;n&&window.open(n,"_blank")},l.prototype._getFeedbackListData=function(){return{name:r.L_Menu_ReportProblem_Link_Text,options:{type:s.feedbackTask,activateOptions:{parentId:this.id},state:{entryPoint:2,feedbackTaskType:3,activeTaskId:this.id,title:this.getTitle(),options:this.getReportOptions()}},cssClass:"menuReportAProblemItem",instData:this.getInstData("Report Problem")}},l.cleanupPrimerData=function(n){l._removeCardPrimer(n);l._removePoiPrimerLayer(n)},l.parseDataFact=function(n){var t=null;if(n)try{t=JSON.parse(n)}catch(i){}return t},l._removeCardPrimer=function(r){if(r.getConfig().enablePoiPrimer){var u=t(".cardPrimer");u&&u.length>0&&!l._removeCardPrimerTimer&&(l._removeCardPrimerTimer=Microsoft.Maps.setTimeout(function(){l._removeCardPrimerTimer=null;!n.showContentFirstForPermalinks||i._getUrlParam(window.location,"disablecf")==="1"?u&&u.removeFromParent():u.set_style({display:"none"})},500))}},l._removePoiPrimerLayer=function(n){for(var t=n.getLayers(),i,r=0,u=t.length;r<u;r++)if(t[r].getId()==="PoiPrimer"){i=t[r];break}i&&n.getFrameManager().frameRendered.addOne(function(){t.remove(i);i.dispose()})},l.prototype._buildTaskStateWithPrimerPois=function(){var n={};for(var t in this._taskState)this._taskState.hasOwnProperty(t)&&(n[t]=this._taskState[t]);return n.primerPois=this._getPrimerPoisFromViewModel(),n},l.prototype._getPrimerPoisFromViewModel=function(){var r=[],i=this.viewModel.getPushpinPrimitives(),u=i.length>5?5:i.length,t,n;for((this.type===s.localDetailsTask||this.type===s.polygonEntityDetailsTask)&&(u=1),t=0;t<u;t++)n=i[t],r.push({geometry:{y:Math.round(n.geometry.y*1e6)/1e6,x:Math.round(n.geometry.x*1e6)/1e6,bounds:[]},entity:{title:n.entity.getTitle(),id:n.entity.id,subtitle:n.entity.getAddress()}});return r},l.prototype._reduceLatLonPrecisions=function(){var n;if(this._taskState){if(this._taskState.mapBounds&&this._taskState.mapBounds.length>0)for(n=0;n<this._taskState.mapBounds.length;n++)this._taskState.mapBounds[n]&&(this._taskState.mapBounds[n]=Math.round(this._taskState.mapBounds[n]*1e6)/1e6);if(this._taskState.point&&this._taskState.point.length>0)for(n=0;n<this._taskState.point.length;n++)this._taskState.point[n]&&(this._taskState.point[n]=Math.round(this._taskState.point[n]*1e6)/1e6);if(this._taskState.keyRoutePoints&&this._taskState.keyRoutePoints.length>0)for(n=0;n<this._taskState.keyRoutePoints.length;n++)this._taskState.keyRoutePoints[n]&&(this._taskState.keyRoutePoints[n].latitude=Math.round(this._taskState.keyRoutePoints[n].latitude*1e6)/1e6,this._taskState.keyRoutePoints[n].longitude=Math.round(this._taskState.keyRoutePoints[n].longitude*1e6)/1e6)}},l.prototype._getLocalFeedbackListData=function(){return{name:r.L_Menu_SuggestAnEdit_Link_Text,options:{type:s.feedbackTask,activateOptions:{parentId:this.id},state:{entryPoint:2,feedbackTaskType:4,activeTaskId:this.id,title:r.L_Menu_SuggestAnEdit_Link_Text+" - "+this.getTitle(),options:this.getLocalReportOptions()}},cssClass:"menuLocalFeedback",instData:this.getInstData("Suggest an Edit")}},l.prototype.getReportOptions=function(){var n=null;return this.getReportType()!==1&&this.getReportType()!==6&&this.viewModel&&this.viewModel.getEntities()&&this.viewModel.getEntities().length>0&&(n=this.viewModel.getEntities()[0].getLocation()),{query:this._taskState.query,reportType:this.getReportType(),pushPinLocation:n,reportLocalProblemLinkURL:this.viewModel.reportLocalProblemLinkURL,taskStateId:this._taskState.id,scenarioKey:this._taskState.scenarioKey,userFacts:this.loadUserFacts(),rapEntryPoint:3}},l.prototype.getLocalReportOptions=function(){var n={},t,i;return this.getReportType()!==1&&this.viewModel&&this.viewModel.getEntities()&&this.viewModel.getEntities().length>0&&(n.pushPinLocation=this.viewModel.getEntities()[0].getLocation(),n.entityName=this.viewModel.getEntities()[0].getTitle(),n.entityYpid=this.viewModel.getEntities()[0].id),t=this.loadDataFacts(),t&&(n.dataFacts=t),i=this.loadUserFacts(),i&&(n.userFacts=i),n.query=this._taskState.query,n.reportType=this.getReportType(),n},l.prototype.loadDataFacts=function(){var n=this.panelRoot.select("div.overlay-taskpane").get_attr("data-facts");return l.parseDataFact(n)},l.prototype.loadUserFacts=function(){var n=null,t=this.panelRoot.select("div[data-ufacts]").get_attr("data-ufacts");if(t)try{n=JSON.parse(t)}catch(i){}return n},l.prototype.isReportable=function(){return this._taskState&&this.getReportType()!==0},l.prototype.isPrintable=function(){var n=this.viewModel?this.viewModel.getPushpinPrimitives():null;return cr.isEnabled&&n&&n.length>0},l.prototype.getReportType=function(){var i=this._taskState.scenarioKey,t=0;return n.reportAsNotFoundKeys.indexOf(i)>-1&&(t=1),n.reportAsMultiBusinessKeys.indexOf(i)>-1?t=6:n.reportAsAddressKeys.indexOf(i)>-1?t=this._taskState.entryPoint===u.ContextMenu?3:2:n.reportAsPlaceKeys.indexOf(i)>-1?t=5:n.reportAsLocalKeys.indexOf(i)>-1&&(t=4),t},l.prototype.getEntityMarket=function(){var n=this.loadDataFacts();return n&&n.languageCultureName?n.languageCultureName:""},l.prototype.shoudEnableSuggestAnEdit=function(){var t=!1,u=this.getEntityMarket(),i=it.ftwMarkets,n,r;if(i!=undefined){n=i.split(",");for(r in n)if(n[r].toLowerCase()===u.toLowerCase()){t=!0;break}}return t},l.prototype._getQueryParam=function(){var n="";return this._taskState&&(n+=encodeURIComponent(this._taskState.query||this._taskState.taskTitle)),n},l.prototype._getSegmentParam=function(){return""},l.prototype._getFiltersParam=function(){var n="";return this._taskState&&this._taskState.localFilters&&(n+=encodeURIComponent(this._taskState.localFilters+" ")),n},l.prototype._setViewportPaddingForCardSide=function(n){var t=this.map.getViewportPadding();t&&(t[i._isRtl()?"right":"left"]=n,this.map.setViewportPadding(t))},l._disableOSearchParameter="&DisableOSearch=1",l._circularViewFormat="&localCircularView={0},{1},{2}",l._mapViewFormat="&localMapView={0}",l._useBfpr=!1,l._cardPrimerConsumed=!1,l._overlayCloseBtnListenerAdded=!1,l._radiusInMeters="16000",l._tabID=_G.IG,l.mouseoverTimeout=500,l.mouseoutTimeout=500,l}(h),rt=function(o){function c(n,t,i,r,u,f,e,h,c,l){var a=o.call(this,n,f,t,r)||this;return a.showCloseButton=!0,a.type=s.localDetailsTask,a.poiManager=i,a._controlTemplateFactory=h,a._buttonGroupViewModel=u,a.disposables.push(a.poiManager.contextMenuInvoked.add(function(n){return a._contextMenuInvoked(n)})),a.disposables.push(a.poiManager.poiTapped.add(function(){return a._poiTapped()})),a.disposables.push(a.poiManager.poiHoverStarted.add(function(n){return a._poiHoverStarted(n)})),a.disposables.push(a.poiManager.poiHoverStopped.add(function(){return a._poiHoverStopped()})),a.disposables.push(a.poiManager.mapViewChanged.add(function(n){return a.updateMapBounds(n)})),a._syndicatedAds=e,a._taskBar=c,a._geochainManager=l,a.scrollToTop=new g,a._taskUrlParams.push({param:"sid",paramGetter:function(){return a._getSidParam()}}),a._taskUrlParams.push({param:"ypid",paramGetter:function(){return a._getYpidParam()}}),a._taskUrlParams.push({param:"eventid",paramGetter:function(){return a._getEventIdParam()}}),a}return y(c,o),c.prototype.activate=function(n,i,r,u){var f=this,s,h,e;i&&(this.viewModel=new hi(this.map,this.panelRoot,this.id,this._logHelper,this._transientLensViewModel,this._buttonGroupViewModel,this._taskBar,i,this._controlTemplateFactory,this.primitiveInteracted),this.registerViewModelEvents(),s=i.taskTitle?i.taskTitle:i.fullQuery||i.query,this.setTitle(s),this.disposables.push(this.viewModel.titleChanged.add(function(n){f.setTitle(n);var t=f.viewModel;t.updatePoiTitle(n);t.resetPrimitives(f.poiManager)})),o.prototype.activate.call(this,n,i),i.content?(i.scenarioKey||(e=k.parseAnswerInfo(i.content,i),i.scenarioKey=e&&e.scenarioKey?e.scenarioKey:null),this._processLocalDetails(i)):(i.disableTaskActivate=!0,h={requestState:i},o.prototype.process.call(this,h,function(n){f.processResponse(n.data.content);f._suppressProcessDetails()||f._processLocalDetails(i);sj_evt&&f.displayState&&f.displayState.stackOrder===1&&sj_evt.fire("OnCardRefresh",f.panelRoot,f.stackId)},u)),i&&i.scrollElement&&i.scrollElement.length>0&&sj_evt.bind("bm_scrollCard",function(){f.scrollToTop.invoke(t(i.scrollElement))}),this._sendProductAdsAjax(i))},c.prototype.process=function(n,t){var i=n&&n.requestState,r,u;i&&(i.hideBackButton&&i.listingTaskId?(r=this.panelRoot.select(".commonButton.backArrowButton.overlayButton"),u=r.get_attr(f.taskDataHandlerKey),u&&u.indexOf(i.listingTaskId)>0&&(r.set_style({display:"none"}),r.parent().set_style({display:"none"})),t&&t({processorId:this.id,data:{}})):o.prototype.process.call(this,n,t))},c.prototype.deactivate=function(){var r,n,t;if(this._taskState.openingNewCard||this._taskState.flippingCard){var u=this._taskState.openingNewCard?!1:!0,i=this.viewModel&&this.viewModel.getEntities(),h={showEntity:!0,selectedEntityId:i&&i.length>0?i[0].id:null},c={requestorType:s.localDetailsTask,requestorId:this.id,type:s.localListingTask,requestState:h,useActiveTasks:u};e.invokeHandler(f.taskProcessDataHandlerKey,c)}this._firstFrameRenderedHandler&&this._firstFrameRenderedHandler.dispose();o.prototype.deactivate.call(this);r=this.panelRoot.select("a[data-streetside]");r.set_style({opacity:0});n=this.panelRoot.select("#bev2Img");n&&n.length>0&&n.set_style({opacity:0});t=this.panelRoot.select(".tp_tasks");t&&t.length>0&&t.set_style({opacity:0})},c.prototype.setTaskComplete=function(){var n=this,h=this._taskState&&this._taskState.id?tt.ID:tt.SB,c=this._logHelper.perfStart(h),r,t,u;if(this.map.getConfig().cardPrimerIsShown&&!l.hasCardPrimerPerfDataLogged&&(r=window.$cp_bsperf=window.$cp_bsperf||{},r.Maps_CP_CLT=r.Maps_CP_CLT||performance.now(),w.record("Maps_CP_LDT",Math.round(r.Maps_CP_CLT))),this._firstFrameRenderedHandler&&this._firstFrameRenderedHandler.dispose(),w.removeKey("SearchRequest"),this._firstFrameRenderedHandler=this.map.getFrameManager().frameRendered.addOne(function(){var t,r,u;n._firstFrameRenderedHandler.dispose();t=w.getStartTime(n.id,!0);t&&(w.log("Maps_LDTTG",t),n.map.getConfig().cardPrimerIsShown&&!l.hasCardPrimerPerfDataLogged&&(w.log("Maps_CP_LDTTG",performance.timing.navigationStart),l.hasCardPrimerPerfDataLogged=!0),r=Microsoft.Maps.Local,u=n instanceof r.HotelsDetailsTask?"Maps_HLDTTG":n instanceof r.RestaurantDetailsTask?"Maps_RLDTTG":n instanceof r.HouseDetailsTask?"Maps_RELDTTG":i._isAttractionCategory(n.viewModel.getCardCategoryId())?"Maps_ALDTTG":"",u&&w.log(u,t));c.end("RT");n.viewModel&&n.viewModel.loadDelayedRecommendationModuleImages();n.viewModel&&n.viewModel.enableAdsShownLogging(n.laneScrolled)}),t=this.viewModel.getEntities(),t&&t.length>0&&(u=t[0],this.poiManager&&this.poiManager.setTargetMapView(this.viewModel.boundingBox),this.setTitle(this._taskState&&this._taskState.taskTitle?this._taskState.taskTitle:u.getTitle()),this._taskState.id||(this._taskState.id=u.id),this._taskState.taskTitle&&this._taskState.overridePoiTitle&&this.viewModel.updatePoiTitle(this._taskState.taskTitle)),o.prototype.setTaskComplete.call(this),(this._taskState.flippingCard||this._taskState.openingNewCard)&&t&&t.length>0){var a={hideEntity:!0,selectedEntityId:t[0].id},v=this._taskState.openingNewCard?!1:!0,y={requestorType:s.localDetailsTask,requestorId:this.id,type:s.localListingTask,requestState:a,useActiveTasks:v};e.invokeHandler(f.taskProcessDataHandlerKey,y)}this.determineCloseButton()},c.prototype.processResponse=function(n,t){var i=this;o.prototype.processResponse.call(this,n,t);this.panelRoot&&(this.panelRoot.add_event("click",function(n){n&&n.target&&n.target.tagName.toLowerCase()==="a"&&i._logInstrumentationEventForEntityClick()}),this._showDestinationItinerariesModule(),this._showProductAdsModule(),this._fetchHotelAdsIfOpalActionWhereToStay())},c.prototype._suppressProcessDetails=function(){return!1},c.prototype.serialize=function(n,t){var r=o.prototype.serialize.call(this,n),i=this.viewModel,u,f;return r&&i&&i.calendarSync&&i.calendarSync.length&&i.calendarSync[0]&&(r.dateTime=i.calendarSync[0].getStartDateTime()),u=i&&i.annotationControl,f=r,r&&u&&u.getCurrentName()!==u.getOriginalName()&&(f.originalName=u.getOriginalName()),r&&t&&t===2&&(f.hideBackButton=!0,f.flippingCard=!1),r},c.prototype.getOriginalName=function(){var t=this.viewModel,n=t&&t.annotationControl;return n&&n.getCurrentName()!==n.getOriginalName()?n.getOriginalName():""},c.prototype.getNotes=function(){var n=this.viewModel,t=n&&n.annotationControl;return t?t.getDescription():""},c.prototype.canColorFade=function(){return!1},c.prototype.hasPrintContent=function(){return this.isPrintable()},c.prototype.getPrintContent=function(){var r=this,n,t;return this.hasPrintContent()?(n=null,this.viewModel instanceof hi&&(n=this.viewModel.getDetailsHtmlContentForPrint(this.loadDataFacts())),t=new ri,t.insert(this.poiManager.getLayerId(),0),ar.onPrintDialogClose.addOne(function(){return i._refocusPrintDropDownMenu(r.id)}),n?new lr(n,t,null):null):null},c.prototype.getShareDescription=function(){var i,r,u,n="",f=String.fromCharCode(183),o=this.viewModel.getEntities(),e=this.loadDataFacts(),t;return(e&&e.price&&(r=e.price),o.length===1&&(t=o[0],i=t.getAddress()||t.getDescription(),u=t.getPrimaryCategoryName()),i&&(n+=i),r&&(n+=f+r),u&&(n+=f+u),n.length&&n.charAt(0)===f&&(n=n.substr(1)),n===t.getTitle())?"":n},c.prototype.setDisplayState=function(n){o.prototype.setDisplayState.call(this,n);n.activationState===1&&n.prominence===1&&(ti&&ti.isEditable&&!this._itineraryTaskChecked&&this._checkItineraryTasks(),this.determineCloseButton(),this._launchOverflowOnActivation());var t=this.panelRoot.select("a[data-streetside]");n.activationState===2||n.activationState===3?t.set_style({opacity:0}):n.activationState===1&&t.set_style({opacity:1})},c.prototype._onPoiViewStateChanged=function(n){var t,i,r;n&&n.primitive&&n.primitive.entity instanceof vr&&n.newValue!==n.oldValue&&(this._logPoiHoverIfNecessary(n,u.LocalDetails),t=n.primitive.entity,t&&t.id&&n.newValue===2&&(i={entryPoint:u.POI,id:t.id,openingNewCard:!0,taskTitle:t.getTitle()},r={taskColorIndex:this.displayState.colorIndex,groupName:this.id},e.invokeHandler(f.taskDataHandlerKey,{type:s.localDetailsTask,state:i,activateOptions:r})))},c.prototype._createUrl=function(n,t,i){var r=o.prototype._createUrl.call(this,n,t,i);return this._taskState&&this._taskState.adProviderId&&(r+="&enablerelprod=true"),r},c.prototype._registerOverlayLinksForInstrumentation=function(n,t,i,r){var e=this,u=this.panelRoot!=null?this.panelRoot.select(n):null,f,o;if(u&&u.length>0)for(f=u.length,o=function(){var n=u[f],o;n&&(o=n.getAttribute("h")||n.getAttribute("data-h"),o&&(n.removeAttribute("h"),n.removeAttribute("data-h"),n.setAttribute("h1",o),sj_be(n,"click",function(u){var f,s=Microsoft.Maps.logger,h,o,c;s&&(h={T:i,feature:t,action:i,data:(f={},f[r]=n.href,f)},s.logObject(h,e._getImpressionGuid(),!1));o=n.getAttribute("h1");o&&(c=_G.IG,_G.IG=e._getImpressionGuid(),n.setAttribute("h",o),_w.si_ct&&_w.si_ct(n,!1,u),_G.IG=c,n.removeAttribute("h"))})))};--f>=0;)o()},c.prototype._showProductAdsModule=function(){var t=this.panelRoot.select("div.productAdsModuleContainer");if(t&&t.length){if(t.getParent().add_class("hideControl"),!this._taskState||!this._taskState.adProviderId||!this._taskState.adQuery||!this._taskState.adImpressionGuid||!this._taskState.adYpid||!this._taskState.adRetailEntitySource||!n.requestUrlFormatForProductAdsModule)return;this._productAdsResponse?this._productAdsResponseHandler(this._productAdsResponse,t):this._productAdsContainer=t}},c.prototype._productAdsResponseHandler=function(n,t){var i=this;Microsoft.Maps.setTimeout(function(){n&&t&&t.length&&(t.getParent().remove_class("hideControl"),t.appendHTML(n),i.viewModel&&i.viewModel.addProductAdsClientInstrumentation());var r=t.select("div.carouselPlaceHolder");r&&r.length&&r.set_style({display:"none"})},5)},c.prototype._sendProductAdsAjax=function(t){var i=this,r;t&&t.adProviderId&&t.adQuery&&t.adImpressionGuid&&t.adYpid&&t.adRetailEntitySource&&n.requestUrlFormatForProductAdsModule&&(r=n.requestUrlFormatForProductAdsModule.replace("{query}",t.adQuery).replace("{provid}",t.adProviderId).replace("{storeid}",t.adStoreId||"").replace("{ig}",t.adImpressionGuid).replace("{ypid}",t.adYpid).replace("{rsource}",t.adRetailEntitySource).replace("{bizloc}",this._taskState.adBusinessLocationId||"").replace("{trigtype}",this._taskState.adTriggerType||""),et.downloadGeneric(r,"productadsajax",function(n){n&&(i._productAdsContainer?i._productAdsResponseHandler(n,i._productAdsContainer):i._productAdsResponse=n)},null,function(){i._productAdsResponse=null},null,0))},c.prototype._showDestinationItinerariesModule=function(){var r=this,t=this.panelRoot.select("div.itinerariesModuleContainer"),i,u;if(t&&t.length){if(i=t.get_attr("data-entitysid"),!n.requestUrlFormatForItineraryModule||!i){t.getParent().set_style({display:"none"});return}i&&(u=n.requestUrlFormatForItineraryModule.replace("{l2sid}",i),et.downloadGeneric(u,"travell2ajax",function(n){n?(t.appendHTML(n),r._setAddItineraryDataTask(t),r._overrideGlinkPing()):t.getParent().set_style({display:"none"})},null,function(){t.getParent().set_style({display:"none"})},null,0))}},c.prototype._findHotelAdsIndex=function(n,t){if(n&&n.length&&t)for(var i=0;i<n.length;i++)if(n[i]&&n[i].EntityId&&n[i].EntityId.indexOf(t)>-1)return i;return-1},c.prototype._fetchHotelAdsIfOpalActionWhereToStay=function(){var u=this,r=this.panelRoot.select("div.EntityCollectionModuleContainer");r&&r.length&&r.for_each(function(r){var o=r.getAttribute("data-moduletag"),e,f;if(o&&o.indexOf("MapsModule.WhereToStayOpalAction")>-1&&(e=r.getAttribute("data-hoteladsajax"),f=u._getImpressionGuid(),e&&f)){t(r).set_style({display:"none"});et.downloadGeneric(e+"&IG="+f+"&originig="+f,"hoteladsajax",function(f){var e,o,s;if(f)try{e=t.Internals.parseJSON(f);e&&e.length&&(o=t(r).select("div[class=slide]"),o&&o.length&&(s=[],o.for_each(function(n){var v=t(n).select("a[data-process]"),y,f,r,s,c,o,p,h,l,a;v&&v.length&&(y=v[0].getAttribute("data-process"),y&&(f=t.Internals.parseJSON(y),f&&f.requestState&&f.requestState.entityId&&(r=e.findIndex?e.findIndex(function(n){return n.EntityId.indexOf(f.requestState.entityId)>-1}):u._findHotelAdsIndex(e,f.requestState.entityId),r>-1&&e[r]&&e[r].Price&&(s=t(n).select(".lc_ritems"),s&&s.length&&(c=e[r].PriceDropPercentage&&e[r].OriginalPrice,o=null,c&&(o=i._createElement("div").add_class("lc_dealbage"),i._createElement("div").add_class("lc_dealtext").set_text("DEAL").appendTo(o),i._createElement("div").set_text(e[r].PriceDropPercentage).appendTo(o)),p="lc_prices"+(c?" lc_deal":""),h=i._createElement("div").add_class(p),i._createElement("div").add_class("lc_curprice").set_text(e[r].Price).appendTo(h),c&&i._createElement("div").add_class("lc_oriprice").set_text(e[r].OriginalPrice).appendTo(h),e[r].NumOfProvider&&i._createElement("div").set_text(e[r].NumOfProvider).appendTo(h),o&&o.appendTo(s),h.appendTo(s))))));l=t(n).select("div[class=lm_hpapriceholder]");l&&l.length&&l.removeFromParent();a=t(n).select("div[class=lm_hpapercentholder]");a&&a.length&&a.removeFromParent()}),n.forceHotelRecoModuleClientSort&&s.length>0&&s.forEach(function(n){if(n){var i=t(n).getParent();i&&i.length&&i[0].insertBefore(n,i[0].firstChild)}})))}catch(h){t(r).set_style({display:"block"});return}t(r).set_style({display:"block"})},null,function(){t(r).set_style({display:"block"})},null,0);return}})},c.prototype.reprocessDetails=function(n){n&&this._processLocalDetails(n)},c.prototype._processLocalDetails=function(t){var f=this,e=null,a=null,v=null,y=null,o=this.viewModel.getEntities(),r,c,l,w;if(o&&o.length>0&&(a=o[0].getRoutableLocation(),v=o[0].getLocation(),y=o[0].getBoundingBox(),e=o[0].getTitle()),!e||t.taskTitle&&t.originalName?e=t.taskTitle||t.title||"":(t.taskTitle=e,this.setTitle(e)),this._processForCollectionError(t),this.pageProcessor.process(this.panelRoot,{routablePoint:a,id:this.id,showBackButton:(t.flippingCard||(t.openingNewCard&&t.entryPoint!==u.LayerManager?!1:t.openingNewCard))&&!i._getIsSlideCardEnabled(),cameFromCollections:t.entryPoint===u.Collections,listingTaskId:t.listingTaskId,location:v,boundingBox:y,map:this.map,geochainManager:this._geochainManager,controlTemplateFactory:this._controlTemplateFactory,taskTitle:e,getDisplayState:function(){return f.displayState},impressionGuid:h.getImpressionGuid(this.panelRoot)},this.perfLog),r=this.viewModel,wu.enableCalendarSync?r.createCalendarSync():(c=this.panelRoot.select(".calendarSyncModule"),c&&c.getParent()&&c.getParent().set_style({display:"none"})),r.launchOverflowTask.add(function(n){f.launchOverflowTask.invoke(n)}),r.processAdvertising(t,this._syndicatedAds),r.processTnAAds(),r.registerActionButtonEvents(this.id,this._taskState),r.registerModuleClickEvents(),r.registerCalendarEvents(),r.registerLocatedAtSearchEvents(),r.processPhotostripData(),r.registerVenueMapEvents(),this._checkLoadingVenueMapTask(),r.addAnnotationControl(t),t.taskTitle&&r.updatePoiTitle(t.taskTitle),r.removeUpcomingEventContainer(),r.registerGeochainEvents(),r.expandDetailsCard(),r.prepareMenuModule(),r.prepareReviewsAccordionModule(function(){f._disableSizeChangeAction()}),r.registerActionsModuleEvents(),r.addRecommendationModuleHover(this.poiManager),n.enableNewActionBarButtons&&(r.registerNewMoreMenuEvents(this),r.registerShowAllImageEvents()),n.edgeRecoModuleFix&&r.edgeRecoModuleFix(),r.logInstrumentationForShoppingDataGroup(),l=this.panelRoot.select('div[id^="locovl"]'),this._imgSetOvlId||(this._imgSetOvlId=l.get_attr("data-ovl")),!t.isImgOvlOpen&&this._imgSetOvlId){var s=_d.getElementsByTagName("html")[0],b=s.style.overflowX,k=s.style.overflowY,d=s.style.overflow;sj_evt.fire("ovlHide",this._imgSetOvlId,!0);s.style.overflow=d;s.style.overflowX=b;s.style.overflowY=k}else this._imgSetOvlId=l.get_attr("data-ovl"),typeof ovlc!="undefined"&&ovlc.show(this._imgSetOvlId,t.imgSetOvlCurIndex);this._imgSetOvlShowHandlerWrapper||(this._imgSetOvlShowHandlerWrapper=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];f._imgSetOvlShowHandler.apply(f,t[0])});sj_evt.unbind("MapsImgSetOvlShow_"+this._imgOvlHitTargetId,this._imgSetOvlShowHandlerWrapper);this._imgOvlHitTargetId=l.get_attr("id");sj_evt.bind("MapsImgSetOvlShow_"+this._imgOvlHitTargetId,this._imgSetOvlShowHandlerWrapper,0);this._imgSetOvlHideHandlerWrapper||(this._imgSetOvlHideHandlerWrapper=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];f._imgSetOvlHideHandler.apply(f,t[0])});sj_evt.unbind("ovlHide",this._imgSetOvlHideHandlerWrapper);sj_evt.bind("ovlHide",this._imgSetOvlHideHandlerWrapper,0);w={searchTaskInstance:this,updateDetailsPricePoi:this._updateDetailsPricePoi};sj_evt.fire("pricePoiInit",w);this._logActivated(p.LDT)},c.prototype._updateDetailsPricePoi=function(n,t,i){var u,f,r;n&&t&&(u=n.searchTaskInstance,u&&(f=u.viewModel,f&&f.getPushpinPrimitives&&(r=f.getPushpinPrimitives(),r&&r.length&&r[0].entity&&(r[0].entity.iconText=t,i&&(r[0].entity.badgeType=3),u.poiManager&&u.poiManager.setPrimitives&&u.poiManager.setPrimitives(r)))))},c.prototype._checkLoadingVenueMapTask=function(){var n=this.panelRoot.select("div[class=bm_venueMapButton]");this._taskState.loadVenueMap&&n&&n[0]&&(this._taskState.loadVenueMap=!1,this.viewModel.handleVenueMapClick())},c.prototype._disableSizeChangeAction=function(){var n=this;Microsoft.Maps.setTimeout(function(){n.primitiveInteracted.invoke({action:2})},0)},c.prototype._processForCollectionError=function(n){var t;if(n&&n.scenarioKey&&n.scenarioKey==="ERR"&&n.entryPoint===u.Collections&&(t=this.panelRoot.select("div[class=errmsg]"),t&&t.length===1)){var f=i._createElement("p"),e=i._createElement("p"),o=i._createElement("p"),s=i._createElement("p");f.set_text(r.L_Collections_NotFound_Text);e.set_text(n.taskTitle);o.set_text(n.query);s.set_text(r.L_Collections_TryAgain_Text);t.clear();t.append(f);t.append(i._createElement("br"));t.append(e);t.append(o);t.append(i._createElement("br"));t.append(s)}},c.prototype._poiTapped=function(){if(this.primitiveInteracted.invoke(),this.displayState.activationState!==1){var n={action:"focus",id:this.id};e.invokeHandler(f.taskDataHandlerKey,n)}},c.prototype._poiHoverStarted=function(n){n&&n.primitive&&this.activateInfobox(n.primitive,this._taskState.infoboxHtml)},c.prototype._poiHoverStopped=function(){window.clearTimeout(l.mouseoverDelayHandle);l.mouseoverDelayHandle=window.setTimeout(function(){l.mapsInfobox&&l.mapsInfobox.setOptions({visible:!1})},l.mouseoutTimeout/2)},c.prototype._imgSetOvlShowHandler=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._taskState.isImgOvlOpen=!0;this._taskState.imgSetOvlCurIndex=t[2];this._imgSetOvlId=t[1];this.serializableObjectChanged.invoke({magnitude:2})},c.prototype._imgSetOvlHideHandler=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t[1]===this._imgSetOvlId&&(this._taskState.isImgOvlOpen=!1,!t[2]==!0&&this.serializableObjectChanged.invoke({magnitude:2}))},c.prototype._checkItineraryTasks=function(){var n={requestorType:s.localDetailsTask,requestorId:this.id,type:s.itineraryDetailsTask,requestState:{action:0},useActiveTasks:!0};e.invokeHandler(f.taskProcessDataHandlerKey,n);this._itineraryTaskChecked=!0},c.prototype.getCardIconInfo=function(){var n=this.viewModel;return{iconClass:n.iconClass,iconElements:this.getCardIcons(this.viewModel.getCardCategoryId())}},c.prototype._getSidParam=function(){var t="",n;return this._taskState&&(n=this._taskState.id,n&&n.indexOf("sid:")===0&&(t=n.substring(4))),t},c.prototype._getYpidParam=function(){var t="",n;return this._taskState&&(n=this._taskState.id,n&&n.indexOf("ypid:")===0&&(t=n.substring(5))),t},c.prototype._getEventIdParam=function(){var t="",n;return this._taskState&&(n=this._taskState.id,n&&n.indexOf("eventId:")===0&&(t=n.substring(8))),t},c.prototype._setAddItineraryDataTask=function(n){var e=this.viewModel.getEntities(),o=n.select("a.itineraryAdd");if(e&&e.length>0&&o&&o.length>0){var i=e[0],h=ei.getItineraryItem(i.getTitle(),i.getLocation(),i.id,i.getImageUrl(),i.getSelectedCategoryForIcon(),i.interests),r=i.addressFields;h.Destination=r&&(r.city||r.stateMunicipality||r.country);h.EntityTypes=i.getSegmentTypes();var c={entryPoint:u.LocalDetails,itineraryItem:h},l={type:s.itineraryDetailsTask,activateOptions:{},state:c},a=o[0];a.setAttribute(f.taskDataHandlerKey,t.Internals.stringify(l))}},c.prototype._launchOverflowOnActivation=function(){var t,i;if(this._taskState.launchOverflowTaskOnTaskActivate&&this.panelRoot&&(t=this.panelRoot.select(".shoppingButton"),t&&t.length===1)){var n=t[0],f=n.getAttribute("data-browseProductUrl"),e=n.getAttribute("data-productSearchUrl"),o=n.getAttribute("data-autosuggestEndPoint"),s=n.getAttribute("data-retailer"),r=this.viewModel.getEntities(),u="";r&&r.length>0&&(u=r[0].getTitle());i=this._taskState.productRootKeyword;i||(i=n.getAttribute("data-productRootKeyword"));this.launchOverflowTask.invoke({title:s||u,loadingUrl:f,productSearchUrl:e,autosuggestEndpoint:o,entryPoint:0,productRootKeyword:i,impressionGuid:h.getImpressionGuid(this.panelRoot)});this._taskState.launchOverflowTaskOnTaskActivate=!1}},c}(l),uu=function(i){function r(t,r,u,f,e,o,s,h,c,l){var a=i.call(this,t,r,u,f,e,o,s,h,c,l)||this;return a.setRecommendedWidth(n.hotelCardWidth),a.setCurrentWidth(n.hotelCardWidth),sj_evt.bind("bm_scrollCard",function(){i.prototype._registerOverlayLinksForInstrumentation.call(a,".hr_link","HotelAds","CI.HotelAdsClick","adsUrl")}),a}return y(r,i),r.prototype._createUrl=function(){var n=i.prototype._createUrl.call(this),a=Logger.getOverlayType(),t,f,u,s;if(a?n+=this._taskState.originIG&&this._taskState.originIG===c.dynamicProperties.serpIG?"&FORM=BHO001":"&FORM=BHO002":(n+="&FORM=BHO003",n+="&mapsVertical=true"),t=this._taskState.passThruParam,f=t&&(t.indexOf("sponover")>-1||t.indexOf("sponad")>-1),!f&&t&&t.toUpperCase().indexOf("FORM=")===-1&&(n+=t.indexOf("&")!==0?"&"+t:t),f&&n.indexOf("&originig=&")>-1&&(n=n.replace("&originig=&","&")),n+=this._taskState&&this._taskState.parentIG?"&parentIG="+this._taskState.parentIG:"&htlsource=overlaynq",_w.hpa_roomnum&&(n+="&guests="+_w.hpa_roomnum),_w.suppressBookingAdsModule=this._taskState.isBookingModuleEntryPoint,f){var r=_w.LocalStorageHelper,h=r&&r.getItem("ol_startdate")?r.getItem("ol_startdate"):_w.ol_startdate,l=r&&r.getItem("ol_enddate")?r.getItem("ol_enddate"):_w.ol_enddate;h&&l&&typeof DateHelper!="undefined"&&typeof DateHelper.formatDate!="undefined"&&(n+="&checkin="+DateHelper.formatDate(new Date(h),"yyyy-mm-dd")+"&checkout="+DateHelper.formatDate(new Date(l),"yyyy-mm-dd"))}if(this._taskState&&this._taskState.activatingElement&&this._taskState.activatingElement.length&&(u=this._taskState.activatingElement,u.get_attr("data-sponad")==="True")){var e=u.get_attr("data-ad_eid"),o=u.get_attr("data-ad_oid"),v=u.get_attr("data-ad_oq")||"";e&&e.length&&o&&o.length&&(n+="&sponad=true&hotelentityid="+e+"&hotelid="+o+"&originalquery="+v)}return s=this._taskState&&this._taskState.originalQuery,s&&(n+="&loq="+s),n},r.prototype._getRequestUrlFormat=function(){return i.prototype._getRequestUrlFormat.call(this),n.requestUrlFormatForLocalOverlayOnSerp},r.prototype.processResponse=function(n,t){_w.hotelsDetailsCardIG=h.getImpressionGuid(n);i.prototype.processResponse.call(this,n,t);this.reprocessDetails(this._taskState);this._processFakeTabDataProcess()},r.prototype._getSegmentParam=function(){return"hotel"},r.prototype._getTextAdsCode=function(){return n.enableHotelTextAds?"h":null},r.prototype._suppressProcessDetails=function(){return!0},r.prototype._processFakeTabDataProcess=function(){var i=this,n;this.panelRoot&&this.id&&(n=this.panelRoot.select("div[class=faketab]"),n&&n.length&&n.for_each(function(n){var r=t(n).select("a[data-process]");r&&r.length&&r.for_each(function(n){var u=n.getAttribute("data-process"),r=u&&t.Internals.parseJSON(u);r&&(r.requestorId=i.id,n.setAttribute("data-process",t.Internals.stringify(r)))})}))},r}(rt),ut=function(o){function a(n,t,r,f,e,h,l,a){var v=o.call(this,t,h,r,e)||this,p,y;return v._primitivesToHideAfterPrint=[],v._defaultInfoboxContentsTemplate='<a class="infoBoxLink" role="button" href="#"><div class="bm_ib_container bm_ib_titleonly"><div class="bm_ib_title">{title}<\/div><\/div><\/a>',v.showCloseButton=!0,v.type=s.localListingTask,v.poiManager=f,v._contextMenu=l,v._taskUrlParams.push({param:"poicount",paramGetter:function(){return v._getPoiCountParam()}}),v.disposables.push(v.poiManager.contextMenuInvoked.add(function(n){return v._contextMenuInvoked(n)})),v.disposables.push(e.poiSelected.add(function(n){return v._setSelectedPrimitive(n)})),v.disposables.push(v.poiManager.mapViewChanged.add(function(n){return v.updateMapBounds(n)})),v._micropoiFetched=!1,v._microPoiManager=a,p=v.poiManager.getZIndex(),v._microPoiManager.setZIndex(p-1),v.disposables.push(v._microPoiManager.poiViewStateChanged.add(function(n){v._onPoiViewStateChanged(n,!0)})),v.disposables.push(v._microPoiManager.zoomChangedOnClusterSelect.add(function(){v.map.viewChanged.addOne(function(){v.poiManager._computeBestMapViewOnSetPrimitives=!1;o.prototype._refreshWithDelay.call(v)})})),v._dateFilterChanged=!1,v._registerEvents(t),v.controlTemplateFactory=n,v.disposables.push(v.laneScrolled.add(function(){v._contextMenuOnListMode&&v._hideListItemContextMenu()})),v._setTaskCompleted=!1,v._polygonLayerAdded=!1,v._categories=new ri,v._categories.changed.add(function(n){v._onCategoriesChanged(n)}),v.registerFilters=new g,v.disposables.push(v.registerFilters.add(function(){v.registerFilterBarEventHandlersV2();v.registerFilterBarSwitchQueryEventHandlers();sj_evt&&sj_evt.fire("filterattached")})),y=c.features.taskFramework,i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&sj_evt?sj_evt.bind("triggerMapSearch",function(n){var t,i;if(v.displayState&&v.displayState.prominence===1)if(t=n&&n[1],t){if(i=t.filters,typeof i!="undefined"){v._logInstrumentationEventForEntityClick();v.onFilterValueChanged(i)}}else v._logInstrumentationEventForEntityClick(),v._refresh({mapPannedOrZooomed:!0,isResearchOnOverlay:!0})}):y&&y.nearbyListingButtonsEnabled&&sj_evt&&sj_evt.bind("triggerMapSearch",function(){v.displayState&&v.displayState.prominence===1&&(v._taskState&&(v._taskState.disableListingRefresh=!1),v._logInstrumentationEventForEntityClick(),v._refresh({mapPannedOrZooomed:!0,isResearchOnOverlay:!0}),v._taskState&&(v._taskState.entryPoint===u.Nearby?(v._taskState.disableListingRefresh=!0,v._nearbyFloatingContainer&&v._nearbyFloatingContainer.logNearbyInstrumentationData(ht.SearchAreaClick,{})):v._nearbyFloatingContainer&&v._nearbyFloatingContainer.logNearbyInstrumentationData(ht.AutoRefreshOnExit,{})))}),v}return y(a,o),a.prototype.activate=function(n,t,i,r){var e=this,s,f,h,l,a;this.viewModel||(this.viewModel=new ci(this.map,this.panelRoot,this.id,this._logHelper,this.poiManager,this._transientLensViewModel,this.controlTemplateFactory));s=c.features.taskFramework;s&&(s.nearbyButtonEnabled&&t.entryPoint===u.Nearby&&(t.disableListingRefresh=!0),s.nearbyListingButtonsEnabled&&!t.nearbyPivotEntity&&t.pivotEntity&&(f=this._getNormalizedPivotEntity(t.pivotEntity),f&&f.name&&f.location&&(t.nearbyPivotEntity={title:f.name,location:f.location,id:f.id,idType:f.idType})));this.registerViewModelEvents();h=t.fullQuery?t.fullQuery:t.query;l=t.taskTitle?t.taskTitle:h;this.setTitle(l);t&&t.categoryLayers&&(this._taskState=t,this._categories.insertAll(t.categoryLayers));o.prototype.activate.call(this,n,t);t&&t.directionsTaskId&&this.enableSearchAlongRoute(t.directionsTaskId);t.content?this._logActivated(p.LLT):(t.disableTaskActivate=!0,a={requestState:t},o.prototype.process.call(this,a,function(n){e.processResponse(n.data.content);e._logActivated(p.LLT);sj_evt&&e.displayState&&e.displayState.stackOrder===1&&sj_evt.fire("OnCardRefresh",e.panelRoot,e.stackId)},r))},a.prototype.process=function(n,t){var u=this,r=n&&n.requestState,f;r.hideEntity?(this._setTaskCompleted?(i._isLargeMapShownOnSerp()&&r.selectedEntityId&&this._updateSelectedPrimitiveById(r.selectedEntityId),this._hideSelectedPrimitive(r.selectedEntityId)):(this._hideSelected=new g,this.disposables.push(this._hideSelected.addOne(function(){u._hideSelectedPrimitive(r.selectedEntityId)}))),t&&t({processorId:this.id,data:{}})):r.showEntity?(r.selectedEntityId&&(f=function(){var n=u.viewModel.UpdatePrimitiveState(r.selectedEntityId,0);n&&u.poiManager.invalidated.invoke()},this._setTaskCompleted?f():(this._hideSelected=new g,this.disposables.push(this._hideSelected.addOne(function(){f()})))),t&&t({processorId:this.id,data:{}})):r.hideContextMenu?(this._transientLensViewModel.hide(),t&&t({processorId:this.id,data:{}})):o.prototype.process.call(this,n,t)},a.prototype.deactivate=function(){o.prototype.deactivate.call(this);this._categories.length===0?this._microPoiManager&&this._microPoiManager.dispose():this._updateCategories("removeLayer");this._firstFrameRenderedHandler&&this._firstFrameRenderedHandler.dispose();var n={hideBackButton:!0,listingTaskId:this.id},t={requestorType:s.localListingTask,type:s.localDetailsTask,requestState:n,useActiveTasks:!0};e.invokeHandler(f.taskProcessDataHandlerKey,t);this._cityPolygonManager&&this._polygonLayerAdded&&(this._cityPolygonManager.removeLayer(),this._polygonLayerAdded=!1);this._nearbyFloatingContainer&&this._nearbyFloatingContainer.deregister(this.id)},a.prototype.registerViewModelEvents=function(){var n=this;this.disposables.push(this.viewModel.loadInfobox.add(function(t){n.activateInfobox(t,"",!1,!0)}));o.prototype.registerViewModelEvents.call(this)},a.prototype.hasPrintContent=function(){return this.isPrintable()},a.prototype.getPrintContent=function(){var o=this,n,i,u,f,r,t,e;if(!this.hasPrintContent())return null;if(n=this.getMapPrimitives(),n[0]&&n[0].entity&&n[0].entity.usePricePoi)for(this._priceText=[],i=0;i<n.length;i++)u=n[i].entity,u.iconText?this._priceText.push(u.iconText):this._priceText.push("");for(f=null,this.viewModel instanceof ci&&(f=this.viewModel.getListingsHtmlContentForPrint(this._colorIndex)),r=0;r<n.length;r++)t=n[r],t&&t.viewState==3&&(this._primitivesToHideAfterPrint.push(t),t.viewState=0);return e=new ri,e.insert(this.poiManager.getLayerId(),0),ar.onPrintDialogClose.addOne(function(){return o.cleanUpPrintEntities()}),new lr(f,e,null)},a.prototype.cleanUpPrintEntities=function(){for(var f,e,u,t,n,r=0;r<this._primitivesToHideAfterPrint.length;r++)f=this._primitivesToHideAfterPrint[r],f&&(f.viewState=3);if(e=this.viewModel,e){for(u=e.getPushpinPrimitives(),t=0;t<u.length;t++)n=u[t].entity,n&&n.iconText&&n.iconText.length>0&&(n.iconText=this._priceText&&this._priceText.length>0&&n.usePricePoi?this._priceText[t]:"");this.poiManager.setPrimitives(u,!0)}i&&i._refocusPrintDropDownMenu(this.id)},a.prototype._resetMicropois=function(){this._microPoiManager&&this._microPoiManager.fetchMicroPois(null,[])},a.prototype._onPrimitivesChanged=function(n){this._setPivotPrimitive();o.prototype._onPrimitivesChanged.call(this,n);this._categories&&this._categories.length>0&&this._updateCategories("updateTaskEntities",null,null,this.viewModel.getEntities())},a.prototype.processResponse=function(r,u){var e=this,s,h,k,o,nt,tt,it,rt,l,et,ot,g,p,w;if(this._getTaskState().content=r,s=r.select(".bm_filterBar"),s.length>0&&(s.removeFromParent(),this.setFilters(s),this.viewModel.isWaterfallListingsEnabled()||sj_evt.fire("scrollToTop")),this.viewModel.setResponseContent(r,this._getTaskState(),u),a._panelRendered||(a._panelRendered=!0,this.viewModel.isWaterfallListingsEnabled()&&sj_evt.fire("WFR.Resize")),h=this.viewModel.panelRoot.select("div[data-mapcardwidth]"),k=h&&h.length&&h[0].getAttribute("data-mapcardwidth"),k&&(o=parseInt(k),this.setRecommendedWidth(o),this.setCurrentWidth(o)),this.getFilters()?sj_evt.fire("resetFilterDisplay"):sj_evt.fire("filterattached"),n.doubleWideListEnabled&&!n.enablePoiCentering?this._setViewportPaddingForCardSide(o+30):n.enablePoiCentering&&i&&(nt=32,this._setViewportPaddingForCardSide(o+i.getVerticalTaskBarWidth()+nt)),tt={taskParentId:this.id,query:this._taskState.query,clickHandler:function(n,t){return e._processItemClickEvent(t)},contextMenuHandler:function(n,t){return e._processContextMenuEvent(n,t)},saveButtonClickHandler:function(n,t,i){return e._processSaveButtonClickEvent(n,t,i)},listItemCarouselHandler:function(n,t){return e.viewModel.InsertListItemCarousel(n,t)},directionsTaskId:this._getTaskState()&&this._getTaskState().directionsTaskId,originIG:this._taskState.originIG,parentIG:this._getImpressionGuid(),isBookingModuleEntryPoint:this._taskState.isBookingModuleEntryPoint},this.pageProcessor.process(this.viewModel.getResponseContainer(),tt),this.viewModel.registerListItemEvents(this._taskState.query,this.isSearchAlongRouteEnabled()),this.viewModel.setIconOnlyLimitBySegmentTypeOrCategoryId(),this._registerNoResultResetFiltersClickHandler(),this._setFocusToClickedSortOptionIfApplicable(),this._updateStateWithQueryParseData(),this._processLocalTopicLinks(),it=this._getTotalResultCount(r),rt=this.viewModel.enableServerPagination(this,u,it),rt||(this.viewModel.processPoiPagination(this._taskState,function(){e._doScrollLaneAction()}),this._setDisableListingRefresh(r)),this.viewModel.updateAdvertising(this._getTaskState()),!u||!u.mapPannedOrZooomed&&!u.isPaginated)try{var l=[],ut=this.panelRoot.select("div[data-boundingbox]").get_attr("data-boundingbox"),f=ut&&t.Internals.parseJSON(ut);if(f&&f.boundingBox&&f.boundingBox.length>1){l=[];l.push(new b(f.boundingBox[0].latitude,f.boundingBox[0].longitude));l.push(new b(f.boundingBox[1].latitude,f.boundingBox[1].longitude));var d=this.map.getMode().getMapViewForLocationsInView(l),v=oi.fromLocation(d.cameraLocation,!0),y=f.minZoomLevel;y&&!isNaN(y)&&v<y&&(v=y);et=er.fromEdges(f.boundingBox[0].latitude,f.boundingBox[0].longitude,f.boundingBox[1].latitude,f.boundingBox[1].longitude);ot=oi.toLocation(et.center,v,!0);d=ft.constructView(this.map,ot,v,null,!1,this.map.getViewportPadding(),this.map.getActualSize());this.poiManager&&(this.poiManager.setMapViewFromBackend&&this.poiManager.setMapViewFromBackend(d),this.poiManager.MapViewFromBackendIsSet())}}catch(st){}if(this.setTaskComplete(u),sj_evt&&sj_evt.fire("MapSearchTaskActivated",this.viewModel.getResponseContainer()),g=c.features.taskFramework,g&&g.nearbyListingButtonsEnabled)if(this._updateTaskStateOnPivotResponse(r),this._taskState.nearbyPivotEntity)this._getResultDistanceAroundPivotAndUpdate();else if(p=this.viewModel.getResponseContainer().select("div.nearbyInfoBoxButton"),p)for(w=0;w<p.length;w++)t(p[w]).removeFromParent()},a.prototype._getCategoryOrSegment=function(){if(this.viewModel){var n=this.viewModel.getCategory();return n?n.toLowerCase():"none"}return"none"},a.prototype._getNormalizedPivotEntity=function(n){if(n)if(typeof n=="string")try{return JSON.parse(n)}catch(t){return null}else return n;else return null},a.prototype._updateTaskStateOnPivotResponse=function(n){var t,r,u,i;this._taskState.nearbyPivotEntity||(this._taskState.pivotEntity?(t=this._getNormalizedPivotEntity(this._taskState.pivotEntity),t&&t.name&&t.location&&(this._taskState.nearbyPivotEntity={title:t.name,id:t.id,idType:t.idType,location:t.location},this._taskState.pivotEntity=null)):n&&n.length>0&&(r=n.select("div.overlay-listings"),r&&r.length>0&&(u=r.get_attr("data-pivot"),u&&u.length>0&&(i=JSON.parse(u),i&&i.name&&i.location&&(this._taskState.nearbyPivotEntity={title:i.name,id:i.id,idType:i.idType,location:i.location},r.set_attr("data-pivot",""))))))},a.prototype._getLatLngsFromRoutableLocations=function(n){for(var i,r="",t=0;t<n.length;t++)i=n[t]&&n[t].location,i&&(r+=i.latitude+","+i.longitude+";");return r.slice(0,-1)},a.prototype._getResultDistanceAroundPivotAndUpdate=function(){var n=this,v=c.features.taskFramework,s=this.viewModel.getResponseContainer(),h=s.select("div.bm_multicol").length>0,l=[],i,f,r,e;if(s.select("a.listings-item").for_each(function(n){n.querySelector("div.nearbyDistance:empty")&&l.push(n)}),i=t(l),i.length!==0){f=[];i.for_each(function(n){var i=n.getAttribute("data-entity"),t=i&&JSON.parse(i);t&&t.routablePoint&&f.push({location:t.routablePoint,title:t.entity&&(t.entity.name||t.entity.title||t.entity.address)})});r=[];i.for_each(function(n){var t=n.querySelector("div.nearbyInfoBoxButton");t&&r.push({nearbyInfoBoxButtonDiv:t,nearbyDistanceDiv:t.querySelector("div.nearbyDistance"),nearbyTimeDiv:t.querySelector("div.nearbyTime")})});var y=this._getLatLngsFromRoutableLocations(f),a=c.features.directions,p=v.nearbyDistanceMatrixURL,o=p.replace("${lat}",this._taskState.nearbyPivotEntity.location.latitude).replace("${lng}",this._taskState.nearbyPivotEntity.location.longitude).replace("${destinations}",y).replace("${key}",a.distanceMatrixApiKey).replace("${seckey}",encodeURIComponent(a.distanceMatrixSecondaryKey));this._nearbyFloatingContainer=su.getInstance(this.map);e=this._nearbyFloatingContainer.getModeForTask(this.id);this._nearbyFloatingContainer.registerTaskInformationAndShow(this.id,{populatedDistanceMatrixURL:o.replace("driving","${mode}"),updateCallback:function(t){n.modeUpdatedCallback(t,r,f,i,h)},exitNearbyCallback:function(){n._taskState.entryPoint=u.Autosuggest;sj_evt.fire("triggerMapSearch");n._taskState.disableListingRefresh=!1;var t=n._getNormalizedPivotEntity(n._taskState.pivotEntity);t&&n._taskState.nearbyPivotEntity&&t.location===n._taskState.nearbyPivotEntity.location&&(n._taskState.pivotEntity=null);n._taskState.nearbyPivotEntity=null;n._nearbyFloatingContainer=null},updateTransportationModeCallback:function(t){n.updateTransportationModeAndIconCallback(t,r)},requestStatusCallback:function(t){n._showOrHideWaitLayer(t)},currentMode:e});e==="driving"&&(o+="&startTime="+su.getCurrentDateTime());et.downloadJson(o.replace("driving",e),"locallisting",function(t){n.modeUpdatedCallback(t,r,f,i,h);n.updateTransportationModeAndIconCallback(e,r)})}},a.prototype.modeUpdatedCallback=function(n,t,u,f,e){var o=this,h=null,y=n,l=y.resourceSets,a,s,v;l&&l.length>0&&(a=l[0],s=a.resources,s&&s.length>0&&(v=s[0],h=v.results));h&&(h.forEach(function(n){var a=n,v=a.destinationIndex,s=a.travelDuration,h=a.travelDistance,y,w,f;s=s>1?Math.round(s):1;var nt=c.features.directions,tt=nt.unit,k=!h||h===-1;if(h*=1e3,y=i._readableTextFromDistance(h,tt!==1),t&&t.length>0){var e=t[v],p=e.nearbyDistanceDiv,g=e.nearbyTimeDiv;if(p.style.display=k?"none":"inline-block",p.innerText=y,k||p.setAttribute("aria-label",y),w=s+" "+r.L_NearbyMinute,g.innerText=w,g.setAttribute("aria-label",w),!e.nearbyInfoBoxButtonDiv.getAttribute("data-task")&&(f=u[v],f&&f.location&&f.location.latitude&&f.location.longitude&&o._taskState.nearbyPivotEntity&&o._taskState.nearbyPivotEntity.location.latitude&&o._taskState.nearbyPivotEntity.location.longitude)){var l=new ir,it=new b(f.location.latitude,f.location.longitude),rt=new b(o._taskState.nearbyPivotEntity.location.latitude,o._taskState.nearbyPivotEntity.location.longitude);l.tryAddWaypoint(new bt(o._taskState.nearbyPivotEntity.title,rt),0);l.tryAddWaypoint(new bt(f.title||null,it),1);l.mode=d.driving;e.nearbyInfoBoxButtonDiv.setAttribute("data-task",JSON.stringify({state:ir.inputDataToDirectionsState(l),type:"DirectionsTask"}));e.nearbyInfoBoxButtonDiv.setAttribute("data-instrumentation",JSON.stringify({logData:{feature:ht.NearbyFeatureName,action:ht.ActionClick,data:{PVT:u[v],DST:o._taskState.nearbyPivotEntity,M:d.driving}}}))}}}),e&&this._fixNearbyInfoBoxButtonPlacement(f,t),t&&t.length>0&&f.for_each(function(n){var t=n.querySelector("div.b_imagePair.tall_m > div.inner > div.cico > img");t&&(t.parentElement.style.height=n.clientHeight+"px",t.style.height=n.clientHeight+"px")}))},a.prototype.updateTransportationModeAndIconCallback=function(n,i){var r=new RegExp(/"mode":[1-3]/),u=new RegExp(/"M":[1-3]/);i&&i.length>0&&i.forEach(function(i){var e=i.nearbyInfoBoxButtonDiv.querySelector("span"),o=i.nearbyInfoBoxButtonDiv.getAttribute("data-task"),s=i.nearbyInfoBoxButtonDiv.getAttribute("data-instrumentation"),f=t(i.nearbyInfoBoxButtonDiv);n==="driving"?(e.className="",f.set_attr("data-task",o.replace(r,'"mode":'+d.driving)),f.set_attr("data-instrumentation",s.replace(u,'"M":'+d.driving))):n==="walking"?(e.className="nearbyWalking",f.set_attr("data-task",o.replace(r,'"mode":'+d.walking)),f.set_attr("data-instrumentation",s.replace(u,'"M":'+d.walking))):n==="transit"?(e.className="nearbyTransit",f.set_attr("data-task",o.replace(r,'"mode":'+d.transit)),f.set_attr("data-instrumentation",s.replace(u,'"M":'+d.transit))):(f.remove_attr("data-task"),f.remove_attr("data-instrumentation"))})},a.prototype._fixNearbyInfoBoxButtonPlacement=function(n,t){var v=this.viewModel.getResponseContainer(),y=v.select("div.bm_2col").length>0,s=!1,h=[],f,a,o;n.for_each(function(n){var t=n.querySelector("div.lMCard"),i;t?(i=t.querySelector("div.b_hPanel"),i.style.paddingBottom="8px"):(t=n.querySelector("div.b_vPanel"),t.style.paddingBottom="0px",s=!0);h.push(t)});f=[];n.for_each(function(n){return f.push(n.clientHeight)});for(var e=h.map(function(n){return n.clientHeight}),u=Array(n.length),c=y?2:3,i=0,r=s?e:f;i<r.length-c;)for(var l=i+c,p=r.slice(i,l),o=Math.max.apply(null,p);i<l;)u[i++]=o;if(i<r.length)for(a=r.slice(i,r.length),o=Math.max.apply(null,a);i<r.length;)u[i++]=o;t&&t.length>0&&t.forEach(function(n,t){var r=n.nearbyInfoBoxButtonDiv,i=r.style.marginTop,f=0;i&&i.length>2&&(f=Number(i.slice(0,-2)));u[t]>e[t]&&(r.style.marginTop=u[t]-e[t]+Math.max(f,8)+"px")})},a.prototype.setTaskComplete=function(t){var u=this,a=this.poiManager,h=this._taskState&&this._taskState.id?tt.ID:tt.SB,c=this._logHelper.perfStart(h),f=this._getCategoryOrSegment(),r,e,s;f&&n.useShowMeForSegmentMicroPoi.indexOf(f)>-1||(f=null);r=this._getTaskState();r.selectedEntityId&&(this._updateSelectedPrimitiveById(r.selectedEntityId),this._hideSelectedPrimitive(r.selectedEntityId));this.map.getConfig().cardPrimerIsShown&&!l.hasCardPrimerPerfDataLogged&&(e=window.$cp_bsperf=window.$cp_bsperf||{},e.Maps_CP_CLT=e.Maps_CP_CLT||performance.now(),w.record("Maps_CP_LLT",Math.round(e.Maps_CP_CLT)));s=this.map.getFrameManager();this._firstFrameRenderedHandler&&this._firstFrameRenderedHandler.dispose();w.removeKey("SearchRequest");this._firstFrameRenderedHandler=s.frameRendered.addOne(function(){function t(){var r=w.getStartTime(n.id,!0),t,u;r&&(w.log("Maps_LLTTG",r),n.map.getConfig().cardPrimerIsShown&&!l.hasCardPrimerPerfDataLogged&&(w.log("Maps_CP_LLTTG",performance.timing.navigationStart),l.hasCardPrimerPerfDataLogged=!0),t=Microsoft.Maps.Local,u=n instanceof t.HotelsListingTask?"Maps_HLLTTG":n instanceof t.RestaurantsListingTask?"Maps_RLLTTG":n instanceof t.HouseListingTask?"Maps_RELLTTG":i._isAttractionCategory(n.viewModel.getCardCategoryId())?"Maps_ALLTTG":"",u&&w.log(u,r))}c.end("RT");var n=u;f&&u._categories.indexOf(f)===-1?(u._categories.insert(f),s.frameRendered.addOne(t)):t();r&&r.searchPerfState&&(u._microPoiManager&&u._microPoiManager.setTaskDisplayState({prominence:1}),u._requestMicroPoiRefresh(r))});this.registerFilterBarEventHandlersV2();this.registerFilterBarSwitchQueryEventHandlers();this._moveComparePanelToSortbar();this._hideSelected&&this._hideSelected.invoke();t&&t.mapPannedOrZooomed&&this.scrollLane.invoke(this.panelRoot);this._drawBoundary();o.prototype.setTaskComplete.call(this,t);this._setTaskCompleted=!0},a.prototype.setDisplayState=function(n){var e=this,u,r,f;o.prototype.setDisplayState.call(this,n);u=c.features.taskFramework;this._categories.length===0?this._microPoiManager&&this._microPoiManager.setTaskDisplayState(n):this._updateCategories("updateDisplayState",null,this.displayState);this.getFilters()&&n.animationState===0&&sj_evt.fire("resetFilterDisplay");u&&u.nearbyListingButtonsEnabled&&n&&(n.prominence&&n.prominence===2||n.isHidden)&&this._nearbyFloatingContainer&&this._nearbyFloatingContainer.showContainer(!1,this.id);n.activationState===2?(i._getIsSlideCardEnabled()||(r=this.viewModel&&this.viewModel.getResponseContainer(),r&&(r.remove_class(a._hoverClassName),f=t("."+a._hoverClassName,r[0]),f.remove_class(a._hoverClassName))),this._cityPolygonManager&&this._polygonLayerAdded&&(this._cityPolygonManager.removeLayer(),this._polygonLayerAdded=!1),l.mapsInfobox&&l.mapsInfobox.setOptions({visible:!1}),u&&u.nearbyListingButtonsEnabled&&n.prominence&&n.prominence===1&&this._nearbyFloatingContainer&&(this._nearbyFloatingContainer.activateTask(this.id),this._nearbyFloatingContainer.showContainer(!0,this.id,!0))):n.activationState===1&&(i._getIsSlideCardEnabled()&&(r=this.viewModel&&this.viewModel.getResponseContainer(),r&&(r.remove_class(a._hoverClassName),f=t("."+a._hoverClassName,r[0]),f.remove_class(a._hoverClassName))),this._taskState&&(this._taskState.selectedEntityId=null),this._taskState&&this._taskState.vdpid&&this._taskState.vdpid!==a._clearAttributeValue&&!this._polygonLayerAdded&&(this._cityPolygonManager?this._cityPolygonManager.addLayer(this._taskState.vdpid,a._polygonMinZoomLevel,a._polygonMaxZoomLevel):this.map.getCityPolygonManager().then(function(n){e.disposables.push(e._cityPolygonManager=n);n.addLayer(e._taskState.vdpid,a._polygonMinZoomLevel,a._polygonMaxZoomLevel)}),this._polygonLayerAdded=!0),u&&u.nearbyListingButtonsEnabled&&this._nearbyFloatingContainer&&(this._nearbyFloatingContainer.activateTask(this.id),this._nearbyFloatingContainer.showContainer(!0,this.id)));typeof n.colorIndex=="number"&&(this._colorIndex=n.colorIndex)},a.prototype.isSharable=function(){return o.prototype.isSharable.call(this)},a.prototype._doScrollLaneAction=function(){this.scrollLane.invoke(this.panelRoot)},a.prototype._registerEvents=function(){var n=this;this.disposables.push(this.poiManager.refreshResultsRequired.add(function(){if(!n._taskState||!n._taskState.disableListingRefresh){var t=_ge("map_auto_refresh_checkbox");(!t||t.checked)&&(n._taskState.point&&(n._taskState.point=null),o.prototype._refreshWithDelay.call(n,{mapPannedOrZooomed:!0}),n._requestMicroPoiRefresh(n._getTaskState()))}}))},a.prototype._closeChildTasks=function(){var n=this;this.map.getContainer().instanceAsync("TaskManager",function(t){var u=t.getFocusedStack(),r,i,f;if(u.id===n.stackId)for(r=u.getAllTasks(),i=0,f=r.length;i<f;i++)r[i].id!==n.id&&t.removeTaskAndReseatChild(r[i].id)})},a.prototype.onFilterValueChanged=function(n,t){this._closeChildTasks();this._taskState.localFilters=n;this._categories.length>0&&this._updateCategories("updateFilters",this._taskState.localFilters);this.viewModel&&this.viewModel.resetServerPagination&&this.viewModel.resetServerPagination();o.prototype._refreshWithDelay.call(this,t?{appliedFilterOption:t,filterValueChanged:!0}:{filterValueChanged:!0})},a.prototype.registerFilterBarEventHandlersV2=function(){var i,s,r,f,l,u,h,a,e,c,o;if(this.panelRoot[0])if(i=void 0,i=this.getFilters()?t(".stickyFiltersRoot")[0].getElementsByClassName("ftrPrBar"):this.panelRoot[0].getElementsByClassName("ftrPrBar"),s=i&&i.length&&i[0].getAttribute("data-advancefilters-house"),s&&s==="true"&&this._priceRangeFilterHandler(i),r=this.panelRoot[0].getElementsByClassName("bm_sortOption"),r&&r.length>0)for(this._bindFiltersV2(r),f=0,l=r.length;f<l;f++)u=r[f].getElementsByClassName("b_toggle"),u&&u.length>0&&(u[0].setAttribute("tabindex","-1"),sj_be(u[0],"click",function(n){sj_pd(n)}));else h=this.panelRoot.select("#LayoutSortBar")[0],h&&this.registerFilterEventHandlers(h);a=n.showInlineFilters?".overlaylistingheader":"#bm_contextualTaskbar";e=this.panelRoot.select(a)[0]||this.panelRoot[0];this.getFilters()&&(c=t(".stickyFiltersRoot"),c.length>0&&(e=c[0]));e&&(o=e.getElementsByClassName("bm_filterBar")[0],o&&this.registerFilterEventHandlers(o),this.restoreWidthForMultiSelect(o))},a.prototype.restoreWidthForMultiSelect=function(n){var u=n&&n.getAttribute("seg"),i,r,e,f;if(u&&u!=="House"&&u==="Hotel"&&(i=n.getElementsByClassName("b_filterOverlay"),i&&!(i.length<1)))for(r=0,e=i.length;r<e;r++)f=t(i[r]),f&&f.set_style({"max-width":"none"})},a.prototype.registerFilterEventHandlers=function(n){var o=n.getElementsByClassName("filterOption"),r,u,f,i,t,e;for(this._bindFiltersV2(o),r=n.getElementsByClassName("b_toggle"),t=0,u=r.length;t<u;t++)f=r[t],sj_be(f,"click",function(n){sj_pd(n)});if(i=n.getElementsByClassName("toggleFilter"),i&&i.length)for(this._bindFiltersV2(i),t=0;t<i.length;t++)sj_be(i[t],"click",function(n){n&&(n.preventDefault&&n.preventDefault(),n.stopImmediatePropagation&&n.stopImmediatePropagation())});e=n.getElementsByClassName("b_filterCtrl");this._bindMultiselectFilters(e)},a.prototype._priceRangeFilterHandler=function(){var n=this,i=function(i){var s=t(".flt_scale_current"),l=s&&s.get_attr("data-href"),a,p,w,v,b;if(s&&l&&!(l.indexOf("realestate")<0)){a=0;a=i[1]?i[1]:_w.priceFilterPrice;var k=_w.minFilterPrice?_w.minFilterPrice:0,d=_w.minPermissibleFilterPrice,g=_w.maxPermissibleFilterPrice,y="mso:real_estate.house.price_limit",c=s.get_attr("data-filterkey"),o=n._getParamterValue("filters",l),u=n.extractLocalFilterArgs(o,"gsfilter%3a","%22"),r="";u&&u.length&&(r=n._base64Decode(decodeURIComponent(u)),p=r.indexOf(c),p>-1&&(w=new RegExp(c.concat("=[0-9]+-[0-9]+;?"),"g"),r=r.replace(w,"")));r&&r.lastIndexOf(";")!==r.length-1&&(r=r.concat(";"));r.indexOf(y)<0&&(r=r.concat(y,"=",d,"-",g,";"));r=r.concat(c,"=",k.toString(),"-",a.toString());o=u&&u.length?o.replace(u,n._base64Encode(r)):o.concat("+gsfilter%3a%22",n._base64Encode(r),"%22");n.onFilterValueChanged(decodeURIComponent(o).replace(/\+/g," "));v=n.getInstrumentationFilterValue(c);v&&(b={logData:{feature:"FSB",action:"SE",data:{Q:n._taskState.query,FT:v,FA:n._taskState.localFilters,IS:!0}},impressionGuid:h.getImpressionGuid(n.panelRoot)},e.invokeHandler(f.instrumentationDataHandlerKey,b))}};sj_evt.unbind("priceFilterUpdate",i);sj_evt.bind("priceFilterUpdate",i)},a.prototype._base64Decode=function(n){return _w?_w.atob(n):""},a.prototype._base64Encode=function(n){return _w?_w.btoa(n):""},a.prototype._getParamterValue=function(n,t){if(!t)return null;n=n.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),i=r.exec(t);return i?i[2]?i[2]:"":null},a.prototype._moveComparePanelToSortbar=function(){var r,u,f,e;n.showInlineFilters&&(r=this.panelRoot.select(".cmp_panel"),u=this.panelRoot.select("#LayoutSortBar"),r&&r.length>0?u&&u.length>0?u[0].appendChild(r[0]):(f=t(".filter_sort_separator_line"),c.dynamicProperties.market.toLowerCase().indexOf("ja-jp")>-1&&f.length>0?(e=i.createElementWithClassName("div","bm_sortBar bm_filterBarItem"),e.appendChild(r[0]),f.getParent().append(e)):r.set_style({display:"none"})):r.set_style({display:"none"}))},a.prototype.registerFilterBarSwitchQueryEventHandlers=function(){var i=this,c=n.showInlineFilters?".overlaylistingheader":"#bm_contextualTaskbar",r=this.panelRoot.select(c+" .bm_searchSwitch a[data-switchquery]"),s,o;if(this.getFilters()&&(s=t(".stickyFiltersRoot"),r=s.select(".bm_searchSwitch a[data-switchquery]")),r&&r.length>0)for(o=0;o<r.length;o++)r[o].addEventListener("click",function(n){var r,a,t,o,s,c,l;n.preventDefault();r=n.currentTarget.getAttribute("data-switchquery");r&&(i._taskState.localFilters=null,i._taskState.query=r,i._taskState.rootKeyword=r,a={logData:{feature:"FSB",action:"SE",data:{Q:i._taskState.query,FT:5,IS:!0}},impressionGuid:h.getImpressionGuid(i.panelRoot)},e.invokeHandler(f.instrumentationDataHandlerKey,a),i.viewModel&&i.viewModel.resetServerPagination&&i.viewModel.resetServerPagination(),i._dateFilterChanged?(t=_w.LocalStorageHelper,t?(o=t.getItem("ol_startdate"),s=t.getItem("ol_enddate"),c=t.getItem("hpa_roomnum"),i._resetFilterStates(),t.setItem("ol_startdate",o,1),t.setItem("ol_enddate",s,1),t.setItem("hpa_roomnum",c,1)):(o=_w.ol_startdate,s=_w.ol_enddate,c=_w.hpa_roomnum,i._resetFilterStates,_w.ol_startdate=o,_w.ol_enddate=s,_w.hpa_roomnum=c)):i._resetFilterStates(),i._closeChildTasks(),i._refresh({forceLogAsLocalListingTask:!0,forceLoggingEntryPoint:u.QuerySwitch}),i.poiManager.setPrimitives([]),l=i._getCategoryOrSegment(),l&&i._categories.remove(l),i._resetMicropois(),i._requestMicroPoiRefresh(i._getTaskState()))})},a.prototype.logInstrumentationEventForServerRenderedFilter=function(n){var t=n.currentTarget&&n.currentTarget.parentElement&&n.currentTarget.parentElement.className,i=t==="ftrPr"?1:t==="ftrRt"?2:0,r=n.currentTarget&&n.currentTarget.parentElement&&n.currentTarget.parentElement.parentElement&&n.currentTarget.parentElement.parentElement.getAttribute("data-filterkey"),u={logData:{feature:"FSB",action:"SE",data:{Q:this._taskState.query,FT:i,FA:this._taskState.localFilters,IS:!0,CK:r}},impressionGuid:h.getImpressionGuid(this.panelRoot)};e.invokeHandler(f.instrumentationDataHandlerKey,u)},a.prototype._resetFilterStates=function(){this._taskState.localFilters=""},a.prototype._processLocalTopicLinks=function(){var i=this,n;this.panelRoot&&this.id&&(n=this.panelRoot.select("div[class=topicsModuleContainer]"),n&&n.length&&n.for_each(function(n){var r=t(n).select("a[data-process]");r&&r.length&&r.for_each(function(n){var u=n.getAttribute("data-process"),r=u&&t.Internals.parseJSON(u);r&&(r.requestorId=i.id,n.setAttribute("data-process",t.Internals.stringify(r)))})}))},a.prototype._registerNoResultResetFiltersClickHandler=function(){var t=this,i,r;this.panelRoot&&(i=this.panelRoot.select("div[data-answerinfo]"),i&&i.length&&i.get_attr("data-answerinfo")==="0"&&(r=n.useNewErrorCard?this.panelRoot.select(".bm_resetButtonOverlay"):this.panelRoot.select(".bm_resetButton"),r&&r.length&&r.add_event("click",function(n){n&&n.preventDefault();t._resetFilterStates();t._categories&&t._categories.length>0&&t._updateCategories("updateFilters",t._taskState.localFilters);t.viewModel&&t.viewModel.resetServerPagination&&t.viewModel.resetServerPagination();o.prototype._refreshWithDelay.call(t,{mapPannedOrZooomed:!0})})))},a.prototype._setFocusToClickedSortOptionIfApplicable=function(){if(this._sortOptionClickedToReloadContent){var n=this.panelRoot.select(".selectedSortOption");n&&n.length>0&&n[0].focus();this._sortOptionClickedToReloadContent=!1}},a.prototype._bindFiltersV2=function(n){var t=this,r,u,i;if(n&&n.length)for(r=0,u=n.length;r<u;r++)(i=n[r],i.className&&i.className.indexOf("selectedSortOption")>=0)||(i.firstElementChild&&i.firstElementChild.classList&&i.firstElementChild.classList.contains("dropdown-range")?sj_be(i,"click",function(n){var r,c,l,s,h,b,g,y,p;if(n.currentTarget&&(r=n.currentTarget,r.parentElement&&r.parentElement.parentElement&&r.firstElementChild)&&(c=r.parentElement.getAttribute("id"),c)){var w=c.indexOf("_min")>-1,u=r.parentElement.parentElement,e=u&&u.getAttribute("data-filterkey");if(u&&e&&!(e.indexOf("real_estate")<0)&&(l=u.getAttribute("parent-id"),l)&&(s=u.previousElementSibling,s)&&(s.classList.add("adv_clicked"),h=s&&u.previousElementSibling.getElementsByClassName("fs_label"),h&&h.length)){b=h[0];b.innerHTML=r.firstElementChild.innerText;var k=_ge(l),a=k&&k.getElementsByClassName(w?"max-filter":"min-filter"),v=a&&a.length&&a[0].getElementsByClassName("b_toggle b_selected");if(v&&v.length){var d=v[0].parentElement,o=d.getAttribute("data-filterparam"),f=t.extractLocalFilterArgs(o,"gsfilter:","&quot;"),i="";f&&f.length&&(i=t._base64Decode(f),i.indexOf(e)>-1&&(g=new RegExp(";?"+e.concat("=[0-9]+(-[0-9]+;)?"),"g"),i=i.replace(g,"")));i&&(i=i.concat(";"));i=i.concat(e,"=");y=(parseInt(r.firstElementChild.innerText)||0).toString();p=(parseInt(d.firstElementChild.textContent)||0).toString();i=w?i.concat(y,"-",p):i.concat(p,"-",y);o=f&&f.length?o.replace(f,t._base64Encode(i)):o.concat(" gsfilter:&quot;",t._base64Encode(i),"&quot;");t.onFilterValueChanged(t.decodeHtmlEncoding(o));t.logInstrumentationEventForServerRenderedFilter(n)}}}}):sj_be(i,"click",function(n){var u=n.currentTarget.getAttribute("data-filterParam"),i,f,e,r;if(u||(u=n.currentTarget.getAttribute("data-url-params")),i=t.decodeHtmlEncoding(u),typeof i!="undefined"){f=t._taskState.localFilters;i.indexOf("hotel_filters:")>-1&&i.indexOf("local_filters")===-1&&(e=/(local_filters:"[,\w]+")/,r=e.exec(f),r&&r.length>0&&(i+=" "+r[0]));t.onFilterValueChanged(i);t.logInstrumentationEventForServerRenderedFilter(n)}}),sj_be(i,"keydown",function(n){var i=n.which;(i===13||i===32)&&(event.currentTarget.className.indexOf("bm_sortOption")>=0&&(t._sortOptionClickedToReloadContent=!0),n.currentTarget.click&&n.currentTarget.click())}))},a.prototype._bindMultiselectFilters=function(n){for(var r,i,t=0;t<n.length;t++)r="",i=n[t].getElementsByClassName("b_filterOverlay"),i&&i.length>0&&(r=i[0].getAttribute("data-filterkey")),this._bindMultiselectFilterForId(n[t].id,r)},a.prototype._bindMultiselectFilterForId=function(n,i){var r=this;sj_evt.bind("filterItems_selected",function(u){var ft,g,nt,l,p,tt,et,v,ot,c,a,b,y,it,st,ht;if(u[1]&&u[1].FilterControlId===n){w.setStartTime(r.id);var rt=u[1],ct=rt.FilterControlId,s=rt.SelectedFilterItemIds,o="";if(s&&s.length>0){if(o=t("#"+s[0]).get_attr("data-filterparam"),s.length>1)if(o.indexOf("realestate")>-1){var k="",ut="gsfilter:",d=r.extractLocalFilterArgs(o,ut);if(!d)return;for(ft=r._base64Decode(d),c=1;c<s.length;c++)(g=t("#"+s[c]),a=g&&g.get_attr("data-filterparam"),a)&&(nt=r.extractLocalFilterArgs(a,ut),l=nt&&r._base64Decode(nt),l)&&(p=l.indexOf(i),tt=l.indexOf(";",p),l=tt===-1?l.substring(p):l.substring(p,tt),k=k.concat(l,";"));et=r._base64Encode(k+ft);o=o.replace(d,et)}else{for(v=r.extractLocalFilterArgs(o),ot=v.join(","),c=1;c<s.length;c++)for(a=t("#"+s[c]).get_attr("data-filterparam"),b=r.extractLocalFilterArgs(a),y=0;y<b.length;y++)v.indexOf(b[y])===-1&&v.push(b[y]);o=o.replace(ot,v.join(","))}}else o=t("#fo_"+ct).get_attr("data-nofilterparam");o=r.decodeHtmlEncoding(o);r.onFilterValueChanged(o);it=r.getInstrumentationFilterValue(i);it&&(st={logData:{feature:"FSB",action:"SE",data:{Q:r._taskState.query,FT:it,FA:r._taskState.localFilters,IS:!0}},impressionGuid:h.getImpressionGuid(r.panelRoot)},e.invokeHandler(f.instrumentationDataHandlerKey,st));ht={logData:{feature:"FSB",action:"SE",data:{Q:r._taskState.query,FT:6,FA:r._taskState.localFilters,IS:!0,CK:i}},impressionGuid:h.getImpressionGuid(r.panelRoot)};e.invokeHandler(f.instrumentationDataHandlerKey,ht)}})},a.prototype.getInstrumentationFilterValue=function(n){switch(n){case"mso:real_estate.house.house_type":return"ftrD_Type";case"mso:real_estate.house.built_date_min":return"ftrD_Built_After";case"mso:real_estate.house.listing_status":return"ftrD_Listing_Status";case"mso:real_estate.house.price_range":return"ftrD_Price_Range";default:return""}},a.prototype.extractLocalFilterArgs=function(n,t,i){var f,u,r;return(t===void 0&&(t=""),i===void 0&&(i="&quot;"),!n)?[]:(t||(t="local_filters:"),t=t+i,f=n,u=f.indexOf(t)+t.length,u===t.length-1)?[]:(r=f.substr(u),u=r.indexOf(i),u===-1)?[]:(r=r.substr(0,u),r.length===0)?[]:f.indexOf("realestate")>-1?r:r.split(",")},a.prototype.decodeHtmlEncoding=function(n){var t=sj_ce("textarea");return t.innerHTML=n,t.value},a.prototype._onPoiViewStateChanged=function(n,t){var y=this,r=n.primitive.entity,o,h,c;if(r){o=this.pageProcessor.getListItem(r.id);this._logPoiHoverIfNecessary(n,u.LocalListing,t);switch(n.newValue){case 1:if(this.viewModel&&this.viewModel.loadDelayedListingImagesInPagination(),h=n.primitive,t?(c=this._defaultInfoboxContentsTemplate.replace("{title}",r.getTitle()),this.activateInfobox(h,c,!0)):this.activateInfobox(h),Microsoft.Maps.setTimeout(function(){y._registerInfoboxClickHandler(r,t)},501),this._taskState&&typeof this._taskState.scrollListOnPoiHover!="undefined"&&!this._taskState.scrollListOnPoiHover)return;this._contextMenuOnListMode&&this._hideListItemContextMenu();this.viewModel.getResponseContainer().add_class(a._hoverClassName);break;case 2:if(r.id){o&&(this.viewModel.getResponseContainer().remove_class(a._hoverClassName),o.remove_class(a._hoverClassName));var v=this._getTaskState()&&this._getTaskState().directionsTaskId,b=v?u.POIAlongRoute:u.POI,k=this.pageProcessor.getCatId(this.viewModel.getResponseContainer()),p=this._getPoiLocalTaskState(r,v),w={parentId:this.id};e.invokeHandler(f.taskDataHandlerKey,{type:s.localDetailsTask,state:p,activateOptions:w});this._logPoiClick(r,t);this._setSelectedPrimitive(n.primitive)}break;case 0:if(l.mouseoverTimeout===0&&(l.mouseoverTimeout=500),window.clearTimeout(l.mouseoverDelayHandle),l.mouseoverDelayHandle=window.setTimeout(function(){l.mapsInfobox&&(l.mapsInfobox.preventAutoClose||l.mapsInfobox.setOptions({visible:!1}))},l.mouseoutTimeout),o){if(i._getIsSlideCardEnabled()&&this._taskState.selectedEntityId&&o===this.pageProcessor.getListItem(this._taskState.selectedEntityId))break;this.viewModel.getResponseContainer().remove_class(a._hoverClassName);o.remove_class(a._hoverClassName)}}}},a.prototype._registerInfoboxClickHandler=function(n,i){var o=this,u=t(".infoBoxLink"),h;u&&(h=this._getTaskState()&&this._getTaskState().directionsTaskId,u.set_attr("aria-label",r.InfoboxListAriaLabel),u.set_style({cursor:"pointer"}),u.add_event("click",function(t){var r=o._getPoiLocalTaskState(n,h),u={parentId:o.id};e.invokeHandler(f.taskDataHandlerKey,{type:s.localDetailsTask,state:r,activateOptions:u});o._logInfoboxClick(n,i);t&&(t.preventDefault&&t.preventDefault(),t.stopImmediatePropagation&&t.stopImmediatePropagation())}))},a.prototype._getPoiLocalTaskState=function(n,t){var o=this.pageProcessor.getCatId(this.viewModel.getResponseContainer()),r={entryPoint:u.Infobox,id:n.id,flippingCard:!0,taskTitle:n.getTitle(),directionsTaskId:t,selectedCategoryId:o?o:n.getSelectedCategoryForIcon&&n.getSelectedCategoryForIcon(),originIG:this._taskState&&this._taskState.originIG,parentIG:this._getImpressionGuid(),iid:this.pageProcessor.iids&&this.pageProcessor.iids[n.id],searchQueryCategory:this._taskState&&this._taskState.searchQueryCategory,listingCategoryPath:this.pageProcessor.getListingCategoryPath(this.viewModel.getResponseContainer()),asName:n&&n.getTitle&&n.getTitle(),asFormattedAddress:n&&n.getAddress&&n.getAddress()},s=n.id.indexOf("eventId")>-1,f,e;return s&&(f=n.getLocation(),e=n.getCity(),f&&(r.latLongForEventRequery=f.latitude+","+f.longitude,r.locationForEventRequery=e?e:"undefined")),n instanceof ii&&(r.localFilters=n.getLocalFilters()),i._updateSearchTaskStateWithAdsData(r,n),r},a.prototype._updateStateWithQueryParseData=function(){var r=this,u=this.panelRoot.select("div[data-queryparse]"),f,i,e;u&&u.length===1&&(f=u[0].getAttribute("data-queryparse"),f&&(i=t.Internals.parseJSON(f),i&&(i.queryKeyword&&(this._queryKeyword=i.queryKeyword.trim(),this._getTaskState().query=this._queryKeyword,this.setTitle(this._queryKeyword),this._initialTitle=this._queryKeyword,this._updateCategories("updateQuery"),e=this.poiManager,e&&e.labelsRendered.addOne(function(){r._taskState.mapBounds=r._getLocalMapViewBounds();r.serializableObjectChanged.invoke({magnitude:0})})),i.spellerCorrectedQuery&&(this._getTaskState().spellerCorrectedQuery=i.spellerCorrectedQuery),i.queryLocation&&(this._getTaskState().queryParseLocation=i.queryLocation),n.bypassMicropoiWorkaround?this._getTaskState().microPoiRequestIsAllowed=i.microPoiRequestIsAllowed:i.microPoiRequestIsAllowed&&(this._getTaskState().microPoiRequestIsAllowed=i.microPoiRequestIsAllowed),i.chainId&&(this._chainId=i.chainId),i.catId&&(this._catId=i.catId))))},a.prototype._logPoiClick=function(n,t){if(this._getTaskState()){var r=this._getTaskState().query||"",u=t?!0:!1,i=this._getlogData(n.id,r,u,"POI");i.impressionGuid=h.getImpressionGuid(this.panelRoot);this.isSearchAlongRouteEnabled()&&(i.logData.data.AL=!0);e.invokeHandler(f.instrumentationDataHandlerKey,i);this._logInstrumentationEventForEntityClick()}},a.prototype._logInfoboxClick=function(n,t){var i,r,f;this._getTaskState()&&(i=this._getTaskState().query||"",r=t?!0:!1);f=this._getlogData(n.id,i,r,u.Infobox)},a.prototype._getlogData=function(n,t,i,r){return{logData:{feature:r,action:"C",data:{ID:n,Q:t,BB:this._getLocalMapViewBounds(),MP:i}}}},a.prototype._updateSelectedPrimitiveById=function(n){for(var t,r=this.getMapPrimitives(),i=0;i<r.length;i++)if(t=r[i],t&&t.entity&&t.entity.id===n){this._taskState.selectedEntityId=null;this._setSelectedPrimitive(t);return}},a.prototype._setSelectedPrimitive=function(t){var u,r,f;if(this._taskState){if(this._taskState.selectedEntityId){if(this._taskState.selectedEntityId===t.entity.id)return;this._resetSelectedPrimitive()}i._getIsSlideCardEnabled()&&(u=this.panelRoot.select("a.listings-item.hover"),u&&u.length&&u.remove_class(a._hoverClassName),r=this.pageProcessor.getListItem(t.entity.id),r&&(this.viewModel.getResponseContainer().add_class(a._hoverClassName),r.add_class(a._hoverClassName),this.viewModel.isWaterfallListingsEnabled()&&(r.add_class(a._waterfallSelectedClassName),n.enableAutoScrollToSelectedListItem&&(f=r.get_sibling(-3),f&&f.length>0&&sj_evt.fire("scrollToTarget",f[0])))));this._taskState.selectedEntityId=t.entity.id}},a.prototype._hideSelectedPrimitive=function(n){var t=this.viewModel.UpdatePrimitiveState(n,3);t&&(this.serializableObjectChanged.invoke({magnitude:0}),this.poiManager.invalidated.invoke())},a.prototype._resetSelectedPrimitive=function(){var n=this.viewModel.UpdatePrimitiveState(this._taskState.selectedEntityId,0);n&&this.poiManager.invalidated.invoke()},a.prototype._processItemClickEvent=function(n){for(var i=this.viewModel.getPushpinPrimitives(),t=0,r=i.length;t<r;t++)if(i[t].entity.id===n){this._setSelectedPrimitive(i[t]);break}this._logInstrumentationEventForEntityClick()},a.prototype.concatOverlayPrimitive=function(){this._contextMenuOnListMode?this._hideListItemContextMenu():o.prototype.concatOverlayPrimitive.call(this)},a.prototype._hideListItemContextMenu=function(){this._contextMenuOnListMode=!1;this._contextMenuElement.removeFromParent();this._contextMenuElement=null},a.prototype._hideContextMenuForOtherListingTasks=function(){var n={requestorType:s.localListingTask,requestorId:this.id,type:s.localListingTask,requestState:{hideContextMenu:!0},useActiveTasks:!0};e.invokeHandler(f.taskProcessDataHandlerKey,n)},a.prototype._processContextMenuEvent=function(n,r){var u=this,e,f,o;for(this._contextMenuOnListMode&&this._hideListItemContextMenu(),this._hideContextMenuForOtherListingTasks(),this._contextMenu.hide(),e=this.viewModel.getPushpinPrimitives(),f=0,o=e.length;f<o;f++)if(e[f].entity.id===r){n.preventDefault&&n.preventDefault();n.stopPropagation&&n.stopPropagation();var s=t(n.currentTarget),h=n.pageX,c=n.pageY-a._contextMenuTopPadding;this._contextMenuOnListMode=!0;this._transientLensViewModel.buildMenu(e[f],s,function(n){u._contextMenuElement=i._createElement("div");u._contextMenuElement.add_class("bm_listMenu").set_style({left:h,top:c,"pointer-events":"none"});n.appendTo(u._contextMenuElement);u.primitiveInteracted.invoke({action:1,element:u._contextMenuElement})})}},a.prototype._processSaveButtonClickEvent=function(n,i,r){var s=this.viewModel.getPushpinPrimitives(),f,v,e,h,c,p,w,l;if(s)for(f=0,v=s.length;f<v;f++)if(s[f].entity.id===r){if(n.preventDefault&&n.preventDefault(),n.stopPropagation&&n.stopPropagation(),e=s[f].entity,!e)return;var o=e.getLocation(),y=this.viewModel.isWaterfallListingsEnabled(),a=y?t(i):t(i.parentElement);if(y&&(h=a.select("div.collectionsPopOut"),c=a.select("img"),h&&h.length&&c&&c.length&&(p=parseInt(c.get_style("height"))+20,h.set_style({top:p+"px"}))),this._transientLensViewModel.getButtonGroupViewModel().setEntityData(e,{requestorType:"LocalListingTask",requestorId:this.id},a),!e||!o)return;w=(new ui).getIsSignedIn();l={logData:{feature:"LC",action:"C",data:{AN:"CollectionsMenu",CP:o,EP:u.LocalListing}}};w?this._transientLensViewModel.getButtonGroupViewModel().collectionMenuButtonClicked(n,o,l,u.LocalListing):ti.isEditable?this._transientLensViewModel.getButtonGroupViewModel().saveWithTravelButtonClicked(n,o,l,u.LocalListing):this._transientLensViewModel.getButtonGroupViewModel().collectionButtonClicked(n,o,l,u.LocalListing);n.target&&n.target.classList.contains("bm_saveButton")&&n.target.setAttribute("aria-expanded","true")}},a.prototype._shouldProcessResponseOnRefresh=function(n,t){var r=!!this._taskState.localFilters||this._taskState.keyRoutePoints&&this._taskState.keyRoutePoints.length>0,u=t&&t.mapPannedOrZooomed;return o.prototype._shouldProcessResponseOnRefresh.call(this,n)||r&&!u||i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&this._taskState.scenarioKey==="ERR"},a.prototype._postRefresh=function(){sj_evt&&this.displayState&&this.displayState.prominence===1&&this.displayState.stackOrder===1&&sj_evt.fire("OnCardRefresh",this.panelRoot,this.stackId)},a.prototype._requestMicroPoiRefresh=function(t){var u;if(t&&!(this._categories.length>0)&&!t.forceDisableMicroPoi){var f=this._isRestaurantMicropoiAllowed(t),e=this.viewModel.getCardCategoryId(),r=e==="School";n.bypassMicropoiWorkaround?(u=t.category&&i._isRestaurantCategory(t.category)||t.searchQueryCategory&&t.searchQueryCategory.indexOf("Restaurant")>-1||this instanceof ai,t.microPoiRequestIsAllowed&&u&&this._previousCatId!==this._catId&&(this._previousCatId=this._catId,this._microPoiManager&&this._microPoiManager.clearMicropoiData()),(t.microPoiRequestIsAllowed||u||r)&&this._microPoiManager&&this._microPoiManager.fetchMicroPois(t.query,this.getMapPrimitives(),u?t.microPoiRequestIsAllowed?null:"requestnotallowed":t.localFilters?t.localFilters:null,this._chainId,this._catId,r?"90199":e)):(t.microPoiRequestIsAllowed||r||f||this.microPoiRequestForLocalOverlayIsAllowed())&&this._microPoiManager&&this._microPoiManager.fetchMicroPois(t.query,this.getMapPrimitives(),t.localFilters&&!f?t.localFilters:f&&t.isFilterSelected?"filterselected":null,this._chainId,this._catId,r?"90199":e)}},a.prototype._isRestaurantMicropoiAllowed=function(n){var r=this._getCategoryOrSegment(),t;return r&&r.toLowerCase().indexOf("testinglocation")>-1?!1:n&&n.entryPoint===u.ServerPagination?!0:(t=this.viewModel.getEntities(),(t&&t.length>=15||this._chainId)&&(n.isFallbackRequery&&(n.category&&i._isRestaurantCategory(n.category)||n.searchQueryCategory&&n.searchQueryCategory.indexOf("Restaurant")>-1)||this instanceof ai))?(this._catId||(this._catId="90287"),!0):!1},a.prototype._onCategoriesChanged=function(n){var c,l,a,o,r,s,t;if(n.added&&this._taskState)for(r=0,s=n.added.length;r<s;r++)c=null,t=n.added[r],t&&i._isHotelsCategory(t)&&this._taskState.keyRoutePoints&&this._taskState.keyRoutePoints.length>=2&&(c=this._getPointsString(this._taskState.keyRoutePoints)),l=t,i._isHotelsCategory(t)&&(l="hotel"),a=this._taskState.query,(fr.useRootQueryInitially[l]||fr.useRootQueryAlways)&&this._taskState.rootKeyword&&(a=this._taskState.rootKeyword),o=i._isLocalOrRealEstateScenarioOverlayShownOnSerp()?this._taskState.localFilters||this._taskState.filterUrlParam:this._taskState.localFilters,!i._isAttractionCategory(t)||this._taskState.keyRoutePoints&&this._taskState.keyRoutePoints.length>0||(o=o?o+' tsource:"attraction"':'tsource:"attraction"'),e.invokeHandler(f.layerManagerDataHandlerKey,{action:"activateLayer",entryPoint:u.LocalListing,taskId:this.id,queryText:a,category:t,displayState:this.displayState,filters:o,cacheId:this._taskState.cacheId,mapBounds:this._taskState.mapBounds,routePoints:c,taskEntities:this.viewModel.getEntities(),disableRefresh:this._taskState.disableListingRefresh,impressionGuid:h.getImpressionGuid(this.panelRoot)});if(n.removed)for(r=0,s=n.removed.length;r<s;r++)t=n.removed[r],e.invokeHandler(f.layerManagerDataHandlerKey,{action:"removeLayer",category:t,taskId:this.id,impressionGuid:h.getImpressionGuid(this.panelRoot)})},a.prototype._updateCategories=function(n,t,i,r){for(var o=0,s=this._categories.length;o<s;o++)e.invokeHandler(f.layerManagerDataHandlerKey,{action:n,entryPoint:u.LocalListing,taskId:this.id,displayState:i,filters:t,category:this._categories[o],queryText:this._taskState.query,taskEntities:r,impressionGuid:h.getImpressionGuid(this.panelRoot)})},a.prototype._drawBoundary=function(){var t=this,n=this.panelRoot.select("div[data-vdpid]").get_attr("data-vdpid")||this._taskState&&this._taskState.vdpid,i=!1;if(n&&this._taskState){if(n===a._clearAttributeValue&&this._polygonLayerAdded&&this._cityPolygonManager){this._cityPolygonManager.removeLayer();this._polygonLayerAdded=!1;return}this._taskState.vdpid&&this._taskState.vdpid!==n&&(i=!0);this._taskState.vdpid=n}this._taskState&&this._taskState.vdpid&&this._taskState.vdpid!==a._clearAttributeValue&&(!this._polygonLayerAdded||i)&&(this._polygonLayerAdded&&this._cityPolygonManager&&this._cityPolygonManager.removeLayer(),this._cityPolygonManager?this._cityPolygonManager.addLayer(this._taskState.vdpid,a._polygonMinZoomLevel,a._polygonMaxZoomLevel):this.map.getCityPolygonManager().then(function(n){t.disposables.push(t._cityPolygonManager=n);n.addLayer(t._taskState.vdpid,a._polygonMinZoomLevel,a._polygonMaxZoomLevel)}),this._polygonLayerAdded=!0)},a.prototype._getPivotEntityForTask=function(){var t=this._taskState.pivotEntity=this._taskState.pivotEntity||this.panelRoot.select("div[data-pivot]").get_attr("data-pivot"),i=this._getNormalizedPivotEntity(t),n;return ot.nearbyListingButtonsEnabled&&(!t||i&&!i.name)&&this._taskState.nearbyPivotEntity&&(n=this._taskState.nearbyPivotEntity,t={name:n.title,id:n.id,idType:n.idType,location:n.location}),t},a.prototype._setPivotPrimitive=function(){var i=this._getPivotEntityForTask(),n,r,u;if(i&&this.poiManager){if(i===a._clearAttributeValue){this.poiManager.setPivotPrimitive(null);return}typeof i=="string"&&(i=this._taskState.pivotEntity=t.Internals.parseJSON(i));n=i;n&&n.name&&n.idType&&n.id&&n.location&&n.location.latitude&&n.location.longitude&&!isNaN(n.location.latitude)&&!isNaN(n.location.longitude)&&(r=new b(n.location.latitude,n.location.longitude),u=new ii(n.name,null,n.idType+":"+n.id,r,r),u.setSearchCategory("PivotEntity"),u.setSelectedCategoryForIcon("PivotEntity"),this.poiManager.setPivotPrimitive(new pi(r,u)))}},a.prototype._setDisableListingRefresh=function(t){var i,r;this._taskState.disableListingRefresh!==!1&&this._taskState.scenarioKey==="EIC"&&(i=k.parseCategory(t),i=i&&i.toLowerCase(),n.enableListingRefreshCats&&n.enableListingRefreshCats.indexOf(i)>-1&&(this._taskState.disableListingRefresh=!1,r=this._queryKeyword||i,this._taskState.query=this._taskState.taskTitle=r,this._initialTitle=r,this.setTitle(r)))},a.prototype._getPoiCountParam=function(){var n="";return this._taskState&&this._taskState.poiCount!==null&&(n=this._taskState.poiCount),n},a._clearAttributeValue="nodata",a._hoverClassName="hover",a._waterfallSelectedClassName="wfrselected",a._polygonMinZoomLevel=3,a._polygonMaxZoomLevel=11,a._panelRendered=!1,a._contextMenuTopPadding=25,a}(l),ki=function(r){function u(n,t,i,u,f,e,o,s){var h=r.call(this,n,t,i,u,f,e,o,s)||this;return h._infoboxOptions={showCloseButton:!1,zIndex:1006,showPointer:!1,visible:!0,htmlContent:null,location:null,autoAlignment:!0},h._bindEventsForInfobox(),h}return y(u,r),u.prototype.activate=function(n,i,u,f){var e=this,o=this._taskState&&this._taskState.isCompareOverlayOpen,s=i&&i.isCompareOverlayOpen;if(o&&!s){sj_evt.fire("ovlHide","ent_ovlc",!0);return}this._compareOverlayShowHandlerWrapper||(this._compareOverlayShowHandlerWrapper=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e._compareOverlayShowHandler.apply(e,t[0])},sj_evt.bind("ovlShow",this._compareOverlayShowHandlerWrapper,0));this._compareOverlayHideHandlerWrapper||(this._compareOverlayHideHandlerWrapper=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e._compareOverlayHideHandler.apply(e,t[0])},sj_evt.bind("ovlHide",this._compareOverlayHideHandlerWrapper,0));this._layoutChangedHandler||(this._layoutChangedHandler=function(n){n[1]==="MultiCardLeftSelectionLayout"?e._filterOverlays=e._removeFilterOverlays():n[1]==="MultiCardLeftLayout"&&e._filterOverlays&&e._filterOverlays.length>0&&Microsoft.Maps.setTimeout(function(){var i=document.getElementsByClassName("taskLayoutContainer"),n,r,u;if(i&&i.length>0)for(n=0,r=e._filterOverlays.length;n<r;n++)u=e._filterOverlays[n],t(i[0]).append(u);e._filterOverlays=null},1e3)},sj_evt.bind("layoutChanged",this._layoutChangedHandler));r.prototype.activate.call(this,n,i,null,f)},u.prototype.deactivate=function(){this._removeFilterOverlays();sj_evt&&sj_evt.unbind("layoutChanged",this._layoutChangedHandler);r.prototype.deactivate.call(this)},u.prototype._refresh=function(n){n&&n.mapPannedOrZooomed&&this._taskState.locationFilter&&(this._taskState.locationFilter=null,this._updateLocalFiltersForPricePoi(),this._updateCategoriesLayer("updateFilters",this._taskState.localFilters));r.prototype._refresh.call(this,n);i._isLocalOverlayShownOnSerp()&&n.isResearchOnOverlay&&this._updateCategoriesLayer("refreshData")},u.prototype.setDisplayState=function(n){n&&n.activationState===1&&n.prominence===1&&this._taskState&&this._taskState.keyRoutePoints&&(n.suppressViewChange=!0);r.prototype.setDisplayState.call(this,n)},u.prototype._updateCategoriesLayer=function(n,t){var r,u,o;if(this._categories&&this._categories.length>0)for(r=0,u=this._categories.length;r<u;r++)i._isHotelsCategory(this._categories[r])&&(o={action:n,taskId:this.id,category:this._categories[r],filters:t,queryText:this._taskState.query,impressionGuid:h.getImpressionGuid(this.panelRoot)},e.invokeHandler(f.layerManagerDataHandlerKey,o))},u.prototype._resetFilterStates=function(){if(r.prototype._resetFilterStates.call(this),n.showPricePoiHotelsOnOneMap){var t=_w.LocalStorageHelper;_w.priceFilterPrice=undefined;t?(t.removeItem("ol_startdate"),t.removeItem("ol_enddate"),t.removeItem("hpa_roomnum")):(_w.ol_startdate=null,_w.ol_enddate=null,_w.hpa_roomnum=null);this._taskState.locationFilter=null}},u.prototype._createUrl=function(i,u,f){var o,e,h;n.useNewListingSearchCount&&!f?f=n.listingSearchCount:(!f||f===20)&&n.threeColumnListSegmentsEnabled&&n.threeColumnListSegmentsEnabled.length>0&&n.threeColumnListSegmentsEnabled.indexOf("Hotel")>-1&&this._isThreeColumnsOk(i)&&(f=21);this._taskState&&(this._taskState.isFallbackRequery=!0,this._taskState.scrollListOnPoiHover=!1);this._updateLocalFiltersForPricePoi();o=r.prototype._createUrl.call(this,i,u,f);i&&(i.filterValueChanged||i.mapPannedOrZooomed)&&(o+="&htlsource=overlayf");var l=Logger.getOverlayType(),s=this._taskState.passThruParam;if(l?o+=this._taskState.originIG&&this._taskState.originIG===c.dynamicProperties.serpIG?s&&s.indexOf("hotelCollectionOverlay=1")!==-1?"&FORM=HOTELC":"&FORM=BHO001":"&FORM=BHO002":(o+="&FORM=BHO003",o+="&mapsVertical=true"),s&&s.toUpperCase().indexOf("FORM=")===-1&&(o+=s.indexOf("&")!==0?"&"+s:s),this._taskState.cacheId&&(o+="&cacheid="+this._taskState.cacheId),this._taskState.pivotEntity){if(e=this._taskState.pivotEntity,typeof e=="string"&&e!==ut._clearAttributeValue)try{e=t.Internals.parseJSON(e)}catch(a){}e=e;e&&e.id&&e.location&&e.location.latitude&&e.location.longitude&&(o+="&pivotinfo="+e.id+"|"+e.location.latitude+"|"+e.location.longitude)}return this._taskState.hotelCompare&&(o+="&compsel=2"),this._taskState.hotelPrimerPois&&this._taskState.hotelPrimerPois.length>0&&(h="",this._taskState.hotelPrimerPois.forEach(function(n){h+=n.entity.id+","}),h=h.substr(0,h.length-1),h&&(o+="&hotelypids="+h),this._taskState.hotelPrimerPois=null),o},u.prototype._getCacheId=function(){return""},u.prototype.onFilterValueChanged=function(n,t){var e,i,o,u,c,f,s,h;this._taskState.originIG&&(e=/GST(\d{1,2})/,i=e.exec(n),i&&i.length>1&&(o=i[1],u=e.exec(this._taskState.localFilters),u&&u.length>1&&(c=u[1],o!=c&&sj_evt.fire("VRGuestsFilterChanged_"+this._taskState.originIG,o))),n&&(f=n.match(/NumOfGuests-(\d)/),f&&f.length===2&&(s=f[1],h=_w.LocalStorageHelper,h?h.setItem("hpa_roomnum",s,1):_w.hpa_roomnum=s)));this._updateLocalFiltersForPricePoi(n);r.prototype.onFilterValueChanged.call(this,this._taskState.localFilters,t)},u.prototype.processResponse=function(i,u){var f,s,e,o,h;if(r.prototype.processResponse.call(this,i,u),this._taskState.localFilters+=' segment:"Hotel"',this._taskState&&this.panelRoot&&(f=this.panelRoot.select("div[data-cacheid]"),f&&f.length===1&&(s=f[0].getAttribute("data-cacheid"),s&&(this._taskState.cacheId=s))),n.showInlineFilters&&(e=t(".infobubble_content .b_vPanel"),e))for(o=0;o<e.length;o++)h=e[o],h&&h.setAttribute("class","")},u.prototype.registerFilterBarEventHandlersV2=function(){var i=this.panelRoot.select("#bm_contextualTaskbar")[0]||this.panelRoot[0],u,n;this.getFilters()&&(u=t(".stickyFiltersRoot"),u.length>0&&(i=u[0]));i&&(this._processCalendarControl(),this._processPriceFilter(),n=i.getElementsByClassName("bm_filterBar")[0],n&&(_w.hpaFilter=n.getAttribute("fp"),this._processLocationFilter(n)));r.prototype.registerFilterBarEventHandlersV2.call(this);this._changePositionOfFilterOverlays()},u.prototype._getRequestUrlFormat=function(){return r.prototype._getRequestUrlFormat.call(this),n.requestUrlFormatForLocalOverlayOnSerp},u.prototype._removeFilterOverlays=function(){var r,i,u,f;if(n.showInlineFilters&&(r=document.getElementsByClassName("taskLayoutContainer"),r&&r.length>0)){if(i=t(r[0]).select("[data-filterTaskId='"+this.id+"']"),i&&i.length>0)for(u=0,f=i.length;u<f;u++)t(i[u]).removeFromParent();return i}},u.prototype._changePositionOfFilterOverlays=function(){var e,l,a,o,r,f,v,s;if(n.showInlineFilters){this._removeFilterOverlays();var h=i.getVerticalTaskBarWidth(),c=32-i.getSearchBoxHeaderHeight(),u=document.getElementsByClassName("taskLayoutContainer");if(u&&u.length>0){for(e=this.panelRoot.select(".b_filterOverlay"),r=0,f=e.length;r<f;r++)l=e[r],a=t(l),this._moveFilterOverlayOrDropdown(a,t(u[0]),h,c);for(o=this.panelRoot.select(".bm_filterBarItem .b_dropdown"),r=0,f=o.length;r<f;r++)v=o[r],s=t(v),s.add_class("bm_filterBarDropdown"),this._moveFilterOverlayOrDropdown(s,t(u[0]),h,c)}}},u.prototype._moveFilterOverlayOrDropdown=function(n,t,i,r){var f=n[0].parentElement,u=f.getBoundingClientRect();n.set_style({"z-index":1e4,left:u.left-i,top:u.top+r,"max-width":"none"});this.id&&n.set_attr("data-filterTaskId",this.id);t.append(n[0])},u.prototype._getPriceFilterFromUrlParam=function(){var n=this._taskState.filterUrlParam,i,t,u,r,f;if(n&&n.length>0&&(i=n.indexOf("LHP"),i>-1&&(t=n.indexOf("_",i),t>-1&&(u=n.substring(i+4,t),r=n.indexOf("_",t+1),r>-1))))return f=n.substring(t+5,r),"LHP-"+u+"_HHP-"+f},u.prototype._updateLocalFiltersForPricePoi=function(i){var f=_w.LocalStorageHelper,l=f?f.getItem("ol_startdate"):_w.ol_startdate,a=f?f.getItem("ol_enddate"):_w.ol_enddate,v,g,r,u,y,nt,tt,b,i,h,d;if(n.showPricePoiHotelsOnOneMap){if(this._taskState&&this._taskState.localFilters&&this._taskState.fromSharing){v=this._taskState.localFilters;this._saveDateFromFilters(v,"_SD-\\d{8}","ol_startdate");this._saveDateFromFilters(v,"_ED-\\d{8}","ol_enddate");this._taskState.fromSharing=!1;return}_w.ol_hdf=!0;g=null;_w.ol_startdate=this._getTaskStateStartDate()||l||g;_w.ol_enddate=this._getTaskStateEndDate()||a}if(r=i||this._taskState.localFilters||this._taskState.filterUrlParam,c.isMobile&&r&&(r.indexOf("hotel_filters")===0?(_w.mobile_hotel_filters=r,r=_w.mobile_local_filters):_w.mobile_local_filters=r),r?r.indexOf('local_filters:"UR')===-1&&r.indexOf(",UR")===-1&&(r=r.replace('local_filters:"','local_filters:"UR4U,')):r='local_filters:"UR4U"',_w.ol_hdf){if(u="",_w.priceFilterPrice?u="LHP-0_HHP-"+_w.priceFilterPrice.replace("+",""):(u=this._getPriceFilterFromUrlParam(),u||(u="")),y=!0,n.showInlineFilters){var p=void 0,w=void 0,e=void 0;if(e=this.getFilters()?t(".stickyFiltersRoot").select("[data-date]"):this.panelRoot.select("[data-date]"),e&&e.length===2&&(nt=e[0].getAttribute("data-date"),tt=e[1].getAttribute("data-date"),p=new Date(this._formatDate(nt)),w=new Date(this._formatDate(tt))),p&&w){var it="MMddyyyy",o=this._calendarFormatDate(p,it),s=this._calendarFormatDate(w,it);u=u?u+"_SD-"+o+"_ED-"+s:"SD-"+o+"_ED-"+s;y=!1}}if(y&&l&&a){var rt="MMddyyyy",ft=new Date(l),et=new Date(a),o=this._calendarFormatDate(ft,rt),s=this._calendarFormatDate(et,rt);u=u?u+"_SD-"+o+"_ED-"+s:"SD-"+o+"_ED-"+s}b=f?f.getItem("hpa_roomnum"):_w.hpa_roomnum;b&&(u+="_NumOfGuests-"+b);i=u?'hotel_filters:"'+u+'" segment:"Hotel"':'segment:"Hotel"';var k=/(local_filters:"[,\w]+")/.exec(r),ut=r.indexOf("hotel_filters");r=ut===-1?r+" "+i:r.slice(0,ut)+i;r&&r.indexOf("local_filters:")===-1&&k&&k.length>0&&(r+=" "+k[0]);_w.mobile_hotel_filters&&(r+=" "+_w.mobile_hotel_filters)}else r+=' segment:"Hotel"';this._taskState.locationFilter?r+=" "+this._taskState.locationFilter:_w.hotelLocationFilter&&(r+=" "+_w.hotelLocationFilter);r.indexOf("LocationFilterKey")===-1&&this.panelRoot&&(h=this.panelRoot.select("div[data-locationfilterkey]"),h&&h.length&&(d=h.get_attr("data-locationfilterkey"),d&&(r+=' LocationFilterKey:"'+d+'"')));this._taskState.localFilters=r},u.prototype._formatDate=function(t){return n.modifyIntlDateFormat&&t.indexOf(".")>-1&&(t=t.replace(/\./g,"/")),t},u.prototype._compareOverlayShowHandler=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t[1]==="ent_ovlc"&&(this._taskState.isCompareOverlayOpen=!0,this.serializableObjectChanged.invoke({magnitude:2}))},u.prototype._compareOverlayHideHandler=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t[1]==="ent_ovlc"&&(this._taskState.isCompareOverlayOpen=!1,!t[2]==!0&&this.serializableObjectChanged.invoke({magnitude:2}))},u.prototype._bindEventsForInfobox=function(){sj_evt&&sj_evt.bind("pushpinhoverstarted",function(n){var t=n[1],u=t.entity.id.replace("ypid:","").replace("sid:",""),i=_ge(u),f,r;i&&(f=new Microsoft.Maps.Location(t.geometry.y,t.geometry.x),r="<div class='MiniInfobox2' id='infobox-container'><a class='infoBoxLink' role='button' href='#'><div class='infobox-body'>"+i.innerHTML+"<\/div><\/a><\/div>",t.entity.infoboxHtml=r)})},u.prototype._processPriceFilter=function(){var n=this;this._priceChangeHandler&&sj_evt.unbind("priceFilterUpdate",this._priceChangeHandler);this._priceChangeHandler=function(){n.onFilterValueChanged(null);var t={logData:{feature:"FSB",action:"SE",data:{Q:n._taskState.query,FT:1,FA:n._taskState.localFilters,IS:!0}},impressionGuid:h.getImpressionGuid(n.panelRoot)};e.invokeHandler(f.instrumentationDataHandlerKey,t)};sj_evt.bind("priceFilterUpdate",this._priceChangeHandler)},u.prototype._processCalendarControl=function(){var i=this,r;this.panelRoot&&(r=void 0,r=this.getFilters()?t(".stickyFiltersRoot").select("div[data-calendarEndId]"):this.panelRoot.select("div[data-calendarEndId]"),r&&r.length&&(this._calendarEndId=r.get_attr("data-calendarEndId")));this._calendarEndId&&(this._calendarChangeHandler&&sj_evt.unbind("TwoCalCombo_EndDateClick",this._calendarChangeHandler),this._calendarChangeHandler=function(r){var u=_w.LocalStorageHelper,a=r[1],o,s,c,l;if(a==i._calendarEndId){n.showInlineFilters?(o=void 0,o=i.getFilters()?t(".stickyFiltersRoot").select("[data-date]"):i.panelRoot.select("[data-date]"),o&&o.length===2&&typeof DateHelper!="undefined"&&typeof DateHelper.parseDate!="undefined"&&(s=DateHelper.parseDate(o[0].getAttribute("data-date"),"mm/dd/yyyy").toJSON(),c=DateHelper.parseDate(o[1].getAttribute("data-date"),"mm/dd/yyyy").toJSON(),u?(u.setItem("ol_startdate",s,1),u.setItem("ol_enddate",c,1)):(_w.ol_startdate=s,_w.ol_enddate=c))):r&&r.length>=4&&r[2]&&r[3]&&(u?(u.setItem("ol_startdate",r[2].toJSON(),1),u.setItem("ol_enddate",r[3].toJSON(),1)):(_w.ol_startdate=r[2].toJSON(),_w.ol_enddate=r[3].toJSON()));i._dateFilterChanged=!0;i.onFilterValueChanged(null);l={logData:{feature:"FSB",action:"SE",data:{Q:i._taskState.query,FT:4,FA:i._taskState.localFilters,IS:!0}},impressionGuid:h.getImpressionGuid(i.panelRoot)};e.invokeHandler(f.instrumentationDataHandlerKey,l)}},sj_evt.bind("TwoCalCombo_EndDateClick",this._calendarChangeHandler))},u.prototype._processLocationFilter=function(i){var r=this,u=i.getElementsByClassName("catfOption"),o,s;if(u!=null&&u.length>0)for(o=0;o<u.length;o++)s=u[o],sj_be(s,"click",function(u){var a=u.currentTarget.getAttribute("data-filterParam"),c=r.decodeHtmlEncoding(a),o,s,l;if(c!=null){n.showInlineFilters&&i&&(o=void 0,o=r.getFilters()?t("#ftrD_Location",i):t(".bm_filterBarDropdown #ftrD_Location"),s=o.getParent(),s&&s.add_class("b_hide"));r._taskState.locationFilter=c;r._taskState.pivotEntity=null;r.onFilterValueChanged(null);l={logData:{feature:"FSB",action:"SE",data:{Q:r._taskState.query,FT:7,FA:r._taskState.localFilters,IS:!0}},impressionGuid:h.getImpressionGuid(r.panelRoot)};e.invokeHandler(f.instrumentationDataHandlerKey,l)}})},u.prototype._getTaskStateStartDate=function(){return this._taskState&&this._taskState.startDate?this._validatedDateString(this._taskState.startDate):null},u.prototype._getTaskStateEndDate=function(){return this._taskState&&this._taskState.endDate?this._validatedDateString(this._taskState.endDate):null},u.prototype._validatedDateString=function(n){var t;try{if(n=this._formatDate(n),t=new Date(n),t){var i=t.getMonth(),r=t.getDate(),u=t.getFullYear();if(i>=0&&i<12&&r>0&&r<32&&u>2e3)return t.toDateString()}}catch(f){return null}return null},u.prototype._calendarFormatDate=function(n,t){var i=n.getMonth(),r=n.getDate();return t.replace(/yyyy/i,n.getFullYear().toString()).replace(/mm/i,(i<9?"0":"")+(i+1)).replace(/m/i,(i+1).toString()).replace(/dd/i,(r<10?"0":"")+r).replace(/d/i,r.toString())},u.prototype._saveDateFromFilters=function(n,t,i){var e=new RegExp(t,"i"),u=n.search(e),r,f;u>-1&&u+12<=n.length&&(r=n.substr(u+4,8),r&&r.length===8&&(f=this._convertFilterDate(r),f&&(_w[i]=f)))},u.prototype._convertFilterDate=function(n){var r;if(n&&n.length===8){n=this._formatDate(n);var t=parseInt(n.substr(0,2),10),i=parseInt(n.substr(2,2),10),u=parseInt(n.substr(4,4),10);return isNaN(t)||t<1||t>12||isNaN(i)||i>31||i<1||isNaN(u)?null:(r=new Date(u,t-1,i),r?r.toDateString():null)}return null},u.prototype._getSegmentParam=function(){return"hotel"},u.prototype._getTextAdsCode=function(){return null},u}(ut),ne=function(i){function r(t,r,u,f,e,o,s,h,c,l){var a=i.call(this,t,r,u,f,e,o,s,h,c,l)||this;return a.setRecommendedWidth(n.houseCardWidth),a.setCurrentWidth(n.houseCardWidth),a._safariClassRemoved=!1,a}return y(r,i),r.prototype._getRequestUrlFormat=function(){return i.prototype._getRequestUrlFormat.call(this),n.requestUrlFormatForRealEstateOverlayOnSerp},r.prototype.processResponse=function(n,t){var u,r,f;i.prototype.processResponse.call(this,n,t);u="data-interestdata";r=n&&n.select("["+u+"]").get_attr("id");r&&this.map&&(f="SubscriptionComponent_Init_"+r,sj_evt.fire(f));i.prototype._registerOverlayLinksForInstrumentation.call(this,".b_entityTP a","OverlayInteractions","CI.HouseLinksClick","REOverlayUrl")},r.prototype.deactivate=function(){if(i.prototype.deactivate.call(this),this._safariClassRemoved){var n=t(".taskLayoutContainer");n&&n.add_class("bm_safari");this._safariClassRemoved=!1}},r.prototype._getSegmentParam=function(){return"house"},r.prototype._getTextAdsCode=function(){return null},r}(rt),di=function(r){function u(n,t,i,u,f,e,o,s){var h=r.call(this,n,t,i,u,f,e,o,s)||this;return h._infoboxOptions={showCloseButton:!1,zIndex:1006,showPointer:!1,visible:!0,htmlContent:null,location:null,autoAlignment:!0},h._bindEventsForInfobox(),h}return y(u,r),u.prototype._refresh=function(n){this.map.getMapType().id!==sr.birdseyeV2&&r.prototype._refresh.call(this,n)},u.prototype.activate=function(n,i,u,f){var e=this;this._layoutChangedHandler||(this._layoutChangedHandler=function(n){n[1]==="MultiCardLeftSelectionLayout"?e._filterOverlays=e._removeFilterOverlays():n[1]==="MultiCardLeftLayout"&&e._filterOverlays&&e._filterOverlays.length>0&&Microsoft.Maps.setTimeout(function(){var i=document.getElementsByClassName("taskLayoutContainer"),n,r,u;if(i&&i.length>0)for(n=0,r=e._filterOverlays.length;n<r;n++)u=e._filterOverlays[n],t(i[0]).append(u);e._filterOverlays=null},1e3)},sj_evt.bind("layoutChanged",this._layoutChangedHandler));this._setIsRealEstateTask();r.prototype.activate.call(this,n,i,null,f)},u.prototype.deactivate=function(){this._removeFilterOverlays();sj_evt&&sj_evt.unbind("layoutChanged",this._layoutChangedHandler);this._clearIsRealEstateTask();r.prototype.deactivate.call(this)},u.prototype._createUrl=function(t,i,u){if(this._taskState){this._taskState.poiCount=n.useNewListingSearchCount?n.listingSearchCount.toString():"20";this._taskState.isFallbackRequery=!0;this._taskState.scrollListOnPoiHover=!1;this._taskState.spellerCorrectedQuery&&(this._taskState.localFilters?(this._taskState.localFilters.indexOf("tsource:")<0&&(this._taskState.localFilters+=' tsource:"realestate"'),this._taskState.localFilters.indexOf("segment:")<0&&(this._taskState.localFilters+=' segment:"generic.carousel"'),this._taskState.localFilters.indexOf("secq:")<0&&(this._taskState.localFilters+=' secq:"'+this._taskState.spellerCorrectedQuery+'"')):this._taskState.localFilters='tsource:"realestate" segment:"generic.carousel" secq:"'+this._taskState.spellerCorrectedQuery+'"');this._taskState.queryParseLocation&&(this._taskState.localFilters?this._taskState.localFilters.indexOf("loc:")<0&&(this._taskState.localFilters+=' loc:"'+this._taskState.queryParseLocation+'"'):this._taskState.localFilters='loc:"'+this._taskState.queryParseLocation+'"');var f=this._tryGetFlyoutParamFromUrl(document.location.search.toLowerCase());f&&(this._taskState.localFilters?this._taskState.localFilters.indexOf("flyout:")<0&&(this._taskState.localFilters+=' flyout:"1"'):this._taskState.localFilters='flyout:"1"')}return(!u||u===20)&&n.threeColumnListSegmentsEnabled&&n.threeColumnListSegmentsEnabled.length>0&&n.threeColumnListSegmentsEnabled.indexOf("House")>-1&&this._isThreeColumnsOk(t)&&(u=18),r.prototype._createUrl.call(this,t,i,u)},u.prototype._tryGetFlyoutParamFromUrl=function(n){var i="flyout=",r,t,u;return!n||n.indexOf(i)===-1?!1:(r=n.indexOf(i)+i.length,r===n.length)?!1:(t=n.substring(r),u=t.indexOf("&"),u!==-1&&(t=t.substring(0,u)),t==="1")?!0:!1},u.prototype._getRequestUrlFormat=function(){return r.prototype._getRequestUrlFormat.call(this),n.requestUrlFormatForRealEstateOverlayOnSerp},u.prototype.logInstrumentationEventForServerRenderedFilter=function(n){var t=n.currentTarget&&n.currentTarget.parentElement&&n.currentTarget.parentElement.id,i={logData:{feature:"FSB",action:"SE",data:{Q:this._taskState.query,FT:t,FA:this._taskState.localFilters,IS:!0}},impressionGuid:h.getImpressionGuid(this.panelRoot)};e.invokeHandler(f.instrumentationDataHandlerKey,i)},u.prototype.processResponse=function(n,t){this._setPreloadedInterestCguidForFollowControl(t);this._updateQueryParamsForSubscription(n);r.prototype.processResponse.call(this,n,t)},u.prototype._setPreloadedInterestCguidForFollowControl=function(n){var e,i,u,t,r,f;if((n===void 0&&(n={}),e=n.mapPannedOrZooomed||n.filterValueChanged,this._isSessionStorageSupported())&&(i="FollowControl",_w[i]=_w[i]||{},u=_w[i],t=this._getInterestCguidFromUrl(),t)){if(r="mapsShouldDisableFollowControlPreload",f="mapsPreloadedInterestCguid",e){u.preloadedInterestCguid=null;sessionStorage.setItem(r,"true");return}(sessionStorage.getItem(f)!==t||sessionStorage.getItem(r)!=="true")&&(u.preloadedInterestCguid=t,sessionStorage.setItem(f,t),sessionStorage.removeItem(r))}},u.prototype._isSessionStorageSupported=function(){if(typeof sessionStorage=="undefined")return!1;try{return sessionStorage.setItem("mapsSessionStorageTest",Math.random().toString()),sessionStorage.getItem("mapsSessionStorageTest"),sessionStorage.removeItem("mapsSessionStorageTest"),!0}catch(n){return!1}},u.prototype._getInterestCguidFromUrl=function(){var i=document.location.search.toLowerCase(),t=i.match(/icguid=([a-z0-9-]+)/),n;return t?(n=t[1],!n||n.length!==36)?null:n:null},u.prototype._updateQueryParamsForSubscription=function(n){var f=this,t="data-interestdata",i=n&&n.select("["+t+"]").get_attr("id"),r="data-interest-json",u=n&&n.select("["+r+"]").get_attr("id");(i||u)&&this.map&&this.poiManager&&this.disposables.push(this.poiManager.labelsRendered.addOne(function(){var o=ft.getMapCenter(f.map),e=ft.getMercatorZoomLevel(f.map),h=_ge(u),v=document.getElementById(i),y,n,c,l,p,a,s,w;if(h){y=h.getAttribute(r);try{n=JSON.parse(y)}catch(b){}if(!n||!n.Filters||!o)return;n.Filters.MapZoomLevel=e;c=o.latitude;l=o.longitude;!isNaN(c)&&!isNaN(l)&&Math.abs(c)<=90&&Math.abs(l)<=180&&(n.Filters.MapCenterPointLat=c,n.Filters.MapCenterPointLong=l);h.setAttribute(r,JSON.stringify(n));e>=12&&e<=20?(p="init_"+u,sj_evt.fire(p)):(a=sj_fa(h,".fc-sec"),a&&a.parentNode.removeChild(a))}else v&&(s=v.getAttribute(t),s&&(s+=";"),s+="cp:"+o.latitude+"~"+o.longitude+";lvl:"+e,v.setAttribute(t,s),e>=12&&e<=20&&(w="SubscriptionComponent_Init_"+i,sj_evt.fire(w)))}))},u.prototype._bindEventsForInfobox=function(){sj_evt&&sj_evt.bind("pushpinhoverstarted",function(n){var t=n[1],u=t.entity.id.replace("ypid:","").replace("sid:",""),i=_ge(u),f,r;i&&(f=new Microsoft.Maps.Location(t.geometry.y,t.geometry.x),r="<div class='MiniInfobox2' id='infobox-container'><a class='infoBoxLink' role='button' href='#'><div class='infobox-body'>"+i.innerHTML+"<\/div><\/a><\/div>",t.entity.infoboxHtml=r)})},u.prototype._getSegmentParam=function(){return"house"},u.prototype._getTextAdsCode=function(){return null},u.prototype.registerFilterBarEventHandlersV2=function(){r.prototype.registerFilterBarEventHandlersV2.call(this);this._changePositionOfFilterOverlays()},u.prototype._removeFilterOverlays=function(){var r,i,u,f;if(n.showInlineFilters&&n.advancedFiltersEnabledForRE&&(r=document.getElementsByClassName("taskLayoutContainer"),r&&r.length>0)){if(i=t(r[0]).select("[data-filterTaskId='"+this.id+"']"),i&&i.length>0)for(u=0,f=i.length;u<f;u++)t(i[u]).removeFromParent();return i}},u.prototype._changePositionOfFilterOverlays=function(){var t=this,r;if(n.showInlineFilters&&n.advancedFiltersEnabledForRE)Microsoft.Maps.setTimeout(function(){t._removeFilterOverlays();var n=i.getVerticalTaskBarWidth(),r=32,u=document.getElementsByClassName("taskLayoutContainer"),f=t.panelRoot.select(".b_filterOverlay"),e=t.panelRoot.select(".bm_filterBarItem .b_dropdown");t._changeFilterPositions(u,f,n,r);t._changeFilterPositions(u,e,n,r-10)},1e3);else if(n.showInlineFilters){var f=15,u=this.panelRoot.select(".bm_filterBarItem .ftrH"),e=function(n){var t=u[n];u[n].addEventListener("click",function(){Microsoft.Maps.setTimeout(function(){var n=t.nextElementSibling;if(n){var e=document.getElementsByClassName("bm_scrollbarMask"),i=e[0].getBoundingClientRect(),r=n.getBoundingClientRect(),u=r.left+r.width-(i.left+i.width-f);u>0&&(n.style.marginLeft=-u+"px")}},100)})};for(r=0;r<u.length;r++)e(r)}},u.prototype._changeFilterPositions=function(n,i,r,u){var e,s,f,h;if(n&&n.length>0&&i&&i.length>0)for(e=0,s=i.length;e<s;e++)if(f=i[e],h=f.getAttribute("data-filterkey")==="mso:real_estate.house.sort",!(f.id.indexOf("maxd")>-1)&&!(f.id.indexOf("mind")>-1)){var o=t(f),l=f.parentElement,c=l.getBoundingClientRect();o.set_style({"z-index":1e4,left:c.left-r,top:c.top+u+(h?10:0)});this.id&&o.set_attr("data-filterTaskId",this.id);o.add_class("advanceFilters");t(n[0]).append(f)}},u.prototype._setIsRealEstateTask=function(){this.poiManager&&this.poiManager.setIsRealEstateTask&&this.poiManager.setIsRealEstateTask(!0)},u.prototype._clearIsRealEstateTask=function(){this.poiManager&&this.poiManager.setIsRealEstateTask&&this.poiManager.setIsRealEstateTask(!1)},u}(ut),te=function(){function s(){this._birdseyePreviewInitialized=!1}return s.prototype.process=function(n,u,e){var o,l,h,s,a;n&&u&&(u.showBackButton&&(o=i._createElement("a"),o.add_class("commonButton backArrowButton overlayButton"),o.set_attr("href","#"),o.set_attr("title",u&&u.cameFromCollections?r.L_LocalSearch_BackToCollections:r.L_LocalSearch_BackToSearchResults),l=u.listingTaskId?{action:"focus",id:u.listingTaskId}:{action:"remove",id:u.id},o.set_attr(f.taskDataHandlerKey,t.Internals.stringify(l)),h=i._createElement("div"),h.add_class("overlayBackButtonText"),h.set_text(r.L_LocalSearch_ReturnToList),o.append(h),s=i._createElement("div"),s.set_attr("data-tag","detailsCardBackBtnContainer"),a=c.features.taskBar,s.set_style({"padding-bottom":"35px"}),s.append(o),n.insertBefore(s,n[0].firstElementChild)),this._processStreetside(n,e,u),this._processGeochain(n,u))},s.prototype._processStreetside=function(i,r,u){var w=this,o=i.select("a[data-streetside]"),k=u?u.routablePoint:null,a,y,p,c,s,d,g,v,l,h;if(!yr||!yr.isEnabled){n&&n.addNewSSPlcHoldImage?(a=i.select(".ssContainer"),a&&a.length>0&&(h=t(".cico.plchold.ssModule",a.getParent()[0]),h&&h.length>0?h.add_class("setOn"):a.set_style({display:"none"})),o&&(y=t("#bev2Img",o.getParent()[0]),y&&y.removeFromParent(),o.removeFromParent())):o&&o.getParent().getParent()&&o.getParent().getParent().removeFromParent();return}p=o&&o.get_attr("data-streetside");p?(c=t.Internals.parseJSON(p),s=c.localDetailsStartupOptions,s&&(s.fov=null,s.heading=null,s.pitch=null,!s.routablePoint&&k&&(s.routablePoint=k),o.set_attr("data-streetside",t.Internals.stringify(c))),s.canonicalImageUrlGroup&&s.canonicalImageUrlGroup.length?o.set_style({display:"block","background-image":"url('"+s.canonicalImageUrlGroup[0].url+"')"}):(o.set_attr("data-streetside",""),d=r&&r.start(sf.LocalDetailsIntegrationTime),s.sivImageContainer=o,u!=null&&u.location==null&&c!=null&&c.location!=null&&(u.location=new b(c.location.latitude,c.location.longitude)),g={action:"showBubbleImage",location:new b(c.location.latitude,c.location.longitude),localDetailsStartupOptions:s,perfState:d,callback:function(){w._processBirdsEyePreview(i,u,o,!1)},errorCallback:function(){w._processBirdsEyePreview(i,u,o,!0)}},v=i.select(".b_FBleedModule.plchold.ssModule"),v&&v.length>0&&v.set_style({display:"none"}),e.invokeHandler(f.streetsideDataHandlerKey,g))):(l=i.select(".ssContainer"),l&&l.length>0&&(h=t(".cico.plchold.ssModule",l.getParent()[0]),n&&n.addNewSSPlcHoldImage?h&&h.length>0?h.add_class("setOn"):l.set_style({display:"none"}):(h&&h.length>0&&h.remove_class("setOn"),l.getParent()&&l.getParent().removeFromParent())))},s.prototype._processBirdsEyePreview=function(n,t,i,r){var f=this,u;if(!this._birdseyePreviewInitialized){if(this._birdseyePreviewInitialized=!0,!n||!t||!t.map||!t.location){r&&i&&i.getParent().getParent()&&i.getParent().getParent().removeFromParent();return}u=n.select("a[id=bev2Img]");u&&u.length?(this._loadBirdsEyeThumbnail(n,t,i,r),t.map.mapResized.add(function(){f._loadBirdsEyeThumbnail(n,t,i,r)})):r&&i&&i.getParent()&&i.getParent().removeFromParent()}},s.prototype._loadBirdsEyeThumbnail=function(i,r,u,f){var v=this,e=i.select("a[id=bev2Img]"),y=r.location,s=r.map,l=lt.north,h=c.features.taskFramework,p=h&&h.defaultZoomLevel?h.defaultZoomLevel:16,a=oi.toLocation(y,p,!0);o.BirdseyeV2Manager.getBirdseyeV2Thumbnail(s.getConfig(),a,19,function(o){var c,y,h,p;o?(e.set_style({"background-image":"url('"+o+"')"}),u.getParent().set_style({display:""}),u?(c=u.get_style("display"),c&&c.indexOf("none")===-1?(u.add_class("bm_sharedModule"),u.set_style({display:"inline-block"}),e.add_class("bm_sharedModule"),e.set_style({display:"inline-block"})):e.set_style({display:"block"})):e.set_style({display:"block"}),e.add_event("click",function(n){v._birdseyePreviewClicked(n,a,s,l,r.taskTitle,r.getDisplayState,r.impressionGuid)})):(e.set_style({display:"none"}),c=u.get_style("display"),c&&c.indexOf("none")===-1&&(u.remove_class("bm_sharedModule"),u.set_style({display:"block"})),f&&u&&(y=u.getParent().getParent(),h=y.length>0&&t(".cico.plchold.ssModule",y[0]),n&&n.addNewSSPlcHoldImage?h&&h.length>0?(h.add_class("setOn"),p=i.select(".b_FBleedModule.plchold.noAns"),p&&p.length>0&&p.set_style({display:"none"})):y.set_style({display:"none"}):(h&&h.length>0&&h.remove_class("setOn"),y.set_style({display:"none"}))))},l,s.getViewport())},s.prototype._computeBirdsEyeHeading=function(n,t){if(!n||!t||isNaN(n.latitude)||isNaN(n.longitude)||isNaN(t.latitude)||isNaN(t.longitude))return lt.north;var r=this._toRad(n.longitude-t.longitude),u=Math.sin(r)*Math.cos(this._toRad(n.latitude)),f=Math.cos(this._toRad(t.latitude))*Math.sin(this._toRad(n.latitude))-Math.sin(this._toRad(t.latitude))*Math.cos(this._toRad(n.latitude))*Math.cos(r),e=this._toDeg(Math.atan2(u,f)),i=(e+360)%360;return i>=315||i>=0&&i<45?lt.north:i>=45&&i<135?lt.east:i>=135&&i<225?lt.south:i>=225&&i<315?lt.west:lt.north},s.prototype._toRad=function(n){return n*Math.PI/180},s.prototype._toDeg=function(n){return n*180/Math.PI},s.prototype._birdseyePreviewClicked=function(n,t,i,r,o,s,h){h===void 0&&(h=null);n&&n.preventDefault();n&&n.stopPropagation();e.invokeHandler(f.instrumentationDataHandlerKey,{logData:{feature:st.BirdseyeV2,action:"C",data:{EP:u.LocalDetails,CP:t}},impressionGuid:h});var l=c.features.taskFramework,a=l&&l.defaultZoomLevel?l.defaultZoomLevel:16;ft.setMapCenter(i,t,a,r,new tf(i.getView(),new hr(oi.toLocation(t,a,!0),r)),null,null,{top:0,right:0,bottom:0,left:0});i.getFrameManager().frameRendered.addOne(function(){i.setMapType(i.createMapType(sr.birdseyeV2));i.getBirdseyeV2Manager().then(function(n){var i=s();n&&n.addContextPoi(t,o,i?i.colorIndex:3)})})},s.prototype._processGeochain=function(n,t){var i,r,u;t.geochainManager&&t.map&&(i=n?n.select(".geochainModule"):null,i&&t.location)&&(t.boundingBox||(t.boundingBox=[t.location,t.location,t.location,t.location]),r=er.fromCorners(t.boundingBox[0],t.boundingBox[1]),u=function(n){if(!n||n.length===0){i.parent().removeFromParent();return}var r=new tu(n,t.controlTemplateFactory);r.getControl().appendTo(i)},t.geochainManager.getGeochain(u,t.location,r,!0))},s}(),fu=function(){function e(){}return e.prototype.getCatId=function(n){var t;return i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&(t=this.getListingCategoryPath(n)),t},e.prototype.getListingCategoryPath=function(n){var i,t;return n&&(t=n.select("div[data-category]"),t&&t.length&&(i=t.get_attr("data-category"))),i},e.prototype.process=function(n,t){var r=this;if(n){this._listElements={};this.iids={};this._listItems=n.select("a[data-entity]");var u=n.select(".announceContainer"),e=!!(u&&u.length),f=this.getCatId(n),i=0;this._updateListCategoryStatus(n);this._processResizeEventForWaterfallGrid();this._listItems.for_each(function(u){var o=r._processItem(i,n,u,f,t,e),s,h;o&&o.entity&&(s=o.entity.fetchMoreUrl,h=u.parentElement,s&&h&&r._fetchListItemCarousel(s,h,n,i,f,t));i++})}},e.prototype._processWaterfallResizeEvent=function(n){n.for_each(function(n){var u=t(n),i=u.select(".bm_qsicon"),r=u.select("div.cico"),f;i&&i.length&&r&&r.length&&(f=parseInt(r.get_style("height")),i.set_style({top:f+25}))})},e.prototype._updateListCategoryStatus=function(t){var u=this.getListingCategoryPath(t),r,i;if(u&&n.listingQuicksaveCategoryWhitelist&&n.listingQuicksaveCategoryWhitelist.length>0)for(r=u.split("."),i=0;i<r.length;i++)if(n.listingQuicksaveCategoryWhitelist.indexOf(r[i])>-1){this._qsCategoryWhitelisted=!0;n.waterfallEnabledCategories.indexOf(r[i].toLowerCase())>-1&&(this._qsCategoryWaterfallWhitelisted=!0);break}},e.prototype._processResizeEventForWaterfallGrid=function(){var n=this;this._qsCategoryWaterfallWhitelisted&&!this._waterfallresizeRegistered&&(this._invokeProcessResizeHandler=function(){n._processWaterfallResizeEvent(n._listItems);sj_evt.unbind("WFR.Resized",n._invokeProcessResizeHandler)},this._waterfallresizeRegistered=!0,sj_evt.bind("WFR.Resized",this._invokeProcessResizeHandler))},e.prototype._processItem=function(n,i,r,u,f,e){var a=r.getAttribute("data-entity"),o=a&&a.length>0&&t.Internals.parseJSON(a),h,c,v,s,l,y,p;return o&&o.entity&&o.entity.id&&(h=t(r),c=o.entity.id,this._listElements[c]=h,v=r.getAttribute("h"),v&&(s=v.split("="),s&&s.length===2&&(s=s[1].split("."),s&&s.length&&(this.iids[c]=s[0].replace(",",".")))),this._qsCategoryWhitelisted||(l=i.select(".quicksave"),l&&l.length>0&&l.remove_class("quicksave")),y=this.getListingCategoryPath(i),p=r.getAttribute("data-productRootKeyword"),this._setTaskData(r,o.entity,f,u,y,o.extraFuiAugmentations,e,p),this._qsCategoryWhitelisted&&this._addQuicksaveIcon(r,c,y,f),h.add_event("click",function(n){return f.clickHandler(n,o.entity.id)}),h.add_event("contextmenu",function(n){return f.contextMenuHandler(n,o.entity.id)})),this._updateListItemStyle(r),this._setInstrumentationData(r,o.entity.id,n,f),o},e.prototype.getListItem=function(n){return this._listElements[n]},e.prototype.getFirstListItem=function(){return t(this._listItems[0])},e.prototype._setInstrumentationData=function(n,i,r,u){var f={ID:i,Q:u&&u.query?u.query:"",PO:r+1},e=p[p.LLT]+"_C",o={logData:{feature:st.Search,action:e,data:f},impressionGuid:u&&u.parentIG};n.setAttribute("data-instrumentation",t.Internals.stringify(o))},e.prototype._updateListItemStyle=function(n){var i=t(n).select("div.inner img");i&&i.length!==0||t(n).select("div.inner").add_class("imgHolder")},e.prototype._setTaskData=function(n,r,e,o,h,c,l,a){var p=e&&e.directionsTaskId,w=p?u.LocalListingAlongRoute:u.LocalListing,v={entryPoint:w,id:r.id,flippingCard:!0,taskTitle:r.title,directionsTaskId:e&&e.directionsTaskId,selectedCategoryId:o?o:r.primaryCategoryPath,originIG:e&&e.originIG,parentIG:e&&e.parentIG,iid:this.iids[r.id],query:r.id?r.seeMoreQueryText:r.title,infoboxHtml:r.infoboxHtml,isBookingModuleEntryPoint:e&&e.isBookingModuleEntryPoint,listingCategoryPath:h,extraFuiAugmentations:c,asName:r&&r.title,asFormattedAddress:r&&r.address,disableWideCard:!0,adProviderId:r.adProviderId,adStoreId:r.adStoreId,adQuery:r.adQuery,adYpid:r.adYpid,adImpressionGuid:r.adImpressionGuid,adRetailEntitySource:r.adRetailEntitySource,adBusinessLocationId:r.adBusinessLocationId,adTriggerType:r.adTriggerType,adsRLinkUrl:r.adsRLinkUrl,localFilters:r.localFilters,productRootKeyword:a,originalQuery:e&&e.query},y;l&&(v.noCoBan=!0);v.id&&v.id.indexOf("eventId:")===0&&(v.latLongForEventRequery=r.latitude+","+r.longitude,v.locationForEventRequery=r.city);y={state:v,type:i._isZipCodeCategory(v.selectedCategoryId)?s.polygonEntityDetailsTask:s.localDetailsTask,activateOptions:{parentId:e&&e.taskParentId}};n.setAttribute(f.taskDataHandlerKey,t.Internals.stringify(y))},e.prototype._addQuicksaveIcon=function(n,i,u,f){var e=t(n).select(".bm_qsicon"),s,o;if(e&&e.length>0&&!c.isInPrivateMode&&(e.add_class("bm_saveButton"),e.set_attr("title",r.L_EditButton),e.set_attr("role","button"),e.set_attr("tabindex","0"),e.set_attr("aria-expanded","false"),e.add_event("click",function(t){return f.saveButtonClickHandler(t,n,i)}),e.add_event("keydown",function(t){var r=t;r&&r.keyCode===13&&f.saveButtonClickHandler(t,n,i)}),this._qsCategoryWaterfallWhitelisted&&(s=e.getParent(),o=s.select("img"),o&&o.length))){var h=parseInt(o[0].getAttribute("height"))+25,a=o.getParent(),l=parseInt(a.get_style("height"));l&&(h=l+25);e.set_style({top:h})}},e.prototype._fetchListItemCarousel=function(n,t,i,r,u,f){var e=this,o=function(n){var o,s,h,c;if(t.innerHTML="",sj_appHTML(t,n),typeof rms!="undefined"&&rms.start(),o=t.getElementsByClassName("listings-item"),e._updateListCategoryStatus(i),o)for(s=0;s<o.length;s++)h=o[s],h&&(c=e._processItem(r,i,h,u,f),c&&f.listItemCarouselHandler(c,h))};et.downloadGeneric(n,"fetchListItemCarousel",o,null,null,null,0)},e}(),li=function(n){function t(){var i=this,t={};return i=n.call(this,t)||this,i.resources=r,t.defineProperty("factLabel"),t.defineProperty("factData"),t.defineProperty("extendedFacts"),i}return y(t,n),t.prototype.dispose=function(){this.factData=null;this.factLabel=null},t.prototype.nullToDisplayNone=function(n){return n?"":"none"},t.prototype.displayOnTrails=function(n){return this.showIfEqual(n,"trails")},t.prototype.displayOnCampgrounds=function(n){return this.showIfEqual(n,"campgrounds")},t.prototype.showIfEqual=function(n,t){return n===t?"":"none"},t}(ni),eu=function(n){function t(){var i=this,t={};return i=n.call(this,t)||this,t.defineProperty("start"),t.defineProperty("end"),i}return y(t,n),t.prototype.dispose=function(){n.prototype.dispose.call(this);this.start=null;this.end=null},t}(ni),ou=function(n){function t(){var i=this,t={};return i=n.call(this,t)||this,t.defineProperty("day"),t.defineProperty("hourRanges"),i}return y(t,n),t.prototype.dispose=function(){n.prototype.dispose.call(this);this.day=null},t}(ni),ie=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return y(t,n),t}(nu),gi=function(){function n(){}return n.getNameForProperty=function(n){switch(n){case"at":return r.L_PrintExtendedAt_Text;case"capital":return r.L_PrintExtendedCapitol_Text;case"countyseat":return r.L_PrintExtendedCounty_Text;case"area":return r.L_PrintExtendedArea_Text;case"population":return r.L_PrintExtendedPopulation_Text;case"cuisine":return r.L_PrintExtendedCuisine_Text;case"price":return r.L_PrintExtendedPrice_Text;case"hotelclass":return r.L_PrintExtendedHotelClass_Text;case"avgrate":return r.L_PrintExtendedAvgRate_Text;case"Founded":case"founded":return r.L_PrintExtendedFounded_Text;case"gdp":return r.L_PrintExtendedGDP_Text;case"callingcode":return r.L_PrintExtendedCC_Text;case"specialty":return r.L_PrintSpecialtyTitle_Text;case"experience":return r.L_PrintExperienceTitle_Text;case"clinic":return r.L_PrintClinicTitle_Text;case"homefacts":return r.L_PrintHomeFactsTitle_Text;case"moreinfo":return r.L_PrintMoreInfoTitle_Text;case"lastsold":return r.L_PrintLastSoldTitle_Text;case"zestimate":return r.L_PrintZestimateTitle_Text;case"Season":return r.L_PrintSeason_Text;case"Activity":case"Activities":return r.L_PrintActivities_Text;case"Rates":return r.L_PrintRates_Text;case"Open":return r.L_PrintOpen_Text;case"Sites":return r.L_PrintSites_Text;case"Interests":return r.L_PrintInterests_Text;case"Opened":return r.L_PrintOpened_Text;case"Floors":return r.L_PrintFloors_Text;case"Height":return r.L_PrintHeight_Text;case"Architect":case"Architects":return r.L_PrintArchitects_Text;case"Established":return r.L_PrintEstablished_Text;case"Artist":case"Artists":return r.L_PrintArtists_Text;case"Subjects":return r.L_PrintSubjects_Text;case"Media":return r.L_PrintMedia_Text;case"Teams":return r.L_PrintTeams_Text;case"Capacity":return r.L_PrintCapacity_Text;case"Elevation":return r.L_PrintElevation_Text;case"Prominence":return r.L_PrintProminence_Text;case"speciality":return r.L_PrintSpecialtyTitle_Text;case"Nearby airports":case"Nearby airport":return r.L_PrintNearbyAirport_Text;case"First ascent":return r.L_PrintFirstAscent_Text;case"First ascender":return r.L_PrintFirstAscender_Text;case"Mountain range":return r.L_PrintMountainRange_Text;case"Last eruption":return r.L_PrintLastEruption_Text;case"Colleges and universities":return r.L_PrintCollegesUniversities_Text;case"Architecture firm":return r.L_PrintArchitectureFirm_Text;case"Service Areas":return r.L_PrintServiceAreas_Text;case"Date completed":return r.L_PrintDateCompleted_Text;case"Annual visitors":return r.L_PrintAnnualVisitors_Text;case"Average stay":return r.L_PrintAverageStay_Text}return null},n.parseAndPushDataFactForPrint=function(t,i){var r,u;if(i&&t)for(r in t)u=n.getNameForProperty(r),n.complexType.indexOf(r)!==-1?n.pushFactToList(i,null,null,t):n.pushFactToList(i,u,n.beautifyList.indexOf(r)===-1?t[r]:n.beautify(t[r]))},n.listContains=function(n,t){for(var i=0;i<n.length;i++)if(n[i].getFactLabel()===t)return!0;return!1},n.pushFactToList=function(t,i,r,u){if(!n.listContains(t,i)){var f=n.setFactsInfo(t,i,r,u);f&&t.push(f)}},n.setFactsInfo=function(t,i,r,u){var f=null;return u?f=n.setExtendedFacts(t,u):i&&r&&(f=new li,f.setFactLabel(i),f.setFactData(r)),f},n.setExtendedFacts=function(n,t){var o=null,i,u,f,e;return t&&(t.trails&&(i=t.trails,u=new ie,u.length=i.length?i.length:"",u.lengthIcon=i.lengthIcon?i.lengthIcon:"",u.elevation=i.elevation?i.elevation:"",u.elevationIcon=i.elevationIcon?i.elevationIcon:"",u.duration=i.duration?i.duration:"",u.durationIcon=i.durationIcon?i.durationIcon:"",u.difficulty=i.difficulty?i.difficulty:"",u.type="trails",o=new li,o.setFactLabel(u.length||u.elevation||u.duration?r.L_PrintTrailInfo_Text:""),o.setExtendedFacts(u)),t.campgrounds&&(f=t.campgrounds,e=new df,e.rvSites=f.RVSites?f.RVSites:"",e.rvIcon=f.RVIcon?f.RVIcon:"",e.tentSites=f.tentSites?f.tentSites:"",e.tentIcon=f.tentIcon?f.tentIcon:"",o=new li,o.setFactLabel(e.rvSites||e.tentSites?r.L_PrintMainSites_Text:""),o.setExtendedFacts(e))),o},n.beautify=function(n){return n.split(",").join(r.L_PrintSeparator_Text)},n.beautifyList=["Main sites","Nearby airport","Nearby airports","Colleges and universities","Teams","Media","Subjects","Artist","Artists","Architect","Architects","Height","Interests","Sites","Activities","Activity"],n.complexType=["trails","campgrounds"],n}(),re=function(){function u(){}return u.RequestDetailPopouts=function(i){if(i&&i[1]&&i[2]){var f=i[1],r=i[2],e=n.locationFilterAjaxEndpoint+f;sj_ajax(e,{callback:function(n,i){var e,o,f;n&&i!==null&&i.request!==null&&i.request.responseText!==null&&i.request.responseText!==""&&(e=JSON.parse(i.request.responseText),e&&(o=t("#"+r),f=function(){sj_evt.unbind("frameRendered",f);o.remove_event("mouseover,touchStart",f);u.CreateDetailPopouts(e,r)},sj_evt.bind("frameRendered",f,0),o.add_event("mouseover,touchStart",f)))}})}},u.CreateDetailPopouts=function(n,u){var e,h,b,c,p,k,l,f,s,w,d,o,a,v,y;if(n!==null&&u!==null&&(e=[],n.Neighborhoods&&n.Neighborhoods.length>0&&(e=e.concat(n.Neighborhoods)),n.PointsOfInterest&&n.PointsOfInterest.length>0&&(e=e.concat(n.PointsOfInterest)),n.Transportation&&n.Transportation.length>0&&(e=e.concat(n.Transportation)),h=t("#"+u),b=n.MapUrl,c=h.select("#ftrD_Location .catfOption"),h&&h.length!==0&&b&&c&&c.length!==0))for(p=h.select("#ftrD_Location"),k=p.getParent().getParent(),l=0;l<e.length;l++)if(f=e[l],f.Location){s=i._createElement("div").add_class("b_htlLocInfo");s.append(i._createElement("img").add_class("b_locMap").set_attr("src",this.getStaticMapUrl(f.Location.Latitude,f.Location.Longitude,n.MapUrl)));w=i._createElement("div").add_class("b_htlLocTitle");d=r.HotelsFound+"<span>"+(f.NearbyHotelCount>100?"100+":f.NearbyHotelCount)+"<\/span>"+r.HotelsNear+f.Name;w.appendHTML(d);s.append(w);o=[];f.PriceTrend===0?o.push(r.HotelPricesHere+"<span class=b_htlGood>"+r.HotelPricesWithin+"<\/span>"+r.HotelWithinCityAverage):f.PriceTrend>1?o.push(r.HotelPricesHere+"<span class=b_htlNeutral>"+Math.round((f.PriceTrend-1)*100)+"%"+r.HotelPricesExpensive+"<\/span>"+r.HotelCityAverage):o.push(r.HotelPricesHere+"<span class=b_htlGood>"+Math.round((1-f.PriceTrend)*100)+"%"+r.HotelPricesCheaper+"<\/span>"+r.HotelCityAverage);f.Distance===0?o.push(r.HotelThisLocation+"<span class=b_htlGood>"+r.HotelNear+"<\/span>"+r.HotelCityCenter):o.push("<span>"+f.Distance+"<\/span>"+r.HotelDistanceFromCityCenter);a="b_htlNeutral";v=r.HotelSafetyNeutral;switch(f.CrimeIndex){case 1:case 2:a="b_htlExcellent";v=r.HotelSafetyExcellent;break;case 3:a="b_htlGood";v=r.HotelSafetyGood}for(o.push(r.HotelAreaSafety+"<span class="+a+">"+v+"<\/span>"),y=0;y<o.length;y++)s.append(i._createElement("div").add_class("b_htlLocData").appendHTML(o[y]));s.append(i._createElement("p").appendText(f.Description));this.attachPopoutEvents(s,c,k,p,f.Id)}},u.attachPopoutEvents=function(i,r,u,f,e){for(var o=null,s=0;s<r.length;s++)if(r[s].getAttribute("data-filterparam").indexOf(e)>=0){o=t(r[s]);break}o&&(o.add_event("mouseover",function(){var r,h,l,a,c;if(n.showInlineFilters){var v=window.innerHeight,y=window.innerWidth,e=50,s=document.getElementsByClassName("taskLayoutContainer");s&&s.length>0&&(r=o[0].getBoundingClientRect(),i.set_style({"z-index":1e4,left:r.left+r.width-e,top:r.top-f[0].scrollTop-32}),t(s[0]).append(i),i[0].getBoundingClientRect().right>y&&(i[0].style.left=(r.left-i[0].offsetWidth-e).toString()+"px"),h=i[0].getBoundingClientRect().bottom-v,h>0&&(i[0].style.top=(r.top-f[0].scrollTop-e-h).toString()+"px"))}else l=window.innerHeight,a=window.innerWidth,i.set_style({"z-index":7,left:o[0].offsetLeft+o[0].offsetWidth-150,top:o[0].offsetTop-f[0].scrollTop-32}),u.append(i),i[0].getBoundingClientRect().right>a&&(i[0].style.left=(o[0].offsetLeft-i[0].offsetWidth-150).toString()+"px"),c=i[0].getBoundingClientRect().bottom-l,c>0&&(i[0].style.top=(o[0].offsetTop-f[0].scrollTop-50-c).toString()+"px")}),o.add_event("mouseout",function(){n.showInlineFilters?i&&i.removeFromParent():u.select(".b_htlLocInfo").removeFromParent()}),n.showInlineFilters&&o.add_event("mouseup",function(){i&&i.removeFromParent()}),o.add_event("touchend",function(){Microsoft.Maps.setTimeout(function(){n.showInlineFilters?i&&i.removeFromParent():u&&u.select(".b_htlLocInfo").removeFromParent()},50)}))},u.getStaticMapUrl=function(n,t,i){return i+("&da=ro&ml=Basemap,Landmarks,OsmBuildings&ms=300,150&pushpin="+n+","+t+";176;1")},u}();sj_evt.bind("AttachLocFilterPopouts",re.RequestDetailPopouts);var ht=function(){function n(){}return n.NearbyFeatureName="NBS",n.ActionClick="C",n.ActionModeSwitch="MS",n.SearchAreaShown="SAS",n.SearchAreaClick="SAC",n.AutoRefreshOnExit="ARE",n.ActionClose="X",n}(),su=function(){function n(n){var u=this,e,f;this.drivingText=r.L_NearbyFloatingContainerDrivingTitle;this.walkingText=r.L_NearbyFloatingContainerWalkingTitle;this.transitText=r.L_NearbyFloatingContainerTransitTitle;this.titleText=r.L_NearbyFloatingContainerNearbyTitle;this._outsideClickHandler=function(){u._nearbyFloatingContainerDiv.select("div.nearbyDropdownList").set_style({visibility:"hidden"})};this._anchorClickHandler=function(n){var t,i;n.stopImmediatePropagation();switch(n.target.className){case"nearbyDrivingOption":t="driving";break;case"nearbyWalkingOption":t="walking";break;case"nearbyTransitOption":t="transit"}u._currentActiveTask&&(i=u._floatingContainerRegisteredTasks[u._currentActiveTask],i&&t&&(u._callDistanceMatrixandUpdate(i,t),u.logNearbyInstrumentationData(ht.ActionModeSwitch,{P:i.currentMode,N:t})))};this._dropdownClickHandler=function(){var n=u._nearbyFloatingContainerDiv.select("div.nearbyDropdownList"),t=n.get_style("visibility")==="hidden",i=t?"visible":"hidden";n.set_style({visibility:i})};this._closeClickHandler=function(){u._handleClose(u._currentActiveTask)};this.resources=r;this._nearbyFloatingContainerDiv=t("div.b_nearbyFloatingContainer");this._nearbyFloatingContainerDiv.length===0&&(e=new dt(bf),this._nearbyFloatingContainerDiv=e.applyDataTemplate(this),f=t("div#mapContainer"),f.length<1&&(f=t("div#b_content .largeMap")),f.append(this._nearbyFloatingContainerDiv),n.viewChanged.add(function(n){u._onMapViewChanged(n)}),this._searchButton=t(".bm_nearbyMapSearchButton"),this._searchButton.add_event("click",function(n){u._onNearbySearchClick(n)}));this._taskLayoutContainer=t("div.taskLayoutContainer");this._taskbarWidth=i.getVerticalTaskBarWidth()/2;this._map=n;this._mapState={zoom:0,bounds:[]};this._showOrHideSearchButton(!1);this._floatingContainerShown=!1;this._nearbyFloatingContainerDiv.select("div.nearbyDropdown").add_event("blur",this._outsideClickHandler);this._nearbyFloatingContainerDiv.select("div.nearbyDropdownList > a").add_event("mousedown",this._anchorClickHandler);this._nearbyFloatingContainerDiv.select("span.nearbyCloseIcon").add_event("click",this._closeClickHandler);this._nearbyFloatingContainerDiv.select("div.nearbyDropdown").add_event("click",this._dropdownClickHandler);this._floatingContainerRegisteredTasks={};this.showContainer(!0)}return n.prototype.dispose=function(){this._nearbyFloatingContainerDiv.select("div.nearbyDropdown").remove_event("blur",this._outsideClickHandler);this._nearbyFloatingContainerDiv.select("div.nearbyDropdownList > a").remove_event("mousedown",this._anchorClickHandler);this._nearbyFloatingContainerDiv.select("span.nearbyCloseIcon").remove_event("click",this._closeClickHandler);this._nearbyFloatingContainerDiv.select("div.nearbyDropdown").remove_event("click",this._dropdownClickHandler);this.showContainer(!1)},n.prototype.registerTaskInformationAndShow=function(n,t){this._mapState={zoom:0,bounds:[]};this._floatingContainerRegisteredTasks[n]=t;this._currentActiveTask=n;this.showContainer(!0,n)},n.prototype.activateTask=function(n){this._currentActiveTask=n},n.prototype._handleClose=function(n){var t=this._floatingContainerRegisteredTasks[n];t&&(t.exitNearbyCallback(),this._floatingContainerRegisteredTasks[n]=null,this.logNearbyInstrumentationData(ht.ActionClose,{task:n}));this.showContainer(!1,n)},n.prototype.getModeForTask=function(n){var t=this._floatingContainerRegisteredTasks[n];return t?t.currentMode:"driving"},n.prototype.showContainer=function(n,t,i){if(t===this._currentActiveTask){var r=this._floatingContainerRegisteredTasks[this._currentActiveTask];this._showOrHideFloatingMapContainer(n);this._showOrHideNearbyModeSelector(n);n?(r&&this._setMode(r.currentMode),this._centerContainer(i)):this._showOrHideSearchButton(!1);this._floatingContainerShown=n}},n.prototype._centerContainer=function(n){var r=parseFloat(this._taskLayoutContainer&&this._taskLayoutContainer.get_style("width")||"0px"),f=c.features.taskFramework,i,u,e,o;n&&f&&f.showLoadingSkeleton&&(i=t(".taskLayoutSkeletonContainer"),u=parseFloat(i.get_style("width")||"0px"),i.length>0&&i[0].style.left&&(u+=parseFloat(i[0].style.left||"0px")),r=Math.max(r,u));e=parseFloat(this._nearbyFloatingContainerDiv.get_style("width")||"200px");o=(r+this._taskbarWidth-e)/2;this._nearbyFloatingContainerDiv.set_style({"margin-left":o+"px"})},n.prototype._callDistanceMatrixandUpdate=function(t,i){var r=t.populatedDistanceMatrixURL.replace("${mode}",i);i==="driving"&&(r+="&startTime="+n.getCurrentDateTime());et.downloadJson(r,"nearbyfloatingcontainer",function(n,t){var i=t;i&&(i.requestStatusCallback(!1),i.updateCallback(n))},function(n){var t=n;t&&t.requestStatusCallback(!1)},t);this._setMode(i);t.requestStatusCallback(!0);t.updateTransportationModeCallback(i);t.currentMode=i},n.prototype._setMode=function(n){var r,i;if(n&&(r=t("div.nearbyDropdown"),r&&r.length>0&&(i=r[0],i&&i.childNodes&&i.childNodes.length>0)))switch(n){case"driving":i.childNodes[0].textContent=this.drivingText;this._nearbyFloatingContainerDiv.select("span.nearbyModePic").remove_class("walking transit");break;case"walking":i.childNodes[0].textContent=this.walkingText;this._nearbyFloatingContainerDiv.select("span.nearbyModePic").remove_class("transit");this._nearbyFloatingContainerDiv.select("span.nearbyModePic").add_class("walking");break;case"transit":i.childNodes[0].textContent=this.transitText;this._nearbyFloatingContainerDiv.select("span.nearbyModePic").remove_class("walking");this._nearbyFloatingContainerDiv.select("span.nearbyModePic").add_class("transit")}},n.prototype.deregister=function(n){this._floatingContainerRegisteredTasks[n]&&this._handleClose(n)},n.prototype._onMapViewChanged=function(){this._floatingContainerShown&&this._isMapChangeSignificant()&&(this._showOrHideSearchButton(!0),this.logNearbyInstrumentationData(ht.SearchAreaShown,{}))},n.prototype._showOrHideSearchButton=function(n){this._searchButton.set_style({display:n?"inline-block":"none"})},n.prototype._showOrHideFloatingMapContainer=function(n){this._nearbyFloatingContainerDiv.set_style({display:n?"block":"none"})},n.prototype._showOrHideNearbyModeSelector=function(n){this._nearbyFloatingContainerDiv.select(".b_nearbyFloatingContainer").set_style({display:n?"flex":"none"})},n.prototype._isMapChangeSignificant=function(){var t=!1,u=this._map,n=this._mapState,i=u.getMercatorZoomLevel(),r=u.getBounds().bounds,f;return n.zoom===0||n.bounds.length===0?(n.zoom=i,n.bounds=r,t):(n.zoom!==i?t=!0:(f=this._getOverlapPercent(n.bounds,r),t=f<.9),t&&(n.zoom=i,n.bounds=r),t)},n.prototype._getOverlapPercent=function(n,t){if(n.length<4||t.length<4)return 0;var i=this._normalizeBounds(n),r=this._normalizeBounds(t),u=Math.max(0,Math.min(i[1],r[1])-Math.max(i[3],r[3])),f=Math.max(0,Math.min(i[0],r[0])-Math.max(i[2],r[2])),e=u*f,o=(i[1]-i[3])*(i[0]-i[2]);return e/o},n.prototype._normalizeBounds=function(n){return[90+n[0],180+n[1],90+n[2],180+n[3]]},n.prototype._onNearbySearchClick=function(){sj_evt.fire("triggerMapSearch");this._showOrHideSearchButton(!1);this._mapState={zoom:this._map.getMercatorZoomLevel(),bounds:this._map.getBounds().bounds}},n.prototype.logNearbyInstrumentationData=function(n,t){var i={logData:{feature:ht.NearbyFeatureName,action:n,data:t},impressionGuid:c.dynamicProperties.mapsIG};e.invokeHandler(f.instrumentationDataHandlerKey,i)},n.getCurrentDateTime=function(){var n=new Date;return n.toISOString()},n.getInstance=function(t){return n._instance||(n._instance=new n(t)),n._instance},n}(),ue=function(n){function t(t,i,r,u,f,e,o,h,c,l){var a=n.call(this,t,i,r,u,f,e,o,h,c,l)||this;return a.type=s.polygonEntityDetailsTask,a.displayState={groupName:"PolygonEntityDetails"},a}return y(t,n),t.prototype.activate=function(t,r,u,f){r.selectedCategoryId&&i._isZipCodeCategory(r.selectedCategoryId.toLowerCase())&&r&&r.id&&r.id.indexOf("sid:")>=0&&(r.query=r.taskTitle,r.id=null);n.prototype.activate.call(this,t,r,null,f)},t.prototype.canColorFade=function(){return c.features.taskFramework.canCardColorFade},t.prototype.setTaskComplete=function(){var t,i;n.prototype.setTaskComplete.call(this);t=this.viewModel.getEntities();t&&t.length>0&&(i=this.viewModel.getEntities()[0].getVdpId(),i&&(this._taskState.vdpid=i,this.serializableObjectChanged.invoke({magnitude:0})))},t.prototype._createUrl=function(t,i,r){var u=n.prototype._createUrl.call(this,t,i,r);return this._taskState&&this._taskState.point&&this._taskState.point.length===2&&(u+="&bmpoint="+this._taskState.point[0]+","+this._taskState.point[1]),u},t}(rt),fe=function(n){function i(){return n!==null&&n.apply(this,arguments)||this}return y(i,n),i.prototype.process=function(n,i){var r=this,u,f;n&&(this._listElements={},this.iids={},this._listItems=n.select("a[data-entity]"),u=this.getCatId(n),f=0,this._listItems.for_each(function(n){var l=n.getAttribute("data-entity"),e,h,c,a,o,s,v;l&&l.length>0?(e=t.Internals.parseJSON(l),e&&e.entity&&e.entity.id&&(h=t(n),c=e.entity.id,r._listElements[c]=h,a=n.getAttribute("h"),a&&(o=a.split("="),o&&o.length===2&&(o=o[1].split("."),o&&o.length&&(r.iids[c]=o[0].replace(",",".")))),r._setTaskData(n,e.entity,i,u),h.add_event("click",function(n){return i.clickHandler(n,e.entity.id)}),h.add_event("contextmenu",function(n){return i.contextMenuHandler(n,e.entity.id)}))):(s=n.getElementsByClassName("b_factrow"),s&&s.length>0&&s[0].innerHTML&&(v=s[0].innerHTML.trim().split("-")[0],r._setTaskData(n,{title:v,primaryCategoryPath:"ZipCode"},i,u)));r._updateListItemStyle(n);r._setInstrumentationData(n,c,f,i);f++}))},i.prototype._updateListItemStyle=function(n){var i=t(n).select("div.inner img"),r;i&&i.length!==0||(r=t(n).select("div.b_vPanel"),r.set_style({"margin-left":0,"text-align":"left"}))},i}(fu),ee=function(n){function r(t,i,r,u,f,e,o,s){return n.call(this,t,i,r,u,f,e,o,s)||this}return y(r,n),r.prototype._refresh=function(){},r.prototype.activate=function(t,i,r,u){this.viewModel||(this.viewModel=new he(this.map,this.panelRoot,this.id,this._logHelper,this.poiManager,this._transientLensViewModel,this.controlTemplateFactory));n.prototype.activate.call(this,t,i,null,u)},r.prototype._onPoiViewStateChanged=function(n,t){var r=n.primitive,i=r.entity;if(i&&i.id&&r.metadata){var h=this.map.getConfig(),c=this.map.getMercatorZoomLevel(),l=h.postCodeMaxHoverClickZoom;if(n.newValue===2&&c<=l){var o=this._getTaskState()&&this._getTaskState().directionsTaskId,a=o?u.POIAlongRoute:u.POI,p=this.pageProcessor.getCatId(this.viewModel.getResponseContainer()),v={entryPoint:a,id:i.id,flippingCard:!0,taskTitle:r.metadata.title,directionsTaskId:o,originIG:this._taskState&&this._taskState.originIG,parentIG:this._getImpressionGuid(),iid:this.pageProcessor.iids&&this.pageProcessor.iids[i.id],searchQueryCategory:this._taskState&&this._taskState.searchQueryCategory},y={parentId:this.id};e.invokeHandler(f.taskDataHandlerKey,{type:s.polygonEntityDetailsTask,state:v,activateOptions:y});this._logPoiClick(i,t);this._setSelectedPrimitive(n.primitive)}}},r.prototype.processResponse=function(r,u){if(i._isZipCodeCategory(this._taskState.category)||i._isZipCodeCategory(this._taskState.searchQueryCategory)){var e=r.select(".listings-item"),f=[];e.for_each(function(n){var r=t(n),i=r.select(".b_factrow");i&&i.length>0&&i[0].innerHTML.indexOf("-")>=0&&f.push(r.getParent())});f.forEach(function(n){return n.removeFromParent()})}n.prototype.processResponse.call(this,r,u)},r.prototype._createUrl=function(t,i,r){var f=i,u;if(this._taskState.originalResponse&&(u=this._taskState.originalResponse.select("div.overlay-listings").get_attr("data-listingMetadata"),u.length>0)){var e=JSON.parse(u),o=parseInt(e.BlockedCount),s=this._taskState.originalResponse.select(".listings-item").length;f=o+s}return n.prototype._createUrl.call(this,t,f,typeof r=="number"?r:100)},r}(ut),k;(function(r){function ht(n,t,i,r){var u,f,s,a,e,h;if(n&&(u=ft(n,t),u&&u.intentKey)){if(f=o[u.intentKey],nr.assert(typeof f=="function","taskInvoker is not defined!"),t&&(t.scenarioKey=u.scenarioKey,ot(n,t)),u.intentKey===c){if(l.cleanupPrimerData(r),s=yt(n,t),s){f&&f(n,s);tt(n,t.entryPoint,u.scenarioKey,t.query,[]);return}}else{if(u.intentKey===it){l.cleanupPrimerData(r);a=pt(n,i,r);tt(n,t.entryPoint,u.scenarioKey,t.query,a);return}if(u.intentKey===rt){if(l.cleanupPrimerData(r),e=kt(n),e){e.entryPoint=t.entryPoint;f&&f(n,e);tt(n,t.entryPoint,u.scenarioKey,t.query,[]);return}}else if(u.intentKey===ut){l.cleanupPrimerData(r);h=wt(n,t,r);f&&f(n,h);tt(n,t.entryPoint,u.scenarioKey,t.query,h.boundingBox);return}}f&&f(n,t)}}function ct(t,r){var h=null,u,o,e,f,s,c;if(t&&(u=ft(t,r),u&&u.intentKey)){if(r.scenarioKey&&!(i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&u.scenarioKey==="ERR")){for(e=Object.keys(n.scenarioKeys),f=0;f<e.length;f++)if(n.scenarioKeys[e[f]]===r.scenarioKey){o=e[f];break}if(o&&n.multiEntityScenarios.indexOf(o)>=0&&(u.intentKey===w||u.intentKey===y))return null}s=a[u.intentKey];s&&(c=s(),h=c.parseEntitiesFromResponse(t,r));r&&(r.scenarioKey=u.scenarioKey,ot(t,r))}return h}function et(n){var i=null,r,u;return n&&(r=n.select("div[data-category]"),r&&r.length&&(i=r.get_attr("data-category")),i||(u=n.select("div.overlay-taskpane"),u&&u.length&&u.for_each(function(n){var u=n.getAttribute("data-entity"),r;u&&u.length&&(r=t.Internals.parseJSON(u),r&&r.entity&&r.entity.primaryCategoryPath&&(i=r.entity.primaryCategoryPath))}))),i}function lt(n){var t=n&&n.select("div[data-hasmoreresults]");return t&&t.length&&t.get_attr("data-hasmoreresults")==="false"}function ft(t,i){var u=t.select("[data-answerinfo]").get_attr("data-answerinfo"),r={};return u?(n.polygonEntityScenarios.indexOf(u)>=0&&at(t)&&vt(t)?r.intentKey=y:n.singleEntityScenarios.indexOf(u)>=0?r.intentKey=i.localFilters||i.keyRoutePoints?k:w:n.multiEntityScenarios.indexOf(u)>=0?r.intentKey=k:n.directionsIntentDrivingScenarios.indexOf(u)>=0?(g=d.driving,r.intentKey=c):n.directionsIntentTransitScenarios.indexOf(u)>=0?(g=d.transit,r.intentKey=c):n.directionsIntentWalkingScenarios.indexOf(u)>=0?(g=d.walking,r.intentKey=c):n.trafficIntentScenarios.indexOf(u)>=0?r.intentKey=it:n.itineraryDetailsIntentScenarios.indexOf(u)>=0?r.intentKey=rt:n.itineraryListingsIntentScenarios.indexOf(u)>=0&&(r.intentKey=ut),r.scenarioKey=n.scenarioKeys[u],r):r}function at(n){var r=n.select("[data-entity]").get_attr("data-entity"),i;return r&&(i=t.Internals.parseJSON(r),i&&i.entity&&i.entity&&i.entity.vdpId&&i.entity.vdpId!=="")?!0:!1}function vt(i){var u=i.select("[data-entity]").get_attr("data-entity"),r;return u&&(r=t.Internals.parseJSON(u),r&&r.entity&&r.entity&&r.entity.locationType&&r.entity.locationType!==""&&n.boundaryDisabledLocationTypes.indexOf(r.entity.locationType)===-1)?!0:!1}function v(n,t,r,u){u===void 0&&(u=!0);u&&r&&(r.content=t);var f=et(t);i._isHouseCategory(f)?r.searchQueryCategory="house":i._isRestaurantCategory(f)?r.searchQueryCategory="restaurant":i._isHotelsCategory(f)?r.searchQueryCategory="hotel":i._isZipCodeCategory(f)&&(r.searchQueryCategory="zipcode");n=i._overrideTasktypeBasedOnCategory(n,r);nt(n,r)}function nt(n,t){e.invokeHandler(f.taskDataHandlerKey,{type:n,state:t})}function yt(n,i){var c=n.select("[data-directionsintent]").get_attr("data-directionsintent"),r,s,h,f,u,e,o;if(c&&(r=t.Internals.parseJSON(c),r&&r.waypoints&&r.waypoints.length>0)){for(s=[],h=r.waypoints.length,f=0;f<h;f++)u=r.waypoints[f],u&&u.address&&u.point&&(e=new bt(u.address,new b(u.point.latitude,u.point.longitude)),f===h-1?e.waypointType=2:f===0&&(e.waypointType=1),e.rawAddress=u.rawAddress,e.eid=u.eid,s.push(e));return o={waypoints:s,mode:g,entryPoint:5,taskStartTime:i.searchPerfState&&i.searchPerfState.timestamp(),originalQuery:i.originalQuery},r.longDistanceDisplay&&(o.longDistanceDisplay=r.longDistanceDisplay),tr.bestModeEnabled&&!r.isTransportModeSpecified&&(o.mode=d.multimode),o}return null}function pt(n,i,r){var f=[],s=n.select("[data-boundingbox]").get_attr("data-boundingbox"),e=s&&t.Internals.parseJSON(s),o,u;return e&&e.boundingBox&&e.boundingBox.length>1&&(o=[],u=e.boundingBox[0],i&&i.hide(),o.push(new b(u.latitude,u.longitude)),f.push(u.latitude),f.push(u.longitude),u=e.boundingBox[1],o.push(new b(u.latitude,u.longitude)),f.push(u.latitude),f.push(u.longitude),r.setView(r.getMode().getMapViewForLocationsInView(o)),i&&i.show(2)),f}function wt(n,r,f){var h={content:n,searchTaskState:r},o,l,v;if(h.entryPoint=r.entryPoint===u.Permalink&&i._isTravelOverlayShownOnSerp()?u.TravelL2:r.entryPoint,o=n.select("div[data-title]"),o&&o.length===1){l=o[0].getAttribute("data-title");h.title=l;var s=[],c=[],a=o[0].getAttribute("data-boundingbox"),e=a&&t.Internals.parseJSON(a);e&&!isNaN(e.SouthLatitude)&&!isNaN(e.WestLongitude)&&!isNaN(e.NorthLatitude)&&!isNaN(e.EastLongitude)&&e.SouthLatitude<90&&e.SouthLatitude>-90&&e.NorthLatitude<90&&e.NorthLatitude>-90&&(s=[e.SouthLatitude,e.WestLongitude,e.NorthLatitude,e.EastLongitude],c.push(new b(s[0],s[1])),c.push(new b(s[2],s[3])),f.setView(f.getMode().getMapViewForLocationsInView(c)),h.boundingBox=s);v=o[0].getAttribute("data-vdpid");h.vdpId=v}return h}function kt(n){var t=n.select("[data-itinerary]").get_attr("data-itinerary");return t?{itineraryJson:t}:null}function tt(n,t,i,r,u){var l,s=n.select("div[data-ig]"),o,c,a;s&&s.length===1&&(l=s[0].getAttribute("data-ig")||"");o={EP:t||"",Q:r||"",BB:u,SNRO:i||""};c=h.getMasterImpressionGuid();o&&c&&(o.MIG=c);a={impressionGuid:l,logData:{feature:st.Search,action:p[p.STP],data:o}};e.invokeHandler(f.instrumentationDataHandlerKey,a)}function ot(n,t){if(t&&t.isEatAndDrinkOpalAction){t.isFilterSelected=!0;return}var i=n.select("div[data-isFilterSelected]").get_attr("data-isFilterSelected");if(i&&i.toLowerCase().indexOf("true")>-1){t.isFilterSelected=!0;return}t.isFilterSelected=!1}var y="polygonEntity",w="singleEntity",k="multiEntity",c="directions",it="traffic",rt="itinerary",ut="itineraryList",o={},a,g;o[w]=function(n,t){v(s.localDetailsTask,n,t)};o[k]=function(n,t){v(s.localListingTask,n,t)};o[y]=function(n,t){v(s.polygonEntityDetailsTask,n,t)};o["multiPolygon"]=function(n,t){v(s.polygonListingTask,n,t)};o[c]=function(n,t){nt(s.directionsTask,t)};o[it]=function(){};o[rt]=function(n,t){nt(s.itineraryDetailsTask,t)};o[ut]=function(n,t){nt(s.itineraryListingsTask,t)};a={};a[w]=function(){return new hi};a[k]=function(){return new ci};a[y]=function(){return new hi};r.parseResponse=ht;r.getEntitiesFromResponse=ct;r.parseCategory=et;r.parseNoMoreResults=lt;r.parseAnswerInfo=ft;r.invokeTask=v})(k||(k={}));var oe=function(t){function i(i,r,u,f,e,o,s,h,c,l){var a=t.call(this,i,r,u,f,e,o,s,h,c,l)||this;return a.setRecommendedWidth(n.restaurantCardWidth),a.setCurrentWidth(n.restaurantCardWidth),a}return y(i,t),i.prototype._createUrl=function(){var n;return Logger.getOverlayType()||(n='disablempr:"true"',this._taskState.extraFuiAugmentations?this._taskState.extraFuiAugmentations+=" "+n:this._taskState.extraFuiAugmentations=n),t.prototype._createUrl.call(this)},i.prototype._getRequestUrlFormat=function(){return t.prototype._getRequestUrlFormat.call(this),n.requestUrlFormatForLocalOverlayOnSerp},i.prototype._getSegmentParam=function(){return"restaurant"},i.prototype._getTextAdsCode=function(){return n.enableRestaurantTextAds?"r":null},i}(rt),ai=function(t){function i(n,i,r,u,f,e,o,s){var h=t.call(this,n,i,r,u,f,e,o,s)||this;return h._infoboxOptions={showCloseButton:!1,zIndex:1006,showPointer:!1,visible:!0,htmlContent:null,location:null,autoAlignment:!0},h._segmentFuiAdded=!1,h._bindEventsForInfobox(),h}return y(i,t),i.prototype._createUrl=function(i,r,u){var o=this._taskState&&this._taskState.isCategoryQuery,e,f;return n.useNewListingSearchCount&&!u?u=n.listingSearchCount:o&&(!u||u===20)&&n.threeColumnListSegmentsEnabled&&n.threeColumnListSegmentsEnabled.length>0&&n.threeColumnListSegmentsEnabled.indexOf("Restaurant")>-1&&this._isThreeColumnsOk(i)&&(u=21),this._taskState&&(this._taskState.isFallbackRequery=!0,this._taskState.scrollListOnPoiHover=!1),i&&i.isPaginated?(f=this.panelRoot.select("div[data-cacheid]").get_attr("data-cacheid"),f&&(this._taskState.extraFuiAugmentations='cacheid:"'+f+'" segment:"Restaurant"')):this._segmentFuiAdded||(this._segmentFuiAdded=!0,this._taskState.extraFuiAugmentations?this._taskState.extraFuiAugmentations+=' segment:"Restaurant"':this._taskState.extraFuiAugmentations='segment:"Restaurant"'),e=t.prototype._createUrl.call(this,i,r,u),i&&i.isPaginated&&(f=this.panelRoot.select("div[data-cacheid]").get_attr("data-cacheid"),f&&(this._taskState.extraFuiAugmentations=null)),e},i.prototype._getRequestUrlFormat=function(){return t.prototype._getRequestUrlFormat.call(this),n.requestUrlFormatForLocalOverlayOnSerp},i.prototype._bindEventsForInfobox=function(){sj_evt&&sj_evt.bind("pushpinhoverstarted",function(n){var t=n[1],u=t.entity.id.replace("ypid:","").replace("sid:",""),i=_ge(u),f,r;i&&(f=new Microsoft.Maps.Location(t.geometry.y,t.geometry.x),r="<div class='MiniInfobox2' id='infobox-container'><a class='infoBoxLink' role='button' href='#'><div class='infobox-body'>"+i.innerHTML+"<\/div><\/a><\/div>",t.entity.infoboxHtml=r)})},i.prototype._getSegmentParam=function(){return"restaurant"},i.prototype._getTextAdsCode=function(){return null},i}(ut),hu=function(){function n(){}return n.prototype.createBar=function(n){var r=new gu([],!1),u,t,f,i,e,o;if(!n||!n.categories&&!n.levels)return null;if(n.levels&&n.levels.length>0){for(u=new gt("bm_level","bm_level","Level",0,5),t=0;t<n.levels.length;t++){var s=n.levels[t],h=s.getName(),c=new ct(t.toString(),h,null,t===n.defaultFloor);u.addOption(c)}r.addItem(u)}if(n.categories&&n.categories.length>0){for(f=new gt("bm_category","bm_category","Category",0,5),i=0;i<n.categories.length;i++)e=n.categories[i],o=new ct(i.toString(),e),f.addOption(o);r.addItem(f)}return r.getItemsNumber()===0?null:r},n}(),vt=function(){function n(){}return n.logFilterBarInteraction=function(n,t,i,r){var o={logData:{feature:"FSB",action:t,data:{EP:u.VenueMap,ID:n,IT:i,DN:r}}};e.invokeHandler(f.instrumentationDataHandlerKey,o)},n.logBusinessClick=function(n,t,i){var r={logData:{feature:st.VenueMap,action:"C",data:{EP:t,ID:n,YP:i,IM:c.isMobile}}};e.invokeHandler(f.instrumentationDataHandlerKey,r)},n.logMobileActivation=function(n){var t={logData:{feature:st.VenueMap,action:"A",data:{EP:u.SerpAnswer,ID:n}}};e.invokeHandler(f.instrumentationDataHandlerKey,t)},n.logMobileViewToggle=function(n,t){var i={logData:{feature:st.VenueMap,action:"C",data:{TG:"ViewToggle",ID:n,TL:t}}};e.invokeHandler(f.instrumentationDataHandlerKey,i)},n}(),cu=function(n){function f(t,i,u,f){var e=this,s={},h,o;return e=n.call(this,s,u,i)||this,s.defineProperty("entities"),e._map=t,e.controlTemplateFactory=u,e.resources=r,e._businessYpidDictionary={},e._selecteDirectoryBusiness=null,e._venueMap=f.venueMap,e._venueMapTask=f,h=e._venueMap.defaultFloor,o=e._venueMap.floors.filter(function(n){return n.getName()===h}),e.activeFloor=o.length>0&&o[0],e.entities=new ri,e._lang=c.dynamicProperties.market.split("-")[0].toLowerCase(),e._setPrimitiveDictionaries(),e._createUIElements(),e}return y(f,n),f.prototype._setPrimitiveDictionaries=function(){var r={},u,s,t,f,h,i,e,n,o;for(this.categories=[],u=this._venueMap.floors,s=u.length,t=0;t<s;t++)for(f=u[t].getPrimitives(),h=f.length,i=0;i<h;i++)e=f[i],n=e.metadata,n&&n.ypid&&n.category&&(!this.activeCategory||n.category===this.activeCategory)&&(this._businessYpidDictionary[n.ypid]=e,r[n.category]=!0);for(o in r)r[o]&&this.categories.push(o);this.categories.sort()},f.prototype._createUIElements=function(){this.name=this._venueMap.name;this._updateEntityList();this._createFiltersBar()},f.prototype._updateEntityList=function(){var r=this,t,i,n;if(this.entities.clear(),this.activeFloor)this._venueMap.setActiveFloor(this.activeFloor.getName()),this._addBusinessesToList(this.activeFloor);else{for(t=this._venueMap.floors,i=t.length,n=0;n<i;n++)this._addBusinessesToList(t[n]);this._venueMap.setActiveFloor(this._venueMap.defaultFloor)}this.updateNoEntityMessage();this._map.getTemplateSelector().then(function(){r._venueMapTask.directoryUpdated.invoke()})},f.prototype._addBusinessesToList=function(n){for(var r,t,u=n.getPrimitives(),f=u.length,i=0;i<f;i++)r=u[i],t=r.metadata,t&&t.ypid&&t.category&&(!this.activeCategory||t.category===this.activeCategory)&&(t.name=r.getTitle(),t.taskInfo=t.ypid&&this._buildEntityDataTask(t),this.entities.insert(t))},f.prototype.toggleSelectedBusiness=function(n){var t="bm_selected";this._selecteDirectoryBusiness&&this._selecteDirectoryBusiness.remove_class(t);n&&(n.add_class(t),this._selecteDirectoryBusiness=n)},f.prototype.onBusinessClick=function(n){var i=t(n.currentTarget?n.currentTarget:n);this.toggleSelectedBusiness(i);vt.logBusinessClick(this._venueMapTask.venueMapState.venueMapId,u.TaskCard,this._getYpidFromBusiness(i))},f.prototype.onBusinessMouseOver=function(n){var f,r;if(this._map.getMercatorZoomLevel()>=15&&!c.isMobile){var e=t(n.currentTarget||n),u=this._getYpidFromBusiness(e),i=u&&this._businessYpidDictionary[u];i&&(i.setState(3),f=i.metadata.polygon,r=new Microsoft.Maps.Polyline(f.getLocations(),{strokeColor:"rgb(0, 0, 0)"}),this._venueMap.activeFloorLayer.add(r),this._hoveredEntityInfo={primitive:i,highlightPolyline:r})}},f.prototype._getYpidFromBusiness=function(n){var t=n&&n.get_attr("data-task"),i=t&&t.length>0&&JSON.parse(t),r=i&&i.state&&i.state.id;return r&&r.substring(5)},f.prototype._buildEntityDataTask=function(n){var i={},t={};return t.entryPoint="LocalListing",t.id="ypid:"+n.ypid,t.flippingCard=!0,t.taskTitle=n.name.replace(/\n/g," "),t.originalName=t.taskTitle,t.selectedCategoryId=n.category,i.state=t,i.type=s.localDetailsTask,i.activateOptions={},i.activateOptions.parentId=this._venueMapTask.id,JSON.stringify(i)},f.prototype._createFiltersBar=function(){var n=this;this._filterBarViewModel=new du(this.controlTemplateFactory);var t=this._venueMap.floors.filter(function(t){return t.getName()===n.activeFloor.getName()}),i={categories:this.categories,levels:this._venueMap.floors,defaultFloor:this._venueMap.floors.indexOf(t[0])},r=new hu;this._filtersBar=r.createBar(i);this._filterBarViewModel.filterItemDiscardedFromSelection.add(function(t){var i=n._venueMapTask.venueMapState.venueMapId;t.id==="bm_level"?(vt.logFilterBarInteraction(i,"R",t.displayName,n.activeFloor.getName()),n.entities.clear(),n.activeFloor=null):t.id==="bm_category"&&(vt.logFilterBarInteraction(i,"R",t.displayName,n.activeCategory),n.activeCategory=null,n._venueMap.setBusinessCategoryFilters([]));n._updateEntityList()});this._filterBarViewModel.filterOptionClicked.add(function(t){var r=n._venueMapTask.venueMapState.venueMapId,i=t.item,u=parseInt(t.value);i.id==="bm_level"?(n.entities.clear(),n.activeFloor=n._venueMap.floors[u],vt.logFilterBarInteraction(r,"SE",i.displayName,n.activeFloor.getName())):i.id==="bm_category"&&(n.activeCategory=n.categories[u],n._venueMap.setBusinessCategoryFilters([n.activeCategory]),vt.logFilterBarInteraction(r,"SE",i.displayName,n.activeCategory));n._updateEntityList()})},f.prototype.showFiltersBar=function(){var n=i._isFeatureEnabled("mobileMyPlaces")?t("#venueFilterContainer"):this._venueMapTask.panelRoot.select("div[class=bm_filtersBarModule]");typeof n!="undefined"&&this._filterBarViewModel.update(this._filtersBar,n)},f.prototype.updateNoEntityMessage=function(){var n=this;this._map.getTemplateSelector().then(function(){var t=n._venueMapTask.panelRoot.select(".bm_noEntityMessage");t&&(t.set_style({display:n.entities.length>0?"none":""}),t.set_text(n.activeFloor&&n.activeFloor.hasRichDetailsPois?n.resources.L_VenueMapTask_NoCategory_Message:n.resources.L_VenueMapTask_NoEntity_Message))})},f.prototype.onBusinessMouseOut=function(){if(this._hoveredEntityInfo){var n=this._hoveredEntityInfo.primitive;n.setState(2);this._venueMap.activeFloorLayer.remove(this._hoveredEntityInfo.highlightPolyline);this._hoveredEntityInfo=null}},f._iconDictionary={},f}(yt),se=function(n){function o(t,i){var u=n.call(this)||this;return u.map=t,u.type=s.venueMapDirectoryTask,u._controlTemplateFactory=i,u.resources=r,u.scrollLane=new g,u.venueMapLoaded=new g,u.directoryUpdated=new g,u}return y(o,n),o.prototype.activate=function(t,i){var r=this,u;i||this.deactivate();n.prototype.activate.call(this,t);u=t.getContainer();this.setTitle(this.resources.L_VenueMapTaskTitle_Suffix+i.title);this.venueMapState=i;u.downloadDependency("VenueMap",function(){r._venueMapFactoryType=Microsoft.Maps.VenueMaps.VenueMapFactory;var n=new r._venueMapFactoryType(t);n.create({venueMapId:r.venueMapState.venueMapId,businessClickedHandler:function(n){r._handleBusinessClick(n)},success:function(n){r.initVenueMap(n)}})});this.setPercentLoaded(1)},o.prototype.initVenueMap=function(n){var r=this,t,u,f;this.venueMap=n;this.venueMap.setActiveFloor(this.venueMap.defaultFloor);this.setTitle(this.resources.L_VenueMapTaskTitle_Suffix+this.venueMap.name);this._viewModel=new cu(this.map,i._isFeatureEnabled("mobileMyPlaces")?dr:kr,this._controlTemplateFactory,this);this.panelRoot.clear();this.changed.add(function(n){if(n&&n.name&&n.name==="displayState"&&n.newValue!==n.oldValue){var t=n.newValue,i=n.oldValue;t&&t.activationState!==3?r.venueMap.show():r.venueMap.hide()}});this.displayState.activationState===3?this.venueMap.hide():this.venueMap.show();t=n.bestMapView;u=ft.constructView(this.map,t.center,Math.round(t.zoom));this.map.setView(u);f=new dt(i._isFeatureEnabled("mobileMyPlaces")?dr:kr,this._viewModel).applyDataTemplate(this._viewModel);this.addControl(f);this._viewModel.showFiltersBar();this._viewModel.updateNoEntityMessage();this.venueMapLoaded.invoke()},o.prototype.setDisplayState=function(t){t.activationState===1&&this._viewModel&&this._viewModel.toggleSelectedBusiness(null);n.prototype.setDisplayState.call(this,t)},o.prototype.deactivate=function(){var t,i;n.prototype.deactivate.call(this);t=this.venueMap&&this.venueMap.getActiveFloor();t&&(i=this.venueMap.floors.filter(function(n){return t===n.getName()}),this.map.getLayers().remove(i[0]));this._viewModel&&this._viewModel.entities.clear();this._viewModel&&this._viewModel.dispose();this.venueMap&&this.venueMap.dispose();n.prototype.deactivate.call(this)},o.prototype.close=function(){var n={action:"remove",id:this.id};e.invokeHandler(f.taskDataHandlerKey,n)},o.prototype.serialize=function(){return this.venueMapState},o.prototype.processCallback=function(){return},o.prototype.getCardIconInfo=function(){var n=o._cardIconCatIdMapping[this.venueMapState&&this.venueMapState.venueMapType]||o._cardIconCatIdMapping["default"];return{iconClass:"vmTask",iconElements:this.getCardIcons(n)}},o.prototype.getIconColorAndClassName=function(n){var t=o._cardIconCatIdMapping[this.venueMapState&&this.venueMapState.venueMapType]||o._cardIconCatIdMapping["default"];this._buildCardIcon(null,t,function(t){n(t,"venueMapTask")})},o.prototype.isSharable=function(){return!1},o.prototype.getListingFromPushpin=function(n){var o=null,s=n&&n.metadata&&n.metadata.ypid,u,r,f,e;if(s)for(u=this.panelRoot.select(i._isFeatureEnabled("mobileMyPlaces")?".bm_venueEntity":"#bm_venueEntity"),r=0;r<u.length;r++)if(f=u[r],e=f.getAttribute("data-task"),e&&e.indexOf(s)>=0){o=t(f);break}return o},o.prototype._handleBusinessClick=function(n){var t=n.primitive,i=this.getListingFromPushpin(t),r;i&&(r=t&&t.metadata&&t.metadata.ypid,this.scrollLane.invoke(i),this._viewModel&&this._viewModel.toggleSelectedBusiness(i),e.invokeHandler(f.taskDataHandlerKey,JSON.parse(i.get_attr("data-task"))),vt.logBusinessClick(this.venueMapState.venueMapId,u.POI,r))},o._cardIconCatIdMapping={Airport:"91621",Mall:"90771","default":"91600"},o}(h),lu=function(n){function t(t,i,u,f,e){var o=this,s={},h,c;for(o=n.call(this,s,i,wi)||this,o._controlTemplateFactory=i,s.defineProperty("printEntities"),s.defineProperty("listHours"),s.defineProperty("wikiText"),s.defineProperty("printFacts"),o._entities=[],o._openHours=[],o._printFacts=[],o.resources=r,o._dataFacts=f,h=0;h<u.length;h++)c=new bi(u[h]),o._entities.push(c);return o.createHoursTemplate(),o._setPrintFacts(),o.setListHours(o._openHours),o.setPrintFacts(o._printFacts),o._entities&&o._entities.length&&o._entities[0].getTitle()!==e&&(o._entities[0].originalName=e),o.setPrintEntities(o._entities),o}return y(t,n),t.prototype.hideIfMatchedData=function(n){return n===null&&this._entities[0].getTitle()===n?"none":""},t.prototype.createHoursTemplate=function(){var t,e,o,s,l,u,v,h,a;if(this._dataFacts&&this._dataFacts.openHours!==undefined)for(t=0;t<this._dataFacts.openHours.length;t++){var f=new ou,n=[],r=[];for(e=0;e<this._dataFacts.openHours[t].hoursRanges.length;e++)if(o=this._dataFacts.openHours[t].hoursRanges[e].start,s=this._dataFacts.openHours[t].hoursRanges[e].end,o!=s){f.setDay(this._dataFacts.openHours[t].day);o=o.split(":");s=s.split(":");var c=new eu,y=i._formatShortTimeString(Number(o[0]),Number(o[1]),0),p=i._formatShortTimeString(Number(s[0]),Number(s[1]),0);c.setStart(y);c.setEnd(p);n.push(c);e>=0&&this._openHours.length>0&&(r=this._openHours[this._openHours.length-1].getHourRanges())}if(r&&r.length>0&&n&&n.length>0&&r.length===n.length){for(l=!1,u=0;u<r.length;u++)(r[u].getStart()!==n[u].getStart()||r[u].getEnd()!==n[u].getEnd())&&(l=!0);l?(f.setHourRanges(n),this._openHours.push(f)):(v=f.getDay(),h=this._openHours[this._openHours.length-1].getDay(),h.indexOf("-")>0&&(a=[],a=h.split("-"),h=a[0].trim()),this._openHours[this._openHours.length-1].setDay(h+" - "+v))}else n&&n.length>0&&(f.setHourRanges(n),this._openHours.push(f))}},t.prototype._setPrintFacts=function(){if(this._entities[0].getLocation()&&!this._entities[0].id.toUpperCase().match("YPID")&&(this._entities[0].getLocationType()==="State"||this._entities[0].getLocationType()==="StreetAddress"||this._entities[0].getLocationType()==="County")){var n=this._entities[0].getLocation(),t=n.latitude.toString()+", "+n.longitude.toString();this._pushFactsIntoList(r.L_PrintExtendedLatLong_Text,t)}this._dataFacts&&(this._dataFacts.website&&!this._entities[0].getWebsite()&&this._entities[0].setWebsite(this._dataFacts.website),this._dataFacts.phone&&!this._entities[0].getPhone()&&this._entities[0].setPhone(this._dataFacts.phone),gi.parseAndPushDataFactForPrint(this._dataFacts,this._printFacts))},t.prototype._pushFactsIntoList=function(n,t,i){var r=gi.setFactsInfo(this._printFacts,n,t,i);r&&this._printFacts.push(r)},t}(yt),au=function(n){function i(i,r,u,f,e){var o=this,v={},c,s,p,h,y,a;for(o=n.call(this,v,r,wi)||this,o._controlTemplateFactory=r,v.defineProperty("printEntities"),v.defineProperty("printEntitiesList2"),o._entities1=[],o._entities2=[],c=e?e.select("a.listings-item"):null,s=0;s<u.length;s++)u[s].entity.iconText=(s+1).toString(),p=u[s].entity,h=new bi(p),o.setPrintIconTextAndColor(h,s,f),c&&s<c.length&&(y=t(c[s]).get_attr("data-facts"),y&&(a=[],o.setPrintFactsForEntity(l.parseDataFact(y),a),a.length>0&&(h.printFacts=a))),s%2==0?o._entities1.push(h):o._entities2.push(h);return o.setPrintEntities(o._entities1),o.setPrintEntitiesList2(o._entities2),o}return y(i,n),i.prototype.hideIfMatchedData=function(n){return n&&n.getAddress()===null||n.getTitle()===n.getAddress()?"none":""},i.prototype.setPrintIconTextAndColor=function(n,t,i){n.iconText=(t+1).toString();n.colorIndex=i},i.prototype.setPrintFactsForEntity=function(n,t){gi.parseAndPushDataFactForPrint(n,t)},i}(yt),he=function(n){function i(t,i,r,u,f,e,o){return n.call(this,t,i,r,u,f,e,o)||this}return y(i,n),i.prototype.setResponseContent=function(t,i){var r=this;(n.prototype.setResponseContent.call(this,t,i),t&&this.panelRoot)&&(this._zipCodes=[],this._zipCodePolygonDownloadCompleted=!1,this.zipCodePolygonsDownloaded=new g,this.zipCodePolygonsDownloaded.add(function(){r._zipCodePolygonDownloadCompleted=!0}),this._getZipCodePolygonsFromResponse(t,i))},i.prototype.registerListItemEvents=function(){var n=this;this._zipCodePolygonDownloadCompleted?this._handlerHoverEvents():this.zipCodePolygonsDownloaded.add(function(){n._handlerHoverEvents()})},i.prototype.parseEntitiesFromResponse=function(){return{entities:[],pushpins:[]}},i.prototype._shouldPaginate=function(n){return!n||n.length<=this._paginationItemsPerPage?!1:!0},i.prototype._paginationSetDisplayForItems=function(n,t,i,r){var u,f,e;if(n&&!(n.length<=this._paginationItemsPerPage)){for(u=0,f=n.length;u<f;u++)e=Math.floor(u/this._paginationItemsPerPage)+1===t,e?n[u].removeAttribute("style"):n[u].style.display="none";r&&r()}},i.prototype._handlerHoverEvents=function(){var t=this,n;this._registerListItemEventsForZipCodes();n=this._poiManager.getLayer();n?Microsoft.Maps.Internal.CityPolygonManager.bindPostCodeLayerHandlers(n,this.map):this._poiManager.primitivesRendered.addOne(function(){n=t._poiManager.getLayer();Microsoft.Maps.Internal.CityPolygonManager.bindPostCodeLayerHandlers(n,t.map)})},i.prototype._getZipCodePolygonsFromResponse=function(n){var t=this,i=n.select(this._selector);i.for_each(function(n){var i=t._findZipCodeInItem(n,!0);i&&i.length>0&&t._zipCodes.indexOf(i)<0&&t._zipCodes.push(i)});this._zipCodes.length>0&&this.map.getCityPolygonManager().then(function(){Microsoft.Maps.Internal.CityPolygonManager.populatePostCodeLayer(t.map,null,t._zipCodes,function(n){t._poiManager.setPrimitives(n);t._primitives=n;t.zipCodePolygonsDownloaded.invoke()},!0)})},i.prototype._registerListItemEventsForZipCodes=function(){var n=this,r=this.panelRoot.select("a[data-entity]"),i=Microsoft.Maps.Internal.CityPolygonManager;r.for_each(function(r){var o=n._findZipCodeInItem(r),u,f,h,c,e;if(o&&o.length>0){for(f=0,h=n._primitives.length;f<h;f++)if(c=n._primitives[f],e=c.metadata,e&&o.indexOf(e.title)>=0&&!e.polygon){u=n._primitives[f];break}if(u){var s=t(r),l=function(){i.handlePostCodePrimitiveHover({eventName:"mouseover",layer:n._poiManager.getLayer(),primitive:u});n._entityCardHoverStartTime=Date.now()},a=function(){i.handlePostCodePrimitiveHover({eventName:"mouseout",layer:n._poiManager.getLayer(),primitive:u});n._logEntityCardHoverIfNecessary(u.entity)};s.add_event("mouseenter",l).add_event("mouseleave",a);n._addEventsToEventList(s,"mouseenter",l);n._addEventsToEventList(s,"mouseleave",a)}}})},i.prototype._findZipCodeInItem=function(n,i){var r,e=n.getAttribute("data-entity"),u,f;return e&&e.length>0?(u=t.Internals.parseJSON(e),u&&u.entity&&(r=u.entity.title)):(f=n.getElementsByClassName("b_factrow"),f&&f.length>0&&(r=f[0].innerHTML)),i&&(r=r.trim().split("-")[0]),r},i}(ci),vu=function(n){function t(t,i,u,f,e,o){var s=this,h={};return s=n.call(this,h,t,yf)||this,h.defineProperty("showSeeMore"),s._listingTask=f,s._totalResultCount=e,s._wfrGridId=o,s.setShowSeeMore(!1),s._offset=0,s._initialItemsCount=u,s._paginationItemsPerPage=i,s.resources=r,s._enableInfiniteScrolling=s._totalResultCount>s._paginationItemsPerPage?!0:!1,sj_evt.bind("customScrolled",function(){s._sendPaginationRequest()}),s}return y(t,n),t.prototype.seeMoreClicked=function(n){n&&(n.stopPropagation(),n.preventDefault());this._offset+=this._paginationItemsPerPage;this._infiniteScrollRequestSent=!0;this._listingTask.sendPaginationRequest(this._offset,this._paginationItemsPerPage,this,!0)},t.prototype.updateDisplayState=function(n,t,i){var r=!1,u,f,e;return this.setShowSeeMore(!1),i&&i.length&&(u=this._listingTask.panelRoot.select("[data-answerinfo]").get_attr("data-answerinfo"),f=i.select("[data-answerinfo]").get_attr("data-answerinfo"),u===f&&(e=i.select("a.listings-item"),sj_evt.fire("onemapdomupd",this._wfrGridId,e),r=!0)),n>0&&(this._enableInfiniteScrolling=n<this._paginationItemsPerPage||t||this._totalResultCount&&n+this._offset>=this._totalResultCount?!1:!0),n===0&&this._infiniteScrollRequestSent&&this._offset>=this._paginationItemsPerPage&&(this._offset-=this._paginationItemsPerPage),this._infiniteScrollRequestSent=!1,r},t.prototype._sendPaginationRequest=function(){var n,i,t;this._enableInfiniteScrolling&&!this._infiniteScrollRequestSent&&(n=this._listingTask.viewModel.getDomEntities(),n&&n.length&&n.length-4>0&&(i=n[n.length-4],t=i.getBoundingClientRect(),t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)&&(this._offset+=this._paginationItemsPerPage,this._initialItemsCount<this._totalResultCount&&this._initialItemsCount===18&&(this._offset=this._offset-32,this._initialItemsCount=0),this._infiniteScrollRequestSent=!0,this._listingTask.sendPaginationRequest(this._offset,this._paginationItemsPerPage,this,!0))))},t}(yt),yu=function(n){function t(t,i,u,f){var e=this,o={};return e=n.call(this,o,t,pf)||this,o.defineProperty("showLeftChevron"),o.defineProperty("showRightChevron"),e._listingTask=u,e._totalResultCount=f,e.setShowLeftChevron(!1),e.setShowRightChevron(!0),e._offset=0,e._paginationItemsPerPage=i,e.resources=r,e}return y(t,n),t.prototype.leftChevronClicked=function(n){n&&(n.stopPropagation(),n.preventDefault());this._offset>=this._paginationItemsPerPage&&(this._offset-=this._paginationItemsPerPage,this._listingTask.sendPaginationRequest(this._offset,this._paginationItemsPerPage,this));this._offset===0&&this.setShowLeftChevron(!1)},t.prototype.rightChevronClicked=function(n){n&&(n.stopPropagation(),n.preventDefault());this._offset+=this._paginationItemsPerPage;this._rightChevronRequestSent=!0;this._listingTask.sendPaginationRequest(this._offset,this._paginationItemsPerPage,this)},t.prototype.seeMoreClicked=function(n){n&&(n.stopPropagation(),n.preventDefault());this._offset+=this._paginationItemsPerPage;this._rightChevronRequestSent=!0;this._listingTask.sendPaginationRequest(this._offset,this._paginationItemsPerPage,this)},t.prototype.updateDisplayState=function(n,t){return n>0&&(n<this._paginationItemsPerPage||t||this._totalResultCount&&n+this._offset>=this._totalResultCount?this.setShowRightChevron(!1):this.setShowRightChevron(!0)),n===0&&this._rightChevronRequestSent&&this._offset>=this._paginationItemsPerPage&&(this._offset-=this._paginationItemsPerPage),this._offset>0?this.setShowLeftChevron(!0):this.setShowLeftChevron(!1),this._rightChevronRequestSent=!1,!0},t}(yt);a.HotelsDetailsTask=uu;a.HotelsListingTask=ki;a.HouseDetailsTask=ne;a.HouseListingTask=di;a.PolygonListingTask=ee;a.RestaurantDetailsTask=oe;a.RestaurantsListingTask=ai;a.AnnotationControl=gr;a.DirectoryFilterBarFactory=hu;a.GeochainListViewModel=tu;a.LocalDetailsPageProcessor=te;a.LocalDetailsPrintViewModel=lu;a.LocalDetailsTask=rt;a.LocalListingPageProcessor=fu;a.LocalListingPrintViewModel=au;a.LocalListingTask=ut;a.LocalPrintEntity=bi;a.LocalPrintFacts=li;a.LocalPrintHourRange=eu;a.LocalPrintOpenHours=ou;a.LocalSearchTask=l;a.LogHelper=iu;a.PolygonEntityDetailsTask=ue;a.PolygonListingPageProcessor=fe;a.ResponseIntentProcessor=k;a.ServerPaginationViewModel=yu;a.InfiniteScrollPaginationViewModel=vu;a.VenueMapLogHelper=vt;a.VenueMapTask=se;a.VenueMapTaskViewModel=cu}catch(pu){if(o.logger)o.logger.logCriticalError(pu);else throw pu;}}).call(window)